/*! For license information please see client-bot.js.LICENSE.txt?35a39c8241424ff1914d */
!function(e,t){for(var n in t)e[n]=t[n]}(window,function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=38)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"f",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return u}));var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},r(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},s.apply(this,arguments)};function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}},,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return u}));var r=n(20),i=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function s(e){return"tracesSampleRate"in e||"tracesSampler"in e}function a(e){var t=e.match(i);if(t){var n=void 0;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}}function o(e){var t,n;return void 0===e&&(e=Object(r.c)()),null===(n=null===(t=e)||void 0===t?void 0:t.getScope())||void 0===n?void 0:n.getTransaction()}function c(e){return e/1e3}function u(e){return 1e3*e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(6),i=Object(r.e)(),s="Sentry Logger ",a=function(){function e(){this._enabled=!1}return e.prototype.disable=function(){this._enabled=!1},e.prototype.enable=function(){this._enabled=!0},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&Object(r.c)((function(){i.console.log(s+"[Log]: "+e.join(" "))}))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&Object(r.c)((function(){i.console.warn(s+"[Warn]: "+e.join(" "))}))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&Object(r.c)((function(){i.console.error(s+"[Error]: "+e.join(" "))}))},e}();i.__SENTRY__=i.__SENTRY__||{};var o=i.__SENTRY__.logger||(i.__SENTRY__.logger=new a)},function(e,t,n){"use strict";function r(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return g(e,Error)}}function i(e){return"[object ErrorEvent]"===Object.prototype.toString.call(e)}function s(e){return"[object DOMError]"===Object.prototype.toString.call(e)}function a(e){return"[object DOMException]"===Object.prototype.toString.call(e)}function o(e){return"[object String]"===Object.prototype.toString.call(e)}function c(e){return null===e||"object"!=typeof e&&"function"!=typeof e}function u(e){return"[object Object]"===Object.prototype.toString.call(e)}function l(e){return"undefined"!=typeof Event&&g(e,Event)}function d(e){return"undefined"!=typeof Element&&g(e,Element)}function h(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function f(e){return Boolean(e&&e.then&&"function"==typeof e.then)}function p(e){return u(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function g(e,t){try{return e instanceof t}catch(e){return!1}}n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return a})),n.d(t,"k",(function(){return o})),n.d(t,"i",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"j",(function(){return h})),n.d(t,"m",(function(){return f})),n.d(t,"l",(function(){return p})),n.d(t,"g",(function(){return g}))},function(e,t,n){window,e.exports=function(){return n={},e.m=t=[function(e,t,n){(function(t){function n(e){return e&&e.Math==Math&&e}e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")()}).call(this,n(50))},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){n=n(5),e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){var r=n(0),i=n(36),s=n(1),a=n(23),o=n(39),c=(n=n(62),i("wks")),u=r.Symbol,l=n?u:u&&u.withoutSetter||a;e.exports=function(e){return s(c,e)||(o&&s(u,e)?c[e]=u[e]:c[e]=l("Symbol."+e)),c[e]}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(2),i=n(32),s=n(10),a=n(18),o=Object.defineProperty;t.f=r?o:function(e,t,n){if(s(e),t=a(t,!0),s(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(2),i=n(6),s=n(15);e.exports=r?function(e,t,n){return i.f(e,t,s(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(11),i=Math.min;e.exports=function(e){return 0<e?i(r(e),9007199254740991):0}},function(e,t,n){var r;"undefined"!=typeof window&&(r=function(){return n={},e.m=t={"./node_modules/eventemitter3/index.js":function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function s(){}function a(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,r,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");return s=new a(n,r||e,s),t=i?i+t:t,e._events[t]?e._events[t].fn?e._events[t]=[e._events[t],s]:e._events[t].push(s):(e._events[t]=s,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=this._events[i?i+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var n=0,r=t.length,s=new Array(r);n<r;n++)s[n]=t[n].fn;return s},u.prototype.listenerCount=function(e){return(e=this._events[i?i+e:e])?e.fn?1:e.length:0},u.prototype.emit=function(e,t,n,r,s,a){var o=i?i+e:e;if(!this._events[o])return!1;var c,u=this._events[o],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,r),!0;case 5:return u.fn.call(u.context,t,n,r,s),!0;case 6:return u.fn.call(u.context,t,n,r,s,a),!0}for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];u.fn.apply(u.context,c)}else for(var d,h=u.length,f=0;f<h;f++)switch(u[f].once&&this.removeListener(e,u[f].fn,void 0,!0),l){case 1:u[f].fn.call(u[f].context);break;case 2:u[f].fn.call(u[f].context,t);break;case 3:u[f].fn.call(u[f].context,t,n);break;case 4:u[f].fn.call(u[f].context,t,n,r);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u[f].fn.apply(u[f].context,c)}return!0},u.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,r){if(e=i?i+e:e,!this._events[e])return this;if(!t)return c(this,e),this;var s=this._events[e];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||c(this,e);else{for(var a=0,o=[],u=s.length;a<u;a++)(s[a].fn!==t||r&&!s[a].once||n&&s[a].context!==n)&&o.push(s[a]);o.length?this._events[e]=1===o.length?o[0]:o:c(this,e)}return this},u.prototype.removeAllListeners=function(e){return e?this._events[e=i?i+e:e]&&c(this,e):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,e.exports=u.EventEmitter=u},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,n){var r,i,s,a,o;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=o.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=o.normalizePath(r.path),o.buildURLFromParts(r)}if(!(r=o.parseURL(t)))throw new Error("Error trying to parse relative URL.");if(r.scheme)return n.alwaysNormalize?(r.path=o.normalizePath(r.path),o.buildURLFromParts(r)):t;if(!(t=o.parseURL(e)))throw new Error("Error trying to parse base URL.");var s;return!t.netLoc&&t.path&&"/"!==t.path[0]&&(s=i.exec(t.path),t.netLoc=s[1],t.path=s[2]),t.netLoc&&!t.path&&(t.path="/"),e={scheme:t.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment},r.netLoc||(e.netLoc=t.netLoc,"/"!==r.path[0]&&(r.path?(s=(s=t.path).substring(0,s.lastIndexOf("/")+1)+r.path,e.path=o.normalizePath(s)):(e.path=t.path,r.params||(e.params=t.params,r.query||(e.query=t.query))))),null===e.path&&(e.path=n.alwaysNormalize?o.normalizePath(r.path):r.path),o.buildURLFromParts(e)},parseURL:function(e){return(e=r.exec(e))?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/webworkify-webpack/index.js":function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",s="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,r){var o={};o[r]=[];var c=t.toString();if(!(t=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)))return o;t=t[1];for(var u,l=new RegExp("(\\\\n|\\W)"+a(t)+s,"g");u=l.exec(c);)"dll-reference"!==u[3]&&o[r].push(u[3]);for(l=new RegExp("\\("+a(t)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+s,"g");u=l.exec(c);)e[u[2]]||(o[r].push(u[1]),e[u[2]]=n(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);for(var d,h=Object.keys(o),f=0;f<h.length;f++)for(var p=0;p<o[h[f]].length;p++)d=o[h[f]][p],isNaN(+d)||(o[h[f]][p]=+o[h[f]][p]);return o}function c(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};function(e){return Object.keys(e).reduce((function(t,n){return t||0<e[n].length}),!1)}(n);)for(var s=Object.keys(n),a=0;a<s.length;a++){var c=s[a],u=n[c].pop();if(i[c]=i[c]||{},!i[c][u]&&e[c][u]){i[c][u]=!0,r[c]=r[c]||[],r[c].push(u);for(var l=o(e,e[c][u],c),d=Object.keys(l),h=0;h<d.length;h++)n[d[h]]=n[d[h]]||[],n[d[h]]=n[d[h]].concat(l[d[h]])}}return r}e.exports=function(e,t){var i={main:n.m},s=(t=t||{}).all?{main:Object.keys(i.main)}:c(i,e),a="";return Object.keys(s).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;s[e][t];)t++;s[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);",e=new window.Blob([a],{type:"text/javascript"}),t.bare||(t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(e),(e=new window.Worker(t)).objectURL=t),e}},"./src/crypt/decrypter.js":function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),i=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),s=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e,t=this.sBox,n=this.invSBox,r=(e=this.subMix)[0],i=e[1],s=e[2],a=e[3],o=(e=this.invSubMix)[0],c=e[1],u=e[2],l=e[3],d=new Uint32Array(256),h=0,f=0,p=0;for(p=0;p<256;p++)d[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var g=f^f<<1^f<<2^f<<3^f<<4;t[h]=g=g>>>8^255&g^99;var m=d[n[g]=h],v=d[m],y=d[v],b=257*d[g]^16843008*g;r[h]=b<<24|b>>>8,i[h]=b<<16|b>>>16,s[h]=b<<8|b>>>24,a[h]=b,o[g]=(b=16843009*y^65537*v^257*m^16843008*h)<<24|b>>>8,c[g]=b<<16|b>>>16,u[g]=b<<8|b>>>24,l[g]=b,h?(h=m^d[d[d[y^m]]],f^=d[d[f]]):h=f=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);for(var s,a,o,c=this.ksRows=4*(i+6+1),u=this.keySchedule=new Uint32Array(c),l=this.invKeySchedule=new Uint32Array(c),d=this.sBox,h=this.rcon,f=(e=this.invSubMix)[0],p=e[1],g=e[2],m=e[3],v=0;v<c;v++)v<i?a=u[v]=t[v]:(o=a,v%i==0?(o=d[(o=o<<8|o>>>24)>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o],o^=h[v/i|0]<<24):6<i&&v%i==4&&(o=d[o>>>24]<<24|d[o>>>16&255]<<16|d[o>>>8&255]<<8|d[255&o]),u[v]=a=(u[v-i]^o)>>>0);for(s=0;s<c;s++)v=c-s,o=3&s?u[v]:u[v-4],l[s]=s<4||v<=4?o:f[d[o>>>24]]^p[d[o>>>16&255]]^g[d[o>>>8&255]]^m[d[255&o]],l[s]=l[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n,r){for(var i,s,a,o,c,u,l,d,h,f,p,g,m,v,y=this.keySize+6,b=this.invKeySchedule,w=this.invSBox,_=this.invSubMix,E=_[0],T=_[1],S=_[2],I=_[3],k=(n=this.uint8ArrayToUint32Array_(n))[0],A=n[1],O=n[2],x=n[3],C=new Int32Array(e),R=new Int32Array(C.length),D=this.networkToHostOrderSwap;t<C.length;){for(h=D(C[t]),f=D(C[t+1]),p=D(C[t+2]),g=D(C[t+3]),c=h^b[0],u=g^b[1],l=p^b[2],d=f^b[3],m=4,v=1;v<y;v++)i=E[c>>>24]^T[u>>16&255]^S[l>>8&255]^I[255&d]^b[m],s=E[u>>>24]^T[l>>16&255]^S[d>>8&255]^I[255&c]^b[m+1],a=E[l>>>24]^T[d>>16&255]^S[c>>8&255]^I[255&u]^b[m+2],o=E[d>>>24]^T[c>>16&255]^S[u>>8&255]^I[255&l]^b[m+3],c=i,u=s,l=a,d=o,m+=4;i=w[c>>>24]<<24^w[u>>16&255]<<16^w[l>>8&255]<<8^w[255&d]^b[m],s=w[u>>>24]<<24^w[l>>16&255]<<16^w[d>>8&255]<<8^w[255&c]^b[m+1],a=w[l>>>24]<<24^w[d>>16&255]<<16^w[c>>8&255]<<8^w[255&u]^b[m+2],o=w[d>>>24]<<24^w[c>>16&255]<<16^w[u>>8&255]<<8^w[255&l]^b[m+3],m+=3,R[t]=D(i^k),R[t+1]=D(o^A),R[t+2]=D(a^O),R[t+3]=D(s^x),k=h,A=f,O=p,x=g,t+=4}return r?(r=(e=(n=R.buffer).byteLength)&&new DataView(n).getUint8(e-1))?n.slice(0,e-r):n:R.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),a=n("./src/errors.ts"),o=n("./src/utils/logger.js"),c=n("./src/events.js"),u=(n=n("./src/utils/get-self-scope.js"),Object(n.getSelfScope)());t.default=function(){function e(e,t,n){if(n=void 0===(n=(void 0===n?{}:n).removePKCS7Padding)||n,this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=n)try{var r=u.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,n,a){var c,u,l=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(o.logger.log("JS AES decrypt"),this.logEnabled=!1),(c=this.decryptor)||(this.decryptor=c=new s),c.expandKey(t),a(c.decrypt(e,0,n,this.removePKCS7Padding))):(this.logEnabled&&(o.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1),u=this.subtle,this.key!==t&&(this.key=t,this.fastAesKey=new i(u,t)),this.fastAesKey.expandKey().then((function(i){new r(u,n).decrypt(e,i).catch((function(r){l.onWebCryptoError(r,e,t,n,a)})).then((function(e){a(e)}))})).catch((function(r){l.onWebCryptoError(r,e,t,n,a)})))},t.onWebCryptoError=function(e,t,n,r,i){this.config.enableSoftwareAES?(o.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,r,i)):(o.logger.error("decrypting error : "+e.message),this.observer.trigger(c.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}()},"./src/demux/demuxer-inline.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.js"),i=n("./src/errors.ts"),s=n("./src/crypt/decrypter.js"),a=n("./src/polyfills/number.js"),o=n("./src/utils/logger.js"),c=n("./src/utils/get-self-scope.js");function u(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function h(e,t){return!!(t+1<e.length&&u(e,t))}function f(e,t,n,s,a){e.samplerate||(a=function(e,t,n,s){var a,c,u=navigator.userAgent.toLowerCase(),l=s,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],h=1+((192&t[n+2])>>>6),f=(60&t[n+2])>>>2;if(!(d.length-1<f))return a=(1&t[n+2])<<2,a|=(192&t[n+3])>>>6,o.logger.log("manifest codec:"+s+",ADTS data:type:"+h+",sampleingIndex:"+f+"["+d[f]+"Hz],channelConfig:"+a),s=/firefox/i.test(u)?6<=f?(h=5,c=new Array(4),f-3):(h=2,c=new Array(2),f):-1!==u.indexOf("android")?(h=2,c=new Array(2),f):(h=5,c=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&6<=f?f-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(6<=f&&1==a||/vivaldi/i.test(u))||!s&&1==a)&&(h=2,c=new Array(2)),f)),c[0]=h<<3,c[0]|=(14&f)>>1,c[1]|=(1&f)<<7,c[1]|=a<<3,5===h&&(c[1]|=(14&s)>>1,c[2]=(1&s)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:d[f],channelCount:a,codec:"mp4a.40."+h,manifestCodec:l};e.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f})}(t,n,s,a),e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,o.logger.log("parsed codec:"+e.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount))}function p(e){return 9216e4/e}function g(e,t,n,r,i){var s=function(e,t,n,r,i){var s=e.length,a=l(e,t);if(e=d(e,t),0<(e-=a)&&t+a+e<=s)return{headerLength:a,frameLength:e,stamp:n+r*i}}(t,n,r,i,p(e.samplerate));if(s)return r=s.stamp,i=s.headerLength,s=s.frameLength,r={unit:t.subarray(n+i,n+i+s),pts:r,dts:r},e.samples.push(r),{sample:r,length:s+i}}var m=n("./src/demux/id3.js"),v=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(m.default.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(function(e,t){if(h(e,t)){var n=l(e,t);if(t+n>=e.length)return;var r=d(e,t);if(r<=n)return;if((r=t+r)===e.length||r+1<e.length&&u(e,r))return 1}}(e,t))return o.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=this._audioTrack,s=m.default.getID3Data(e,0)||[],c=m.default.getTimeStamp(s),u=Object(a.isFiniteNumber)(c)?90*c:9e4*t,l=0,d=u,p=e.length,v=s.length,y=[{pts:d,dts:d,data:s}];v<p-1;)if(h(e,v)&&v+5<p){f(i,this.observer,e,v,i.manifestCodec);var b=g(i,e,v,u,l);if(!b){o.logger.log("Unable to parse AAC frame");break}v+=b.length,d=b.sample.pts,l++}else m.default.isHeader(e,v)?(s=m.default.getID3Data(e,v),y.push({pts:d,dts:d,data:s}),v+=s.length):v++;this.remuxer.remux(i,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),y=n("./src/demux/mp4demuxer.js"),b={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,r,i){if(!(n+24>t.length)){var s=this.parseHeader(t,n);if(s&&n+s.frameLength<=t.length)return i=r+i*(9e4*s.samplesPerFrame/s.sampleRate),i={unit:t.subarray(n,n+s.frameLength),pts:i,dts:i},e.config=[],e.channelCount=s.channelCount,e.samplerate=s.sampleRate,e.samples.push(i),{sample:i,length:s.frameLength}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,s=e[t+2]>>2&3,a=e[t+2]>>1&1;if(1!=n&&0!=i&&15!=i&&3!=s)return i=1e3*b.BitratesMap[14*(3==n?3-r:3==r?3:4)+i-1],s=b.SamplingRateMap[3*(3==n?0:2==n?1:2)+s],e=e[t+3]>>6==3?1:2,r=8*(t=b.SamplesCoefficients[n][r])*(n=b.BytesInSlot[r]),{sampleRate:s,channelCount:e,frameLength:parseInt(t*i/s+a,10)*n,samplesPerFrame:r}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n=this.parseHeader(e,t),r=4;if((r=t+(r=n&&n.frameLength?n.frameLength:r))===e.length||r+1<e.length&&this.isHeaderPattern(e,r))return!0}return!1}},w=b,_=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4);if(0===(t=Math.min(4,t)))throw new Error("no bytes available");r.set(e.subarray(n,n+t)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t},t.skipBits=function(e){var t;this.bitsAvailable>e||(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return 32<e&&o.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){for(var e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,n=8,r=0;r<e;r++)t=0===(n=0!==n?(t+this.readEG()+256)%256:n)?t:n},t.readSPS=function(){var e,t,n,r,i,s=0,a=0,o=0,c=0,u=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),h=this.readBoolean.bind(this),f=this.skipBits.bind(this),p=this.skipEG.bind(this),g=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(u(),e=u(),l(5),f(3),u(),g(),(100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e)&&(3===(i=d())&&f(1),g(),g(),f(1),h()))for(n=3!==i?8:12,r=0;r<n;r++)h()&&m(r<6?16:64);if(g(),0===(i=d()))d();else if(1===i)for(f(1),p(),p(),t=d(),r=0;r<t;r++)p();g(),f(1),i=d(),g=d(),0===(l=l(1))&&f(1),f(1),h()&&(s=d(),a=d(),o=d(),c=d());var v=[1,1];if(h()&&h())switch(u()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil(16*(i+1)-2*s-2*a),height:(2-l)*(g+1)*16-(l?2:4)*(o+c),pixelRatio:v}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),E=function(){function e(e,t,n,r){this.decryptdata=n,this.discardEPB=r,this.decrypter=new s.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,n,r){var i=e[t].unit,s=(s=i.subarray(16,i.length-i.length%16)).buffer.slice(s.byteOffset,s.byteOffset+s.length),a=this;this.decryptBuffer(s,(function(s){s=new Uint8Array(s),i.set(s,16),r||a.decryptAacSamples(e,t+1,n)}))},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<=e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(t.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,n,r,i,s){var a=this.discardEPB(i.data),o=this.getAvcEncryptedData(a),c=this;this.decryptBuffer(o.buffer,(function(o){i.data=c.getAvcDecryptedUnit(a,o),s||c.decryptAvcSamples(e,t,n+1,r)}))},t.decryptAvcSamples=function(e,t,n,r){for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var s=i[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,s,a),!a)return}}}},e}(),T={video:1,audio:2,id3:3,text:4},S=function(){function e(e,t,n,r){this.observer=e,this.config=n,this.typeSupported=r,this.remuxer=t,this.sampleAes=null,this.pmtUnknownTypes={}}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new E(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){return!((t=e._syncOffset(t))<0||(t&&o.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:T[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.append=function(t,n,s,a){var c,u,l,d,h,f=t.length,p=!1;this.pmtUnknownTypes={},this.contiguous=s;var g=this.pmtParsed,m=this._avcTrack,v=this._audioTrack,y=this._id3Track,b=m.pid,w=v.pid,_=y.pid,E=this._pmtId,T=m.pesData,S=v.pesData,I=y.pesData,k=this._parsePAT,A=this._parsePMT.bind(this),O=this._parsePES,x=this._parseAVCPES.bind(this),C=this._parseAACPES.bind(this),R=this._parseMPEGPES.bind(this),D=this._parseID3PES.bind(this),L=e._syncOffset(t);for(f-=(f+L)%188,c=L;c<f;c+=188)if(71===t[c]){if(u=!!(64&t[c+1]),l=((31&t[c+1])<<8)+t[c+2],1<(48&t[c+3])>>4){if((d=c+5+t[c+4])===c+188)continue}else d=c+4;switch(l){case b:u&&(T&&(h=O(T))&&x(h,!1),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,c+188)),T.size+=c+188-d);break;case w:u&&(S&&(h=O(S))&&(v.isAAC?C:R)(h),S={data:[],size:0}),S&&(S.data.push(t.subarray(d,c+188)),S.size+=c+188-d);break;case _:u&&(I&&(h=O(I))&&D(h),I={data:[],size:0}),I&&(I.data.push(t.subarray(d,c+188)),I.size+=c+188-d);break;case 0:u&&(d+=t[d]+1),E=this._pmtId=k(t,d);break;case E:u&&(d+=t[d]+1);var P=A(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(b=P.avc)&&(m.pid=b),0<(w=P.audio)&&(v.pid=w,v.isAAC=P.isAAC),0<(_=P.id3)&&(y.pid=_),p&&!g&&(o.logger.log("reparse from beginning"),p=!1,c=L-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(h=O(T))?(x(h,!0),m.pesData=null):m.pesData=T,S&&(h=O(S))?((v.isAAC?C:R)(h),v.pesData=null):(S&&S.size&&o.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=S),I&&(h=O(I))?(D(h),y.pesData=null):y.pesData=I,null==this.sampleAes?this.remuxer.remux(v,m,y,this._txtTrack,n,s,a):this.decryptAndRemux(v,m,y,this._txtTrack,n,s,a)},t.decryptAndRemux=function(e,t,n,r,i,s,a){var o;e.samples&&e.isAAC?(o=this).sampleAes.decryptAacSamples(e.samples,0,(function(){o.decryptAndRemuxAvc(e,t,n,r,i,s,a)})):this.decryptAndRemuxAvc(e,t,n,r,i,s,a)},t.decryptAndRemuxAvc=function(e,t,n,r,i,s,a){var o;t.samples?(o=this).sampleAes.decryptAvcSamples(t.samples,0,0,(function(){o.remuxer.remux(e,t,n,r,i,s,a)})):this.remuxer.remux(e,t,n,r,i,s,a)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._trackUnknownPmt=function(e,t,n){var r=this.pmtUnknownTypes[e]||0;return 0===r&&(this.pmtUnknownTypes[e]=0,t.call(o.logger,n)),this.pmtUnknownTypes[e]++,r},t._parsePMT=function(e,t,n,r){var i,s={audio:-1,avc:-1,id3:-1,isAAC:!0},a=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<a;){switch(i=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){this._trackUnknownPmt(e[t],o.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=i);break;case 21:-1===s.id3&&(s.id3=i);break;case 219:if(!r){this._trackUnknownPmt(e[t],o.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=i);break;case 3:case 4:n?-1===s.audio&&(s.audio=i,s.isAAC=!1):this._trackUnknownPmt(e[t],o.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(e[t],o.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(e[t],o.logger.log,"Unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s},t._parsePES=function(e){var t,n,r,i,s,a=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&1<c.length;){var u=new Uint8Array(c[0].length+c[1].length);u.set(c[0]),u.set(c[1],c[0].length),c[0]=u,c.splice(1,1)}if(1!==((f=c[0])[0]<<16)+(f[1]<<8)+f[2])return null;if((t=(f[4]<<8)+f[5])&&t>e.size-6)return null;if(192&(n=f[7])&&(r=536870912*(14&f[9])+4194304*(255&f[10])+16384*(254&f[11])+128*(255&f[12])+(254&f[13])/2,64&n?54e5<r-(i=536870912*(14&f[14])+4194304*(255&f[15])+16384*(254&f[16])+128*(255&f[17])+(254&f[18])/2)&&(o.logger.warn(Math.round((r-i)/9e4)+"s delta between PTS and DTS, align them"),r=i):i=r),n=f[8],e.size<=(s=n+9))return null;e.size-=s;for(var l=new Uint8Array(e.size),d=0,h=c.length;d<h;d++){var f,p=(f=c[d]).byteLength;if(s){if(p<s){s-=p;continue}f=f.subarray(s),p-=s,s=0}l.set(f,a),a+=p}return t&&(t-=n+3),{data:l,pts:r,dts:i,len:t}},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var n=t.samples,r=n.length;if(isNaN(e.pts)){if(!r)return void t.dropped++;var i=n[r-1];e.pts=i.pts,e.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,n.push(e)):t.dropped++}e.debug.length&&o.logger.log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){function n(e,t,n,r){return{key:e,pts:t,dts:n,units:[],debug:r}}var r,i,s,a=this,o=this._avcTrack,c=this._parseAVCNALu(e.data),u=this.avcSample,l=!1,d=this.pushAccesUnit.bind(this);e.data=null,u&&c.length&&!o.audFound&&(d(u,o),u=this.avcSample=n(!1,e.pts,e.dts,"")),c.forEach((function(t){switch(t.type){case 1:i=!0,(u=u||(a.avcSample=n(!0,e.pts,e.dts,""))).frame=!0;var c=t.data;l&&4<c.length&&(2!==(S=new _(c).readSliceType())&&4!==S&&7!==S&&9!==S||(u.key=!0));break;case 5:i=!0,(u=u||(a.avcSample=n(!0,e.pts,e.dts,""))).key=!0,u.frame=!0;break;case 6:i=!0,(r=new _(a.discardEPB(t.data))).readUByte();for(var h=0,f=0,p=!1,g=0;!p&&1<r.bytesAvailable;){for(h=0;h+=g=r.readUByte(),255===g;);for(f=0;f+=g=r.readUByte(),255===g;);if(4===h&&0!==r.bytesAvailable){if(p=!0,181===(v=r.readUByte())&&49===r.readUShort()&&1195456820===(v=r.readUInt())&&3===r.readUByte()){var v,y=31&(v=r.readUByte()),b=[v,r.readUByte()];for(s=0;s<y;s++)b.push(r.readUByte()),b.push(r.readUByte()),b.push(r.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:b})}}else if(5===h&&0!==r.bytesAvailable){if(p=!0,16<f){var w=[];for(s=0;s<16;s++)w.push(r.readUByte().toString(16)),3!==s&&5!==s&&7!==s&&9!==s||w.push("-");var E=f-16,T=new Uint8Array(E);for(s=0;s<E;s++)T[s]=r.readUByte();a._insertSampleInOrder(a._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:w.join(""),userDataBytes:T,userData:Object(m.utf8ArrayToStr)(T.buffer)})}}else if(f<r.bytesAvailable)for(s=0;s<f;s++)r.readUByte()}break;case 7:if(l=i=!0,!o.sps){var S=(r=new _(t.data)).readSPS();o.width=S.width,o.height=S.height,o.pixelRatio=S.pixelRatio,o.sps=[t.data],o.duration=a._duration;var I=t.data.subarray(1,4),k="avc1.";for(s=0;s<3;s++){var A=I[s].toString(16);k+=A=A.length<2?"0"+A:A}o.codec=k}break;case 8:i=!0,o.pps||(o.pps=[t.data]);break;case 9:i=!1,o.audFound=!0,u&&d(u,o),u=a.avcSample=n(!1,e.pts,e.dts,"");break;case 12:i=!1;break;default:i=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&i&&u.units.push(t)})),t&&u&&(d(u,o),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var n=e.length;if(0<n){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;0<=r;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t,n=this.avcSample;return(n=n&&0!==n.units.length?n:(e=this._avcTrack.samples)[e.length-1])?(n=n.units)[n.length-1]:t},t._parseAVCNALu=function(e){var t,n,r,i,s,a=0,o=e.byteLength,c=this._avcTrack,u=p=c.naluState||0,l=[],d=-1;for(-1===p&&(r=31&e[d=0],p=0,a=1);a<o;){var h,f,p,g=e[a++];p=p?1!==p?g?1===g?(0<=d?(n={data:e.subarray(d,a-p-1),type:r},l.push(n)):(h=this._getLastNalUnit())&&(u&&a<=4-u&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-u)),0<(t=a-p-1)&&((f=new Uint8Array(h.data.byteLength+t)).set(h.data,0),f.set(e.subarray(0,t),h.data.byteLength),h.data=f)),a<o?(r=31&e[d=a],0):-1):0:3:g?0:2:g?0:1}return 0<=d&&0<=p&&(n={data:e.subarray(d,o),type:r,state:p},l.push(n)),0!==l.length||(i=this._getLastNalUnit())&&((s=new Uint8Array(i.data.byteLength+e.byteLength)).set(i.data,0),s.set(e,i.data.byteLength),i.data=s),c.naluState=p,l},t.discardEPB=function(e){for(var t=e.byteLength,n=[],r=1;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;var i=t-n.length,s=new Uint8Array(i),a=0;for(r=0;r<i;a++,r++)a===n[0]&&(a++,n.shift()),s[r]=e[a];return s},t._parseAACPES=function(e){var t,n,s,a,c=this._audioTrack,u=e.data,l=e.pts,d=this.aacOverFlow,m=this.aacLastPTS;for(d&&((e=new Uint8Array(d.byteLength+u.byteLength)).set(d,0),e.set(u,d.byteLength),u=e),n=0,a=u.length;n<a-1&&!h(u,n);n++);if(n){var v,y=n<a-1?(v="AAC PES did not start with ADTS header,offset:"+n,!1):(v="no ADTS header found in AAC PES",!0);if(o.logger.warn("parsing error:"+v),this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:y,reason:v}),y)return}for(f(c,this.observer,u,n,this.audioCodec),t=0,y=p(c.samplerate),d&&m&&(y=m+y,1<Math.abs(y-l)&&(o.logger.log("AAC: align PTS for overlapping frames by "+Math.round((y-l)/90)),l=y));n<a;){if(h(u,n)){if(n+5<a){var b=g(c,u,n,l,t);if(b){n+=b.length,s=b.sample.pts,t++;continue}}break}n++}d=n<a?u.subarray(n,a):null,this.aacOverFlow=d,this.aacLastPTS=s},t._parseMPEGPES=function(e){for(var t=e.data,n=t.length,r=0,i=0,s=e.pts;i<n;)if(w.isHeader(t,i)){var a=w.appendFrame(this._audioTrack,t,i,s,r);if(!a)break;i+=a.length,r++}else i++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),I=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,n,r=m.default.getID3Data(e,0);if(r&&void 0!==m.default.getTimeStamp(r))for(t=r.length,n=Math.min(e.length-1,t+100);t<n;t++)if(w.probe(e,t))return o.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=m.default.getID3Data(e,0)||[],s=m.default.getTimeStamp(i),a=void 0!==s?90*s:9e4*t,o=i.length,c=e.length,u=0,l=0,d=this._audioTrack,h=[{pts:a,dts:a,data:i}];o<c;)if(w.isHeader(e,o)){var f=w.appendFrame(d,e,o,a,u);if(!f)break;o+=f.length,l=f.sample.pts,u++}else m.default.isHeader(e,o)?(i=m.default.getID3Data(e,o),h.push({pts:l,dts:l,data:i}),o+=i.length):o++;this.remuxer.remux(d,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),k=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),A=Math.pow(2,32)-1,O=function(){function e(){}return e.init=function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),n=new Uint8Array([105,115,111,109]),r=new Uint8Array([97,118,99,49]),s=new Uint8Array([0,0,0,1]),e.FTYP=e.box(e.types.ftyp,n,s,n,r),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,s=i;i--;)r+=n[i].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<s;i++)t.set(n[i],r),r+=n[i].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var r=Math.floor(n/(1+A));return n=Math.floor(n%(1+A)),e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var r=Math.floor(n/(1+A));return n=Math.floor(n%(1+A)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),e.box(e.types.mvhd,n)},e.sdtp=function(t){for(var n,r=t.samples||[],i=new Uint8Array(4+r.length),s=0;s<r.length;s++)n=r[s].flags,i[s+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,i)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){for(var n,r,i=[],s=[],a=0;a<t.sps.length;a++)r=(n=t.sps[a]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(n));for(a=0;a<t.pps.length;a++)r=(n=t.pps[a]).byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),c=t.width,u=t.height,l=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,s=t.height;return t=Math.floor(r/(1+A)),r=Math.floor(r%(1+A)),e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,s>>8&255,255&s,0,0]))},e.traf=function(t,n){var r=e.sdtp(t),i=t.id,s=Math.floor(n/(1+A));return n=Math.floor(n%(1+A)),e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,n>>24,n>>16&255,n>>8&255,255&n])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){return t=t.id,e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,s,a,o,c=t.samples||[],u=c.length,l=(t=12+16*u,new Uint8Array(t));for(l.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,(n+=8+t)>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<u;r++)i=(o=c[r]).duration,s=o.size,a=o.flags,o=o.cts,l.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,s>>>24&255,s>>>16&255,s>>>8&255,255&s,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,o>>>24&255,o>>>16&255,o>>>8&255,255&o],12+16*r);return e.box(e.types.trun,l)},e.initSegment=function(t){e.types||e.init();var n=e.moov(t);return(t=new Uint8Array(e.FTYP.byteLength+n.byteLength)).set(e.FTYP),t.set(n,e.FTYP.byteLength),t},e}();function x(e,t,n,r){return n=e*t*(n=void 0===n?1:n),(r=void 0!==r&&r)?Math.round(n):n}function C(e,t){return x(e,1e3,1/9e4,t=void 0!==t&&t)}function R(e,t){return x(e,9e4,1/(t=void 0===t?1:t))}var D=R(10),L=R(.2),P=null;function N(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=n;return e}var M,j=function(){function e(e,t,n,r){this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===P&&(n=navigator.userAgent.match(/Chrome\/(\d+)/i),P=n?parseInt(n[1]):0)}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1;return e=e.reduce((function(e,n){var r=n.pts-e;return r<-4294967296?(t=!0,N(e,n.pts)):0<r?e:n.pts}),e[0].pts),t&&o.logger.debug("PTS rollover detected"),e},t.remux=function(e,t,n,i,s,a,c){var u,l,d,h,f,p;this.ISGenerated||this.generateIS(e,t,s),this.ISGenerated&&(f=e.samples.length,u=t.samples.length,d=l=s,f&&u&&(h=this.getVideoStartPts(t.samples),h=(N(e.samples[0].pts,h)-h)/t.inputTimeScale,l+=Math.max(0,h),d+=Math.max(0,-h)),f?(e.timescale||(o.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,s)),f=this.remuxAudio(e,l,a,c),u&&(f&&(p=f.endPTS-f.startPTS),t.timescale||(o.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,s)),this.remuxVideo(t,d,a,p))):!u||(c=this.remuxVideo(t,d,a,0,c))&&e.codec&&this.remuxEmptyAudio(e,l,a,c)),n.samples.length&&this.remuxID3(n,s),i.samples.length&&this.remuxText(i,s),this.observer.trigger(r.default.FRAG_PARSED)},t.generateIS=function(e,t,n){var s,a,c=this.observer,u=e.samples,l=t.samples,d=this.typeSupported,h="audio/mp4",f={},p={tracks:f},g=void 0===this._initPTS;g&&(a=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,o.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(d.mpeg?(h="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3")),f.audio={container:h,codec:e.codec,initSegment:!e.isAAC&&d.mpeg?new Uint8Array:O.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(a=s=u[0].pts-Math.round(e.inputTimeScale*n))),t.sps&&t.pps&&l.length?(e=t.inputTimeScale,t.timescale=e,f.video={container:"video/mp4",codec:t.codec,initSegment:O.initSegment([t]),metadata:{width:t.width,height:t.height}},g&&(t=this.getVideoStartPts(l),n=Math.round(e*n),s=Math.min(s,N(l[0].dts,t)-n),a=Math.min(a,t-n),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:a}))):g&&f.audio&&this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:a}),Object.keys(f).length?(c.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,g&&(this._initPTS=a,this._initDTS=s)):c.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,n,s){var a,c,u=e.timescale,l=e.samples,d=[],h=l.length,f=this._initPTS,p=8,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=0,y=!1,b=this.nextAvcDts;if(0!==h){n||(b=t*u-(l[0].pts-N(l[0].dts,l[0].pts)));for(var w=0;w<h;w++){var _=l[w];_.pts=N(_.pts-f,b),_.dts=N(_.dts-f,b),_.dts>_.pts&&(v=Math.max(Math.min(v,_.pts-_.dts),-1*L)),_.dts<l[0<w?w-1:w].dts&&(y=!0)}y&&l.sort((function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r||e.id-t.id})),E=l[0].dts,t=l[h-1].dts;var E,T=Math.round((t-E)/(h-1));if(v<0){if(v<-2*T){o.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+C(-T,!0)+" ms");for(var S=v,I=0;I<h;I++)l[I].dts=S=Math.max(S,l[I].pts-T),l[I].pts=Math.max(S,l[I].pts)}else{o.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+C(v,!0)+" ms to overcome this issue");for(var k=0;k<h;k++)l[k].dts=l[k].dts+v}E=l[0].dts,t=l[h-1].dts}!n||((n=T<(B=E-b))||B<-1)&&(n?o.logger.warn("AVC: "+C(B,!0)+" ms ("+B+"dts) hole between fragments detected, filling it"):o.logger.warn("AVC: "+C(-B,!0)+" ms ("+B+"dts) overlapping between fragments detected"),n=l[0].pts-B,l[0].dts=E=b,l[0].pts=n,o.logger.log("Video: First PTS/DTS adjusted: "+C(n,!0)+"/"+C(E,!0)+", delta: "+C(B,!0)+" ms")),P&&P<75&&(E=Math.max(0,E));for(var A=0,x=0,R=0;R<h;R++){for(var D=l[R],M=D.units,j=M.length,F=0,U=0;U<j;U++)F+=M[U].data.length;x+=F,A+=j,D.length=F,D.dts=Math.max(D.dts,E),D.pts=Math.max(D.pts,D.dts,0),g=Math.min(D.pts,g),m=Math.max(D.pts,m)}t=l[h-1].dts;var B=x+4*A+8;try{c=new Uint8Array(B)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating video mdat "+B})}var V,q=new DataView(c.buffer);q.setUint32(0,B),c.set(O.types.mdat,4);for(var G=0;G<h;G++){for(var K,z,H,W=l[G],$=W.units,Y=0,Q=0,X=$.length;Q<X;Q++){var J=(Z=$[Q]).data,Z=Z.data.byteLength;q.setUint32(p,Z),p+=4,c.set(J,p),p+=Z,Y+=4+Z}G<h-1?a=l[G+1].dts-W.dts:(H=this.config,z=W.dts-l[0<G?G-1:G].dts,H.stretchShortVideoTrack?(H=H.maxBufferHole,Math.floor(H*u)<(H=(s?g+s*u:this.nextAudioPts)-W.pts)?((a=H-z)<0&&(a=z),o.logger.log("It is approximately "+C(H,!1)+" ms to the next segment; using duration "+C(a,!1)+" ms for the last video frame.")):a=z):a=z),K=Math.round(W.pts-W.dts),d.push({size:Y,duration:a,cts:K,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:W.key?2:1,isNonSync:W.key?0:1}})}return this.nextAvcDts=t+a,t=e.dropped,e.nbNalu=0,e.dropped=0,d.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&((V=d[0].flags).dependsOn=2,V.isNonSync=0),e.samples=d,V=O.moof(e.sequenceNumber++,E,e),e.samples=[],t={data1:V,data2:c,startPTS:g/u,endPTS:(m+a)/u,startDTS:E/u,endDTS:this.nextAvcDts/u,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:t},this.observer.trigger(r.default.FRAG_PARSING_DATA,t),t}},t.remuxAudio=function(e,t,n,s){var a,c,u,l,d=e.inputTimeScale,h=e.timescale,f=d/h,p=(e.isAAC?1024:1152)*f,g=this._initPTS,m=!e.isAAC&&this.typeSupported.mpeg,v=m?0:8,y=e.samples,b=[],w=this.nextAudioPts;if(n|=y.length&&w&&(s&&Math.abs(t-w/d)<.1||Math.abs(y[0].pts-w-g)<20*p),y.forEach((function(e){e.pts=e.dts=N(e.pts-g,t*d)})),0!==(y=y.filter((function(e){return 0<=e.pts}))).length){if(n||(w=s?Math.max(0,t*d):y[0].pts),e.isAAC)for(var _=this.config.maxAudioFramesDrift,E=0,T=w;E<y.length;){var S=y[E],I=S.pts,A=I-T;if(A<=-_*p)n||0<E?(o.logger.warn("Dropping 1 audio frame @ "+C(T,!0)/1e3+"s due to "+C(A,!0)+" ms overlap."),y.splice(E,1)):(o.logger.warn("Audio frame @ "+C(I,!0)/1e3+"s overlaps nextAudioPts by "+C(A,!0)+" ms."),T=I+p,E++);else if(_*p<=A&&A<D&&T){var x=Math.round(A/p);o.logger.warn("Injecting "+x+" audio frames @ "+C(T,!0)/1e3+"s due to "+C(A,!0)+" ms gap.");for(var R=0;R<x;R++){var L,P=Math.max(T,0);(L=k.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),L=S.unit.subarray()),y.splice(E,0,{unit:L,pts:P,dts:P}),T+=p,E++}S.pts=S.dts=T,T+=p,E++}else Math.abs(A),S.pts=S.dts=T,T+=p,E++}for(var M=y.length,j=0;M--;)j+=y[M].unit.byteLength;for(var F=0,U=y.length;F<U;F++){var B=(V=y[F]).unit,V=V.pts;if(void 0!==l&&a)a.duration=Math.round((V-l)/f);else{var q=V-w,G=0;if(n&&e.isAAC&&q){if(0<q&&q<D)G=Math.round((V-w)/p),o.logger.log(C(q,!0)+" ms hole between AAC samples detected,filling it"),0<G&&(j+=G*(L=(L=k.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||B.subarray()).length);else if(q<-12){o.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+C(w,!0)+" ms / "+C(V,!0)+" ms / "+C(-q,!0)+" ms"),j-=B.byteLength;continue}V=w}if(u=V,!(0<j))return;j+=v;try{c=new Uint8Array(j)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:j,reason:"fail allocating audio mdat "+j})}m||(new DataView(c.buffer).setUint32(0,j),c.set(O.types.mdat,4));for(var K=0;K<G;K++)(L=k.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),L=B.subarray()),c.set(L,v),v+=L.byteLength,a={size:L.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(a)}c.set(B,v),v+=q=B.byteLength,b.push(a={size:q,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}}),l=V}var z=0;return 2<=(M=b.length)&&(z=b[M-2].duration,a.duration=z),M?(this.nextAudioPts=w=l+f*z,e.samples=b,h=m?new Uint8Array:O.moof(e.sequenceNumber++,u/f,e),e.samples=[],z={data1:h,data2:c,startPTS:s=u/d,endPTS:z=w/d,startDTS:s,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:M},this.observer.trigger(r.default.FRAG_PARSING_DATA,z),z):null}},t.remuxEmptyAudio=function(e,t,n,r){var i=e.inputTimeScale,s=e.samplerate||i,a=this.nextAudioPts,c=(void 0!==a?a:r.startDTS*i)+this._initDTS,u=(r=r.endDTS*i+this._initDTS,i/s*1024),l=Math.ceil((r-c)/u),d=k.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(o.logger.warn("remux empty Audio"),d){for(var h=[],f=0;f<l;f++){var p=c+f*u;h.push({unit:d,pts:p,dts:p})}e.samples=h,this.remuxAudio(e,t,n)}else o.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e,t){var n=e.samples.length;if(n){for(var i=e.inputTimeScale,s=this._initPTS,a=this._initDTS,o=0;o<n;o++){var c=e.samples[o];c.pts=N(c.pts-s,t*i)/i,c.dts=N(c.dts-a,t*i)/i}this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:e.samples}),e.samples=[]}},t.remuxText=function(e,t){var n=e.samples.length,i=e.inputTimeScale,s=this._initPTS;if(n){for(var a=0;a<n;a++){var o=e.samples[a];o.pts=N(o.pts-s,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts})),this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e}(),F=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,n,i,s,a,o,c){var u=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),u.trigger(r.default.FRAG_PARSING_DATA,{data1:c,startPTS:s,startDTS:s,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(r.default.FRAG_PARSED)},e}();c=Object(c.getSelfScope)();try{M=c.performance.now.bind(c.performance)}catch(e){o.logger.debug("Unable to use Performance API on this environment"),M=c.Date.now}t.default=function(){function e(e,t,n,r){this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,n,i,a,o,c,u,l,d,h,f){var p,g,m=this;0<e.byteLength&&null!=t&&null!=t.key&&"AES-128"===t.method?(null==(p=this.decrypter)&&(p=this.decrypter=new s.default(this.observer,this.config)),g=M(),p.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var s=M();m.observer.trigger(r.default.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:s}}),m.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,a,o,c,u,l,d,h,f)}))):this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,a,o,c,u,l,d,h,f)},t.pushDecrypted=function(e,t,n,s,a,o,c,u,l,d,h,f){var p=this.demuxer,g=this.remuxer;if(!p||c||u){for(var m,b=this.observer,w=this.typeSupported,_=this.config,E=[{demux:S,remux:j},{demux:y.default,remux:F},{demux:v,remux:j},{demux:I,remux:j}],T=0,k=E.length;T<k&&!(m=E[T]).demux.probe(e);T++);if(!m)return void b.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});g&&g instanceof m.remux||(g=new m.remux(b,_,w,this.vendor)),p&&p instanceof m.demux||(p=new m.demux(b,g,_,w),this.probe=m.demux.probe),this.demuxer=p,this.remuxer=g}(c||u)&&(p.resetInitSegment(n,s,a,d),g.resetInitSegment()),c&&(p.resetTimeStamp(f),g.resetTimeStamp(f)),"function"==typeof p.setDecryptData&&p.setDecryptData(t),p.append(e,o,l,h)},e}()},"./src/demux/demuxer-worker.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/demux/demuxer-inline.js"),i=n("./src/events.js"),s=n("./src/utils/logger.js"),a=n("./node_modules/eventemitter3/index.js");t.default=function(e){var t=new a.EventEmitter;function n(t,n){e.postMessage({event:t,data:n})}t.trigger=function(e){for(var n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))},e.addEventListener("message",(function(i){var a=i.data;switch(a.cmd){case"init":var o=JSON.parse(a.config);e.demuxer=new r.default(t,a.typeSupported,o,a.vendor),Object(s.enableLogs)(o.debug),n("init",null);break;case"demux":e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}})),t.on(i.default.FRAG_DECRYPTED,n),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(i.default.FRAG_PARSED,n),t.on(i.default.ERROR,n),t.on(i.default.FRAG_PARSING_METADATA,n),t.on(i.default.FRAG_PARSING_USERDATA,n),t.on(i.default.INIT_PTS_FOUND,n),t.on(i.default.FRAG_PARSING_DATA,(function(t,n){var r=[];t={event:t,data:n},n.data1&&(t.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(t.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),e.postMessage(t,r)}))}},"./src/demux/id3.js":function(e,t,n){"use strict";n.r(t),n.d(t,"utf8ArrayToStr",(function(){return s}));var r,i=n("./src/utils/get-self-scope.js"),s=(n=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,n){for(var r=n,i=0;e.isHeader(t,n);)i+=10,i+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(i+=10),n+=i;if(0<i)return t.subarray(r,r+i)},e._readSize=function(e,t){var n=(127&e[t])<<21;return n|=(127&e[t+1])<<14,(n|=(127&e[t+2])<<7)|127&e[t+3]},e.getTimeStamp=function(t){for(var n=e.getID3Frames(t),r=0;r<n.length;r++){var i=n[r];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:n,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var n=0,r=[];e.isHeader(t,n);){for(var i=e._readSize(t,n+6),s=(n+=10)+i;n+8<s;){var a=e._getFrameData(t.subarray(n)),o=e._decodeFrame(a);o&&r.push(o),n+=a.size+10}e.isFooter(t,n)&&(n+=10)}return r},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):e._decodeTextFrame(t)},e._readTimeStamp=function(e){if(8===e.data.byteLength){e=1&(t=new Uint8Array(e.data))[3];var t=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return t/=45,e&&(t+=47721858.84),Math.round(t)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var n=1,r=e._utf8ArrayToStr(t.data.subarray(1),!0);return n+=r.length+1,n=e._utf8ArrayToStr(t.data.subarray(n)),{key:t.type,info:r,data:n}}return n=e._utf8ArrayToStr(t.data.subarray(1)),{key:t.type,data:n}}},e._decodeURLFrame=function(t){if("WXXX"!==t.type){var n=e._utf8ArrayToStr(t.data);return{key:t.type,data:n}}if(!(t.size<2)){var r=1;return r+=(n=e._utf8ArrayToStr(t.data.subarray(1),!0)).length+1,r=e._utf8ArrayToStr(t.data.subarray(r)),{key:t.type,info:n,data:r}}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var n=function(){var e=Object(i.getSelfScope)();return r||void 0===e.TextDecoder||(r=new e.TextDecoder("utf-8")),r}();if(n){var s=n.decode(e);return t?-1!==(n=s.indexOf("\0"))?s.substring(0,n):s:s.replace(/\0/g,"")}for(var a,o,c,u=e.length,l="",d=0;d<u;){if(0===(a=e[d++])&&t)return l;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(a);break;case 12:case 13:o=e[d++],l+=String.fromCharCode((31&a)<<6|63&o);break;case 14:o=e[d++],c=e[d++],l+=String.fromCharCode((15&a)<<12|(63&o)<<6|(63&c)<<0)}}return l},e}(),n._utf8ArrayToStr);t.default=n},"./src/demux/mp4demuxer.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/logger.js"),i=n("./src/events.js"),s=Math.pow(2,32)-1;t.default=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,n,r,s){var a,o;t&&t.byteLength?(null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e"),o={},(a=this.initData=e.parseInitSegment(t)).audio&&a.video?o.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:s?t:null}:(a.audio&&(o.audio={container:"audio/mp4",codec:n,initSegment:s?t:null}),a.video&&(o.video={container:"video/mp4",codec:r,initSegment:s?t:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})):(n&&(this.audioCodec=n),r&&(this.videoCodec=r))},e.probe=function(t){return 0<e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){return e.data&&(t+=e.start,e=e.data),(t=e[t]<<8|e[t+1])<0?65536+t:t},e.readUint32=function(e,t){return e.data&&(t+=e.start,e=e.data),(t=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])<0?4294967296+t:t},e.writeUint32=function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},e.findBox=function(t,n){var r,i,s,a,o,c=[];if(t.data?(a=t.start,i=t.end,t=t.data):(a=0,i=t.byteLength),!n.length)return null;for(r=a;r<i;)o=1<(s=e.readUint32(t,r))?r+s:i,e.bin2str(t.subarray(r+4,r+8))===n[0]&&(1===n.length?c.push({data:t,start:r+8,end:o}):(s=e.findBox({data:t,start:r+8,end:o},n.slice(1))).length&&(c=c.concat(s))),r=o;return c},e.parseSegmentIndex=function(t){var n=(n=e.findBox(t,["moov"])[0])?n.end:null,r=0,i=e.findBox(t,["sidx"]);if(!i||!i[0])return null;var s=[],a=(t=(i=i[0]).data[0],e.readUint32(i,r=0===t?8:16));r+=4,r+=0===t?8:16;var o=i.end+0,c=e.readUint16(i,r+=2);r+=2;for(var u=0;u<c;u++){var l=r,d=e.readUint32(i,l);l+=4;var h=2147483647&d;if(1==(2147483648&d)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");d=e.readUint32(i,l),l+=4,s.push({referenceSize:h,subsegmentDuration:d,info:{duration:d/a,start:o,end:o+h-1}}),o+=h,r=l+=4}return{earliestPresentationTime:0,timescale:a,version:t,referencesCount:c,references:s,moovEndOffset:n}},e.parseInitSegment=function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach((function(t){var i,s,a=e.findBox(t,["tkhd"])[0];a&&(s=a.data[a.start],i=e.readUint32(a,0===s?12:20),(a=e.findBox(t,["mdia","mdhd"])[0])&&(s=a.data[a.start],a=e.readUint32(a,0===s?12:20),!(s=e.findBox(t,["mdia","hdlr"])[0])||(s={soun:"audio",vide:"video"}[e.bin2str(s.data.subarray(s.start+8,s.start+12))])&&((t=e.findBox(t,["mdia","minf","stbl","stsd"])).length&&(t=t[0],t=e.bin2str(t.data.subarray(t.start+12,t.start+16)),r.logger.log("MP4Demuxer:"+s+":"+t+" found")),n[i]={timescale:a,type:s},n[s]={timescale:a,id:i})))})),n},e.getStartDTS=function(t,n){return n=e.findBox(n,["moof","traf"]),n=[].concat.apply([],n.map((function(n){return e.findBox(n,["tfhd"]).map((function(r){return r=e.readUint32(r,4),r=t[r].timescale||9e4,e.findBox(n,["tfdt"]).map((function(t){var n=t.data[t.start],r=e.readUint32(t,4);return 1===n&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r}))[0]/r}))}))),n=Math.min.apply(null,n),isFinite(n)?n:0},e.offsetStartDTS=function(t,n,r){e.findBox(n,["moof","traf"]).map((function(n){return e.findBox(n,["tfhd"]).map((function(i){i=e.readUint32(i,4);var a=t[i].timescale||9e4;e.findBox(n,["tfdt"]).map((function(t){var n=t.data[t.start],i=e.readUint32(t,4);0===n?e.writeUint32(t,4,i-r*a):(i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=r*a,i=Math.max(i,0),n=Math.floor(i/(1+s)),i=Math.floor(i%(1+s)),e.writeUint32(t,4,n),e.writeUint32(t,8,i))}))}))}))},t.append=function(t,n,r,s){var a=this.initData;a||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),a=this.initData);var o,c=this.initPTS;void 0===c&&(o=e.getStartDTS(a,t),this.initPTS=c=o-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:c})),e.offsetStartDTS(a,t,c),c=e.getStartDTS(a,t),this.remuxer.remux(a.audio,a.video,null,null,c,r,s,t)},t.destroy=function(){},e}()},"./src/errors.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"ErrorTypes",(function(){return r})),n.d(t,"ErrorDetails",(function(){return i})),(t=r=r||{}).NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",(t=i=i||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException"},"./src/events.js":function(e,t,n){"use strict";n.r(t),t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Xt}));var r={};n.r(r),n.d(r,"newCue",(function(){return lt}));var i,s,a=n("./node_modules/url-toolkit/src/url-toolkit.js"),o=n("./src/errors.ts"),c=n("./src/polyfills/number.js"),u=n("./src/events.js"),l=n("./src/utils/logger.js"),d={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if(d[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)}),this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}),this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){try{(function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)}).call(this,e,t).call()}catch(t){l.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();($e=i=i||{}).MANIFEST="manifest",$e.LEVEL="level",$e.AUDIO_TRACK="audioTrack",$e.SUBTITLE_TRACK="subtitleTrack",(Qe=s=s||{}).MAIN="main",Qe.AUDIO="audio",Qe.SUBTITLE="subtitle";var f=n("./src/demux/mp4demuxer.js");function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g,m=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}var t,n,r;return t=e,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(a.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&p(t.prototype,n),r&&p(t,r),e}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(et=g=g||{}).AUDIO="audio",et.VIDEO="video";var y=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[g.AUDIO]=!1,e[g.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t,n,r=e.prototype;return r.setByteRange=function(e,t){var n=e.split("@",2);e=[],1===n.length?e[0]=t?t.byteRangeEndOffset:0:e[0]=parseInt(n[1]),e[1]=parseInt(n[0])+e[0],this._byteRange=e},r.addElementaryStream=function(e){this._elementaryStreams[e]=!0},r.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},r.createInitializationVector=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},r.setDecryptDataFromLevelKey=function(e,t){var n=e;return null!=e&&e.method&&e.uri&&!e.iv&&((n=new m(e.baseuri,e.reluri)).method=e.method,n.iv=this.createInitializationVector(t)),n},t=e,(r=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(e=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&l.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)),this._decryptdata):null;var e}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(c.isFiniteNumber)(this.programDateTime))return null;var e=Object(c.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&v(t.prototype,r),n&&v(t,n),e}();function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}var t,n,r;return t=e,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(c.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&b(t.prototype,n),r&&b(t,r),e}(),_=/^(\d+)x(\d+)$/,E=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,T=function(){function e(t){for(var n in t="string"==typeof t?e.parseAttrList(t):t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){return(e=parseInt(this[e],10))>Number.MAX_SAFE_INTEGER?1/0:e},t.hexadecimalInteger=function(e){if(this[e]){for(var t=(1&(t=(this[e]||"0x").slice(2)).length?"0":"")+t,n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){return(e=parseInt(this[e],16))>Number.MAX_SAFE_INTEGER?1/0:e},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){if(null!==(e=_.exec(this[e])))return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},e.parseAttrList=function(e){var t,n={};for(E.lastIndex=0;null!==(t=E.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}(),S={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function I(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var k=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,A=/#EXT-X-MEDIA:(.*)/g,O=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),x=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,C=/\.(mp4|m4s|m4v|m4a)$/i,R=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t,n=e.split(".");return 2<n.length?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return a.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i,s,a,o=[],c={},u=!1;function l(e,t){["video","audio"].forEach((function(n){var r,i=e.filter((function(e){return t=e,!!(e=S[e=n])&&!0===e[t.slice(0,4)];var t}));i.length&&(r=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)})),t[n+"Codec"]=(0<r.length?r:i)[0],e=e.filter((function(e){return-1===i.indexOf(e)})))})),t.unknownCodecs=e}for(k.lastIndex=0;null!=(a=k.exec(t));)a[1]?(i=(r={}).attrs=new T(a[1]),r.url=e.resolve(a[2],n),(s=i.decimalResolution("RESOLUTION"))&&(r.width=s.width,r.height=s.height),r.bitrate=i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),r.name=i.NAME,l([].concat((i.CODECS||"").split(/[ ,]+/)),r),r.videoCodec&&-1!==r.videoCodec.indexOf("avc1")&&(r.videoCodec=e.convertAVC1ToAVCOTI(r.videoCodec)),o.push(r)):!a[3]||(a=new T(a[3]))["DATA-ID"]&&(u=!0,c[a["DATA-ID"]]=a);return{levels:o,sessionData:u?c:null}},e.parseMasterPlaylistMedia=function(t,n,r,i){void 0===i&&(i=[]);var s=[],a=0;for(A.lastIndex=0;null!==(o=A.exec(t));){var o,c=new T(o[1]);c.TYPE===r&&(o={attrs:c,id:a++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE,type:r,default:"YES"===c.DEFAULT,autoselect:"YES"===c.AUTOSELECT,forced:"YES"===c.FORCED,lang:c.LANGUAGE},c.URI&&(o.url=e.resolve(c.URI,n)),i.length&&(c=e.findGroup(i,o.groupId),o.audioCodec=(c||i[0]).codec),s.push(o))}return s},e.parseLevelPlaylist=function(e,t,n,r,i){var s,a,o,u=0,d=0,h=new w(t),f=0,p=null,g=new y,v=null;for(O.lastIndex=0;null!==(s=O.exec(e));){var b=s[1];if(b){g.duration=parseFloat(b);var _=(" "+s[2]).slice(1);g.title=_||null,g.tagList.push(_?["INF",b,_]:["INF",b])}else if(s[3])Object(c.isFiniteNumber)(g.duration)&&(E=u++,g.type=r,g.start=d,o&&(g.levelkey=o),g.sn=E,g.level=n,g.cc=f,g.urlId=i,g.baseurl=t,g.relurl=(" "+s[3]).slice(1),function(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(c.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}(g,p),h.fragments.push(g),d+=(p=g).duration,g=new y);else if(s[4]){var E=(" "+s[4]).slice(1);p?g.setByteRange(E,p):g.setByteRange(E)}else if(s[5])g.rawProgramDateTime=(" "+s[5]).slice(1),g.tagList.push(["PROGRAM-DATE-TIME",g.rawProgramDateTime]),null===v&&(v=h.fragments.length);else if(s=s[0].match(x)){for(a=1;a<s.length&&void 0===s[a];a++);var S=(" "+s[a+1]).slice(1),I=(" "+s[a+2]).slice(1);switch(s[a]){case"#":g.tagList.push(I?[S,I]:[S]);break;case"PLAYLIST-TYPE":h.type=S.toUpperCase();break;case"MEDIA-SEQUENCE":u=h.startSN=parseInt(S);break;case"TARGETDURATION":h.targetduration=parseFloat(S);break;case"VERSION":h.version=parseInt(S);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":f++,g.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(S);break;case"KEY":var k=new T(S),A=k.enumeratedString("METHOD"),R=k.URI,D=k.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(k.KEYFORMAT||"identity")){l.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}A&&(o=new m(t,R),R&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(A)&&(o.method=A,o.key=null,o.iv=D));break;case"START":var L=new T(S).decimalFloatingPoint("TIME-OFFSET");Object(c.isFiniteNumber)(L)&&(h.startTimeOffset=L);break;case"MAP":L=new T(S),g.relurl=L.URI,L.BYTERANGE&&g.setByteRange(L.BYTERANGE),g.baseurl=t,g.level=n,g.type=r,g.sn="initSegment",h.initSegment=g,(g=new y).rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:l.logger.warn("line parsed but not handled: "+s)}}else l.logger.warn("No matches on slow regex match for level playlist!")}return(g=p)&&!g.relurl&&(h.fragments.pop(),d-=g.duration),h.totalduration=d,h.averagetargetduration=d/h.fragments.length,h.endSN=u-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=f,!h.initSegment&&h.fragments.length&&h.fragments.every((function(e){return C.test(e.relurl)}))&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(g=new y).relurl=h.fragments[0].relurl,g.baseurl=t,g.level=n,g.type=r,g.sn="initSegment",h.initSegment=g,h.needSidxRanges=!0),v&&function(e,t){for(var n=e[t],r=t-1;0<=r;r--){var i=e[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(h.fragments,v),h},e}(),D=window.performance,L=function(e){var t;function n(t){return(t=e.call(this,t,u.default.MANIFEST_LOADING,u.default.LEVEL_LOADING,u.default.AUDIO_TRACK_LOADING,u.default.SUBTITLE_TRACK_LOADING)||this).loaders={},t}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r,n.canHaveQualityLevels=function(e){return e!==i.AUDIO_TRACK&&e!==i.SUBTITLE_TRACK},n.mapContextToLevelType=function(e){switch(e.type){case i.AUDIO_TRACK:return s.AUDIO;case i.SUBTITLE_TRACK:return s.SUBTITLE;default:return s.MAIN}},n.getResponseUrl=function(e,t){return void 0===(e=e.url)||0===e.indexOf("data:")?t.url:e};var r=n.prototype;return r.createInternalLoader=function(e){var t=(r=this.hls.config).pLoader,n=r.loader,r=new(t||n)(r);return e.loader=r,this.loaders[e.type]=r},r.getInternalLoader=function(e){return this.loaders[e.type]},r.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},r.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},r.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},r.onManifestLoading=function(e){this.load({url:e.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},r.onLevelLoading=function(e){this.load({url:e.url,type:i.LEVEL,level:e.level,id:e.id,responseType:"text"})},r.onAudioTrackLoading=function(e){this.load({url:e.url,type:i.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},r.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:i.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},r.load=function(e){var t,n,r,s,a=this.hls.config;if(l.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id),o=this.getInternalLoader(e)){if((u=o.context)&&u.url===e.url)return l.logger.trace("playlist request ongoing"),!1;l.logger.warn("aborting previous loader for type: "+e.type),o.abort()}switch(e.type){case i.MANIFEST:t=a.manifestLoadingMaxRetry,n=a.manifestLoadingTimeOut,r=a.manifestLoadingRetryDelay,s=a.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:r=s=t=0,n=a.levelLoadingTimeOut;break;default:t=a.levelLoadingMaxRetry,n=a.levelLoadingTimeOut,r=a.levelLoadingRetryDelay,s=a.levelLoadingMaxRetryTimeout}var o=this.createInternalLoader(e),c={timeout:n,maxRetry:t,retryDelay:r,maxRetryDelay:s},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return l.logger.debug("Calling internal loader delegate for URL: "+e.url),o.load(e,c,u),!0},r.loadsuccess=function(e,t,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,r);if(this.resetInternalLoader(n.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=e.data;t.tload=D.now(),0===i.indexOf("#EXTM3U")?0<i.indexOf("#EXTINF:")||0<i.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(e,t,n,r):this._handleMasterPlaylist(e,t,n,r):this._handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},r.loaderror=function(e,t,n){this._handleNetworkError(t,n=void 0===n?null:n,!1,e)},r.loadtimeout=function(e,t,n){this._handleNetworkError(t,n=void 0===n?null:n,!0)},r._handleMasterPlaylist=function(e,t,r,i){var s,a,o=this.hls,c=e.data,d=n.getResponseUrl(e,r),h=R.parseMasterPlaylist(c,d),f=h.levels,p=h.sessionData;f.length?(s=f.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),h=R.parseMasterPlaylistMedia(c,d,"AUDIO",s),s=R.parseMasterPlaylistMedia(c,d,"SUBTITLES"),c=R.parseMasterPlaylistMedia(c,d,"CLOSED-CAPTIONS"),h.length&&(a=!1,h.forEach((function(e){e.url||(a=!0)})),!1===a&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(l.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))),o.trigger(u.default.MANIFEST_LOADED,{levels:f,audioTracks:h,subtitles:s,captions:c,url:d,stats:t,networkDetails:i,sessionData:p})):this._handleManifestParsingError(e,r,"no level found in manifest",i)},r._handleTrackOrLevelPlaylist=function(e,t,r,s){var a=this.hls,l=r.id,d=r.level,h=r.type,f=n.getResponseUrl(e,r),p=Object(c.isFiniteNumber)(l)?l:0,g=Object(c.isFiniteNumber)(d)?d:p,m=n.mapContextToLevelType(r);(m=R.parseLevelPlaylist(e.data,f,g,m,p)).tload=t.tload,m.fragments.length?(h===i.MANIFEST&&a.trigger(u.default.MANIFEST_LOADED,{levels:[{url:f,details:m}],audioTracks:[],url:f,stats:t,networkDetails:s,sessionData:null}),t.tparsed=D.now(),m.needSidxRanges?(p=m.initSegment.url,this.load({url:p,isSidxRequest:!0,type:h,level:d,levelDetails:m,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})):(r.levelDetails=m,this._handlePlaylistLoaded(e,t,r,s))):a.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},r._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var n,r=f.default.parseSegmentIndex(new Uint8Array(e.data));r&&(e=r.references,n=t.levelDetails,e.forEach((function(e,t){e=e.info,!n||0===(t=n.fragments[t]).byteRange.length&&t.setByteRange(String(1+e.end-e.start)+"@"+String(e.start))})),n&&n.initSegment.setByteRange(String(r.moovEndOffset)+"@0"))},r._handleManifestParsingError=function(e,t,n,r){this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:r})},r._handleNetworkError=function(e,t,n,r){var s,a;void 0===n&&(n=!1),void 0===r&&(r=null),l.logger.info("A network error occured while loading a "+e.type+"-type playlist");var c=this.getInternalLoader(e);switch(e.type){case i.MANIFEST:s=n?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case i.LEVEL:s=n?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case i.AUDIO_TRACK:s=n?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;default:a=!1}c&&(c.abort(),this.resetInternalLoader(e.type)),t={type:o.ErrorTypes.NETWORK_ERROR,details:s,fatal:a,url:e.url,loader:c,context:e,networkDetails:t},r&&(t.response=r),this.hls.trigger(u.default.ERROR,t)},r._handlePlaylistLoaded=function(e,t,r,s){var a=r.type,o=r.level,c=r.id,l=r.levelDetails;if(l&&l.targetduration)if(n.canHaveQualityLevels(r.type))this.hls.trigger(u.default.LEVEL_LOADED,{details:l,level:o||0,id:c||0,stats:t,networkDetails:s});else switch(a){case i.AUDIO_TRACK:this.hls.trigger(u.default.AUDIO_TRACK_LOADED,{details:l,id:c,stats:t,networkDetails:s});break;case i.SUBTITLE_TRACK:this.hls.trigger(u.default.SUBTITLE_TRACK_LOADED,{details:l,id:c,stats:t,networkDetails:s})}else this._handleManifestParsingError(e,r,"invalid target duration",s)},n}(h),P=function(e){var t;function n(t){return(t=e.call(this,t,u.default.FRAG_LOADING)||this).loaders={},t}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.destroy=function(){var t,n=this.loaders;for(t in n){var r=n[t];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},r.onFragLoading=function(e){var t=(a=e.frag).type,n=this.loaders,r=this.hls.config,i=r.fLoader,s=r.loader;a.loaded=0,(e=n[t])&&(l.logger.warn("abort previous fragment loader for type: "+t),e.abort()),e=n[t]=a.loader=new(r.fLoader?i:s)(r),i={url:a.url,frag:a,responseType:"arraybuffer",progressData:!1},s=a.byteRangeStartOffset;var a=a.byteRangeEndOffset;Object(c.isFiniteNumber)(s)&&Object(c.isFiniteNumber)(a)&&(i.rangeStart=s,i.rangeEnd=a),a={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout},r={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},e.load(i,a,r)},r.loadsuccess=function(e,t,n,r){void 0===r&&(r=null),e=e.data,(n=n.frag).loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:e,frag:n,stats:t,networkDetails:r})},r.loaderror=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})},r.loadtimeout=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})},r.loadprogress=function(e,t,n,r){void 0===r&&(r=null),(t=t.frag).loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:t,stats:e,networkDetails:r})},n}(h),N=function(e){var t;function n(t){return(t=e.call(this,t,u.default.KEY_LOADING)||this).loaders={},t.decryptkey=null,t.decrypturl=null,t}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.destroy=function(){for(var t in this.loaders)(t=this.loaders[t])&&t.destroy();this.loaders={},e.prototype.destroy.call(this)},r.onKeyLoading=function(e){var t,n=e.frag,r=n.type,i=this.loaders[r];n.decryptdata?(t=n.decryptdata.uri)!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,i&&(l.logger.warn("abort previous key loader for type:"+r),i.abort()),t?(n.loader=this.loaders[r]=new e.loader(e),this.decrypturl=t,this.decryptkey=null,r={url:t,frag:n,responseType:"arraybuffer"},t={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout},e={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},n.loader.load(r,t,e)):l.logger.warn("key uri is falsy")):this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:n})):l.logger.warn("Missing decryption data on fragment in onKeyLoading")},r.loadsuccess=function(e,t,n){(n=n.frag).decryptdata?(this.decryptkey=n.decryptdata.key=new Uint8Array(e.data),n.loader=void 0,delete this.loaders[n.type],this.hls.trigger(u.default.KEY_LOADED,{frag:n})):l.logger.error("after key load, decryptdata unset")},r.loaderror=function(e,t){var n=t.frag;(t=n.loader)&&t.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},r.loadtimeout=function(e,t){var n=t.frag;(t=n.loader)&&t.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},n}(h),M="NOT_LOADED",j="APPENDING",F="PARTIAL",U="OK",B=function(e){var t;function n(t){var n=e.call(this,t,u.default.BUFFER_APPENDED,u.default.FRAG_BUFFERED,u.default.FRAG_LOADED)||this;return n.bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=t.config,n}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,h.prototype.destroy.call(this),e.prototype.destroy.call(this)},r.getBufferedFrag=function(e,t){var n=this.fragments,r=Object.keys(n).filter((function(r){return(r=n[r]).body.type===t&&!!r.buffered&&(r=r.body).startPTS<=e&&e<=r.endPTS}));return 0===r.length?null:(r=r.pop(),n[r].body)},r.detectEvictedFragments=function(e,t){var n=this;Object.keys(this.fragments).forEach((function(r){var i=n.fragments[r];if(i&&i.buffered&&(r=i.range[e]))for(var s=r.time,a=0;a<s.length;a++){var o=s[a];if(!n.isTimeBuffered(o.startPTS,o.endPTS,t)){n.removeFragment(i.body);break}}}))},r.detectPartialFragments=function(e){var t=this,n=this.getFragmentKey(e),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach((function(n){var i;e.hasElementaryStream(n)&&(i=t.timeRanges[n],r.range[n]=t.getBufferedTimes(e.startPTS,e.endPTS,i))})))},r.getBufferedTimes=function(e,t,n){for(var r,i,s=[],a=!1,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,r<=e&&t<=i){s.push({startPTS:Math.max(e,n.start(o)),endPTS:Math.min(t,n.end(o))});break}if(e<i&&r<t)s.push({startPTS:Math.max(e,n.start(o)),endPTS:Math.min(t,n.end(o))}),a=!0;else if(t<=r)break}return{time:s,partial:a}},r.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},r.getPartialFragment=function(e){var t,n,r=this,i=null,s=0;return Object.keys(this.fragments).forEach((function(a){a=r.fragments[a],r.isPartial(a)&&(t=a.body.startPTS-r.bufferPadding,n=a.body.endPTS+r.bufferPadding,t<=e&&e<=n&&(n=Math.min(e-t,n-e),s<=n&&(i=a.body,s=n)))})),i},r.getState=function(e){var t=this.getFragmentKey(e);return e=this.fragments[t],t=M,void 0!==e?e.buffered?!0===this.isPartial(e)?F:U:j:t},r.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},r.isTimeBuffered=function(e,t,n){for(var r,i,s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,r<=e&&t<=i)return!0;if(t<=r)return!1}return!1},r.onFragLoaded=function(e){e=e.frag,Object(c.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.fragments[this.getFragmentKey(e)]={body:e,range:Object.create(null),buffered:!1})},r.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)}))},r.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},r.hasFragment=function(e){return e=this.getFragmentKey(e),void 0!==this.fragments[e]},r.removeFragment=function(e){e=this.getFragmentKey(e),delete this.fragments[e]},r.removeAllFragments=function(){this.fragments=Object.create(null)},n}(h),V={search:function(e,t){for(var n=0,r=e.length-1,i=null,s=null;n<=r;){var a=t(s=e[i=(n+r)/2|0]);if(0<a)n=1+i;else{if(!(a<0))return s;r=i-1}}return null}},q=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,n){try{if(e){for(var r=e.buffered,i=[],s=0;s<r.length;s++)i.push({start:r.start(s),end:r.end(s)});return this.bufferedInfo(i,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,n){e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var r=[];if(n)for(var i=0;i<e.length;i++){var s,a=r.length;a?(s=r[a-1].end,e[i].start-s<n?e[i].end>s&&(r[a-1].end=e[i].end):r.push(e[i])):r.push(e[i])}else r=e;for(var o,c=0,u=t,l=t,d=0;d<r.length;d++){var h=r[d].start,f=r[d].end;if(h<=t+n&&t<f)u=h,c=(l=f)-t;else if(t+n<h){o=h;break}}return{len:c,start:u,end:l,nextStart:o}},e}(),G=n("./node_modules/eventemitter3/index.js"),K=n("./node_modules/webworkify-webpack/index.js"),z=n("./src/demux/demuxer-inline.js");function H(){return window.MediaSource||window.WebKitMediaSource}var W=n("./src/utils/get-self-scope.js"),$=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n,r.prototype.trigger=function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(n))},r}(G.EventEmitter),Y=Object(W.getSelfScope)(),Q=H()||{isTypeSupported:function(){return!1}},X=function(){function e(e,t){var n=this;this.hls=e,this.id=t;var r=this.observer=new $,i=e.config,s=function(t,r){(r=r||{}).frag=n.frag,r.id=n.id,e.trigger(t,r)};r.on(u.default.FRAG_DECRYPTED,s),r.on(u.default.FRAG_PARSING_INIT_SEGMENT,s),r.on(u.default.FRAG_PARSING_DATA,s),r.on(u.default.FRAG_PARSED,s),r.on(u.default.ERROR,s),r.on(u.default.FRAG_PARSING_METADATA,s),r.on(u.default.FRAG_PARSING_USERDATA,s),r.on(u.default.INIT_PTS_FOUND,s);var a,c={mp4:Q.isTypeSupported("video/mp4"),mpeg:Q.isTypeSupported("audio/mpeg"),mp3:Q.isTypeSupported('audio/mp4; codecs="mp3"')};if(s=navigator.vendor,i.enableWorker&&"undefined"!=typeof Worker){l.logger.log("demuxing in webworker");try{a=this.w=K("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),a.addEventListener("message",this.onwmsg),a.onerror=function(t){e.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},a.postMessage({cmd:"init",typeSupported:c,vendor:s,id:t,config:JSON.stringify(i)})}catch(t){l.logger.warn("Error in worker:",t),l.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),a&&Y.URL.revokeObjectURL(a.objectURL),this.demuxer=new z.default(r,c,i,s),this.w=void 0}}else this.demuxer=new z.default(r,c,i,s)}var t=e.prototype;return t.destroy=function(){var e=this.w;e?(e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null):(t=this.demuxer)&&(t.destroy(),this.demuxer=null);var t=this.observer;t&&(t.removeAllListeners(),this.observer=null)},t.push=function(e,t,n,r,i,s,a,o){var u=this.w,d=Object(c.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,h=i.decryptdata,f=!((g=this.frag)&&i.cc===g.cc),p=!(g&&i.level===g.level),g=g&&i.sn===g.sn+1;g=!p&&g,f&&l.logger.log(this.id+":discontinuity detected"),p&&l.logger.log(this.id+":switch detected"),this.frag=i,u?u.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:t,audioCodec:n,videoCodec:r,timeOffset:d,discontinuity:f,trackSwitch:p,contiguous:g,duration:s,accurateTimeOffset:a,defaultInitPTS:o},e instanceof ArrayBuffer?[e]:[]):(u=this.demuxer)&&u.push(e,h,t,n,r,d,f,p,g,s,a,o)},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":Y.URL.revokeObjectURL(this.w.objectURL);break;case u.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},e}();function J(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function Z(e,t,n){var r=e[t],i=e[n];e=i.startPTS,Object(c.isFiniteNumber)(e)?t<n?(r.duration=e-r.start,r.duration<0&&l.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-e,i.duration<0&&l.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):t<n?(n=r.cc===i.cc,i.start=r.start+(n&&r.minEndPTS?r.minEndPTS-r.start:r.duration)):i.start=Math.max(r.start-i.duration,0)}function ee(e,t,n,r,i,s){var a=n,o=r;Object(c.isFiniteNumber)(t.startPTS)&&(d=Math.abs(t.startPTS-n),Object(c.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,a=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),o=Math.min(r,t.endPTS),r=Math.max(r,t.endPTS),i=Math.min(i,t.startDTS),s=Math.max(s,t.endDTS));var u,l,d=n-t.start;if(t.start=t.startPTS=n,t.maxStartPTS=a,t.endPTS=r,t.minEndPTS=o,t.startDTS=i,t.endDTS=s,t.duration=r-n,n=t.sn,!e||n<e.startSN||n>e.endSN)return 0;for(n-=e.startSN,(u=e.fragments)[n]=t,l=n;0<l;l--)Z(u,l,l-1);for(l=n;l<u.length-1;l++)Z(u,l,l+1);return e.PTSKnown=!0,d}function te(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var n,r=0;if(ne(e,t,(function(e,i){r=e.cc-i.cc,Object(c.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,n=i),t.PTSKnown=!0})),t.PTSKnown){if(r){l.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=t.fragments,s=0;s<i.length;s++)i[s].cc+=r}n?ee(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(e,t){var n=t.startSN-e.startSN,r=e.fragments,i=t.fragments;if(!(n<0||n>r.length))for(var s=0;s<i.length;s++)i[s].start+=r[n].start}(e,t),t.PTSKnown=e.PTSKnown}}function ne(e,t,n){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,s=t.startSN-e.startSN,a=r;a<=i;a++){var o=e.fragments[s+a],c=t.fragments[a];if(!o||!c)break;n(o,c,a)}}function re(e,t,n){var r=1e3*(t.averagetargetduration||t.targetduration),i=r/2;return e&&t.endSN===e.endSN&&(r=i),n&&(r=Math.max(i,r-(window.performance.now()-n))),Math.round(r)}var ie={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}};function se(e,t){if(e=e.fragments,(t=t.fragments).length&&e.length){if(t=function(e,t){for(var n=null,r=0;r<e.length;r+=1){var i=e[r];if(i&&i.cc===t){n=i;break}}return n}(e,t[0].cc),t&&(!t||t.startPTS))return t;l.logger.log("No frag in previous level to align on")}else l.logger.log("No fragments to align")}function ae(e,t){t.fragments.forEach((function(t){var n;t&&(n=t.start+e,t.start=t.startPTS=n,t.endPTS=n+t.duration)})),t.PTSKnown=!0}function oe(e,t,n){var r;!function(e,t,n){var r=!1;return!!(t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC))||r}(e,r=t,e=n)||(r=se(r.details,e))&&(l.logger.log("Adjusting PTS using last level due to CC increase within current level"),ae(r.start,e)),!n.PTSKnown&&t&&function(e,t){var n;t&&t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime&&(n=t.fragments[0].programDateTime,t=(e.fragments[0].programDateTime-n)/1e3+t.fragments[0].start,Object(c.isFiniteNumber)(t)&&(l.logger.log("adjusting PTS using programDateTime delta, sliding:"+t.toFixed(3)),ae(t,e)))}(n,t.details)}function ce(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Object(c.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if((e[e.length-1].endProgramDateTime||0)<=t)return null;n=n||0;for(var r=0;r<e.length;++r){var i=e[r];if(function(e,t,n){return t=1e3*Math.min(t,n.duration+(n.deltaPTS||0)),(n.endProgramDateTime||0)-t>e}(t,n,i))return i}return null}function ue(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null;return e?i=t[e.sn-t[0].sn+1]:0===n&&0===t[0].start&&(i=t[0]),i&&0===le(n,r,i)?i:(r=V.search(t,le.bind(null,n,r)))||i}function le(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),t=Math.min(t,n.duration+(n.deltaPTS||0)),n.start+n.duration-t<=e?1:n.start-t>e&&n.start?-1:0}var de=function(){function e(e,t,n,r){this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,n=this.media,r=this.stalled,i=n.currentTime,s=n.seeking,a=this.seeking&&!s,o=!this.seeking&&s;if(this.seeking=s,i!==e)return this.moved=!0,void(null!==r&&(this.stallReported&&(c=self.performance.now()-r,l.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(c)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0));if((o||a)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var c=0<(e=q.bufferInfo(n,i,0)).len;if(o=e.nextStart||0,c||o){if(s){if(a=2<e.len,c=!o||2<o-i&&!this.fragmentTracker.getPartialFragment(i),a||c)return;this.moved=!1}if(!this.moved&&this.stalled){var u=Math.max(o,e.start||0)-i;if(0<u&&u<=2)return void this._trySkipBufferHole(null)}u=self.performance.now(),null!==r?(r=u-r,!s&&250<=r&&this._reportStall(e.len),t=q.bufferInfo(n,i,t.maxBufferHole),this._tryFixBufferStall(t,r)):this.stalled=u}}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime;(i=r.getPartialFragment(i))&&this._trySkipBufferHole(i)||e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(l.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,l.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,n=this.hls,r=this.media,i=r.currentTime,s=0,a=0;a<r.buffered.length;a++){var c=r.buffered.start(a);if(i+t.maxBufferHole>=s&&i<c)return c=Math.max(c+.05,r.currentTime+.1),l.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+c),this.moved=!0,this.stalled=null,r.currentTime=c,e&&n.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+c,frag:e}),c;s=r.buffered.end(a)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;(this.nudgeRetry=i)<e.nudgeMaxRetry?(i=r+i*e.nudgeOffset,l.logger.warn("Nudging 'currentTime' from "+r+" to "+i),n.currentTime=i,t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(l.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))},e}(),he=function(e){var t;function n(t){for(var n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return(t=e.call.apply(e,[this,t].concat(r))||this)._boundTick=void 0,t._tickTimer=null,t._tickInterval=null,t._tickCallCount=0,t._boundTick=t.tick.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)),t}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},r.hasInterval=function(){return!!this._tickInterval},r.hasNextTick=function(){return!!this._tickTimer},r.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},r.clearInterval=function(){return!(!this._tickInterval||(self.clearInterval(this._tickInterval),this._tickInterval=null))},r.clearNextTick=function(){return!(!this._tickTimer||(self.clearTimeout(this._tickTimer),this._tickTimer=null))},r.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},r.doTick=function(){},n}(h),fe="STOPPED",pe="STARTING",ge="IDLE",me="PAUSED",ve="KEY_LOADING",ye="FRAG_LOADING",be="FRAG_LOADING_WAITING_RETRY",we="WAITING_TRACK",_e="PARSING",Ee="PARSED",Te="BUFFER_FLUSHING",Se="ENDED",Ie="ERROR",ke="WAITING_INIT_PTS",Ae="WAITING_LEVEL",Oe=function(e){var t;function n(){return e.apply(this,arguments)||this}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.doTick=function(){},r.startLoad=function(){},r.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=fe},r._streamEnded=function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;return!(t.live||!n||n.backtracked||n.sn!==t.endSN||e.nextStart||(n=r.getState(n))!==F&&n!==U)},r.onMediaSeeking=function(){var e,t=this.config,n=this.media,r=this.mediaBuffer,i=this.state,s=n?n.currentTime:null,a=q.bufferInfo(r||n,s,this.config.maxBufferHole);l.logger.log("media seeking to "+(Object(c.isFiniteNumber)(s)?s.toFixed(3):s)),i===ye?(e=this.fragCurrent,0===a.len&&e&&(r=t.maxFragLookUpTolerance,t=e.start-r,r=e.start+e.duration+r,s<t||r<s?(e.loader&&(l.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ge):l.logger.log("seeking outside of buffer but within currently loaded fragment range"))):i===Se&&(0===a.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=ge),n&&(this.lastCurrentTime=s),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=s),this.tick()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=fe,this.fragmentTracker=null},r.computeLivePosition=function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},n}(he);function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ce,Re=function(e){function t(t,n){var r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.LEVEL_LOADED,u.default.LEVELS_UPDATED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_LOAD_EMERGENCY_ABORTED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_SWITCHED,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED)||this;return r.fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=fe,r.stallReported=!1,r.gapController=null,r.altAudio=!1,r.audioOnly=!1,r.bitrateTest=!1,r}n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n,r,i=t.prototype;return i.startLoad=function(e){var t,n,r;this.levels?(t=this.lastCurrentTime,n=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(r=n.startLevel)&&(n.config.testBandwidth?this.bitrateTest=!(r=0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1),0<t&&-1===e&&(l.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=ge,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()):(this.forceStartLoad=!0,this.state=fe)},i.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case Te:this.fragLoadError=0;break;case ge:this._doTickIdle();break;case Ae:(e=this.levels[this.level])&&e.details&&(this.state=ge);break;case be:var e,t=window.performance.now();(!(e=this.retryDate)||e<=t||this.media&&this.media.seeking)&&(l.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ge)}this._checkBuffer(),this._checkFragmentChanged()},i._doTickIdle=function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&t.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var r=this.loadedmetadata?n.currentTime:this.nextLoadPosition,i=e.nextLoadLevel,s=this.levels[i];if(s){var a=(a=s.bitrate)?Math.max(8*t.maxBufferSize/a,t.maxBufferLength):t.maxBufferLength;if(a=Math.min(a,t.maxMaxBufferLength),t=r<t.maxBufferHole?Math.max(2,t.maxBufferHole):t.maxBufferHole,!(a<=(t=(n=q.bufferInfo(this.mediaBuffer||n,r,t)).len)))if(l.logger.trace("buffer length of "+t.toFixed(3)+" is below max of "+a.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i,!(s=s.details)||s.live&&this.levelLastLoaded!==i)this.state=Ae;else{if(this._streamEnded(n,s))return i={},this.altAudio&&(i.type="video"),this.hls.trigger(u.default.BUFFER_EOS,i),void(this.state=Se);this._fetchPayloadOrEos(r,n,s)}}}},i._fetchPayloadOrEos=function(e,t,n){var r=this.fragPrevious,i=(this.level,n.fragments),s=i.length;if(0!==s){var a,o=i[0].start,c=i[s-1].start+i[s-1].duration,u=t.end;if(n.initSegment&&!n.initSegment.data)a=n.initSegment;else if(n.live){if(s<(t=this.config.initialLiveManifestSize))return void l.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+t);if(null===(a=this._ensureFragmentAtLivePoint(n,u,o,c,r,i)))return}else u<o&&(a=i[0]);(a=a||this._findFragment(o,r,s,i,u,c,n))&&(a.encrypted?this._loadKey(a,n):this._loadFragment(a,n,e,u))}},i._ensureFragmentAtLivePoint=function(e,t,n,r,i,s){var a,o=this.hls.config,u=this.media,d=1/0;return void 0!==o.liveMaxLatencyDuration?d=o.liveMaxLatencyDuration:Object(c.isFiniteNumber)(o.liveMaxLatencyDurationCount)&&(d=o.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(n-o.maxFragLookUpTolerance,r-d)&&(t=n=this.liveSyncPosition=this.computeLivePosition(n,e),u&&!u.paused&&u.readyState&&u.duration>n&&n>u.currentTime&&(l.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+n.toFixed(3)),u.currentTime=n),this.nextLoadPosition=n),e.PTSKnown&&r<t&&u&&u.readyState?null:(this.startFragRequested&&!e.PTSKnown&&i&&(e.hasProgramDateTime?(l.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=ce(s,i.endProgramDateTime,o.maxFragLookUpTolerance)):((o=i.sn+1)>=e.startSN&&o<=e.endSN&&(e=s[o-e.startSN],i.cc===e.cc&&l.logger.log("live playlist, switching playlist, load frag with next SN: "+(a=e).sn)),a||(a=V.search(s,(function(e){return i.cc-e.cc})))&&l.logger.log("live playlist, switching playlist, load frag with same CC: "+a.sn))),a)},i._findFragment=function(e,t,n,r,i,s,a){var o,c=this.hls.config;return(o=i<s?ue(t,r,i,i>s-c.maxFragLookUpTolerance?0:c.maxFragLookUpTolerance):r[n-1])&&(i=o.sn-a.startSN,s=t&&o.level===t.level,n=r[i-1],r=r[1+i],t&&o.sn===t.sn&&(s&&!o.backtracked?o.sn<a.endSN?(a=t.deltaPTS)&&a>c.maxBufferHole&&t.dropped&&i?(o=n,l.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):this.fragmentTracker.getState(o=r)!==U&&l.logger.log("Re-loading fragment with SN: "+o.sn):o=null:o.backtracked&&(r&&r.backtracked?(l.logger.warn("Already backtracked from fragment "+r.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+r.sn),o=r):(l.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,n?(o=n).backtracked=!0:i&&(o=null))))),o},i._loadKey=function(e,t){l.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=ve,this.hls.trigger(u.default.KEY_LOADING,{frag:e})},i._loadFragment=function(e,t,n,r){var i=this.fragmentTracker.getState(e);"initSegment"!==(this.fragCurrent=e).sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===M||i===F?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,l.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(r.toFixed(3))),this.hls.trigger(u.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new X(this.hls,"main")),this.state=ye):i===j&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,s.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},i._checkFragmentChanged=function(){var e,t,n=this.media;n&&n.readyState&&!1===n.seeking&&((t=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),q.isBuffered(n,t)?e=this.getBufferedFrag(t):q.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),!e||(t=e)!==this.fragPlaying&&(this.hls.trigger(u.default.FRAG_CHANGED,{frag:t}),e=t.level,this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(u.default.LEVEL_SWITCHED,{level:e}),this.fragPlaying=t))},i.immediateLevelSwitch=function(){var e;l.logger.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,(e=this.media)?(t=e.paused)||e.pause():t=!0,this.previouslyPaused=t);var t=this.fragCurrent;t&&t.loader&&t.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,0<e.currentTime&&q.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.nextLevelSwitch=function(){var e,t,n,r=this.media;r&&r.readyState&&((e=this.getBufferedFrag(r.currentTime))&&1<e.startPTS&&this.flushMainBuffer(0,e.startPTS-1),n=r.paused?0:(t=this.hls.nextLoadLevel,n=this.levels[t],(t=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*t)+1:0),!(t=this.getBufferedFrag(r.currentTime+n))||(r=this.followingBufferedFrag(t))&&((n=this.fragCurrent)&&n.loader&&n.loader.abort(),this.fragCurrent=null,r=Math.max(t.endPTS,r.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,r.duration)),this.flushMainBuffer(r,Number.POSITIVE_INFINITY)))},i.flushMainBuffer=function(e,t){this.state=Te,t={startOffset:e,endOffset:t},this.altAudio&&(t.type="video"),this.hls.trigger(u.default.BUFFER_FLUSHING,t)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended),e=this.config,this.levels&&e.autoStartLoad&&this.hls.startLoad(e.startPosition),this.gapController=new de(e,t,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach((function(e){e.details&&e.details.fragments.forEach((function(e){e.backtracked=void 0}))})),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.onMediaSeeked=function(){var e=(e=this.media)?e.currentTime:void 0;Object(c.isFiniteNumber)(e)&&l.logger.log("media seeked to "+e.toFixed(3)),this.tick()},i.onManifestLoading=function(){l.logger.log("trigger BUFFER_RESET"),this.hls.trigger(u.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.onManifestParsed=function(e){var t,n=!1,r=!1;e.levels.forEach((function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&l.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1,((e=this.config).autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},i.onLevelLoaded=function(e){var t=e.details,n=e.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],s=t.totalduration,a=0;l.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+s),t.live||i.details&&i.details.live?(e=i.details)&&0<t.fragments.length?(te(e,t),a=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(a,e),t.PTSKnown&&Object(c.isFiniteNumber)(a)?l.logger.log("live playlist sliding:"+a.toFixed(3)):(l.logger.log("live playlist - outdated PTS, unknown sliding"),oe(this.fragPrevious,r,t))):(l.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,oe(this.fragPrevious,r,t)):t.PTSKnown=!1,i.details=t,this.levelLastLoaded=n,this.hls.trigger(u.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested&&(-1!==this.startPosition&&-1!==this.lastCurrentTime||(n=t.startTimeOffset,Object(c.isFiniteNumber)(n)?(n<0&&(l.logger.log("negative start time offset "+n+", count from end of last fragment"),n=a+s+n),l.logger.log("start time offset found in playlist, adjust startPosition to "+n),this.startPosition=n):t.live?(this.startPosition=this.computeLivePosition(a,t),l.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition),this.state===Ae&&(this.state=ge),this.tick()},i.onKeyLoaded=function(){this.state===ve&&(this.state=ge,this.tick())},i.onFragLoaded=function(e){var t,n,r=this.fragCurrent,i=this.hls,s=this.levels,a=this.media,o=e.frag;this.state===ye&&r&&"main"===o.type&&o.level===r.level&&o.sn===r.sn&&(n=e.stats,s=(t=s[r.level]).details,this.bitrateTest=!1,this.stats=n,l.logger.log("Loaded "+r.sn+" of ["+s.startSN+" ,"+s.endSN+"],level "+r.level),o.bitrateTest&&i.nextLoadLevel?(this.state=ge,this.startFragRequested=!1,n.tparsed=n.tbuffered=window.performance.now(),i.trigger(u.default.FRAG_BUFFERED,{stats:n,frag:r,id:"main"}),this.tick()):"initSegment"===o.sn?(this.state=ge,n.tparsed=n.tbuffered=window.performance.now(),s.initSegment.data=e.payload,i.trigger(u.default.FRAG_BUFFERED,{stats:n,frag:r,id:"main"}),this.tick()):(l.logger.log("Parsing "+r.sn+" of ["+s.startSN+" ,"+s.endSN+"],level "+r.level+", cc "+r.cc),this.state=_e,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o})),n=!(a&&a.seeking)&&(s.PTSKnown||!s.live),o=s.initSegment?s.initSegment.data:[],a=this._getAudioCodec(t),(this.demuxer=this.demuxer||new X(this.hls,"main")).push(e.payload,o,a,t.videoCodec,r,s.totalduration,n))),this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===_e){var r,i,s=e.tracks;for(r in this.audioOnly=s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio,(i=s.audio)&&(n=this.levels[this.level].audioCodec,t=navigator.userAgent.toLowerCase(),n&&this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===t.indexOf("firefox")&&(n="mp4a.40.5"),-1!==t.indexOf("android")&&"audio/mpeg"!==i.container&&l.logger.log("Android: force audio codec to "+(n="mp4a.40.2")),i.levelCodec=n,i.id=e.id),(i=s.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),this.hls.trigger(u.default.BUFFER_CODECS,s),s){i=s[r],l.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var a=i.initSegment;a&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,{type:r,data:a,parent:"main",content:"initSegment"}))}this.tick()}},i.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"main"===e.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===_e){var i=this.levels[this.level];if(r=n,Object(c.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&r.addElementaryStream(g.AUDIO),!0===e.hasVideo&&r.addElementaryStream(g.VIDEO),l.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(r.dropped=e.dropped,r.dropped)if(r.backtracked)l.logger.warn("Already backtracked on this fragment, appending with the gap",r.sn);else{if(!(n=i.details)||r.sn!==n.startSN)return l.logger.warn("missing video frame(s), backtracking fragment",r.sn),this.fragmentTracker.removeFragment(r),r.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=ge,this.fragPrevious=r,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();l.logger.warn("missing video frame(s) on first frag, appending with gap",r.sn)}else r.backtracked=!1;r=ee(i.details,r,e.startPTS,e.endPTS,e.startDTS,e.endDTS);var s=this.hls;s.trigger(u.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:r,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach((function(n){n&&n.length&&t.state===_e&&(t.appended=!0,t.pendingBuffering=!0,s.trigger(u.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))})),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===_e&&(this.stats.tparsed=window.performance.now(),this.state=Ee,this._checkAppendedParsed())},i.onAudioTrackSwitching=function(e){var t,n=this.altAudio,r=!!e.url;e=e.id,r||(this.mediaBuffer!==this.media&&(l.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(t=this.fragCurrent).loader&&(l.logger.log("switching to main audio track, cancel main fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ge),t=this.hls,n&&t.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),t.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:e}))},i.onAudioTrackSwitched=function(e){var t=e.id;!(e=!!this.hls.audioTracks[t].url)||(t=this.videoBuffer)&&this.mediaBuffer!==t&&(l.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t),this.altAudio=e,this.tick()},i.onBufferCreated=function(e){var t,n,r,i=e.tracks,s=!1;for(r in i){var a=i[r];"main"===a.id?(t=a,"video"===(n=r)&&(this.videoBuffer=i[r].buffer)):s=!0}s&&t?(l.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},i.onBufferAppended=function(e){var t;"main"===e.parent&&((t=this.state)!==_e&&t!==Ee||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed()))},i._checkAppendedParsed=function(){var e,t;this.state!==Ee||this.appended&&this.pendingBuffering||((e=this.fragCurrent)&&(t=this.mediaBuffer||this.media,l.logger.log("main buffered : "+ie.toString(t.buffered)),this.fragPrevious=e,(t=this.stats).tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*t.total/(t.tbuffered-t.tfirst)),this.hls.trigger(u.default.FRAG_BUFFERED,{stats:t,frag:e,id:"main"}),this.state=ge),(this.loadedmetadata||this.startPosition<=0)&&this.tick())},i.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n,r=!!this.media&&q.isBuffered(this.media,this.media.currentTime)&&q.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:e.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(n=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),l.logger.warn("mediaController: frag loading failed, retry in "+n+" ms"),this.retryDate=window.performance.now()+n,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=be):(l.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ie));break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Ie&&(e.fatal?(this.state=Ie,l.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==Ae||(this.state=ge));break;case o.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==_e&&this.state!==Ee||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ge):(l.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},i._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,l.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},i._checkBuffer=function(){var e=this.media;e&&0!==e.readyState&&(e=(this.mediaBuffer||e).buffered,!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e))},i.onFragLoadEmergencyAborted=function(){this.state=ge,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.onBufferFlushed=function(){var e,t=this.mediaBuffer||this.media;t&&(e=this.audioOnly?g.AUDIO:g.VIDEO,this.fragmentTracker.detectEvictedFragments(e,t.buffered)),this.state=ge,this.fragPrevious=null},i.onLevelsUpdated=function(e){this.levels=e.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i._seekToStartPos=function(){var e,t=this.media,n=t.currentTime,r=this.startPosition;n!==r&&0<=r&&(t.seeking?l.logger.log("could not seek to "+r+", already seeking at "+n):(0<(e=(t.buffered.length?t.buffered.start(0):0)-r)&&e<this.config.maxBufferHole&&(l.logger.log("adjusting start position by "+e+" to match buffer start"),this.startPosition=r+=e),l.logger.log("seek to target start position "+r+" from current time "+n+". ready state "+t.readyState),t.currentTime=r))},i._getAudioCodec=function(e){return e=this.config.defaultAudioCodec||e.audioCodec,this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),e=e&&(-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},n=t,(i=[{key:"state",set:function(e){var t;this.state!==e&&(t=this.state,this._state=e,l.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(u.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e}))},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;return e&&(e=this.getBufferedFrag(e.currentTime))?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}])&&xe(n.prototype,i),r&&xe(n,r),t}(Oe);function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Le=function(e){function t(t){return(t=e.call(this,t,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this).canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,Ce=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t}n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n,r,i=t.prototype;return i.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},i.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},i.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach((function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)})),null!==this.timer&&this.loadLevel()},i.stopLoad=function(){this.canload=!1},i.onManifestLoaded=function(e){var t,n=[],r=[],i={},s=null,a=!1,c=!1;if(e.levels.forEach((function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,a=a||!!e.videoCodec,c=c||!!e.audioCodec,Ce&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(s=i[e.bitrate])?s.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,n.push(e)),t&&(t.AUDIO&&J(s||e,"audio",t.AUDIO),t.SUBTITLES&&J(s||e,"text",t.SUBTITLES))})),n=(n=a&&c?n.filter((function(e){return!!e.videoCodec})):n).filter((function(e){var t=e.audioCodec;return e=e.videoCodec,(!t||I(t,"audio"))&&(!e||I(e,"video"))})),e.audioTracks&&(r=e.audioTracks.filter((function(e){return!e.audioCodec||I(e.audioCodec,"audio")}))).forEach((function(e,t){e.id=t})),0<n.length){t=n[0].bitrate,n.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=n;for(var d=0;d<n.length;d++)if(n[d].bitrate===t){this._firstLevel=d,l.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(u.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:e.stats,audio:c,video:a,altAudio:!(c&&!a)&&r.some((function(e){return!!e.url}))})}else this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},i.setLevelInternal=function(e){var t,n=this._levels,r=this.hls;0<=e&&e<n.length?(this.clearTimer(),this.currentLevelIndex!==e&&(l.logger.log("switching to level "+e),(t=n[this.currentLevelIndex=e]).level=e,r.trigger(u.default.LEVEL_SWITCHING,t)),(n=(t=n[e]).details)&&!n.live||(n=t.urlId,r.trigger(u.default.LEVEL_LOADING,{url:t.url[n],level:e,id:n}))):r.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},i.onError=function(e){if(e.fatal)e.type===o.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,n=!1,r=!1;switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,r=!0;break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,n=!0;break;case o.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,n=!0}void 0!==t&&this.recoverLevel(e,t,n,r)}},i.recoverLevel=function(e,t,n,r){var i=this,s=this.hls.config,a=e.details,o=this._levels[t];if(o.loadError++,o.fragmentError=r,n){if(!(this.levelRetryCount+1<=s.levelLoadingMaxRetry))return l.logger.error("level controller, cannot recover from "+a+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);s=Math.min(Math.pow(2,this.levelRetryCount)*s.levelLoadingRetryDelay,s.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return i.loadLevel()}),s),e.levelRetry=!0,this.levelRetryCount++,l.logger.warn("level controller, "+a+", retry in "+s+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&(1<(n=o.url.length)&&o.loadError<n?(o.urlId=(o.urlId+1)%n,o.details=void 0,l.logger.warn("level controller, "+a+" for level "+t+": switching to redundant URL-id "+o.urlId)):-1===this.manualLevelIndex?(t=0===t?this._levels.length-1:t-1,l.logger.warn("level controller, "+a+": switch to "+t),this.hls.nextAutoLevel=this.currentLevelIndex=t):r&&(l.logger.warn("level controller, "+a+": reload a fragment"),this.currentLevelIndex=null))},i.onFragLoaded=function(e){void 0===(e=e.frag)||"main"!==e.type||void 0!==(e=this._levels[e.level])&&(e.fragmentError=!1,e.loadError=0,this.levelRetryCount=0)},i.onLevelLoaded=function(e){var t=this,n=e.level,r=e.details;n===this.currentLevelIndex&&((n=this._levels[n]).fragmentError||(n.loadError=0,this.levelRetryCount=0),r.live?(e=re(n.details,r,e.stats.trequest),l.logger.log("live playlist, reload in "+Math.round(e)+" ms"),this.timer=setTimeout((function(){return t.loadLevel()}),e)):this.clearTimer())},i.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===t){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},i.loadLevel=function(){var e,t,n;l.logger.debug("call to loadLevel"),null===this.currentLevelIndex||!this.canload||"object"==typeof(n=this._levels[this.currentLevelIndex])&&0<n.url.length&&(e=this.currentLevelIndex,t=n.urlId,n=n.url[t],l.logger.log("Attempt loading level index "+e+" with URL-id "+t),this.hls.trigger(u.default.LEVEL_LOADING,{url:n,level:e,id:t}))},i.removeLevel=function(e,t){var n=this.levels.filter((function(n,r){return r!==e||1<n.url.length&&void 0!==t&&(n.url=n.url.filter((function(e,n){return n!==t})),!(n.urlId=0))})).map((function(e,t){var n=e.details;return n&&n.fragments&&n.fragments.forEach((function(e){e.level=t})),e}));this._levels=n,this.hls.trigger(u.default.LEVELS_UPDATED,{levels:n})},n=t,(i=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&De(n.prototype,i),r&&De(n,r),t}(h),Pe=n("./src/demux/id3.js");function Ne(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function Me(e){if(null!=e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}var je=function(e){var t;function n(t){return(t=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA,u.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,t.media=void 0,t}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.destroy=function(){h.prototype.destroy.call(this)},r.onMediaAttached=function(e){this.media=e.media,this.media},r.onMediaDetaching=function(){Me(this.id3Track),this.id3Track=void 0,this.media=void 0},r.getID3Track=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return Ne(n,this.media),n}return this.media.addTextTrack("metadata","id3")},r.onFragParsingMetadata=function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var s=Pe.default.getID3Frames(n[i].data);if(s){var a=Math.max(n[i].pts,0),o=i<n.length-1?n[i+1].pts:t.endPTS;(o=o||t.start+t.duration)-a<=0&&(o=a+.25);for(var c=0;c<s.length;c++){var u,l=s[c];Pe.default.isTimeStampFrame(l)||((u=new r(a,o,"")).value=l,this.id3Track.addCue(u))}}}},r.onLiveBackBufferReached=function(e){e=e.bufferEnd;var t=this.id3Track;if(t&&t.cues&&t.cues.length){var n=function(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var n=0,r=e.length-1;n<=r;){var i=Math.floor((r+n)/2);if(t<e[i].endTime)r=i-1;else{if(!(t>e[i].endTime))return e[i];n=i+1}}return e[n].endTime-t<t-e[r].endTime?e[n]:e[r]}(t.cues,e);if(n)for(;t.cues[0]!==n;)t.removeCue(t.cues[0])}},n}(h),Fe=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),Ue=function(){function e(e,t,n,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Fe(t),this.fast_=new Fe(n)}var t=e.prototype;return t.sample=function(e,t){t=8*t/(e=(e=Math.max(e,this.minDelayMs_))/1e3),this.fast_.sample(e,t),this.slow_.sample(e,t)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ve=window.performance,qe=function(e){function t(t){var n=e.call(this,t,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR)||this;return n.lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n,r,i=t.prototype;return i.destroy=function(){this.clearTimer(),h.prototype.destroy.call(this)},i.onFragLoading=function(e){var t,n,r=e.frag;"main"===r.type&&(this.timer||(this.fragCurrent=r,this.timer=setInterval(this.onCheck,100)),this._bwEstimator||(e=(t=this.hls).config,r=r.level,r=t.levels[r].details.live?(n=e.abrEwmaFastLive,e.abrEwmaSlowLive):(n=e.abrEwmaFastVoD,e.abrEwmaSlowVoD),this._bwEstimator=new Ue(t,r,n,e.abrEwmaDefaultEstimate)))},i._abandonRulesCheck=function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var r=n.loader;if(!r||r.stats&&r.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var i=r.stats;if(t&&i&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var s=Ve.now()-i.trequest,a=Math.abs(t.playbackRate);if(s>500*n.duration/a){var o=e.levels,c=Math.max(1,i.bw?i.bw/8:1e3*i.loaded/s);if(h=o[n.level]){var d=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,h=i.total||Math.max(i.loaded,Math.round(n.duration*d/8)),f=(d=t.currentTime,h=(h-i.loaded)/c,(q.bufferInfo(t,d,e.config.maxBufferHole).end-d)/a);if(f<2*n.duration/a&&f<h){for(var p=e.minAutoLevel,g=n.level-1;p<g;g--){var m=o[g].realBitrate?Math.max(o[g].realBitrate,o[g].bitrate):o[g].bitrate;if(n.duration*m/(6.4*c)<f)break}void 0<h&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+g+":fragLoadedDelay["+g+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+h.toFixed(1)+":"+f.toFixed(1)),e.nextLoadLevel=g,this._bwEstimator.sample(s,i.loaded),r.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:i}))}}}}}},i.onFragLoaded=function(e){var t,n,r=e.frag;"main"===r.type&&Object(c.isFiniteNumber)(r.sn)&&(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(r=((t=this.hls.levels[r.level]).loaded?t.loaded.bytes:0)+e.stats.loaded,n=(t.loaded?t.loaded.duration:0)+e.frag.duration,t.loaded={bytes:r,duration:n},t.realBitrate=Math.round(8*r/n)),e.frag.bitrateTest&&((n=e.stats).tparsed=n.tbuffered=n.tload,this.onFragBuffered(e)))},i.onFragBuffered=function(e){var t=e.stats,n=e.frag;!0===t.aborted||"main"!==n.type||!Object(c.isFiniteNumber)(n.sn)||n.bitrateTest&&t.tload!==t.tbuffered||(e=t.tparsed-t.trequest,l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(e,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0)},i.onError=function(e){switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},i.clearTimer=function(){clearInterval(this.timer),this.timer=null},i._findBestLevel=function(e,t,n,r,i,s,a,o,c){for(var u=i;r<=u;u--)if(d=c[u]){var d,h=(g=d.details)?g.totalduration/g.fragments.length:t,f=!!g&&g.live,p=void 0,g=(p=u<=e?a*n:o*n,(d=c[u].realBitrate?Math.max(c[u].realBitrate,c[u].bitrate):c[u].bitrate)*h/p);if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+d+"/"+h+"/"+s+"/"+g),d<p&&(!g||f&&!this.bitrateTestDelay||g<s))return u}return-1},n=t,(i=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;return-1===e||t&&t.canEstimate()?(t=this._nextABRAutoLevel,-1!==e?Math.min(e,t):t):e},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,r=e.config,i=e.minAutoLevel,s=e.media,a=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,c=s?s.currentTime:0,u=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,h=(q.bufferInfo(s,c,r.maxBufferHole).end-c)/u,f=this._findBestLevel(a,o,d,i,t,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);return 0<=f?f:(l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering"),e=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay,s=r.abrBandWidthFactor,c=r.abrBandWidthUpFactor,0!=h||(u=this.bitrateTestDelay)&&(e=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-u,l.logger.trace("bitrate test took "+Math.round(1e3*u)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*e)+" ms"),s=c=1),f=this._findBestLevel(a,o,d,i,t,h+e,s,c,n),Math.max(f,0))}}])&&Be(n.prototype,i),r&&Be(n,r),t}(h),Ge=H(),Ke=function(e){var t;function n(t){var n=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED)||this;return n._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){l.logger.log("media source opened"),n.hls.trigger(u.default.MEDIA_ATTACHED,{media:n.media});var e=n.mediaSource;e&&e.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){l.logger.log("media source closed")},n._onMediaSourceEnded=function(){l.logger.log("media source ended")},n._onSBUpdateEnd=function(){n.audioTimestampOffset&&n.sourceBuffer.audio&&(r=n.sourceBuffer.audio,l.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+n.audioTimestampOffset),r.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset),n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var e,t=n.parent,r=n.segments.reduce((function(e,n){return n.parent===t?e+1:e}),0),i={},s=n.sourceBuffer;for(e in s){var a=s[e];if(!a)throw Error("handling source buffer update end error: source buffer for "+e+" uninitilized and unable to update buffered TimeRanges.");i[e]=a.buffered}n.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:i}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===r&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(e){l.logger.error("sourceBuffer error:",e),n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=t.config,n}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.destroy=function(){h.prototype.destroy.call(this)},r.onLevelPtsUpdated=function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){if(!(t=this.sourceBuffer.audio))throw Error("Level PTS Updated and source buffer for audio uninitalized");if(.1<Math.abs(t.timestampOffset-e.start)){n=t.updating;try{t.abort()}catch(e){l.logger.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(l.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+e.start),t.timestampOffset=e.start)}}},r.onManifestParsed=function(e){var t=2;(!e.audio||e.video)&&e.altAudio||(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,l.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},r.onMediaAttaching=function(e){var t=this.media=e.media;t&&Ge&&((e=this.mediaSource=new Ge).addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(e),this._objectUrl=t.src)},r.onMediaDetaching=function(){l.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){l.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):l.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(u.default.MEDIA_DETACHED)},r.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||2===n)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},r.onBufferReset=function(){var e,t=this.sourceBuffer;for(e in t){var n=t[e];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},r.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach((function(n){t.pendingTracks[n]=e[n]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},r.createSourceBuffers=function(e){var t,n=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(t in e)if(!n[t]){var i=e[t];if(!i)throw Error("source buffer exists for track "+t+", however track does not");var s=i.levelCodec||i.codec,a=i.container+";codecs="+s;l.logger.log("creating sourceBuffer("+a+")");try{var c=n[t]=r.addSourceBuffer(a);c.addEventListener("updateend",this._onSBUpdateEnd),c.addEventListener("error",this._onSBUpdateError),this.tracks[t]={buffer:c,codec:s,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(e){l.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:a})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:this.tracks})},r.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},r.onBufferEos=function(e){for(var t in this.sourceBuffer){var n;e.type&&e.type!==t||(n=this.sourceBuffer[t])&&!n.ended&&(n.ended=!0,l.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},r.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e)if(n=e[n]){if(!n.ended)return;if(n.updating)return void(this._needsEos=!0)}l.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},r.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},r.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=t-Math.max(e,this._levelTargetDuration),s=r.length-1;0<=s;s--){var a,o=r[s],c=n[o];!c||0<(a=c.buffered).length&&i>a.start(0)&&this.removeBufferRange(o,c,0,i)&&this.hls.trigger(u.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}else l.logger.error("flushLiveBackBuffer called without attaching media")}},r.onLevelUpdated=function(e){0<(e=e.details).fragments.length&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._levelTargetDuration=e.averagetargetduration||e.targetduration||10,this._live=e.live,this.updateMediaElementDuration())},r.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer)if((n=this.sourceBuffer[n])&&!0===n.updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(l.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(c.isFiniteNumber)(e))&&(l.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},r.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n){var i=n[r];i&&(t+=i.buffered.length)}}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}},r.doAppending=function(){var e=this.config,t=this.hls,n=this.segments,r=this.sourceBuffer;if(Object.keys(r).length){if(!this.media||this.media.error)return this.segments=[],void l.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=n.shift();if(i)try{var s=r[i.type];if(!s)return void this._onSBUpdateEnd();if(s.updating)return void n.unshift(i);s.ended=!1,this.parent=i.parent,s.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(r){l.logger.error("error while trying to append buffer:"+r.message),n.unshift(i),i={type:o.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1},22===r.code?(this.segments=[],i.details=o.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,i.details=o.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(l.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],i.fatal=!0)),t.trigger(u.default.ERROR,i)}}}},r.flushBuffer=function(e,t,n){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),l.logger.log("flushBuffer,pos/start/end: "+i+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return l.logger.warn("abort flushing too many retries"),!0;if(r=r[n]){if(r.ended=!1,r.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,r,e,t))return this.flushBufferCounter++,!1}return l.logger.log("buffer flushed"),!0},r.removeBufferRange=function(e,t,n,r){try{for(var i=0;i<t.buffered.length;i++){var s=t.buffered.start(i),a=t.buffered.end(i),o=Math.max(s,n),c=Math.min(a,r);if(.5<Math.min(c,a)-o){var u="null";return this.media&&(u=this.media.currentTime.toString()),l.logger.log("sb remove "+e+" ["+o+","+c+"], of ["+s+","+a+"], pos:"+u),t.remove(o,c),!0}}}catch(e){l.logger.warn("removeBufferRange failed",e)}return!1},n}(h);function ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var He=function(e){function t(t){return(t=e.call(this,t,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED,u.default.LEVELS_UPDATED,u.default.BUFFER_CODECS,u.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,t.firstLevel=null,t.levels=[],t.media=null,t.restrictedLevels=[],t.timer=null,t.clientRect=null,t}r=e,(n=t).prototype=Object.create(r.prototype),(n.prototype.constructor=n).__proto__=r;var n,r,i=t.prototype;return i.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},i.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},i.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},i.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onLevelsUpdated=function(e){this.levels=e.levels},i.onMediaDetaching=function(){this.stopCapping()},i.detectPlayerSize=function(){var e,t;!this.media||(e=this.levels?this.levels.length:0)&&((t=this.hls).autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping)},i.getMaxLevel=function(e){var n=this;if(!this.levels)return-1;var r=this.levels.filter((function(r,i){return t.isLevelAllowed(i,n.restrictedLevels)&&i<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},i.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},i.getDimensions=function(){if(this.clientRect)return this.clientRect;var e,t=this.media,n={width:0,height:0};return t&&(e=t.getBoundingClientRect(),n.width=e.width,n.height=e.height,n.width||n.height||(n.width=e.right-e.left||t.width||0,n.height=e.bottom-e.top||t.height||0)),this.clientRect=n},t.isLevelAllowed=function(e,t){return-1===(t=void 0===t?[]:t).indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var r,i,s=e.length-1,a=0;a<e.length;a+=1){var o=e[a];if((o.width>=t||o.height>=n)&&(r=o,!(i=e[a+1])||r.width!==i.width||r.height!==i.height)){s=a;break}}return s},n=t,r=[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}],(i=[{key:"mediaWidth",get:function(){return this.getDimensions().width*t.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*t.contentScaleFactor}}])&&ze(n.prototype,i),r&&ze(n,r),t}(h),We=window.performance,$e=(t=function(e){var t;function n(t){return e.call(this,t,u.default.MEDIA_ATTACHING)||this}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},r.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},r.checkFPS=function(e,t,n){var r,i,s,a,o=We.now();t&&(this.lastTime&&(s=o-this.lastTime,r=n-this.lastDroppedFrames,a=t-this.lastDecodedFrames,i=1e3*r/s,(s=this.hls).trigger(u.default.FPS_DROP,{currentDropped:r,currentDecoded:a,totalDroppedFrames:n}),0<i&&r>s.config.fpsDroppedMonitoringThreshold*a&&(a=s.currentLevel,l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),0<a&&(-1===s.autoLevelCapping||s.autoLevelCapping>=a)&&(s.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:a-=1,droppedLevel:s.currentLevel}),s.autoLevelCapping=a,s.streamController.nextLevelSwitch()))),this.lastTime=o,this.lastDroppedFrames=n,this.lastDecodedFrames=t)},r.checkFPSInterval=function(){var e,t=this.video;t&&(this.isVideoPlaybackQualityAvailable?(e=t.getVideoPlaybackQuality(),this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)):this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount))},n}(h),function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.context,t=this.loader=new window.XMLHttpRequest,n=this.stats;n.tfirst=0,n.loaded=0,n=this.xhrSetup;try{if(n)try{n(t,e.url)}catch(r){t.open("GET",e.url,!0),n(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(n){return void this.callbacks.onError({code:t.status,text:n.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.readystatechange=function(e){var t,n=e.currentTarget,r=n.readyState,i=this.stats,s=this.context,a=this.config;i.aborted||2<=r&&(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(window.performance.now(),i.trequest)),4===r?200<=(e=n.status)&&e<300?(i.tload=Math.max(i.tfirst,window.performance.now()),r="arraybuffer"===s.responseType?(t=n.response).byteLength:(t=n.responseText).length,i.loaded=i.total=r,t={url:n.responseURL,data:t},this.callbacks.onSuccess(t,i,s,n)):i.retry>=a.maxRetry||400<=e&&e<499?(l.logger.error(e+" while loading "+s.url),this.callbacks.onError({code:e,text:n.statusText},s,n)):(l.logger.warn(e+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),i.retry++):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout))},t.loadtimeout=function(){l.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total),(e=this.callbacks.onProgress)&&e(n,this.context,null,t)},e}());function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qe=function(e){function t(t){return(t=e.call(this,t,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.AUDIO_TRACK_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.LEVEL_LOADED,u.default.ERROR)||this)._trackId=-1,t._selectDefaultTrack=!0,t.tracks=[],t.trackIdBlacklist=Object.create(null),t.audioGroupId=null,t}n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n,r,i=t.prototype;return i.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},i.onManifestParsed=function(e){e=this.tracks=e.audioTracks||[],this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:e}),this._selectAudioGroup(this.hls.nextLoadLevel)},i.onAudioTrackLoaded=function(e){var t;e.id>=this.tracks.length?l.logger.warn("Invalid audio track id:",e.id):(l.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()&&(t=1e3*e.details.targetduration,this.setInterval(t)),!e.details.live&&this.hasInterval()&&this.clearInterval())},i.onAudioTrackSwitched=function(e){(e=this.tracks[e.id].groupId)&&this.audioGroupId!==e&&(this.audioGroupId=e)},i.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},i.onError=function(e){e.type===o.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(l.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},i._setAudioTrack=function(e){var t,n,r;this._trackId===e&&this.tracks[this._trackId].details?l.logger.debug("Same id as current audio-track passed, and track details available -> no-op"):e<0||e>=this.tracks.length?l.logger.warn("Invalid id passed to audio-track controller"):(t=this.tracks[e],l.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e,n=t.url,r=t.type,e=t.id,this.hls.trigger(u.default.AUDIO_TRACK_SWITCHING,{id:e,type:r,url:n}),this._loadTrackDetailsIfNeeded(t))},i.doTick=function(){this._updateTrack(this._trackId)},i._selectAudioGroup=function(e){(e=this.hls.levels[e])&&e.audioGroupIds&&(e=e.audioGroupIds[e.urlId],this.audioGroupId!==e&&(this.audioGroupId=e,this._selectInitialAudioTrack()))},i._selectInitialAudioTrack=function(){var e,t,n,r,i=this,s=this.tracks;s.length&&(e=this.tracks[this._trackId],t=null,e&&(t=e.name),this._selectDefaultTrack&&((r=s.filter((function(e){return e.default}))).length?s=r:l.logger.warn("No default audio tracks defined")),n=!1,(r=function(){s.forEach((function(e){n||i.audioGroupId&&e.groupId!==i.audioGroupId||t&&t!==e.name||(i._setAudioTrack(e.id),n=!0)}))})(),n||(t=null,r()),n||(l.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0})))},i._needsTrackLoading=function(e){var t=e.details;return e=e.url,!(t&&!t.live||!e)},i._loadTrackDetailsIfNeeded=function(e){var t;this._needsTrackLoading(e)&&(t=e.url,e=e.id,l.logger.log("loading audio-track playlist for id: "+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:t,id:e}))},i._updateTrack=function(e){e<0||e>=this.tracks.length||(this.clearInterval(),this._trackId=e,l.logger.log("trying to update audio-track "+e),e=this.tracks[e],this._loadTrackDetailsIfNeeded(e))},i._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=(r=this.tracks[e]).name,n=r.language,r=r.groupId;l.logger.warn("Loading failed on audio track id: "+e+", group-id: "+r+', name/language: "'+t+'" / "'+n+'"');for(var i=e,s=0;s<this.tracks.length;s++)if(!this.trackIdBlacklist[s]&&this.tracks[s].name===t){i=s;break}i!==e?(l.logger.log("Attempting audio-track fallback id:",i,"group-id:",this.tracks[i].groupId),this._setAudioTrack(i)):l.logger.warn('No fallback audio-track found for name/language: "'+t+'" / "'+n+'"')},n=t,(i=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}])&&Ye(n.prototype,i),r&&Ye(n,r),t}(he);function Xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Je(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}var Ze=window.performance,et=function(e){function t(t,n){var r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.AUDIO_TRACKS_UPDATED,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_LOADED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.BUFFER_RESET,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED,u.default.INIT_PTS_FOUND)||this;return r.fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=fe,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r.waitingVideoCC=null,r}n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n,r,i=t.prototype;return i.onInitPtsFound=function(e){var t=e.id,n=e.frag.cc;e=e.initPTS,"main"===t&&(this.initPTS[n]=e,this.videoTrackCC=n,l.logger.log("InitPTS for cc: "+n+" found from main: "+e),this.state===ke&&this.tick())},i.startLoad=function(e){var t;this.tracks?(t=this.lastCurrentTime,this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<t&&-1===e?(l.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=ge):(this.lastCurrentTime=this.startPosition||e,this.state=pe),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()):(this.startPosition=e,this.state=fe)},i.doTick=function(){var e,t,n,r=this.hls,i=r.config;switch(this.state){case Ie:case me:case Te:break;case pe:this.state=we,this.loadedmetadata=!1;break;case ge:var s=this.tracks;if(!s)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var a=this.mediaBuffer||this.media,o=this.videoBuffer||this.media,d=e<i.maxBufferHole?Math.max(2,i.maxBufferHole):i.maxBufferHole,h=q.bufferInfo(a,e,d),f=q.bufferInfo(o,e,d),p=h.len,g=h.end,m=this.fragPrevious,v=Math.min(i.maxBufferLength,i.maxMaxBufferLength),y=Math.max(v,f.len);if(o=this.audioSwitch,d=this.trackId,(p<y||o)&&d<s.length){if(void 0===(t=s[d].details)){this.state=we;break}if(!o&&this._streamEnded(h,t))return this.hls.trigger(u.default.BUFFER_EOS,{type:"audio"}),void(this.state=Se);var b;if(f=(v=t.fragments).length,p=v[0].start,y=v[f-1].start+v[f-1].duration,o)if(t.live&&!t.PTSKnown)l.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),g=0;else if(g=e,t.PTSKnown&&e<p){if(!(h.end>p||h.nextStart))return;l.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=p+.05}if(t.initSegment&&!t.initSegment.data)b=t.initSegment;else if(g<=p){if(b=v[0],null!==this.videoTrackCC&&b.cc!==this.videoTrackCC&&(s=v,n=this.videoTrackCC,b=V.search(s,(function(e){return e.cc<n?1:e.cc>n?-1:0}))),t.live&&b.loadIdx&&b.loadIdx===this.fragLoadIdx){var w=h.nextStart||p;return l.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(w+.05)),void(this.media.currentTime=w+.05)}}else{var _=i.maxFragLookUpTolerance;w=m?v[m.sn-v[0].sn+1]:void 0,f=g<y?(y-_<g&&(_=0),w&&!le(g,_,w)?w:V.search(v,(function(e){return le(g,_,e)}))):v[f-1],f&&(p=(b=f).start,m&&b.level===m.level&&b.sn===m.sn&&(b.sn<t.endSN?(b=v[b.sn+1-t.startSN],this.fragmentTracker.getState(b)!==U&&l.logger.log("SN just loaded, load next one: "+b.sn)):b=null))}b&&(b.encrypted?(l.logger.log("Loading key for "+b.sn+" of ["+t.startSN+" ,"+t.endSN+"],track "+d),this.state=ve,r.trigger(u.default.KEY_LOADING,{frag:b})):(this.fragCurrent=b,!o&&this.fragmentTracker.getState(b)!==M||(l.logger.log("Loading "+b.sn+", cc: "+b.cc+" of ["+t.startSN+" ,"+t.endSN+"],track "+d+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+g.toFixed(3)),"initSegment"!==b.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(b.sn)&&(this.nextLoadPosition=b.start+b.duration),r.trigger(u.default.FRAG_LOADING,{frag:b}),this.state=ye)))}break;case we:(b=this.tracks[this.trackId])&&b.details&&(this.state=ge);break;case be:var E=Ze.now(),T=this.retryDate,S=(a=this.media)&&a.seeking;(!T||T<=E||S)&&(l.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ge);break;case ke:(T=this.waitingFragment)?(E=T.frag.cc,void 0!==this.initPTS[E]?(this.waitingFragment=null,this.state=ye,this.onFragLoaded(T)):this.videoTrackCC!==this.waitingVideoCC?(l.logger.log("Waiting fragment cc ("+E+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):le((S=q.bufferInfo(this.mediaBuffer,this.media.currentTime,i.maxBufferHole)).end,i.maxFragLookUpTolerance,T.frag)<0&&(l.logger.log("Waiting fragment cc ("+E+") @ "+T.frag.start+" cancelled because another fragment at "+S.end+" is needed"),this.clearWaitingFragment())):this.state=ge}},i.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=ge)},i.onMediaAttached=function(e){e=this.media=this.mediaBuffer=e.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended),e=this.config,this.tracks&&e.autoStartLoad&&this.startLoad(e.startPosition)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onAudioTracksUpdated=function(e){l.logger.log("audio tracks updated"),this.tracks=e.audioTracks},i.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=me,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=ge),this.tick()},i.onAudioTrackLoaded=function(e){var t=e.details,n=e.id,r=this.tracks[n],i=r.details,s=t.totalduration;e=0,l.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+s),t.live||i&&i.live?i&&0<t.fragments.length?(te(i,t),e=t.fragments[0].start,t.PTSKnown?l.logger.log("live audio playlist sliding:"+e.toFixed(3)):l.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,l.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,r.details=t,this.startFragRequested||(-1===this.startPosition&&(r=t.startTimeOffset,Object(c.isFiniteNumber)(r)?(l.logger.log("start time offset found in playlist, adjust startPosition to "+r),this.startPosition=r):t.live?(this.startPosition=this.computeLivePosition(e,t),l.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0),this.nextLoadPosition=this.startPosition),this.state===we&&(this.state=ge),this.tick()},i.onKeyLoaded=function(){this.state===ve&&(this.state=ge,this.tick())},i.onFragLoaded=function(e){var t,n,r,i,s,a,o,c=this.fragCurrent,d=e.frag;this.state===ye&&c&&"audio"===d.type&&d.level===c.level&&d.sn===c.sn&&(n=(t=(o=this.tracks[this.trackId]).details).totalduration,r=c.level,i=c.sn,s=c.cc,a=this.config.defaultAudioCodec||o.audioCodec||"mp4a.40.2",d=this.stats=e.stats,"initSegment"===i?(this.state=ge,d.tparsed=d.tbuffered=Ze.now(),t.initSegment.data=e.payload,this.hls.trigger(u.default.FRAG_BUFFERED,{stats:d,frag:c,id:"audio"}),this.tick()):(this.state=_e,this.appended=!1,this.demuxer||(this.demuxer=new X(this.hls,"audio")),o=this.initPTS[s],d=t.initSegment?t.initSegment.data:[],void 0!==o?(this.pendingBuffering=!0,l.logger.log("Demuxing "+i+" of ["+t.startSN+" ,"+t.endSN+"],track "+r),this.demuxer.push(e.payload,d,a,null,c,n,!1,o)):(l.logger.log("Unknown video PTS for cc "+s+", waiting for video PTS before demuxing audio frag "+i+" of ["+t.startSN+" ,"+t.endSN+"],track "+r),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=ke))),this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===_e&&((n=e.tracks).video&&delete n.video,(t=n.audio)&&(t.levelCodec=t.codec,t.id=e.id,this.hls.trigger(u.default.BUFFER_CODECS,n),l.logger.log("audio track:audio,container:"+t.container+",codecs[level/parsed]=["+t.levelCodec+"/"+t.codec+"]"),(t=t.initSegment)&&(t={type:"audio",data:t,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[t]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,t))),this.tick()))},i.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"audio"===e.id&&"audio"===e.type&&r.sn===n.sn&&r.level===n.level&&this.state===_e){var i=this.trackId,s=this.tracks[i];r=this.hls,Object(c.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(g.AUDIO),l.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),ee(s.details,n,e.startPTS,e.endPTS),s=this.media,n=!1,this.audioSwitch&&(s&&s.readyState?(s=s.currentTime,l.logger.log("switching audio track : currentTime:"+s),s>=e.startPTS&&(l.logger.log("switching audio track : flushing all audio"),this.state=Te,r.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),this.audioSwitch=!(n=!0),r.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i}))):(this.audioSwitch=!1,r.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i})));var a=this.pendingData;if(!a)return l.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void r.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach((function(t){t&&t.length&&a.push({type:e.type,data:t,parent:"audio",content:"data"})})),!n&&a.length&&(a.forEach((function(e){t.state===_e&&(t.pendingBuffering=!0,t.hls.trigger(u.default.BUFFER_APPENDING,e))})),this.pendingData=[],this.appended=!0)),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===_e&&(this.stats.tparsed=Ze.now(),this.state=Ee,this._checkAppendedParsed())},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},i.onBufferAppended=function(e){var t;"audio"===e.parent&&((t=this.state)!==_e&&t!==Ee||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed()))},i._checkAppendedParsed=function(){var e,t,n;this.state!==Ee||this.appended&&this.pendingBuffering||(n=this.fragCurrent,e=this.stats,t=this.hls,n&&(this.fragPrevious=n,e.tbuffered=Ze.now(),t.trigger(u.default.FRAG_BUFFERED,{stats:e,frag:n,id:"audio"}),(n=this.mediaBuffer||this.media)&&l.logger.log("audio buffered : "+ie.toString(n.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,t.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ge),this.tick())},i.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:var n,r,i=e.frag;if(i&&"audio"!==i.type)break;e.fatal||((i=this.fragLoadError)?i++:i=1,i<=(n=this.config).fragLoadingMaxRetry?(this.fragLoadError=i,r=Math.min(Math.pow(2,i-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout),l.logger.warn("AudioStreamController: frag loading failed, retry in "+r+" ms"),this.retryDate=Ze.now()+r,this.state=be):(l.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ie));break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==Ie&&(this.state=e.fatal?Ie:ge,l.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case o.ErrorDetails.BUFFER_FULL_ERROR:"audio"!==e.parent||this.state!==_e&&this.state!==Ee||(n=this.mediaBuffer,r=this.media.currentTime,n&&q.isBuffered(n,r)&&q.isBuffered(n,r+.5)?((r=this.config).maxMaxBufferLength>=r.maxBufferLength&&(r.maxMaxBufferLength/=2,l.logger.warn("AudioStreamController: reduce max buffer length to "+r.maxMaxBufferLength+"s")),this.state=ge):(l.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Te,this.hls.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})))}},i.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(l.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach((function(t){e.hls.trigger(u.default.BUFFER_APPENDING,t)})),this.appended=!0,this.pendingData=[],this.state=Ee):(this.state=ge,this.fragPrevious=null,this.tick())},n=t,(i=[{key:"state",set:function(e){var t;this.state!==e&&(t=this.state,this._state=e,l.logger.log("audio stream:"+t+"->"+e))},get:function(){return this._state}}])&&Xe(n.prototype,i),r&&Xe(n,r),t}(Oe),tt=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}function r(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)e[n]=r[n]}return e}function i(t,i,s){var a=this,o={enumerable:!0};a.hasBeenReset=!1;var c="",u=!1,l=t,d=i,h=s,f=null,p="",g=!0,m="auto",v="start",y=50,b="middle",w=50,_="middle";Object.defineProperty(a,"id",r({},o,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(a,"pauseOnExit",r({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(a,"startTime",r({},o,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",r({},o,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",r({},o,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",r({},o,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",r({},o,{get:function(){return p},set:function(t){if(!1===(t="string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()))throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",r({},o,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",r({},o,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",r({},o,{get:function(){return v},set:function(e){if(!(e=n(e)))throw new SyntaxError("An invalid or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",r({},o,{get:function(){return y},set:function(e){if(e<0||100<e)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",r({},o,{get:function(){return b},set:function(e){if(!(e=n(e)))throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",r({},o,{get:function(){return w},set:function(e){if(e<0||100<e)throw new Error("Size must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",r({},o,{get:function(){return _},set:function(e){if(!(e=n(e)))throw new SyntaxError("An invalid or illegal string was specified.");_=e,this.hasBeenReset=!0}})),a.displayState=void 0}return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}();function nt(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Je,this.regionList=[]}function rt(){this.values=Object.create(null)}function it(e,t,n,r){var i,s,a=r?e.split(r):[e];for(i in a)"string"==typeof a[i]&&2===(s=a[i].split(n)).length&&t(s[0],s[1])}rt.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var st=new tt(0,0,0),at="middle"===st.align?"middle":"center";function ot(e,t,n){var r,i,s,a=e;function o(){var t;function n(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}if(null===(t=(t=(t=e).match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/))?t[3]?n(t[1],t[2],t[3].replace(":",""),t[4]):59<t[1]?n(t[1],t[2],0,t[4]):n(0,t[1],t[2],t[4]):null))throw new Error("Malformed timestamp: "+a);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function c(){e=e.replace(/^\s+/,"")}if(c(),t.startTime=o(),c(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+a);e=e.substr(3),c(),t.endTime=o(),c(),r=e,i=t,s=new rt,it(r,(function(e,t){switch(e){case"region":for(var r=n.length-1;0<=r;r--)if(n[r].id===t){s.set(e,n[r].region);break}break;case"vertical":s.alt(e,t,["rl","lr"]);break;case"line":var i=t.split(","),a=i[0];s.integer(e,a),s.percent(e,a)&&s.set("snapToLines",!1),s.alt(e,a,["auto"]),2===i.length&&s.alt("lineAlign",i[1],["start",at,"end"]);break;case"position":i=t.split(","),s.percent(e,i[0]),2===i.length&&s.alt("positionAlign",i[1],["start",at,"end","line-left","line-right","auto"]);break;case"size":s.percent(e,t);break;case"align":s.alt(e,t,["start",at,"end","left","right"])}}),/:/,/\s/),i.region=s.get("region",null),i.vertical=s.get("vertical",""),"auto"===(r=s.get("line","auto"))&&-1===st.line&&(r=-1),i.line=r,i.lineAlign=s.get("lineAlign","start"),i.snapToLines=s.get("snapToLines",!0),i.size=s.get("size",100),i.align=s.get("align",at),"auto"===(r=s.get("position","auto"))&&50===st.position&&(r="start"===i.align||"left"===i.align?0:"end"===i.align||"right"===i.align?100:50),i.position=r}function ct(e){return e.replace(/<br(?: \/)?>/gi,"\n")}nt.prototype={parse:function(e){var t=this;function n(){for(var e=0,n=ct(n=t.buffer);e<n.length&&"\r"!==n[e]&&"\n"!==n[e];)++e;var r=n.substr(0,e);return"\r"===n[e]&&++e,"\n"===n[e]&&++e,t.buffer=n.substr(e),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var r,i=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:r=n(),t.state){case"HEADER":/:/.test(r)?it(r,(function(e,t){}),/:/):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new tt(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{ot(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=-1!==r.indexOf("--\x3e");if(!r||a&&(s=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),!this.cue&&"HEADER"!==this.state||(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var ut=nt;function lt(e,t,n,r){for(var i,s,a,o,c,u=[],l=window.VTTCue||TextTrackCue,d=0;d<r.rows.length;d++)if(a=!0,o=0,c="",!(i=r.rows[d]).isEmpty()){for(var h=0;h<i.chars.length;h++)i.chars[h].uchar.match(/\s/)&&a?o++:(c+=i.chars[h].uchar,a=!1);(i.cueStartTime=t)===n&&(n+=1e-4),s=new l(t,n,ct(c.trim())),16<=o?o--:o++,navigator.userAgent.match(/Firefox\//)?s.line=d+1:s.line=7<d?d-2:d+1,s.align="left",s.position=Math.max(0,Math.min(100,o/32*100)),u.push(s),e&&e.addCue(s)}return u}function dt(e){var t=e;return ft.hasOwnProperty(e)&&(t=ft[e]),String.fromCharCode(t)}var ht,ft={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},pt=100,gt={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},mt={17:2,18:4,21:6,22:8,23:10,19:13,20:15},vt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},yt={25:2,26:4,29:6,30:8,31:10,27:13,28:15},bt=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];function wt(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t}(G=ht=ht||{})[G.ERROR=0]="ERROR",G[G.TEXT=1]="TEXT",G[G.WARNING=2]="WARNING",G[G.INFO=2]="INFO",G[G.DEBUG=3]="DEBUG",G[G.DATA=3]="DATA";var _t=function(){function e(){this.time=null,this.verboseLevel=ht.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&l.logger.log(this.time+" ["+e+"] "+t)},e}(),Et=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),Tt=function(){function e(e,t,n,r,i,s){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Et(t,n,r,i,s)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),St=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<pt;t++)this.chars.push(new Tt);this.logger=e,this.pos=0,this.currPenState=new Et}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<pt;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<pt;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<pt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(ht.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>pt&&(this.logger.log(ht.DEBUG,"Too large cursor position "+this.pos),this.pos=pt)},t.moveCursor=function(e){var t=this.pos+e;if(1<e)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){144<=e&&this.backSpace();var t=dt(e);this.pos>=pt?this.logger.log(ht.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){for(var t=e;t<pt;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<pt;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),It=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<15;t++)this.rows.push(new St(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,n=0;n<15;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(ht.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(ht.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<15;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var s=i.rows[r].cueStartTime,a=this.logger.time;if(s&&null!==a&&s<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(i.rows[r+o])}}this.currRow=t,s=this.rows[this.currRow],null!==e.indent&&(a=e.indent,a=Math.max(a-1,0),s.setCursor(e.indent),e.color=s.chars[a].penState.foreground),e={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1},this.setPen(e)},t.setBkgData=function(e){this.logger.log(ht.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e;null!==this.nrRollUpRows?(this.logger.log(ht.TEXT,this.getDisplayText()),e=this.currRow+1-this.nrRollUpRows,(e=this.rows.splice(e,1)[0]).clear(),this.rows.splice(this.currRow,0,e),this.logger.log(ht.INFO,"Rolling up")):this.logger.log(ht.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=0;r<15;r++){var i=this.rows[r].getTextString();i&&(e?t.push("Row "+(r+1)+": '"+i+"'"):t.push(i.trim()))}return 0<t.length?e?"["+t.join(" | ")+"]":t.join("\n"):n},t.getTextAndFormat=function(){return this.rows},e}(),kt=function(){function e(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new It(n),this.nonDisplayedMemory=new It(n),this.lastOutputScreen=new It(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(ht.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(ht.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(ht.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(ht.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(ht.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(ht.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(ht.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(ht.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(ht.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(ht.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(ht.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(ht.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(ht.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(ht.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e;this.logger.log(ht.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(e=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(ht.TEXT,"DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(ht.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};t.underline=e%2==1,t.italics=46<=e,t.italics?t.foreground="white":(e=Math.floor(e/2)-16,t.foreground=["white","green","blue","cyan","red","yellow","magenta"][e]),this.logger.log(ht.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}();function At(e,t,n){n.a=e,n.b=t}function Ot(e,t,n){return n.a===e&&n.b===t}function xt(){return{a:null,b:null}}function Ct(e,t,n){return e.substr(n||0,t.length)===t}function Rt(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()}var Dt=function(){function e(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new _t;this.channels=[null,new kt(e,t,r),new kt(e+1,n,r)],this.cmdHistory=xt(),this.logger=r}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,r=!1;this.logger.time=e;for(var i=0;i<t.length;i+=2){var s,a=127&t[i],o=127&t[i+1];0==a&&0==o||(this.logger.log(ht.DATA,"["+wt([t[i],t[i+1]])+"] -> ("+wt([a,o])+")"),(n=(n=(n=(n=this.parseCmd(a,o))||this.parseMidrow(a,o))||this.parsePAC(a,o))||this.parseBackgroundAttributes(a,o))||(r=this.parseChars(a,o))&&((s=this.currentChannel)&&0<s?this.channels[s].insertChars(r):this.logger.log(ht.WARNING,"No channel found yet. TEXT-MODE?")),n||r||this.logger.log(ht.WARNING,"Couldn't parse cleaned data "+wt([a,o])+" orig: "+wt([t[i],t[i+1]])))}},t.parseCmd=function(e,t){var n=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;if(Ot(e,t,n))return At(null,null,n),this.logger.log(ht.DEBUG,"Repeated command ("+wt([e,t])+") is dropped"),!0;var r=20===e||21===e||23===e?1:2,i=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),At(e,t,n),this.currentChannel=r,!0},t.parseMidrow=function(e,t){var n=0;return(17===e||25===e)&&32<=t&&t<=47&&((n=17===e?1:2)!==this.currentChannel?(this.logger.log(ht.ERROR,"Mismatch channel in midrow parsing"),!1):!!(n=this.channels[n])&&(n.ccMIDROW(t),this.logger.log(ht.DEBUG,"MIDROW ("+wt([e,t])+")"),!0))},t.parsePAC=function(e,t){var n=this.cmdHistory;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;if(Ot(e,t,n))return At(null,null,n),!0;var r=e<=23?1:2,i=this.channels[r];return!!i&&(i.setPAC(this.interpretPAC((64<=t&&t<=95?1==r?gt:vt:1==r?mt:yt)[e],t)),At(e,t,n),this.currentChannel=r,!0)},t.interpretPAC=function(e,t){var n=t;return(e={color:null,italics:!1,indent:null,underline:!1,row:e}).underline=1==(1&(n=95<t?t-96:t-64)),n<=13?e.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(e.italics=!0,e.color="white"):e.indent=4*Math.floor((n-16)/2),e},t.parseChars=function(e,t){var n,r,i=null,s=null;return 17<=(s=25<=e?(n=2,e-8):(n=1,e))&&s<=19?(r=t,this.logger.log(ht.INFO,"Special char '"+dt(r=17===s?t+80:18===s?t+112:t+144)+"' in channel "+n),i=[r]):32<=e&&e<=127&&(i=0===t?[e]:[e,t]),i&&(r=wt(i),this.logger.log(ht.DEBUG,"Char codes =  "+r.join(",")),At(e,t,this.cmdHistory)),i},t.parseBackgroundAttributes=function(e,t){var n;if(!((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47))return!1;var r={};return 16===e||24===e?(n=Math.floor((t-32)/2),r.background=bt[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),this.channels[e<=23?1:2].setBkgData(r),At(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory=xt()},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}},e}(),Lt=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[]},e}(),Pt={parse:function(e,t,n,r,i,s){e=Object(Pe.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");var a,o="00:00.000",u=0,l=0,d=0,h=[],f=!0,p=!1,g=new ut;g.oncue=function(e){var t=n[r],i=n.ccOffset;t&&t.new&&(void 0!==l?i=n.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,r.new=!1;for(;i&&i.new;)e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC];e.presentationOffset=n}(n,r,d)),d&&(i=d-n.presentationOffset),p&&(e.startTime+=i-l,e.endTime+=i-l),e.id=Rt(e.startTime.toString())+Rt(e.endTime.toString())+Rt(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),0<e.endTime&&h.push(e)},g.onparsingerror=function(e){a=e},g.onflush=function(){a&&s?s(a):i(h)},e.forEach((function(e){if(f){if(Ct(e,"X-TIMESTAMP-MAP=")){p=!(f=!1),e.substr(16).split(",").forEach((function(e){Ct(e,"LOCAL:")?o=e.substr(6):Ct(e,"MPEGTS:")&&(u=parseInt(e.substr(7)))}));try{t+(9e4*n[r].start||0)<0&&(t+=8589934592),u-=t,l=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),i=9<e.length?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(c.isFiniteNumber)(t)&&Object(c.isFiniteNumber)(n)&&Object(c.isFiniteNumber)(r)&&Object(c.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,(t+=6e4*r)+36e5*i}(o)/1e3,d=u/9e4}catch(e){p=!1,a=e}return}""===e&&(f=!1)}g.parse(e+"\n")})),g.flush()}};function Nt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mt(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}function jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}W=function(e){var t;function n(t){var n,r,i,s=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.FRAG_DECRYPTED,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.FRAG_LOADED,u.default.INIT_PTS_FOUND)||this;return s.media=null,s.config=void 0,s.enabled=!0,s.Cues=void 0,s.textTracks=[],s.tracks=[],s.initPTS=[],s.unparsedVttFrags=[],s.captionsTracks={},s.nonNativeCaptionsTracks={},s.captionsProperties=void 0,s.cea608Parser1=void 0,s.cea608Parser2=void 0,s.lastSn=-1,s.prevCC=-1,s.vttCCs=Mt(),s.hls=t,s.config=t.config,s.Cues=t.config.cueHandler,s.captionsProperties={textTrack1:{label:s.config.captionsTextTrack1Label,languageCode:s.config.captionsTextTrack1LanguageCode},textTrack2:{label:s.config.captionsTextTrack2Label,languageCode:s.config.captionsTextTrack2LanguageCode},textTrack3:{label:s.config.captionsTextTrack3Label,languageCode:s.config.captionsTextTrack3LanguageCode},textTrack4:{label:s.config.captionsTextTrack4Label,languageCode:s.config.captionsTextTrack4LanguageCode}},s.config.enableCEA708Captions&&(n=new Lt(Nt(s),"textTrack1"),r=new Lt(Nt(s),"textTrack2"),i=new Lt(Nt(s),"textTrack3"),t=new Lt(Nt(s),"textTrack4"),s.cea608Parser1=new Dt(1,n,r),s.cea608Parser2=new Dt(3,i,t)),s}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.addCues=function(e,t,n,r,i){for(var s,a,o,c=!1,l=i.length;l--;){var d=i[l],h=(s=d[0],a=d[1],h=t,o=n,Math.min(a,o)-Math.max(s,h));if(0<=h&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],n),c=!0,.5<h/(n-t)))return}c||i.push([t,n]),this.config.renderTextTracksNatively?this.Cues.newCue(this.captionsTracks[e],t,n,r):(r=this.Cues.newCue(null,t,n,r),this.hls.trigger(u.default.CUES_PARSED,{type:"captions",cues:r,track:e}))},r.onInitPtsFound=function(e){var t=this,n=e.frag,r=e.id,i=e.initPTS;e=this.unparsedVttFrags,"main"===r&&(this.initPTS[n.cc]=i),e.length&&(this.unparsedVttFrags=[],e.forEach((function(e){t.onFragLoaded(e)})))},r.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},r.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},r.createNativeTrack=function(e){var t,n,r,i,s;this.captionsTracks[e]||(s=this.captionsProperties,t=this.captionsTracks,n=this.media,r=(i=s[e]).label,s=i.languageCode,(i=this.getExistingTrack(e))?(t[e]=i,Me(t[e]),Ne(t[e],n)):(s=this.createTextTrack("captions",r,s))&&(s[e]=!0,t[e]=s))},r.createNonNativeTrack=function(e){var t;this.nonNativeCaptionsTracks[e]||(t=this.captionsProperties[e])&&(t={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media},this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]}))},r.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},r.destroy=function(){e.prototype.destroy.call(this)},r.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},r.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Me(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},r.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=Mt(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},r._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Me(t[n])}},r.onManifestLoaded=function(e){var t,n,r=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT&&(n=e.subtitles||[],n=this.tracks&&n&&this.tracks.length===n.length,this.tracks=e.subtitles||[],this.config.renderTextTracksNatively?(t=this.media?this.media.textTracks:[],this.tracks.forEach((function(e,n){var i,s,a;if(n<t.length){for(var o=null,c=0;c<t.length;c++)if(a=e,(s=t[c])&&s.label===a.name&&!s.textTrack1&&!s.textTrack2){o=t[c];break}o&&(i=o)}i=i||r.createTextTrack("subtitles",e.name,e.lang),e.default?i.mode=r.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",r.textTracks.push(i)}))):!n&&this.tracks&&this.tracks.length&&(n=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}})),this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n}))),this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);t&&(t="textTrack"+t[1],(t=r.captionsProperties[t])&&(t.label=e.name,e.lang&&(t.languageCode=e.lang),t.media=e))}))},r.onFragLoaded=function(e){var t=e.frag,n=e.payload,r=this.cea608Parser1,i=this.cea608Parser2,s=this.initPTS,a=this.lastSn,o=this.unparsedVttFrags;if("main"===t.type){var l=t.sn;t.sn!==a+1&&r&&i&&(r.reset(),i.reset()),this.lastSn=l}else if("subtitle"===t.type)if(n.byteLength){if(!Object(c.isFiniteNumber)(s[t.cc]))return o.push(e),void(s.length&&this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));null!=(s=t.decryptdata)&&null!=s.key&&"AES-128"===s.method||this._parseVTTs(t,n)}else this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},r._parseVTTs=function(e,t){var n=this,r=this.hls,i=this.prevCC,s=this.textTracks,a=this.vttCCs;a[e.cc]||(a[e.cc]={start:e.start,prevCC:i,new:!0},this.prevCC=e.cc),Pt.parse(t,this.initPTS[e.cc],a,e.cc,(function(t){if(n.config.renderTextTracksNatively){var i=s[e.level];if("disabled"===i.mode)return void r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach((function(e){if(!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(n){l.logger.debug("Failed occurred on adding cues: "+n);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}))}else{var a=n.tracks[e.level].default?"default":"subtitles"+e.level;r.trigger(u.default.CUES_PARSED,{type:"subtitles",cues:t,track:a})}r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){l.logger.log("Failed to parse VTT cue: "+t),r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}))},r.onFragDecrypted=function(e){var t=e.frag,n=e.payload;"subtitle"===t.type&&(Object(c.isFiniteNumber)(this.initPTS[t.cc])?this._parseVTTs(t,n):this.unparsedVttFrags.push(e))},r.onFragParsingUserdata=function(e){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var r=0;r<e.samples.length;r++){var i=e.samples[r].bytes;i&&(i=this.extractCea608Data(i),t.addData(e.samples[r].pts,i[0]),n.addData(e.samples[r].pts,i[1]))}},r.extractCea608Data=function(e){for(var t=31&e[0],n=2,r=[[],[]],i=0;i<t;i++){var s=e[n++],a=127&e[n++],o=127&e[n++],c=3&s;0==a&&0==o||0!=(4&s)&&(0!=c&&1!=c||(r[c].push(a),r[c].push(o)))}return r},n}(h),he=function(e){function t(t){return(t=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADED,u.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],t.trackId=-1,t.media=null,t.stopped=!0,t.subtitleDisplay=!0,t.queuedDefaultTrack=null,t}n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n,r,i=t.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(c.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){t.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(c.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Ft(this.media.textTracks).forEach((function(e){Me(e)})),this.subtitleTrack=-1,this.media=null)},i.onManifestLoaded=function(e){var t=this;e=e.subtitles||[],this.tracks=e,this.hls.trigger(u.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:e}),e.forEach((function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)}))},i.onSubtitleTrackLoaded=function(e){var t=this,n=e.id,r=e.details,i=this.trackId,s=this.tracks,a=s[i];n>=s.length||n!==i||!a||this.stopped?this._clearReloadTimer():(l.logger.log("subtitle track "+n+" loaded"),r.live?(e=re(a.details,r,e.stats.trequest),l.logger.log("Reloading live subtitle playlist in "+e+"ms"),this.timer=setTimeout((function(){t._loadCurrentTrack()}),e)):this._clearReloadTimer())},i.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},i._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},i._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,n=this.hls;t=t[e],e<0||!t||t.details&&!t.details.live||(l.logger.log("Loading subtitle track "+e),n.trigger(u.default.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))},i._toggleTrackModes=function(e){var t=this.media,n=this.subtitleDisplay,r=this.trackId;t&&(t=Ft(t.textTracks),-1===e?[].slice.call(t).forEach((function(e){e.mode="disabled"})):(r=t[r])&&(r.mode="disabled"),(e=t[e])&&(e.mode=n?"showing":"hidden"))},i._setSubtitleTrackInternal=function(e){var t=this.hls,n=this.tracks;!Object(c.isFiniteNumber)(e)||e<-1||e>=n.length||(this.trackId=e,l.logger.log("Switching to subtitle track "+e),t.trigger(u.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},i._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=Ft(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack=e}},n=t,(i=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}])&&jt(n.prototype,i),r&&jt(n,r),t}(h);var Ut,Bt=n("./src/crypt/decrypter.js"),Vt=window.performance;function qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)),r}function Kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(n),!0).forEach((function(t){var r,i;r=e,t=n[i=t],i in r?Object.defineProperty(r,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[i]=t})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}G=function(e){var t;function n(t,n){var r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.ERROR,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED,u.default.LEVEL_UPDATED)||this;return r.fragmentTracker=n,r.config=t.config,r.state=fe,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new Bt.default(t,t.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r;var r=n.prototype;return r.startLoad=function(){this.stopLoad(),this.state=ge;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(500),this.tick())},r.onSubtitleFragProcessed=function(e){var t=e.frag;if(e=e.success,this.fragPrevious=t,this.state=ge,e){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var r,i=t.start,s=0;s<n.length;s++)if(i>=n[s].start&&i<=n[s].end){r=n[s];break}t=t.start+t.duration,r?r.end=t:n.push(r={start:i,end:t})}}},r.onMediaAttached=function(e){e=e.media,(this.media=e).addEventListener("seeking",this._onMediaSeeking),this.state=ge},r.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]})),this.media=null,this.state=fe)},r.onError=function(e){(e=e.frag)&&"subtitle"===e.type&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=ge)},r.onSubtitleTracksUpdated=function(e){var t=this;l.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]}))},r.onSubtitleTrackSwitch=function(e){this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId?(e=this.tracks[this.currentTrackId])&&e.details&&this.setInterval(500):this.clearInterval()},r.onSubtitleTrackLoaded=function(e){var t=e.id,n=e.details,r=this.currentTrackId,i=this.tracks;e=i[r],t>=i.length||t!==r||!e||(n.live&&function(e,t,n){void 0===n&&(n=0);var r=-1;ne(e,t,(function(e,t,n){t.start=e.start,r=n}));var i=t.fragments;if(r<0)i.forEach((function(e){e.start+=n}));else for(var s=r+1;s<i.length;s++)i[s].start=i[s-1].start+i[s-1].duration}(e.details,n,this.lastAVStart),e.details=n,this.setInterval(500))},r.onKeyLoaded=function(){this.state===ve&&(this.state=ge)},r.onFragLoaded=function(e){var t,n=this.fragCurrent,r=e.frag.decryptdata,i=e.frag,s=this.hls;this.state===ye&&n&&"subtitle"===e.frag.type&&n.sn===e.frag.sn&&0<e.payload.byteLength&&r&&r.key&&"AES-128"===r.method&&(t=Vt.now(),this.decrypter.decrypt(e.payload,r.key.buffer,r.iv.buffer,(function(e){var n=Vt.now();s.trigger(u.default.FRAG_DECRYPTED,{frag:i,payload:e,stats:{tstart:t,tdecrypt:n}})})))},r.onLevelUpdated=function(e){e=e.details.fragments,this.lastAVStart=e.length?e[0].start:0},r.doTick=function(){if(this.media)switch(this.state){case ge:var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,r=this.media;if(!(s=this.tracks)||!s[t]||!s[t].details)break;var i,s,a,o=e.maxBufferHole,c=e.maxFragLookUpTolerance,d=Math.min(e.maxBufferLength,e.maxMaxBufferLength);if(e=(i=q.bufferedInfo(this._getBuffered(),r.currentTime,o)).end,r=i.len,t=(i=(o=s[t].details).fragments)[(s=i.length)-1].start+i[s-1].duration,d<r)return;r=this.fragPrevious,(a=e<t?(a=r&&o.hasProgramDateTime?ce(i,r.endProgramDateTime,c):a)||ue(r,i,e,c):i[s-1])&&a.encrypted?(l.logger.log("Loading key for "+a.sn),this.state=ve,this.hls.trigger(u.default.KEY_LOADING,{frag:a})):a&&n.getState(a)===M&&(this.fragCurrent=a,this.state=ye,this.hls.trigger(u.default.FRAG_LOADING,{frag:a}))}else this.state=ge},r.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,e.prototype.stopLoad.call(this)},r._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},r.onMediaSeeking=function(){var e,t,n;this.fragCurrent&&(e=this.media?this.media.currentTime:0,n=this.config.maxFragLookUpTolerance,t=this.fragCurrent.start-n,n=this.fragCurrent.start+this.fragCurrent.duration+n,(e<t||n<e)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=ge,this.tick()))},n}(Oe),(n=Ut=Ut||{}).WIDEVINE="com.widevine.alpha",n.PLAYREADY="com.microsoft.playready",Oe="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null,n=function(e){function t(t){var n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHED,u.default.MANIFEST_PARSED)||this;return n._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._drmSystemOptions=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n.mediaKeysPromise=null,n._onMediaEncrypted=function(e){if(l.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!n.mediaKeysPromise)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});function t(t){n._media&&(n._attemptSetMediaKeys(t),n._generateRequestWithPreferredKeySession(e.initDataType,e.initData))}n.mediaKeysPromise.then(t).catch(t)},n._config=t.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n._drmSystemOptions=t.config.drmSystemOptions,n}n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n,r,i=t.prototype;return i.getLicenseServerUrl=function(e){switch(e){case Ut.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},i._attemptKeySystemAccess=function(e,t,n){var r=this;n=function(e,t,n,r){if(e!==Ut.WIDEVINE)throw new Error("Unknown key-system: "+e);return i=r,s={audioCapabilities:[],videoCapabilities:[]},t.forEach((function(e){s.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:i.audioRobustness||""})})),n.forEach((function(e){s.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:i.videoRobustness||""})})),[s];var i,s}(e,t,n,this._drmSystemOptions),l.logger.log("Requesting encrypted media key-system access"),n=this.requestMediaKeySystemAccess(e,n),this.mediaKeysPromise=n.then((function(t){return r._onMediaKeySystemAccessObtained(e,t)})),n.catch((function(t){l.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},i._onMediaKeySystemAccessObtained=function(e,t){var n=this;l.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r);var i=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(t){return r.mediaKeys=t,l.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated(),t}));return i.catch((function(e){l.logger.error("Failed to create media-keys:",e)})),i},i._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},i._onNewMediaKeySession=function(e){var t=this;l.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(n){t._onKeySessionMessage(e,n.message)}),!1)},i._onKeySessionMessage=function(e,t){l.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){l.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),e.update(t)}))},i._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(e,t){var n=this,r=this._mediaKeysList[0];if(!r)return l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(!r.mediaKeysSessionInitialized){var i=r.mediaKeysSession;return i?t?(l.logger.log('Generating key-session request for "'+e+'" init data type'),r.mediaKeysSessionInitialized=!0,void i.generateRequest(e,t).then((function(){l.logger.debug("Key-session generation succeeded")})).catch((function(e){l.logger.error("Error generating key-session request:",e),n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))):(l.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(l.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}))}l.logger.warn("Key-Session already initialized but requested again")},i._createLicenseXhr=function(e,t,n){var r=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(r,e)}catch(t){r.open("POST",e,!0),i(r,e)}r.readyState||r.open("POST",e,!0)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n),r},i._onLicenseRequestReadyStageChange=function(e,t,n,r){if(4===e.readyState)if(200===e.status)this._requestLicenseFailureCount=0,l.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&l.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(e.response);else{if(l.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,3<this._requestLicenseFailureCount)return void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});e=3-this._requestLicenseFailureCount+1,l.logger.warn("Retrying license request, "+e+" attempts left"),this._requestLicense(n,r)}},i._generateLicenseRequestChallenge=function(e,t){if(e.mediaKeySystemDomain===Ut.WIDEVINE)return t;throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},i._requestLicense=function(e,t){l.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,e,t);l.logger.log("Sending license request to URL: "+r);var s=this._generateLicenseRequestChallenge(n,e);i.send(s)}catch(e){l.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},i.onMediaAttached=function(e){this._emeEnabled&&(e=e.media,(this._media=e).addEventListener("encrypted",this._onMediaEncrypted))},i.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch((function(){}))}))).then((function(){return e.setMediaKeys(null)})).catch((function(){})))},i.onManifestParsed=function(e){var t;this._emeEnabled&&(t=e.levels.map((function(e){return e.audioCodec})),e=e.levels.map((function(e){return e.videoCodec})),this._attemptKeySystemAccess(Ut.WIDEVINE,t,e))},n=t,(i=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&qt(n.prototype,i),r&&qt(n,r),t}(h);var zt=Kt(Kt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:$e,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:qe,bufferController:Ke,capLevelController:He,fpsController:t,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Oe,testBandwidth:!0},{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:G,subtitleTrackController:he,timelineController:W,audioStreamController:et,audioTrackController:Qe,emeController:n});function Ht(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)),r}function Wt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){var r,i;r=e,t=n[i=t],i in r?Object.defineProperty(r,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[i]=t})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qt(e,t,n){return t&&Yt(e.prototype,t),n&&Yt(e,n),e}var Xt=function(e){var t;function n(t){var r;void 0===t&&(t={}),(r=e.call(this)||this).config=void 0,r._autoLevelCapping=void 0,r.abrController=void 0,r.capLevelController=void 0,r.levelController=void 0,r.streamController=void 0,r.networkControllers=void 0,r.audioTrackController=void 0,r.subtitleTrackController=void 0,r.emeController=void 0,r.coreComponents=void 0,r.media=null,r.url=null;var i=n.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");r.config=Wt(Wt({},i),t);var s=$t(r).config;if(void 0!==s.liveMaxLatencyDurationCount&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==s.liveMaxLatencyDuration&&(void 0===s.liveSyncDuration||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(l.enableLogs)(s.debug),r._autoLevelCapping=-1;var a,o=r.abrController=new s.abrController($t(r)),c=new s.bufferController($t(r)),u=r.capLevelController=new s.capLevelController($t(r)),d=new s.fpsController($t(r)),h=new L($t(r)),f=new P($t(r)),p=new N($t(r)),g=new je($t(r)),m=r.levelController=new Le($t(r));return i=new B($t(r)),t=[m,r.streamController=new Re($t(r),i)],(m=s.audioStreamController)&&t.push(new m($t(r),i)),r.networkControllers=t,d=[h,f,p,o,c,u,d,g,i],(m=s.audioTrackController)&&(g=new m($t(r)),r.audioTrackController=g,d.push(g)),(m=s.subtitleTrackController)&&(a=new m($t(r)),r.subtitleTrackController=a,t.push(a)),(m=s.emeController)&&(a=new m($t(r)),r.emeController=a,d.push(a)),(m=s.subtitleStreamController)&&t.push(new m($t(r),i)),(m=s.timelineController)&&d.push(new m($t(r))),r.coreComponents=d,r}r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r,n.isSupported=function(){if(!(t=H()))return!1;var e=self.SourceBuffer||self.WebKitSourceBuffer,t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,!!t&&!!e},Qt(n,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return u.default}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig||zt},set:function(e){n.defaultConfig=e}}]);var r=n.prototype;return r.destroy=function(){l.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(e){e.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},r.attachMedia=function(e){l.logger.log("attachMedia"),this.media=e,this.trigger(u.default.MEDIA_ATTACHING,{media:e})},r.detachMedia=function(){l.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null},r.loadSource=function(e){e=a.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),l.logger.log("loadSource:"+e),this.url=e,this.trigger(u.default.MANIFEST_LOADING,{url:e})},r.startLoad=function(e){l.logger.log("startLoad("+(e=void 0===e?-1:e)+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},r.stopLoad=function(){l.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},r.swapAudioCodec=function(){l.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},r.recoverMediaError=function(){l.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},r.removeLevel=function(e,t){this.levelController.removeLevel(e,t=void 0===t?0:t)},Qt(n,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){l.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){l.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){l.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){l.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){l.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){(e=!!e)!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){l.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,r=0;r<n;r++)if(t<(e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate))return r;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels;return e=-1===(e=this.autoLevelCapping)&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),n}($);Xt.defaultConfig=void 0},"./src/polyfills/number.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isFiniteNumber",(function(){return r})),n.d(t,"MAX_SAFE_INTEGER",(function(){return i}));var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(e,t,n){"use strict";function r(){return"undefined"==typeof window?self:window}n.r(t),n.d(t,"getSelfScope",(function(){return r}))},"./src/utils/logger.js":function(e,t,n){"use strict";function r(){}n.r(t),n.d(t,"enableLogs",(function(){return c})),n.d(t,"logger",(function(){return u})),n=n("./src/utils/get-self-scope.js");var i={trace:r,debug:r,log:r,warn:r,info:r,error:r},s=i,a=Object(n.getSelfScope)();function o(e){var t=a.console[e];return t?function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]="["+e+"] > "+r[0]),t.apply(a.console,r)}:r}var c=function(e){if(a.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){s[t]=e[t]?e[t].bind(e):o(t)}))}(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i},u=s}},e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(e){return t[e]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="/dist/",e(e.s="./src/hls.ts").default;function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t,n},e.exports=r())},function(e,t,n){var r=n(3);e.exports=function(e){if(!r(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?r:n)(e)}},function(e,t,n){var r=n(31);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(10),i=n(65);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(n){}return function(n,s){return r(n),i(s),t?e.call(n,s):n.__proto__=s,n}}():void 0)},function(e,t,n){var r=n(2),i=n(51),s=n(15),a=n(16),o=n(18),c=n(1),u=n(32),l=Object.getOwnPropertyDescriptor;t.f=r?l:function(e,t){if(e=a(e),t=o(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return s(!i.f.call(e,t),e[t])}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(30),i=n(31);e.exports=function(e){return r(i(e))}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(3);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(0),i=n(7),s=n(1),a=n(20),o=n(34),c=(n=n(21)).get,u=n.enforce,l=String(String).split("String");(e.exports=function(e,t,n,o){var c=!!o&&!!o.unsafe,d=!!o&&!!o.enumerable;o=!!o&&!!o.noTargetGet,"function"==typeof n&&("string"!=typeof t||s(n,"name")||i(n,"name",t),u(n).source=l.join("string"==typeof t?t:"")),e!==r?(c?!o&&e[t]&&(d=!0):delete e[t],d?e[t]=n:i(e,t,n)):d?e[t]=n:a(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||o(this)}))},function(e,t,n){var r=n(0),i=n(7);e.exports=function(e,t){try{i(r,e,t)}catch(n){r[e]=t}return t}},function(e,t,n){var r,i,s,a,o,c,u,l,d=n(52),h=n(0),f=n(3),p=n(7),g=n(1),m=n(22);n=n(24),h=h.WeakMap,u=d?(r=new h,i=r.get,s=r.has,a=r.set,o=function(e,t){return a.call(r,e,t),t},c=function(e){return i.call(r,e)||{}},function(e){return s.call(r,e)}):(n[l=m("state")]=!0,o=function(e,t){return p(e,l,t),t},c=function(e){return g(e,l)?e[l]:{}},function(e){return g(e,l)}),e.exports={set:o,get:c,has:u,enforce:function(e){return u(e)?c(e):o(e,{})},getterFor:function(e){return function(t){var n;if(!f(t)||(n=c(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}}},function(e,t,n){var r=n(36),i=n(23),s=r("keys");e.exports=function(e){return s[e]||(s[e]=i(e))}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+r).toString(36)}},function(e,t){e.exports={}},function(e,t,n){function r(e){return"function"==typeof e?e:void 0}var i=n(56),s=n(0);e.exports=function(e,t){return arguments.length<2?r(i[e])||r(s[e]):i[e]&&i[e][t]||s[e]&&s[e][t]}},function(e,t,n){var r=n(37),i=n(27).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,n){"use strict";function r(e){return u(e)&&l(k,d(e))}var i,s,a=n(40),o=n(2),c=n(0),u=n(3),l=n(1),d=n(29),h=n(7),f=n(19),p=n(6).f,g=n(41),m=n(13),v=n(4),y=n(23),b=c.Int8Array,w=b&&b.prototype,_=(n=(s=c.Uint8ClampedArray)&&s.prototype,b&&g(b)),E=w&&g(w),T=(s=Object.prototype).isPrototypeOf,S=(v=v("toStringTag"),y("TYPED_ARRAY_TAG")),I=a&&!!m&&"Opera"!==d(c.opera),k=(a=!1,{Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8});for(i in k)c[i]||(I=!1);if((!I||"function"!=typeof _||_===Function.prototype)&&(_=function(){throw TypeError("Incorrect invocation")},I))for(i in k)c[i]&&m(c[i],_);if((!I||!E||E===s)&&(E=_.prototype,I))for(i in k)c[i]&&m(c[i].prototype,E);if(I&&g(n)!==E&&m(n,E),o&&!l(E,v))for(i in a=!0,p(E,v,{get:function(){return u(this)?this[S]:void 0}}),k)c[i]&&h(c[i],S,i);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:I,TYPED_ARRAY_TAG:a&&S,aTypedArray:function(e){if(r(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(m){if(T.call(_,e))return e}else for(var t in k)if(l(k,i)&&(t=c[t])&&(e===t||T.call(t,e)))return e;throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(o){if(n)for(var r in k)(r=c[r])&&l(r.prototype,e)&&delete r.prototype[e];E[e]&&!n||f(E,e,!n&&I&&w[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(o){if(m){if(n)for(r in k)(i=c[r])&&l(i,e)&&delete i[e];if(_[e]&&!n)return;try{return f(_,e,!n&&I&&b[e]||t)}catch(e){}}for(r in k)!(i=c[r])||i[e]&&!n||f(i,e,t)}},isView:function(e){return"DataView"===(e=d(e))||l(k,e)},isTypedArray:r,TypedArray:_,TypedArrayPrototype:E}},function(e,t,n){var r=n(63),i=n(17),s=n(4)("toStringTag"),a="Arguments"==i(function(){return arguments}());e.exports=r?i:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),s))?e:a?i(t):"Object"==(e=i(t))&&"function"==typeof t.callee?"Arguments":e}},function(e,t,n){var r=n(5),i=n(17),s="".split;e.exports=r((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?s.call(e,""):Object(e)}:Object},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,n){var r=n(2),i=n(5),s=n(33);e.exports=!r&&!i((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},function(e,t,n){var r=n(0),i=(n=n(3),r.document),s=n(i)&&n(i.createElement);e.exports=function(e){return s?i.createElement(e):{}}},function(e,t,n){n=n(35);var r=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(e){return r.call(e)}),e.exports=n.inspectSource},function(e,t,n){var r=n(0),i=n(20);n=r[n="__core-js_shared__"]||i(n,{}),e.exports=n},function(e,t,n){var r=n(53),i=n(35);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:r?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){var r=n(1),i=n(16),s=n(57).indexOf,a=n(24);e.exports=function(e,t){var n,o=i(e),c=0,u=[];for(n in o)!r(a,n)&&r(o,n)&&u.push(n);for(;t.length>c;)r(o,n=t[c++])&&(~s(u,n)||u.push(n));return u}},function(e,t,n){var r=n(11),i=Math.max,s=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):s(e,t)}},function(e,t,n){n=n(5),e.exports=!!Object.getOwnPropertySymbols&&!n((function(){return!String(Symbol())}))},function(e,t){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(e,t,n){var r=n(1),i=n(12),s=n(22),a=(n=n(64),s("IE_PROTO")),o=Object.prototype;e.exports=n?Object.getPrototypeOf:function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},function(e,t,n){var r=n(11),i=n(8);e.exports=function(e){if(void 0===e)return 0;var t=r(e);if(t!==(e=i(t)))throw RangeError("Wrong length or index");return e}},function(e,t){e.exports={}},function(e,t,n){var r=n(80);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){e.exports=n(87)},function(e,t,n){n(48)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},function(e,t,n){"use strict";function r(e,t){for(var n=0,r=t.length,i=new(K(e))(r);n<r;)i[n]=t[n++];return i}function i(e){var t;return e instanceof F||"ArrayBuffer"==(t=w(e))||"SharedArrayBuffer"==t}function s(e,t){return z(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)}var a=n(49),o=n(0),c=n(2),u=n(60),l=n(28),d=n(66),h=n(42),f=n(15),p=n(7),g=n(8),m=n(43),v=n(71),y=n(18),b=n(1),w=n(29),_=n(3),E=n(73),T=n(13),S=n(26).f,I=n(77),k=n(81).forEach,A=n(84),O=n(6),x=n(14),C=n(21),R=n(85),D=C.get,L=C.set,P=O.f,N=x.f,M=Math.round,j=o.RangeError,F=d.ArrayBuffer,U=d.DataView,B=l.NATIVE_ARRAY_BUFFER_VIEWS,V=l.TYPED_ARRAY_TAG,q=l.TypedArray,G=l.TypedArrayPrototype,K=l.aTypedArrayConstructor,z=l.isTypedArray,H="BYTES_PER_ELEMENT",W="Wrong length";C=function(e,t){P(e,t,{get:function(){return D(this)[t]}})},d=function(e,t){return s(e,t=y(t,!0))?f(2,e[t]):N(e,t)},l=function(e,t,n){return!(s(e,t=y(t,!0))&&_(n)&&b(n,"value"))||b(n,"get")||b(n,"set")||n.configurable||b(n,"writable")&&!n.writable||b(n,"enumerable")&&!n.enumerable?P(e,t,n):(e[t]=n.value,e)},c?(B||(x.f=d,O.f=l,C(G,"buffer"),C(G,"byteOffset"),C(G,"byteLength"),C(G,"length")),a({target:"Object",stat:!0,forced:!B},{getOwnPropertyDescriptor:d,defineProperty:l}),e.exports=function(e,t,n){function s(e,t){P(e,t,{get:function(){return function(e,t){return(e=D(e)).view[d](t*c+e.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,r){e=D(e),n&&(r=(r=M(r))<0?0:255<r?255:255&r),e.view[f](t*c+e.byteOffset,r,!0)}(this,t,e)},enumerable:!0})}var c=e.match(/\d+$/)[0]/8,l=e+(n?"Clamped":"")+"Array",d="get"+e,f="set"+e,y=o[l],b=y,w=b&&b.prototype;e={},B?u&&(b=t((function(e,t,n,s){return h(e,b,l),R(_(t)?i(t)?void 0!==s?new y(t,v(n,c),s):void 0!==n?new y(t,v(n,c)):new y(t):z(t)?r(b,t):I.call(b,t):new y(m(t)),e,b)})),T&&T(b,q),k(S(y),(function(e){e in b||p(b,e,y[e])})),b.prototype=w):(b=t((function(e,t,n,a){h(e,b,l);var o,u,d=0,f=0;if(_(t)){if(!i(t))return z(t)?r(b,t):I.call(b,t);var p=t;if(f=v(n,c),n=t.byteLength,void 0===a){if(n%c)throw j(W);if((o=n-f)<0)throw j(W)}else if(n<(o=g(a)*c)+f)throw j(W);u=o/c}else u=m(t),p=new F(o=u*c);for(L(e,{buffer:p,byteOffset:f,byteLength:o,length:u,view:new U(p)});d<u;)s(e,d++)})),T&&T(b,q),w=b.prototype=E(G)),w.constructor!==b&&p(w,"constructor",b),V&&p(w,V,l),e[l]=b,a({global:!0,forced:b!=y,sham:!B},e),H in b||p(b,H,c),H in w||p(w,H,c),A(l)}):e.exports=function(){}},function(e,t,n){var r=n(0),i=n(14).f,s=n(7),a=n(19),o=n(20),c=n(54),u=n(59);e.exports=function(e,t){var n,l,d,h=e.target,f=e.global,p=e.stat,g=f?r:p?r[h]||o(h,{}):(r[h]||{}).prototype;if(g)for(n in t){if(l=t[n],d=e.noTargetGet?(d=i(g,n))&&d.value:g[n],!u(f?n:h+(p?".":"#")+n,e.forced)&&void 0!==d){if(typeof l==typeof d)continue;c(l,d)}(e.sham||d&&d.sham)&&s(l,"sham",!0),a(g,n,l,e)}}},function(e,t){var n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,s=i&&!r.call({1:2},1);t.f=s?function(e){return!!(e=i(this,e))&&e.enumerable}:r},function(e,t,n){var r=n(0);n=n(34),r=r.WeakMap,e.exports="function"==typeof r&&/native code/.test(n(r))},function(e,t){e.exports=!1},function(e,t,n){var r=n(1),i=n(55),s=n(14),a=n(6);e.exports=function(e,t){for(var n=i(t),o=a.f,c=s.f,u=0;u<n.length;u++){var l=n[u];r(e,l)||o(e,l,c(t,l))}}},function(e,t,n){var r=n(25),i=n(26),s=n(58),a=n(10);e.exports=r("Reflect","ownKeys")||function(e){var t=i.f(a(e)),n=s.f;return n?t.concat(n(e)):t}},function(e,t,n){n=n(0),e.exports=n},function(e,t,n){var r=n(16),i=n(8),s=n(38);n=function(e){return function(t,n,a){var o,c=r(t),u=i(c.length),l=s(a,u);if(e&&n!=n){for(;l<u;)if((o=c[l++])!=o)return!0}else for(;l<u;l++)if((e||l in c)&&c[l]===n)return e||l||0;return!e&&-1}},e.exports={includes:n(!0),indexOf:n(!1)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(5),i=/#|\.prototype\./,s=(n=function(e,t){return(e=a[s(e)])==c||e!=o&&("function"==typeof t?r(t):!!t)},n.normalize=function(e){return String(e).replace(i,".").toLowerCase()}),a=n.data={},o=n.NATIVE="N",c=n.POLYFILL="P";e.exports=n},function(e,t,n){var r=n(0),i=n(5),s=n(61),a=(n=n(28).NATIVE_ARRAY_BUFFER_VIEWS,r.ArrayBuffer),o=r.Int8Array;e.exports=!n||!i((function(){o(1)}))||!i((function(){new o(-1)}))||!s((function(e){new o,new o(null),new o(1.5),new o(e)}),!0)||i((function(){return 1!==new o(new a(2),1,void 0).length}))},function(e,t,n){var r=n(4)("iterator"),i=!1;try{var s=0,a={next:function(){return{done:!!s++}},return:function(){i=!0}};a[r]=function(){return this},Array.from(a,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var s={};s[r]=function(){return{next:function(){return{done:n=!0}}}},e(s)}catch(e){}return n}},function(e,t,n){n=n(39),e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,n){var r={};r[n(4)("toStringTag")]="z",e.exports="[object z]"===String(r)},function(e,t,n){n=n(5),e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,n){var r=n(3);e.exports=function(e){if(!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,n){"use strict";function r(e){return[255&e]}function i(e){return[255&e,e>>8&255]}function s(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function a(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function o(e){return U(e,23,4)}function c(e){return U(e,52,8)}function u(e,t,n,r){var i=w(n);if(i+t>(n=O(e)).byteLength)throw F(L);return e=O(n.buffer).bytes,n=i+n.byteOffset,t=e.slice(n,n+t),r?t:t.reverse()}function l(e,t,n,r,i,s){if((n=w(n))+t>(e=O(e)).byteLength)throw F(L);for(var a=O(e.buffer).bytes,o=n+e.byteOffset,c=r(+i),u=0;u<t;u++)a[o+u]=c[s?u:t-u-1]}var d=n(0),h=n(2),f=n(40),p=n(7),g=n(67),m=n(5),v=n(42),y=n(11),b=n(8),w=n(43),_=n(68),E=n(41),T=n(13),S=n(26).f,I=n(6).f,k=n(69),A=n(70),O=(j=n(21)).get,x=j.set,C="ArrayBuffer",R="DataView",D="prototype",L="Wrong index",P=d[C],N=P,M=d[R],j=(n=M&&M[D],Object.prototype),F=d.RangeError,U=_.pack,B=_.unpack;if(_=function(e,t){I(e[D],t,{get:function(){return O(this)[t]}})},f){if(!m((function(){P(1)}))||!m((function(){new P(-1)}))||m((function(){return new P,new P(1.5),new P(NaN),P.name!=C}))){m=(N=function(e){return v(this,N),new P(w(e))})[D]=P[D];for(var V,q=S(P),G=0;q.length>G;)(V=q[G++])in N||p(N,V,P[V]);m.constructor=N}T&&E(n)!==j&&T(n,j),j=new M(new N(2));var K=n.setInt8;j.setInt8(0,2147483648),j.setInt8(1,2147483649),!j.getInt8(0)&&j.getInt8(1)||g(n,{setInt8:function(e,t){K.call(this,e,t<<24>>24)},setUint8:function(e,t){K.call(this,e,t<<24>>24)}},{unsafe:!0})}else N=function(e){v(this,N,C),e=w(e),x(this,{bytes:k.call(new Array(e),0),byteLength:e}),h||(this.byteLength=e)},M=function(e,t,n){v(this,M,R),v(e,N,R);var r=O(e).byteLength;if((t=y(t))<0||r<t)throw F("Wrong offset");if(r<t+(n=void 0===n?r-t:b(n)))throw F("Wrong length");x(this,{buffer:e,byteLength:n,byteOffset:t}),h||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},h&&(_(N,"byteLength"),_(M,"buffer"),_(M,"byteLength"),_(M,"byteOffset")),g(M[D],{getInt8:function(e){return u(this,1,e)[0]<<24>>24},getUint8:function(e){return u(this,1,e)[0]},getInt16:function(e){return((e=u(this,2,e,1<arguments.length?arguments[1]:void 0))[1]<<8|e[0])<<16>>16},getUint16:function(e){return(e=u(this,2,e,1<arguments.length?arguments[1]:void 0))[1]<<8|e[0]},getInt32:function(e){return a(u(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return a(u(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return B(u(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return B(u(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){l(this,1,e,r,t)},setUint8:function(e,t){l(this,1,e,r,t)},setInt16:function(e,t){l(this,2,e,i,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){l(this,2,e,i,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){l(this,4,e,s,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){l(this,4,e,s,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){l(this,4,e,o,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){l(this,8,e,c,t,2<arguments.length?arguments[2]:void 0)}});A(N,C),A(M,R),e.exports={ArrayBuffer:N,DataView:M}},function(e,t,n){var r=n(19);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t){var n=Math.abs,r=Math.pow,i=Math.floor,s=Math.log,a=Math.LN2;e.exports={pack:function(e,t,o){var c,u,l=new Array(o),d=8*o-t-1,h=(1<<d)-1,f=h>>1,p=23===t?r(2,-24)-r(2,-77):0,g=e<0||0===e&&1/e<0?1:0,m=0;for((e=n(e))!=e||e===1/0?(u=e!=e?1:0,c=h):(c=i(s(e)/a),e*(o=r(2,-c))<1&&(c--,o*=2),2<=(e+=1<=c+f?p/o:p*r(2,1-f))*o&&(c++,o/=2),h<=c+f?(u=0,c=h):1<=c+f?(u=(e*o-1)*r(2,t),c+=f):(u=e*r(2,f-1)*r(2,t),c=0));8<=t;l[m++]=255&u,u/=256,t-=8);for(c=c<<t|u,d+=t;0<d;l[m++]=255&c,c/=256,d-=8);return l[--m]|=128*g,l},unpack:function(e,t){var n,i,s=8*(i=e.length)-t-1,a=(1<<s)-1,o=a>>1,c=s-7,u=i-1,l=127&(i=e[u--]);for(i>>=7;0<c;l=256*l+e[u],u--,c-=8);for(n=l&(1<<-c)-1,l>>=-c,c+=t;0<c;n=256*n+e[u],u--,c-=8);if(0===l)l=1-o;else{if(l===a)return n?NaN:i?-1/0:1/0;n+=r(2,t),l-=o}return(i?-1:1)*n*r(2,l-t)}}},function(e,t,n){"use strict";var r=n(12),i=n(38),s=n(8);e.exports=function(e){for(var t,n=r(this),a=s(n.length),o=i(1<(t=arguments.length)?arguments[1]:void 0,a),c=void 0===(t=2<t?arguments[2]:void 0)?a:i(t,a);o<c;)n[o++]=e;return n}},function(e,t,n){var r=n(6).f,i=n(1),s=n(4)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,s)&&r(e,s,{configurable:!0,value:t})}},function(e,t,n){var r=n(72);e.exports=function(e,t){if((e=r(e))%t)throw RangeError("Wrong offset");return e}},function(e,t,n){var r=n(11);e.exports=function(e){if((e=r(e))<0)throw RangeError("The argument can't be less than 0");return e}},function(e,t,n){function r(){}function i(e){return"<script>"+e+"</"+f+">"}var s,a=n(10),o=n(74),c=n(27),u=n(24),l=n(76),d=n(33),h=(n=n(22),"prototype"),f="script",p=n("IE_PROTO"),g=function(){try{s=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e;g=s?function(e){e.write(i("")),e.close();var t=e.parentWindow.Object;return e=null,t}(s):((e=d("iframe")).style.display="none",l.appendChild(e),e.src=String("javascript:"),(e=e.contentWindow.document).open(),e.write(i("document.F=Object")),e.close(),e.F);for(var t=c.length;t--;)delete g[h][c[t]];return g()};u[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(r[h]=a(e),n=new r,r[h]=null,n[p]=e):n=g(),void 0===t?n:o(n,t)}},function(e,t,n){var r=n(2),i=n(6),s=n(10),a=n(75);e.exports=r?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),o=r.length,c=0;c<o;)i.f(e,n=r[c++],t[n]);return e}},function(e,t,n){var r=n(37),i=n(27);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){n=n(25),e.exports=n("document","documentElement")},function(e,t,n){var r=n(12),i=n(8),s=n(78),a=n(79),o=n(45),c=n(28).aTypedArrayConstructor;e.exports=function(e){var t,n,u,l,d,h,f=r(e),p=arguments.length,g=1<p?arguments[1]:void 0,m=void 0!==g,v=s(f);if(null!=v&&!a(v))for(h=(d=v.call(f)).next,f=[];!(l=h.call(d)).done;)f.push(l.value);for(m&&2<p&&(g=o(g,arguments[2],2)),n=i(f.length),u=new(c(this))(n),t=0;t<n;t++)u[t]=m?g(f[t],t):f[t];return u}},function(e,t,n){var r=n(29),i=n(44),s=n(4)("iterator");e.exports=function(e){if(null!=e)return e[s]||e["@@iterator"]||i[r(e)]}},function(e,t,n){var r=n(4),i=n(44),s=r("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||a[s]===e)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,n){var r=n(45),i=n(30),s=n(12),a=n(8),o=n(82),c=[].push;n=function(e){var t=1==e,n=2==e,u=3==e,l=4==e,d=6==e,h=5==e||d;return function(f,p,g,m){for(var v,y,b=s(f),w=i(b),_=r(p,g,3),E=a(w.length),T=0,S=(m=m||o,t?m(f,E):n?m(f,0):void 0);T<E;T++)if((h||T in w)&&(y=_(v=w[T],T,b),e))if(t)S[T]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return T;case 2:c.call(S,v)}else if(l)return!1;return d?-1:u||l?l:S}},e.exports={forEach:n(0),map:n(1),filter:n(2),some:n(3),every:n(4),find:n(5),findIndex:n(6)}},function(e,t,n){var r=n(3),i=n(83),s=n(4)("species");e.exports=function(e,t){var n;return new(void 0===(n=i(e)&&("function"==typeof(n=e.constructor)&&(n===Array||i(n.prototype))||r(n)&&null===(n=n[s]))?void 0:n)?Array:n)(0===t?0:t)}},function(e,t,n){var r=n(17);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){"use strict";var r=n(25),i=n(6),s=n(4),a=n(2),o=s("species");e.exports=function(e){var t=r(e);e=i.f,a&&t&&!t[o]&&e(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(3),i=n(13);e.exports=function(e,t,n){var s,a;return i&&"function"==typeof(s=t.constructor)&&s!==n&&r(a=s.prototype)&&a!==n.prototype&&i(e,a),e}},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Ae})),n(47);var r=n(9);function i(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function s(e){return function t(n){return 0===arguments.length||i(n)?t:e.apply(this,arguments)}}function a(e){return function t(n,r){switch(arguments.length){case 0:return t;case 1:return i(n)?t:s((function(t){return e(n,t)}));default:return i(n)&&i(r)?t:i(n)?s((function(t){return e(t,r)})):i(r)?s((function(t){return e(n,t)})):e(n,r)}}}function o(e){return function t(n,r,o){switch(arguments.length){case 0:return t;case 1:return i(n)?t:a((function(t,r){return e(n,t,r)}));case 2:return i(n)&&i(r)?t:i(n)?a((function(t,n){return e(t,r,n)})):i(r)?a((function(t,r){return e(n,t,r)})):s((function(t){return e(n,r,t)}));default:return i(n)&&i(r)&&i(o)?t:i(n)&&i(r)?a((function(t,n){return e(t,n,o)})):i(n)&&i(o)?a((function(t,n){return e(t,r,n)})):i(r)&&i(o)?a((function(t,r){return e(n,t,r)})):i(n)?s((function(t){return e(t,r,o)})):i(r)?s((function(t){return e(n,t,o)})):i(o)?s((function(t){return e(n,r,t)})):e(n,r,o)}}}var c=o((function(e,t,n){if(t<e)throw new Error("min must not be greater than max in clamp(min, max, value)");return n<e?e:t<n?t:n})),u=a((function(e,t){return null==t||t!=t?e:t}));function l(e){return 1===(e=e.toString(16)).length?"0"+e:e}function d(e){return"#"+e.map(l).join("")}function h(e,t,n){for(let r=0;r<n.length;r++)if(function(e,t,n){switch(n.length){case 3:if(function(e,t,n){return 255!==e[t+3]||e[t]===n[0]&&e[t+1]===n[1]&&e[t+2]===n[2]}(e,t,n))return!0;break;case 4:if(function(e,t,n){return e[t+3]&&n[3]?e[t]===n[0]&&e[t+1]===n[1]&&e[t+2]===n[2]&&e[t+3]===n[3]:e[t+3]===n[3]}(e,t,n))return!0;break;case 5:if(function(e,t,n){var r=n[0],i=n[1],s=n[2],a=n[3],o=n[4],c=e[t+3];return n=f(c,a,o),a?!(c||!n)||!!(f(e[t],r,o)&&f(e[t+1],i,o)&&f(e[t+2],s,o)&&n):n}(e,t,n))return!0;break;default:return!1}}(e,t,n[r]))return 1}function f(e,t,n){return t-n<=e&&e<=t+n}function p(e,t,n){const r={};var i=n.ignoredColor,s=n.step;for(let n=0;n<t;n+=s){var a,o=e[n],c=e[n+1],u=e[n+2],l=e[n+3];i&&h(e,n,i)||(a=Math.round(o/24)+","+Math.round(c/24)+","+Math.round(u/24),r[a]?r[a]=[r[a][0]+o*l,r[a][1]+c*l,r[a][2]+u*l,r[a][3]+l,r[a][4]+1]:r[a]=[o*l,c*l,u*l,l,1])}var d=Object.keys(r).map((e=>r[e])).sort(((e,t)=>(e=e[4],(t=t[4])<e?-1:e===t?0:1)))[0],f=d[0],p=d[1],g=d[2],m=d[3];return d=d[4],m?[Math.round(f/m),Math.round(p/m),Math.round(g/m),Math.round(m/d)]:n.defaultColor}function g(e,t,n){let r=0,i=0,s=0,a=0,o=0;var c=n.ignoredColor,u=n.step;for(let n=0;n<t;n+=u){var l=e[n+3],d=e[n]*l,f=e[n+1]*l,p=e[n+2]*l;c&&h(e,n,c)||(r+=d,i+=f,s+=p,a+=l,o++)}return a?[Math.round(r/a),Math.round(i/a),Math.round(s/a),Math.round(a/o)]:n.defaultColor}function m(e,t,n){let r=0,i=0,s=0,a=0,o=0;var c=n.ignoredColor,u=n.step;for(let n=0;n<t;n+=u){var l=e[n],d=e[n+1],f=e[n+2],p=e[n+3];c&&h(e,n,c)||(r+=l*l*p,i+=d*d*p,s+=f*f*p,a+=p,o++)}return a?[Math.round(Math.sqrt(r/a)),Math.round(Math.sqrt(i/a)),Math.round(Math.sqrt(s/a)),Math.round(a/o)]:n.defaultColor}function v(e){return y(e,"defaultColor",[0,0,0,0])}function y(e,t,n){return void 0===e[t]?n:e[t]}const b="FastAverageColor: ";function w(e,t,n){e.silent||(console.error(b+t),n&&console.error(n))}function _(e){return Error(b+e)}var E=class{getColorAsync(e,t){if(!e)return Promise.reject(_("call .getColorAsync() without resource."));if("string"==typeof e){const n=new Image;return n.crossOrigin="",n.src=e,this._bindImageEvents(n,t)}return e instanceof Image&&!e.complete?this._bindImageEvents(e,t):(t=this.getColor(e,t)).error?Promise.reject(t.error):Promise.resolve(t)}getColor(e,t){var n=v(t=t||{});if(!e)return w(t,"call .getColor(null) without resource."),this.prepareResult(n);var r=function(e,t){var n=y(t,"left",0),r=y(t,"top",0),i=y(t,"width",e.width);let s,a=i,o=e=y(t,"height",e.height);return"precision"===t.mode||(e<i?(s=i/e,a=100,o=Math.round(a/s)):(s=e/i,o=100,a=Math.round(o/s)),(a>i||o>e||a<10||o<10)&&(a=i,o=e)),{srcLeft:n,srcTop:r,srcWidth:i,srcHeight:e,destWidth:a,destHeight:o}}(function(e){if(e instanceof HTMLImageElement){let t=e.naturalWidth,n=e.naturalHeight;return e.naturalWidth||-1===e.src.search(/\.svg(\?|$)/i)||(t=n=100),{width:t,height:n}}return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:{width:e.width,height:e.height}}(e),t);if(!(r.srcWidth&&r.srcHeight&&r.destWidth&&r.destHeight))return w(t,`incorrect sizes for resource "${e.src}".`),this.prepareResult(n);if(!this._ctx&&(this._canvas="undefined"==typeof window?new OffscreenCanvas(1,1):document.createElement("canvas"),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return w(t,"Canvas Context 2D is not supported in this browser."),this.prepareResult(n);this._canvas.width=r.destWidth,this._canvas.height=r.destHeight;let i=n;try{this._ctx.clearRect(0,0,r.destWidth,r.destHeight),this._ctx.drawImage(e,r.srcLeft,r.srcTop,r.srcWidth,r.srcHeight,0,0,r.destWidth,r.destHeight);var s=this._ctx.getImageData(0,0,r.destWidth,r.destHeight).data;i=this.getColorFromArray4(s,t)}catch(n){w(t,`security error (CORS) for resource ${e.src}.\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`,n)}return this.prepareResult(i)}getColorFromArray4(e,t){var n=e.length,r=v(t=t||{});if(n<4)return r;var i=n-n%4;let s;switch(n=4*(t.step||1),t.algorithm||"sqrt"){case"simple":s=g;break;case"sqrt":s=m;break;case"dominant":s=p;break;default:throw _(`${t.algorithm} is unknown algorithm.`)}return s(e,i,{defaultColor:r,ignoredColor:(r=t.ignoredColor)&&(Array.isArray(r)?"number"==typeof r[0]?[r.slice()]:r:[r]),step:n})}prepareResult(e){const t=e.slice(0,3),n=[].concat(t,e[3]/255);var r=(299*(r=e)[0]+587*r[1]+114*r[2])/1e3<128;return{value:e,rgb:"rgb("+t.join(",")+")",rgba:"rgba("+n.join(",")+")",hex:d(t),hexa:d(e),isDark:r,isLight:!r}}destroy(){delete this._canvas,delete this._ctx}_bindImageEvents(e,t){return new Promise(((n,r)=>{const i=()=>{o();var i=this.getColor(e,t);i.error?r(i.error):n(i)},s=()=>{o(),r(_(`Error loading image "${e.src}".`))},a=()=>{o(),r(_(`Image "${e.src}" loading aborted.`))},o=()=>{e.removeEventListener("load",i),e.removeEventListener("error",s),e.removeEventListener("abort",a)};e.addEventListener("load",i),e.addEventListener("error",s),e.addEventListener("abort",a)}))}},T=s((function(e){return null==e})),S=a((function(e,t){return null!=t&&t.constructor===e||t instanceof e}));function I(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var k=Object.prototype.toString,A=function(){return"[object Arguments]"===k.call(arguments)?function(e){return"[object Arguments]"===k.call(e)}:function(e){return I("callee",e)}}(),O=Array.isArray||function(e){return null!=e&&0<=e.length&&"[object Array]"===Object.prototype.toString.call(e)};function x(e){return"[object String]"===Object.prototype.toString.call(e)}var C=s((function(e){return null!=e&&"function"==typeof e["fantasy-land/empty"]?e["fantasy-land/empty"]():null!=e&&null!=e.constructor&&"function"==typeof e.constructor["fantasy-land/empty"]?e.constructor["fantasy-land/empty"]():null!=e&&"function"==typeof e.empty?e.empty():null!=e&&null!=e.constructor&&"function"==typeof e.constructor.empty?e.constructor.empty():O(e)?[]:x(e)?"":(t=e,"[object Object]"===Object.prototype.toString.call(t)?{}:A(e)?function(){return arguments}():void 0);var t}));function R(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function D(e,t,n){for(var r=0,i=n.length;r<i;){if(e(t,n[r]))return 1;r+=1}}var L="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},P=!{toString:null}.propertyIsEnumerable("toString"),N=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],M=function(){return arguments.propertyIsEnumerable("length")}(),j="function"!=typeof Object.keys||M?s((function(e){if(Object(e)!==e)return[];var t,n,r=[],i=M&&A(e);for(t in e)!I(t,e)||i&&"length"===t||(r[r.length]=t);if(P)for(n=N.length-1;0<=n;)I(t=N[n],e)&&!function(e,t){for(var n=0;n<e.length;){if(e[n]===t)return!0;n+=1}return!1}(r,t)&&(r[r.length]=t),--n;return r})):s((function(e){return Object(e)!==e?[]:Object.keys(e)})),F=s((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function U(e,t,n,r){function i(e,t){return B(e,t,n.slice(),r.slice())}return e=R(e),!D((function(e,t){return!D(i,t,e)}),R(t),e)}function B(e,t,n,r){if(L(e,t))return!0;var i,s=F(e);if(s!==F(t))return!1;if(null==e||null==t)return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(s){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===(i=e.constructor,null==(i=String(i).match(/^function (\w*)/))?"":i[1]))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!L(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!L(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var a=n.length-1;0<=a;){if(n[a]===e)return r[a]===t;--a}switch(s){case"Map":return e.size===t.size&&U(e.entries(),t.entries(),n.concat([e]),r.concat([t]));case"Set":return e.size===t.size&&U(e.values(),t.values(),n.concat([e]),r.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var o=j(e);if(o.length!==j(t).length)return!1;var c=n.concat([e]),u=r.concat([t]);for(a=o.length-1;0<=a;){var l=o[a];if(!I(l,t)||!B(t[l],e[l],c,u))return!1;--a}return!0}var V,q,G,K,z,H=a((function(e,t){return B(e,t,[],[])})),W=s((function(e){return null!=e&&H(e,C(e))})),$="function"==typeof Object.assign?Object.assign:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1,r=arguments.length;n<r;){var i=arguments[n];if(null!=i)for(var s in i)I(s,i)&&(t[s]=i[s]);n+=1}return t},Y=a((function(e,t){return $({},e,t)})),Q=a((function(e,t){var n,r=Number(t),i=0;if(r<0||isNaN(r))throw new RangeError("n must be a non-negative number");for(n=new Array(r);i<r;)n[i]=e(i),i+=1;return n}));n(86),(n=V=V||{}).HLS="hls",n.WEBRTC="webrtc",(n=q=q||{}).PLAYER="player",n.LIST="list",n.SETTINGS="settings",(n={}).CLOSED="closed",n.FAILED="failed",n.LISTENING="listening",n.OPEN="open",n.PAUSED="paused",n.RESPONDING="responding",n.PROCESSING="processing",n.SLEEPING="sleeping",(n=G=G||{}).LANDSCAPE="landscape",n.PORTRAIT="portrait",(n=K=K||{}).CHAT="chat",n.KIOSK="kiosk",(n=z=z||{}).BOT="bot",n.USER="user";const X=e=>{const t=document.createElement("DIV");return t.innerHTML=e,t};var J=s((function(e){return function(){return e}}));function Z(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,n){return t.apply(this,arguments)};case 3:return function(e,n,r){return t.apply(this,arguments)};case 4:return function(e,n,r,i){return t.apply(this,arguments)};case 5:return function(e,n,r,i,s){return t.apply(this,arguments)};case 6:return function(e,n,r,i,s,a){return t.apply(this,arguments)};case 7:return function(e,n,r,i,s,a,o){return t.apply(this,arguments)};case 8:return function(e,n,r,i,s,a,o,c){return t.apply(this,arguments)};case 9:return function(e,n,r,i,s,a,o,c,u){return t.apply(this,arguments)};case 10:return function(e,n,r,i,s,a,o,c,u,l){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function ee(e,t,n){return function(){if(0===arguments.length)return n();var r,i=Array.prototype.slice.call(arguments,0),s=i.pop();if(!O(s)){for(var a=0;a<e.length;){if("function"==typeof s[e[a]])return s[e[a]].apply(s,i);a+=1}if(null!=(r=s)&&"function"==typeof r["@@transducer/step"])return t.apply(null,i)(s)}return n.apply(this,arguments)}}var te=s((function(e){return!!O(e)||!!e&&"object"==typeof e&&!x(e)&&(1===e.nodeType?!!e.length:0===e.length||0<e.length&&e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1))})),ne=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}(),re=a((function(e,t){return Z(e.length,(function(){return e.apply(t,arguments)}))}));function ie(e,t,n){for(var r=n.next();!r.done;){if((t=e["@@transducer/step"](t,r.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r=n.next()}return e["@@transducer/result"](t)}function se(e,t,n,r){return e["@@transducer/result"](n[r](re(e["@@transducer/step"],e),t))}var ae="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function oe(e,t,n){if("function"==typeof e&&(e=new ne(e)),te(n))return function(e,t,n){for(var r=0,i=n.length;r<i;){if((t=e["@@transducer/step"](t,n[r]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}r+=1}return e["@@transducer/result"](t)}(e,t,n);if("function"==typeof n["fantasy-land/reduce"])return se(e,t,n,"fantasy-land/reduce");if(null!=n[ae])return ie(e,t,n[ae]());if("function"==typeof n.next)return ie(e,t,n);if("function"==typeof n.reduce)return se(e,t,n,"reduce");throw new TypeError("reduce: list must be array or iterable")}var ce=function(){return this.xf["@@transducer/init"]()},ue=function(e){return this.xf["@@transducer/result"](e)},le=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=ce,e.prototype["@@transducer/result"]=ue,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}(),de=a((function(e,t){return 1===e?s(t):Z(e,function e(t,n,r){return function(){for(var s,a=[],o=0,c=t,u=0;u<n.length||o<arguments.length;)u<n.length&&(!i(n[u])||arguments.length<=o)?s=n[u]:(s=arguments[o],o+=1),i(a[u]=s)||--c,u+=1;return c<=0?r.apply(this,a):Z(c,e(t,a,r))}}(e,[],t))})),he=a(ee(["fantasy-land/map","map"],a((function(e,t){return new le(e,t)})),(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return de(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return oe((function(n,r){return n[r]=e(t[r]),n}),{},j(t));default:return function(e,t){for(var n=0,r=t.length,i=Array(r);n<r;)i[n]=e(t[n]),n+=1;return i}(e,t)}}))),fe=a((function(e,t){return e<t?t:e})),pe=o(oe),ge=s((function(e){return Z(pe(fe,0,he((function(e){return e[0].length}),e)),(function(){for(var t=0;t<e.length;){if(e[t][0].apply(this,arguments))return e[t][1].apply(this,arguments);t+=1}}))}));function me(e,t){return 0<=function(e,t,n){var r,i;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(r=1/t;n<e.length;){if(0===(i=e[n])&&1/i==r)return n;n+=1}return-1}if(t==t)return e.indexOf(t,n);for(;n<e.length;){if("number"==typeof(i=e[n])&&i!=i)return n;n+=1}return-1;case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,n);case"object":if(null===t)return e.indexOf(t,n)}for(;n<e.length;){if(H(e[n],t))return n;n+=1}return-1}(t,e,0)}function ve(){return!0}var ye=a(me);const be=(e,t,n)=>{let r=e.scrollTop,i=t-r,s=0;const a=()=>{var t,o,c;s+=20,e.scrollTop=(t=s,o=r,c=i,(t/=n/2)<1?c/2*t*t+o:-c/2*(--t*(t-2)-1)+o),s<n&&setTimeout(a,20)};a()};var we=function(e,t,n,r){return new(n=n||Promise)((function(i,s){function a(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))},_e=function(e,t,n,r){return new(n=n||Promise)((function(i,s){function a(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))};const Ee={animationSpeed:500,goTo:!0,title:"",feedback:!0,backgroundAdvancedAnimationParticlesCount:20,backgroundColor:"#927263",backgroundImage:null,backgroundImageBlur:0,backgroundSimpleAnimation:!0,detectOrientation:!0,fullScreen:!0,customIcons:!1,arrowIcon:"icon--content--arrow-up",micIcon:"icon--content--mic",pauseIcon:"icon--content--pause",playIcon:"icon--content--play",keyboardIcon:"icon--content--keyboard",muteIcon:"icon--content--volume-mute",volumeIcon:"icon--content--volume",upSop:"icon--content--upSop",downSop:"icon--content--downSop",guiMode:K.KIOSK,imageAverageColorOpacity:.5,widgetSize:{height:"600px",width:"400px"},userMessageBackgroundColor:"rgba(255, 255, 255, .3)",userMessageTextColor:"#ffffff",userMessageTextOutlineColor:"rgba(0, 0, 0, .5)",botMessageBackgroundColor:"rgba(0, 0, 0, .4)",botMessageTextColor:"#ffffff",inputMode:"sop",standardQuestionMode:"text",inputAudio:!0,outputAudio:!0,botMessageTextOutlineColor:"rgba(0, 0, 0, .5)",reverseAvatarOrder:!1,collapsable:!1,collapsed:!1,sectionActive:0,sections:["SOP","QUESTION","SOLUTIONS","PDF","FEEDBACK","LOGIN","INPUTSELECT"],interactionMode:"SOP",sound:!0},Te="80px",Se={[K.CHAT]:2/3,[K.KIOSK]:1},Ie=["mic","blocked","volume","speaking-head","arrow-up","play","pause","stop","keyboard","volume-mute","menu","mic2","back","downSop","upSop","undo","restart","feedback","close"],ke="icon-sop--mic--active";class Ae{constructor(e,t=Ee){var n,i;if(this.setControls=e=>{e?Ae.chatTextInputElement.removeAttribute("no-controls"):Ae.chatTextInputElement.setAttribute("no-controls","")},this.expand=()=>{Ae.settings.collapsable&&Ae.settings.collapsed&&this.changeCollapsedMode()},this.changeCollapsedMode=()=>{Ae.settings.collapsed=!Ae.settings.collapsed,Ae.setCollapsableUIHeight(),this.collapsableTriggerCallback(Ae.settings.collapsed),Ae.settings.collapsed?Ae.collapsableTriggerElement.classList.remove("hidden"):Ae.collapsableTriggerElement.classList.add("hidden");var e=(e=Ae.element.getBoundingClientRect()).width>e.height?G.LANDSCAPE:G.PORTRAIT;this.setOrientation(e)},this.setupDataChannel=e=>{try{const t=Ae.avatarConnection.createDataChannel(e,{ordered:!0});t.binaryType="arraybuffer";const n=this.dataChannelMessageCallback;return console.log("Created data channel (".concat(e,")")),t.onopen=function(t){console.log("data channel (".concat(e,") connect")),Ae.avatarDataChannel.send(new Uint8Array([7]).buffer),Ae.avatarDataChannel.send(new Uint8Array([1]).buffer)},t.onclose=function(t){console.log("data channel (".concat(e,") closed"))},t.onmessage=function(t){if(console.log("Got message (".concat(e,")"),t.data),void 0!==t.data.size){const e=new FileReader;e.addEventListener("loadend",(()=>{n(new Uint8Array(e.result))})),e.readAsArrayBuffer(t.data)}else n(new Uint8Array(t.data))},t}catch(e){return console.warn("No data channel",e),null}},this.setPlayIcon=e=>{Ae.chatInputPlayElement&&(Ae.chatInputPlayElement.classList.remove(Ae.settings.pauseIcon),Ae.chatInputPlayElement.classList.remove(Ae.settings.playIcon),Ae.chatInputPlayElement.classList.add(e))},this.setScreen=(e=q.PLAYER)=>{},this.setOrientation=(e=Ae.orientation)=>{Ae.element.setAttribute("data-orientation",e);var{width:t,height:e}=Ae.element.getBoundingClientRect(),t="100%"===Ae.element.style.width?"".concat(t,"px"):Ae.element.style.width;e="100%"===Ae.element.style.height?"".concat(e,"px"):Ae.element.style.height,Ae.element.style.setProperty("--bot-ui-window-width",t),Ae.element.style.setProperty("--bot-ui-window-height",e)},this.setState=e=>{},this.setBackgroundColor=e=>Ae.setBackground({color:e}),this.setBackgroundImage=(e,t=Ae.settings.backgroundImageBlur)=>Ae.setBackground({url:{path:e,blur:t}}),this.setUserText=(e=null)=>{Ae.settings.guiMode===K.KIOSK&&(Ae.userTextKioskElement.setAttribute("data-empty",""),window.setTimeout((()=>{T(e)||W(e)?Ae.userTextKioskElement.setAttribute("data-empty",""):(Ae.userTextKioskElement.innerText=e,Ae.userTextKioskElement.removeAttribute("data-empty"))}),Ae.settings.animationSpeed)),Ae.settings.guiMode!==K.CHAT||T(e)||W(e)||this.setChatMessage(e,null,null,z.USER,!0)},this.setBotText=(e=null,t="")=>{Ae.settings.guiMode===K.KIOSK&&(Ae.botTextKioskElement.setAttribute("data-empty",""),window.setTimeout((()=>{T(e)||W(e)?Ae.botTextKioskElement.setAttribute("data-empty",""):(Ae.botTextKioskElement.innerText=e,Ae.botTextKioskElement.removeAttribute("data-empty"))}),Ae.settings.animationSpeed)),Ae.settings.guiMode!==K.CHAT||T(e)||W(e)||this.setChatMessage(e,null,null,z.BOT,!1,t,this.botMessagesCallback)},this.setVideo=(e=null,t)=>{if(Ae.videoCallback=t,Ae.settings.guiMode===K.CHAT&&this.setChatMessage(null,null,e,z.BOT,!1),Ae.settings.guiMode===K.KIOSK){const t=(e=!0)=>{Ae.imageKioskElement.innerHTML="",e&&(Ae.imageKioskElement.classList.add("bu-d-none"),Ae.element.removeAttribute("data-width-image"))};if(e)if(e.includes("youtube.com/embed")){const n=document.createElement("iframe");n.setAttribute("src",e),t(!1),Ae.imageKioskElement.classList.remove("bu-d-none"),Ae.element.setAttribute("data-width-image",""),Ae.imageKioskElement.appendChild(n),Ae.videoCallback()}else{const n=document.createElement("video");n.autoplay=!0,n.onloadeddata=e=>{t(!1),Ae.imageKioskElement.classList.remove("bu-d-none"),Ae.element.setAttribute("data-width-image",""),Ae.imageKioskElement.appendChild(n)},n.onended=e=>{Ae.videoCallback()},n.src=e}else t()}},this.toggleLoader=e=>{e?(Ae.loadingSpinner.classList.remove("hidden"),Ae.messagesElement.classList.add("hidden")):(Ae.loadingSpinner.classList.add("hidden"),Ae.messagesElement.classList.remove("hidden"))},this.appSelectToggle=(e,t="")=>{e?(Ae.sopName.classList.remove("hidden"),Ae.chatTextInputElement.style.setProperty("--bot-ui-sop-name-height","50px"),Ae.messagesElement.style.setProperty("--bot-ui-sop-name-height","50px"),Ae.sopName.textContent=t):(Ae.sopName.classList.add("hidden"),Ae.chatTextInputElement.style.setProperty("--bot-ui-sop-name-height","0px"),Ae.messagesElement.style.setProperty("--bot-ui-sop-name-height","0px"),Ae.sopName.textContent="")},this.removeSuggestions=()=>{document.querySelectorAll("[data-messages] > div > [data-suggestions-container]").forEach((e=>{const t=e.parentNode;t.parentNode.removeChild(t)}))},this.setSuggestion=(e,t=!1)=>{this.removeSuggestions();const n=Ae.messagesElement,r=X('\n    <div data-suggestions-container class="data-suggestions-container">\n    </div>\n');t&&r.children[0].classList.add("list-view"),n.appendChild(r);var i=!1;t||(r.addEventListener("mouseover",(function(){i=!0})),r.addEventListener("mouseout",(function(){i=!1})),r.addEventListener("wheel",(e=>{console.log("hovering"),i&&(e.preventDefault(),e=e.deltaY/Math.abs(e.deltaY)*30,r.children[0].scrollLeft+=e)}))),e.forEach((e=>{let n=document.createElement("button");n.innerText=e,n.setAttribute("data-suggestions-button",""),n.classList.add("data-suggestions-button"),t&&n.classList.add("list-view"),n.onclick=this.suggestionsCallback,document.querySelector("[data-suggestions-container].data-suggestions-container").appendChild(n)})),Ae.scrollToLastMessage(n)},this.setMedia=(e={})=>{const t=Ae.messagesElement,n=document.createElement("video"),r=document.createElement("source");r.src=e.src,n.appendChild(r),n.setAttribute("controls",""),n.classList.add("chat-message"),e.sound||(n.classList.add("bot-muted-video"),window.onload=function(){var e=document.getElementsByClassName("bot-muted-video");for(let t=0;t<e.length;t++)e[t].muted=!0}),t.appendChild(n)},this.disableButtonGroup=(e,t,n)=>{Ae.messagesElement,Ae.inputTakers.classList.remove("hidden"),t&&t(),e.disableGroup&&document.querySelectorAll("[data-button-group=".concat(n,"]")).forEach((e=>{e.setAttribute("disabled","")})),this.setInputMode(e.oldMode)},this.setButton=(e={},t=(()=>{}))=>{console.log(e);const n=Ae.messagesElement;this.setInputMode("button");const r=document.createElement("button");if(e.background){const t=new Image;r.append(t),t.src=e.background,r.style.background="transparent"}e.text&&(r.textContent=e.text),r.classList.add("inputButton","chat-message","chat-message-bot"),r.setAttribute("data-message-type","bot"),r.setAttribute("data-button-group","buttons"),r.onclick=()=>{this.disableButtonGroup(e,t,"buttons")},n.appendChild(r),n.scrollTop=n.scrollHeight,Ae.scrollToLastMessage(n)},this.setImage=(e=null,t="")=>{if(Ae.settings.guiMode===K.KIOSK){const t=(e=!0)=>{Ae.imageKioskElement.innerHTML="",e&&(Ae.imageKioskElement.classList.add("bu-d-none"),Ae.element.removeAttribute("data-width-image"))};if(e){const n=new Image,r=new E;n.crossOrigin="anonymous",n.onload=e=>{t(!1),Ae.imageKioskElement.classList.remove("bu-d-none"),Ae.element.setAttribute("data-width-image",""),Ae.imageKioskElement.appendChild(n),r.getColorAsync(Ae.imageKioskElement.querySelector("img")).then((function(e){Ae.element.style.setProperty("--bot-ui-image-background-color","rgba(".concat(e.value[0],", ").concat(e.value[1],", ").concat(e.value[2],", ").concat(Ae.settings.imageAverageColorOpacity,")"))})).catch((function(e){console.log(e)}))},n.onerror=e=>{t()},n.src="https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=2592000&url="+e}else t()}Ae.settings.guiMode!==K.CHAT||T(e)||W(e)||this.setChatMessage(null,e,null,z.BOT,!1,t,this.botMessagesCallback)},this.setInputAudio=(e=null)=>{Ae.botPcmElement.classList.add("bu-invisible"),Ae.botPcmElement.classList.remove("bu-visible"),T(e)||W(e)?(Ae.userPcmElement.classList.add("bu-invisible"),Ae.userPcmElement.classList.remove("bu-visible")):(Ae.userPcmElement.classList.add("bu-visible"),Ae.userPcmElement.classList.remove("bu-invisible"))},this.setOutputAudio=(e=null,t,n)=>{Ae.userPcmElement.classList.add("bu-invisible"),Ae.userPcmElement.classList.remove("bu-visible"),T(e)||W(e)?(Ae.botPcmElement.classList.add("bu-invisible"),Ae.botPcmElement.classList.remove("bu-visible")):"voice"===Ae.settings.inputMode&&(Ae.botPcmElement.classList.add("bu-visible"),Ae.botPcmElement.classList.remove("bu-invisible"))},this.chatInputCallback=()=>{},this.inputModeCallback=()=>{},this.chatArrowCallback=()=>{},this.chatMicrophoneCallback=()=>{},this.closeElementCallback=()=>{this.changeCollapsedMode()},this.feedbackCallback=()=>{},this.chatRestartCallback=()=>{},this.botMessagesCallback=e=>{},this.chatMuteCallback=()=>{},this.chatBargeCallback=()=>{},this.chatPlayCallback=()=>{},this.chatStopCallback=()=>{},this.chatMicCallback=()=>{},this.loginCallback=()=>_e(this,void 0,void 0,(function*(){})),this.sectionChangeCallback=()=>{},this.chatBackCallback=()=>{},this.chatKeyboardCallback=()=>{Ae.settings.inputAudio=!Ae.settings.inputAudio,Ae.settings.inputAudio?document.querySelector("[data-chat-input-keyboard]").classList.add("icon-sop--keyboard-active"):document.querySelector("[data-chat-input-keyboard]").classList.remove("icon-sop--keyboard-active")},this.chatSopNextCallback=()=>{},this.chatSopQuestionCallback=()=>{},this.chatTextInputElementCallback=()=>{},this.dataChannelMessageCallback=()=>{},this.collapsableTriggerCallback=e=>{},this.suggestionsCallback=()=>{},this.goToPositive=e=>{},this.setMicrophone=(e=!1)=>{Ae.isMicrophoneEnabled=e,Ae._setMicrophone(),Ae.getChatMicrophone(Ae.isMicrophoneEnabled,this.chatMicrophoneCallback)},this.setUserMessageBackgroundColor=e=>{e=T(e)||!S(String,e)?this.getSettings().userMessageBackgroundColor:e,Ae.element.style.setProperty("--bot-ui-message-background-user",e)},this.setBotMessageBackgroundColor=e=>{e=T(e)||!S(String,e)?this.getSettings().botMessageBackgroundColor:e,Ae.element.style.setProperty("--bot-ui-message-background-bot",e)},this.setUserMessageTextColor=e=>{e=T(e)||!S(String,e)?this.getSettings().userMessageTextColor:e,Ae.element.style.setProperty("--bot-ui-message-color-user",e)},this.setBotMessageTextColor=e=>{e=T(e)||!S(String,e)?this.getSettings().botMessageTextColor:e,Ae.element.style.setProperty("--bot-ui-message-color-bot",e)},this.setUserMessageTextOutlineColor=e=>{e=T(e)||!S(String,e)?this.getSettings().userMessageTextOutlineColor:e,Ae.element.style.setProperty("--bot-ui-message-color-outline-user",e)},this.setBotMessageTextOutlineColor=e=>{e=T(e)||!S(String,e)?this.getSettings().botMessageTextOutlineColor:e,Ae.element.style.setProperty("--bot-ui-message-color-outline-bot",e)},this.setTextInputEnabled=(e=!1)=>{let t="0px";(Ae.settings.textInputEnabled=e)?(Ae.element.setAttribute("data-with-chat-input",""),t=Te):Ae.element.removeAttribute("data-with-chat-input"),Ae.element.style.setProperty("--bot-ui-chat-input-height",t),Ae.handleBotUiHeights()},this.setHlsAvatar=(e=null)=>{this.setAvatar({type:V.HLS,streamUrl:e})},this.setWebRtcAvatar=(e=null)=>{this.setAvatar({type:V.WEBRTC,streamUrl:e})},this.setAvatar=({type:e,streamUrl:t}={type:V.HLS,streamUrl:null})=>_e(this,void 0,void 0,(function*(){const n=document.createElement("video"),i=(e=!1)=>{Ae.avatarElement.innerHTML="",Ae.showAvatar(!1),e&&Ae.avatarWs&&Ae.avatarWs.close()};var s,a;if(i(),(e=>(e=e&&e.split(":/")||"",-1!==["http","https","ws","wss"].indexOf(e[0])))(t))if(e===V.HLS){if(Ae.avatarElement.appendChild(n),r.isSupported()){const e=new r;e.detachMedia(),e.loadSource(t),e.attachMedia(n),e.on(r.Events.MANIFEST_PARSED,(()=>{n.play(),Ae.showAvatar(!0)})),e.on(r.Events.ERROR,((t,n)=>{n&&n.response&&404===n.response.code&&(e.detachMedia(),i()),console.log(t,n.response,n)})),e.on(r.Events.LEVEL_SWITCHED,((t,n)=>{var{width:r,height:n}=e.levels[n.level];r&&n&&console.log("qualityChange ".concat(r,"x").concat(n))})),e.on(r.Events.BUFFER_EOS,(e=>{this.setHlsAvatar(null)}))}}else{let e=[];Ae.avatarWs=new WebSocket(t),s=Ae.avatarWs,a=1e4,(yield we(void 0,void 0,void 0,(function*(){var e=()=>s.readyState===WebSocket.OPEN;if(s.readyState!==WebSocket.CONNECTING)return e();{var t=a/100;let n=0;for(;s.readyState===WebSocket.CONNECTING&&n<t;)yield new Promise((e=>setTimeout(e,100))),n++;return e()}})))&&(Ae.avatarWs.onmessage=t=>{var n=JSON.parse(t.data);switch(n.type){case"answer":Ae.avatarConnection.setRemoteDescription({type:"answer",sdp:n.sdp}).then((()=>{e.forEach((e=>{Ae.avatarConnection.addIceCandidate(e)})),e=[]})).catch((e=>{console.error("Failed to set remote description",e)}));break;case"error":console.error("Error message from server ".concat(n.message));break;case"iceCandidate":var r=new RTCIceCandidate(n.candidate);Ae.avatarConnection&&Ae.avatarConnection.remoteDescription?Ae.avatarConnection.addIceCandidate(r).catch((e=>{console.error("Failed to add ICE candidate",e)})):(console.log("Connection not ready, queuing candidate",r),e.push(r));break;default:console.error("Unknown message from server ".concat(n.message))}},_e(this,void 0,void 0,(function*(){Ae.avatarConnection=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"],username:"",credential:""}]}),Ae.avatarDataChannel=this.setupDataChannel("cirrus"),Ae.avatarConnection.addEventListener("icecandidate",(e=>{(e=e.candidate)&&(console.log("Local ICE candidate"+JSON.stringify(e)),""!==e.candidate&&this.avatarSendMessage({type:"iceCandidate",candidate:e}))})),Ae.avatarConnection.addEventListener("track",(e=>{console.log("Video track ready"),i(!1),Ae.avatarElement.appendChild(n),n.playsInline=!0,n.srcObject?n.srcObject.addTrack(e.track):n.srcObject=e.streams[0],Ae.showAvatar(!0)}));var e=yield Ae.avatarConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});yield Ae.avatarConnection.setLocalDescription(e),console.info("Sending SDP offer"),this.avatarSendMessage({type:"offer",sdp:e.sdp})})).catch((e=>{console.error("Failed to create WebRTC connection",e),i()})))}})),this.setReverseAvatarOrder=(e=!1)=>{Ae.settings.guiMode===K.CHAT&&(e=!!e,Ae.reverseAvatarOrderAction(e))},this.avatarSendMessage=e=>{e=JSON.stringify(e),console.log("Sending message: "+e),Ae.avatarWs.send(e)},this.getSettings=()=>Ae.settings,this.sendRTCData=e=>{if(Ae.avatarDataChannel&&"open"==Ae.avatarDataChannel.readyState){console.log("Sending",e);const t=JSON.stringify(e),n=new DataView(new ArrayBuffer(3+2*t.length));let r=0;n.setUint8(r,50),r++,n.setUint16(r,t.length,!0),r+=2;for(let e=0;e<t.length;e++)n.setUint16(r,t.charCodeAt(e),!0),r+=2;Ae.avatarDataChannel.send(n.buffer)}},this.disableStop=e=>{Ae.chatInputStopElement.classList.remove("icon--light"),e&&Ae.chatInputStopElement.classList.add("icon--light")},this.setChatMessage=(e,t,n,r,i=!1,s=null,a=(()=>{}))=>{const o=Ae.messagesElement,c=X('\n    <div class="chat-message">\n        <span></span>\n    </div>\n'),u=c.querySelector("div.chat-message"),l=u.querySelector(":scope span");var d;if(null!==o.lastChild&&(({dataset:{messageType:d}={}}=o&&o.lastChild&&o.lastChild),i&&null!==o.lastChild&&d!==z.BOT?o.removeChild(o.lastChild):d&&d===r&&o.lastChild.classList.remove("chat-message-last")),l.innerHTML=e,u.setAttribute("data-message-type",r),u.classList.add("chat-message-"+r),u.classList.add("chat-message-last"),t){const e=new Image;e.onload=t=>{u.appendChild(e),o.scrollTop=o.scrollHeight},e.onerror=e=>{},e.src=t}if(n)if(n.includes("youtube.com/embed")){const e=document.createElement("iframe");e.setAttribute("src",n),u.appendChild(e),o.scrollTop=o.scrollHeight,Ae.videoCallback()}else{const e=document.createElement("video");e.src=n,e.autoplay=!0,e.onloadeddata=e=>{o.scrollTop=o.scrollHeight},e.onended=e=>{Ae.videoCallback()},u.appendChild(e)}if(r===z.BOT&&this.getSettings().goTo){var h=document.getElementsByClassName("latest-message");for(let e=0;e<h.length;e++)h[e].classList.remove("latest-message");const e=document.createElement("span");e.innerHTML=" ",["icon-sop","icon-sop--undo","icon--content--undo","latest-message"].forEach((t=>{e.classList.add(t)})),e.addEventListener("click",(()=>{a(s)})),c.children[0].appendChild(e)}o.appendChild(c.children[0]),this.chatMessageHeightLimit(o.children[o.children.length-1]),o.scrollTop=o.scrollHeight,Ae.scrollToLastMessage(o)},Ae.element=document.getElementById(e),Ee.textInputEnabled=t.guiMode===K.CHAT,t.guiMode=(n=t.guiMode,i=Object.values(K),e=K.KIOSK,ge([[ye(n),J(n)],[ve,J(e)]])(i)),Ae.settings=Y(Ee,t),Ae.settings.fullScreen=!Ae.settings.collapsable&&Ae.settings.fullScreen,Ae.rootElement=document.documentElement,Ae.element){if(Ae.element.style.setProperty("--bot-ui-animation-speed","".concat(Ae.settings.animationSpeed,"ms")),Ae.element.style.setProperty("--bot-ui-background-url-blur","".concat(Ae.settings.backgroundImageBlur,"px")),Ae.element.style.setProperty("--bot-ui-background-url",'url("'.concat(Ae.settings.backgroundImage,'")')),Ae.element.style.setProperty("--bot-ui-background-color","".concat(Ae.settings.backgroundColor)),Ae.element.style.setProperty("--bot-ui-message-color-bot","".concat(Ae.settings.botMessageTextColor)),Ae.element.style.setProperty("--bot-ui-message-color-user","".concat(Ae.settings.userMessageTextColor)),Ae.element.style.setProperty("--bot-ui-message-background-bot","".concat(Ae.settings.botMessageBackgroundColor)),Ae.element.style.setProperty("--bot-ui-message-background-user","".concat(Ae.settings.userMessageBackgroundColor)),Ae.element.style.setProperty("--bot-ui-chat-pcm-height",Te),Ae.orientation=G.LANDSCAPE,"SOP"==Ae.settings.interactionMode||"GUIDE"==Ae.settings.interactionMode?Ae.element.innerHTML='\n    <div data-wrapper class="bot bot-wrapper">\n        <div data-sop-header>\n            <h3 data-sop-title>UPV</h3>\n            <div data-sop-close class="icon-sop icon-sop--close"></div>\n        </div>\n        <div class="column column-image">\n            <div data-image class="image"></div>\n            </div>\n            <div data-avatar class="column column-avatar">\n            </div>\n            <div bot-login class="bot-login">\n                <div bot-log-container class="bot-log-container">\n                    <h2>Welcome</h2>\n                    <p>Please login to use the bot</p>\n                    <button class="instantLogIn btn btn-light"> \n                        <img src="https://img.icons8.com/fluency/512/google-logo.png" class="bot-googleIcon"/>\n                        <div class="bot-googleLogText">Login with Google</div>\n                    </button>\n                </div>\n                <div bot-loginPopup class="bot-login-failed-popup hidden">Account doesn\'t exist!</div>\n            </div>\n            <div data-messages class="column column-messages">\n            </div>\n            <div loader class="loader hidden">\n                <span loader-text class="loader-text">Loading PDF Files...</span>\n            </div>\n        <div data-chat-input class="chat-input">\n            <div class="chat-input-wrapper">\n                <div data-input-takers> \n                    <div data-chat-sop class="sop-section">\n                        <button data-sop-question>Ask Question</button>\n                        <button data-sop-question>Feedback</button>\n                        <button data-sop-next class="next-button">\n                            <div data-chat-input-arrow-down>Next</div>\n                        </button>\n                    </div>\n                    <div data-chat-ask class="ask-section">\n                        <span data-chat-input-keyboard class="icon-sop icon-sop--keyboard"></span>\n                        <span data-chat-input-mute class="icon-sop icon-sop--volume-mute"></span>\n                        <span data-chat-input-restart class="icon-sop icon-sop--restart hidden"></span>\n    \n                        <div data-sound-input-wrap>\n                            <span data-chat-input-mic class="icon-sop icon--largest icon-sop--mic"></span>\n                        </div>\n                        <div data-text-input-wrap>\n    \n                            <input type="text" id="chatWindowTextInput" placeholder="Type text..." autocomplete="off" class="sop-text-input"/>\n                            <span data-chat-input-controls class="controls--visible">\n                                <span data-chat-input-stop class="icon-sop icon-sop--stop icon--hidden"></span>\n                            </span>\n                            <span data-chat-input-arrow class="icon-sop icon-sop--arrow-up icon-sop--arrow-up--hidden"></span>\n                        </div>\n    \n                    </div>\n                </div>\n            </div>\n        </div>\n        <div data-user-pcm class="pcm pcm-user bu-invisible"></div>\n        <div data-bot-pcm class="pcm pcm-bot bu-invisible"></div>\n        <div data-background class="background"></div>\n    </div>\n    <div data-trigger></div>\n':Ae.element.innerHTML='\n    <div data-wrapper class="bot bot-wrapper">\n        <div class="column column-image">\n            <div data-image class="image">\n            </div>\n        </div>\n        <div data-avatar class="column column-avatar">\n        </div>\n        <div data-messages class="column column-messages">\n        </div>\n        <div data-chat-input class="chat-input">\n            <div class="chat-input-wrapper">\n                <input type="text" id="chatWindowTextInput" placeholder="Type text..." autocomplete="off" class="text-input"/>\n                <span data-chat-input-settings class="settings settings--hidden">\n                    <span data-chat-input-microphone>\n                        <span data-chat-input-mic class="icon icon--blocked"></span>\n                    </span>\n                    <span data-chat-input-mute class="icon icon--volume-mute"></span>\n                </span>\n                <span data-chat-input-controls class="controls--visible">\n                    <span data-chat-input-play class="icon icon--play"></span>\n                    <span data-chat-input-stop class="icon icon--stop"></span>\n                </span>\n                <span data-chat-input-barge class="icon icon--mic"></span>\n                <span data-chat-input-menu class="icon icon--menu"></span>\n            </div>\n        </div>\n        <div data-user-pcm class="pcm pcm-user bu-invisible"></div>\n        <div data-bot-pcm class="pcm pcm-bot bu-invisible"></div>\n        <div data-background class="background"></div>\n    </div>\n    <div data-trigger></div>\n',Ae.element.setAttribute("data-gui-mode",Ae.settings.guiMode),Ae.settings.fullScreen&&Ae.element.setAttribute("data-fullscreen",""),Ae.reverseAvatarOrderAction(),Ae.imageKioskElement=Ae.element.querySelector("[data-image]"),Ae.userPcmElement=Ae.element.querySelector("[data-user-pcm]"),Ae.botPcmElement=Ae.element.querySelector("[data-bot-pcm]"),Ae.messagesElement=Ae.element.querySelector("[data-messages]"),Ae.chatElement=Ae.element.querySelector("[data-chat-input]"),Ae.chatInputElement=Ae.chatElement.querySelector("input"),Ae.chatTextInputElement=Ae.element.querySelector("[data-chat-input]"),Ae.chatInputMuteElement=Ae.element.querySelector("[data-chat-input-mute]"),Ae.chatInputMicrophoneElement=Ae.element.querySelector("[data-chat-input-microphone]"),Ae.chatInputMicElement=Ae.element.querySelector("[data-chat-input-mic]"),Ae.chatInputArrowElement=Ae.element.querySelector("[data-chat-input-arrow]"),Ae.avatarElement=Ae.element.querySelector("[data-avatar]"),Ae.chatInputMenuElement=Ae.element.querySelector("[data-chat-input-menu]"),Ae.chatInputSettingsElement=Ae.element.querySelector("[data-chat-input-settings]"),Ae.chatInputControlsElement=Ae.element.querySelector("[data-chat-input-controls]"),Ae.chatInputPlayElement=Ae.element.querySelector("[data-chat-input-play]"),Ae.chatInputStopElement=Ae.element.querySelector("[data-chat-input-stop]"),Ae.collapsableTriggerElement=Ae.element.querySelector("[data-trigger]"),Ae.botWrapperElement=Ae.element.querySelector("[data-wrapper]"),Ae.chatInputKeyboardElement=Ae.element.querySelector("[data-chat-input-keyboard]"),Ae.soundInput=Ae.element.querySelector("[data-sound-input-wrap]"),Ae.textInput=Ae.element.querySelector("[data-text-input-wrap"),Ae.controllerWrapper=Ae.element.querySelector("[data-chat-input-controllers]"),Ae.chatInputBackElement=Ae.element.querySelector("[data-chat-input-back]"),Ae.sopSection=Ae.element.querySelector("[data-chat-sop]"),Ae.questionSection=Ae.element.querySelector("[data-chat-ask]"),Ae.questionSOPButton=Ae.element.querySelector("[data-sop-question]"),Ae.downSOPButton=Ae.element.querySelector("[data-sop-next]"),Ae.sopHeader=Ae.element.querySelector("[data-sop-header]"),Ae.sopName=Ae.element.querySelector("[data-sop-title]"),Ae.inputTakers=Ae.element.querySelector("[data-input-takers]"),Ae.askAnother=Ae.element.querySelector("[data-pdf-question-another]"),Ae.continue=Ae.element.querySelector("[data-pdf-question-continue]"),Ae.solutionsControllers=Ae.element.querySelector("[data-solutions-inputs]"),Ae.loadingSpinner=Ae.element.querySelector("[loader]"),Ae.botLogin=Ae.element.querySelector("[bot-login]"),Ae.botLoginPopup=Ae.element.querySelector("[bot-loginPopup]"),Ae.restartElement=Ae.element.querySelector("[data-chat-input-restart]"),Ae.closeElement=Ae.element.querySelector("[data-sop-close]"),Ae.settings.collapsed?Ae.collapsableTriggerElement.classList.remove("hidden"):Ae.collapsableTriggerElement.classList.add("hidden"),Ae.settings.collapsable?(Ae.setCollapsableUIHeight(),Ae.collapsableTriggerElement.addEventListener("click",(e=>{this.changeCollapsedMode()}))):Ae.collapsableTriggerElement.parentNode.removeChild(Ae.collapsableTriggerElement),Ae.settings.customIcons||Ie.forEach((e=>{var t="SOP"==Ae.settings.interactionMode||"GUIDE"==Ae.settings.interactionMode?"-sop":"";const n=document.querySelector(".icon"+t+"--"+e);null!==n&&n.classList.add("icon--content--"+e)})),this.setTitle(Ae.settings.title),"SOP"===Ae.settings.interactionMode?Ae.settings.sections=["SOP","QUESTION","SOLUTIONS","PDF","FEEDBACK","LOGIN","INPUTSELECT"]:"GUIDE"===Ae.settings.interactionMode&&(Ae.settings.sections=["QUESTION","SOLUTIONS","PDF","FEEDBACK","LOGIN","INPUTSELECT"]),this.setSection(Ae.settings.sections[0]),this.isMobileDevice()){let s=100;function a(){var e=window.innerHeight-document.documentElement.clientHeight;0<e?(console.log("changing address bar height"),s=e,Ae.botWrapperElement.style.removeProperty("height")):(console.log("Browser address bar height: ".concat(s,"px")),Ae.botWrapperElement.style.height="calc(100vh - ".concat(s,"px)"))}a(),window.addEventListener("resize",a)}Ae.settings.guiMode===K.KIOSK&&(Ae.messagesElement.innerHTML='\n    <div data-user-message class="message message-user"><span></span></div>\n    <div data-bot-message class="message message-bot"><span></span></div>\n',Ae.userTextKioskElement=Ae.element.querySelector("[data-user-message] span"),Ae.botTextKioskElement=Ae.element.querySelector("[data-bot-message] span")),Ae.isChatEnabled=Ae.settings.outputAudio,Ae.isMicrophoneEnabled=Ae.settings.inputAudio,"SOP"!==Ae.settings.interactionMode&&"GUIDE"!=Ae.settings.interactionMode?(Ae.isChatEnabled?Ae.chatInputMuteElement.classList.remove("icon--light"):Ae.chatInputMuteElement.classList.add("icon--light"),Ae.isMicrophoneEnabled?Ae.chatInputMicElement.classList.add("icon--light"):Ae.chatInputMicElement.classList.remove("icon--light")):Ae.settings.sound?Ae.chatInputMuteElement.classList.remove("icon--light"):Ae.chatInputMuteElement.classList.add("icon--light"),Ae.backgroundElement=Ae.element.querySelector("[data-background]"),Ae.settings.collapsable||(({width:e,height:i}=Ae.settings.widgetSize),Ae.element.style.width=u("100vw",!Ae.settings.fullScreen&&e?e:null),Ae.element.style.height=u("100vh",!Ae.settings.fullScreen&&i?i:null)),Ae.settings.backgroundAdvancedAnimationParticlesCount=c(0,20,Ae.settings.backgroundAdvancedAnimationParticlesCount),Ae.backgroundElement.innerHTML="",Ae.settings.backgroundSimpleAnimation,Q((()=>{Ae.backgroundElement.appendChild(document.createElement("span"))}),Ae.settings.backgroundAdvancedAnimationParticlesCount),window.addEventListener("resize",((e,t=100)=>{let n;return function(r){n&&clearTimeout(n),n=setTimeout(e,t,r)}})((e=>{var t=(t=Ae.element.getBoundingClientRect()).width>t.height?G.LANDSCAPE:G.PORTRAIT;this.setOrientation(t),Ae.element.setAttribute("data-orientation",t),Ae.handleBotUiHeights()}))),window.addEventListener("load",(e=>{var t=(t=Ae.element.getBoundingClientRect()).width>t.height?G.LANDSCAPE:G.PORTRAIT;this.setOrientation(t)})),Ae.chatInputElement.onkeyup=e=>{13===e.keyCode?(Ae.getInputValue(Ae.chatInputElement.value,this.chatInputCallback),Ae.chatInputElement.value="",Ae.changeClasses("icon--arrow-up--visible","icon--arrow-up--hidden",Ae.chatInputArrowElement)):0<Ae.chatInputElement.value.length?Ae.chatInputArrowElement.classList.contains("icon--arrow-up--hidden")&&Ae.changeClasses("icon--arrow-up--hidden","icon--arrow-up--visible",Ae.chatInputArrowElement):Ae.changeClasses("icon--arrow-up--visible","icon--arrow-up--hidden",Ae.chatInputArrowElement)},Ae.chatInputMuteElement.onclick=e=>{Ae.settings.sound=!Ae.settings.sound,Ae.settings.sound?(Ae.chatInputMuteElement.classList.remove("icon--light"),Ae.chatInputMuteElement.classList.remove("icon--content--volume-mute"),Ae.chatInputMuteElement.classList.add("icon--content--volume")):(Ae.chatInputMuteElement.classList.add("icon--light"),Ae.chatInputMuteElement.classList.add("icon--content--volume-mute"),Ae.chatInputMuteElement.classList.remove("icon--content--volume")),Ae.getChatMute(Ae.settings.sound,this.chatMuteCallback)},Ae.restartElement.onclick=()=>{this.chatRestartCallback()},this.setTextInputEnabled(Ae.settings.textInputEnabled),(()=>{var e=document.querySelector("script[data-bot-ui-resource]");if(e){const t=e.src;e=t.substring(0,t.lastIndexOf("/")+1);const n="".concat(e,"app.css"),r=document.querySelectorAll('link[rel="stylesheet"]');let i=!1;if(r.forEach((e=>{0===e.href.indexOf(n)&&(i=!0)})),!i){const e=document.head,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=n,e.appendChild(t)}}})(),Ae.chatInputPlayElement&&(Ae.chatInputPlayElement.onclick=e=>{this.chatPlayCallback()}),Ae.chatInputMicElement.onclick=e=>{"SOP"!==t.interactionMode&&"GUIDE"!=Ae.settings.interactionMode&&(Ae.isMicrophoneEnabled=!Ae.isMicrophoneEnabled,Ae._setMicrophone()),this.chatMicCallback()},Ae.botLogin.onclick=e=>_e(this,void 0,void 0,(function*(){yield this.loginCallback()})),Ae.chatInputStopElement.onclick=e=>{this.chatStopCallback()},Ae.chatTextInputElement.oninput=e=>{this.chatTextInputElementCallback(e)},Ae.settings.sound?(Ae.chatInputMuteElement.classList.remove("icon--light"),Ae.chatInputMuteElement.classList.remove("icon--content--volume-mute"),Ae.chatInputMuteElement.classList.add("icon--content--volume")):(Ae.chatInputMuteElement.classList.add("icon--light"),Ae.chatInputMuteElement.classList.add("icon--content--volume-mute"),Ae.chatInputMuteElement.classList.remove("icon--content--volume")),"SOP"!=Ae.settings.interactionMode&&"GUIDE"!=Ae.settings.interactionMode||(Ae.chatInputKeyboardElement.onclick=e=>{this.chatKeyboardCallback()},Ae.chatInputArrowElement.onclick=e=>{var t=Ae.chatInputElement.value;""!==t?(Ae.changeClasses("icon--arrow-up--visible","icon--arrow-up--hidden",Ae.chatInputArrowElement),Ae.getInputValue(t,this.chatInputCallback),Ae.chatInputElement.value=""):this.chatArrowCallback()},Ae.questionSOPButton.onclick=e=>{this.chatSopQuestionCallback()},Ae.downSOPButton.onclick=e=>{this.chatSopNextCallback()},Ae.closeElement.onclick=e=>{this.closeElementCallback()}),Ae.setBackground({})}}setMicIcon(e){"SOP"==Ae.settings.interactionMode||"GUIDE"==Ae.settings.interactionMode?e?(Ae.chatInputMicElement.classList.add(ke,"icon--large"),Ae.chatInputMicElement.classList.remove("icon--largest")):(Ae.chatInputMicElement.classList.remove(ke,"icon--large"),Ae.chatInputMicElement.classList.add("icon--largest")):e?Ae.chatInputMuteElement.classList.remove("icon--light"):Ae.chatInputMuteElement.classList.add("icon--light")}getSection(){return Ae.settings.sections[Ae.settings.sectionActive]}setSection(e="SOP"){var t;"SOP"!=Ae.settings.interactionMode&&"GUIDE"!=Ae.settings.interactionMode||(t=Ae.settings.sections.indexOf(e),Ae.settings.sectionActive=t,this.sectionChangeCallback(e),this.setSectionUI(e))}setSectionByIndex(e){e=Ae.settings.sections[e],this.setSection(e)}nextSection(){var e;Ae.settings.sectionActive<Ae.settings.sections.length-1&&(Ae.settings.sectionActive+=1,e=Ae.settings.sections[Ae.settings.sectionActive],this.setSection(e))}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}previousSection(){var e;0<=Ae.settings.sectionActive&&(--Ae.settings.sectionActive,e=Ae.settings.sections[Ae.settings.sectionActive],this.setSection(e))}setModeCallback(e){}setInputMode(e){"text"===e?(this.removeOverlay(),sessionStorage.setItem("INPUTSELECT",e),Ae.chatElement.classList.remove("chat-input--hidden"),Ae.chatInputKeyboardElement.classList.add(Ae.settings.micIcon+"2"),Ae.chatInputKeyboardElement.classList.remove(Ae.settings.keyboardIcon),Ae.soundInput.setAttribute("style","display:none;"),Ae.textInput.setAttribute("style","display:block;"),Ae.settings.standardQuestionMode=e,Ae.settings.inputMode=e):"voice"===e?(sessionStorage.setItem("INPUTSELECT",e),Ae.chatElement.classList.remove("chat-input--hidden"),Ae.chatInputKeyboardElement.classList.remove(Ae.settings.micIcon+"2"),Ae.chatInputKeyboardElement.classList.add(Ae.settings.keyboardIcon),Ae.soundInput.setAttribute("style","display:block;"),Ae.textInput.setAttribute("style","display:none;"),Ae.chatInputBackElement.classList.remove("text-mode"),Ae.controllerWrapper.classList.remove("text-mode"),Ae.chatInputSettingsElement.classList.add("text-mode"),Ae.settings.standardQuestionMode=e,Ae.settings.inputMode=e):"button"===e?(Ae.inputTakers.classList.add("hidden"),Ae.settings.inputMode=e):"sop"===e&&(this.removeOverlay(),Ae.chatElement.classList.remove("chat-input--hidden"),Ae.settings.inputMode=e),this.setModeCallback(e)}getInputMode(){return Ae.settings.inputMode}removeAllMessages(){Ae.messagesElement.textContent=""}loginPop(){Ae.botLoginPopup.classList.remove("hidden")}removeAllProperties(){Ae.sopSection.classList.add("sop-section--hidden"),Ae.questionSection.classList.add("ask-section--hidden"),Ae.messagesElement.classList.remove("hidden"),Ae.chatElement.classList.remove("chat-input--hidden"),Ae.botLogin.classList.add("hidden"),Ae.chatTextInputElement.style.setProperty("--bot-ui-chat-input-height",Te),Ae.messagesElement.style.setProperty("--bot-ui-chat-input-height",Te),Ae.chatTextInputElement.style.setProperty("--chat-padding-amount","4")}inputButtonsHeightSet(){Ae.chatTextInputElement.style.setProperty("--bot-ui-chat-input-height","110px"),Ae.chatTextInputElement.style.setProperty("--chat-padding-amount","6"),Ae.messagesElement.style.setProperty("--bot-ui-chat-input-height","110px")}newMessageSection(e){var t,n=!0;for(let r=0;r<Ae.messagesElement.children.length;r++){const i=Ae.messagesElement.children[r];i.getAttribute("data-button-group")===e?0!==r&&n&&("BUTTON"===Ae.messagesElement.children[r].tagName&&(t=Ae.messagesElement.children[r-1]),n=!1):i.style.display="none"}t&&(t.style.display="block",t.setAttribute("data-button-group",e))}oldMessagesSection(e){document.querySelectorAll("[data-button-group=".concat(e,"]")).forEach((e=>{e.remove()}));for(let e=0;e<Ae.messagesElement.children.length;e++)Ae.messagesElement.children[e].style.display="block"}setSectionUI(e){switch(this.removeAllProperties(),console.log(e),e){case"LOGIN":Ae.messagesElement.classList.add("hidden"),Ae.botLogin.classList.remove("hidden");break;case"INPUTSELECT":const e=Ae.messagesElement;Ae.messagesElement.textContent="",Ae.chatElement.classList.add("chat-input--hidden"),this.setBotText("Please choose an input type.");var t={background:"",oldMode:this.getInputMode(),title:"modeSelect",groupName:"modeSelect",disableGroup:!0,text:"Voice Input"};this.setButton(t,(()=>{this.inputModeCallback("voice"),e.textContent=""})),this.setButton(Object.assign(Object.assign({},t),{text:"Text Input"}),(()=>{this.inputModeCallback("text"),e.textContent=""}));break;case"SOP":Ae.sopSection.classList.remove("sop-section--hidden"),this.inputButtonsHeightSet(),this.setInputMode("sop");break;case"QUESTION":Ae.questionSection.classList.remove("ask-section--hidden"),this.setInputMode(Ae.settings.standardQuestionMode);break;case"PDF":this.inputButtonsHeightSet(),Ae.messagesElement.classList.add("hidden"),Ae.solutionsControllers.classList.remove("pdf-section--hidden"),Ae.askAnother.onclick=e=>{this.setSection("SOLUTIONS")},Ae.askAnother.innerText="Back";break;case"FEEDBACK":this.nextSection();break;default:console.log("SECTION NOT FOUND!"),this.nextSection()}}setSnippet(e,t,n=""){const r=document.createElement("div");r.setAttribute("data-snippet-container",""),r.classList.add("data-snippet-container");const i=document.createElement("h3");i.textContent=t;const s=document.createElement("div");s.textContent=n,r.addEventListener("click",(()=>{window.open(e)})),r.appendChild(i),r.appendChild(s);const a=Ae.messagesElement;a.appendChild(r),this.setSuggestion(["Continue"]),Ae.scrollToLastMessage(a)}toggleRestart(e){e?(Ae.restartElement.classList.remove("hidden"),Ae.chatInputKeyboardElement.classList.add("hidden"),Ae.chatInputMuteElement.classList.add("hidden")):(Ae.restartElement.classList.add("hidden"),Ae.chatInputKeyboardElement.classList.remove("hidden"),Ae.chatInputMuteElement.classList.remove("hidden"))}getLastUserMessage(){for(var e=Ae.messagesElement,t=Ae.messagesElement.childNodes.length-1;0<t;t--)if(e.childNodes[t].classList.contains("chat-message-user"))return e.childNodes[t]}setTitle(e){this.appSelectToggle(!0,e)}removeOverlay(){Ae.botPcmElement.classList.add("bu-invisible"),Ae.botPcmElement.classList.remove("bu-visible")}addOverlay(){Ae.botPcmElement.classList.remove("bu-invisible"),Ae.botPcmElement.classList.add("bu-visible")}resume(){"voice"===Ae.settings.inputMode&&(Ae.botPcmElement.classList.remove("bu-invisible"),Ae.botPcmElement.classList.add("bu-visible"))}chatMessageHeightLimit(e){if(40<e.offsetHeight/window.innerHeight*100){const t=document.createElement("div");t.classList.add("chat-message--limit"),e.appendChild(t),t.appendChild(e.children[0])}}}Ae.isChatEnabled=!0,Ae.isMicrophoneEnabled=!0,Ae.changeClasses=(e,t,n)=>{n.classList.contains(e)?(n.classList.remove(e),n.classList.add(t)):(n.classList.remove(t),n.classList.add(e))},Ae.videoCallback=()=>{},Ae.reverseAvatarOrderAction=(e=Ae.settings.reverseAvatarOrder)=>{Ae.settings.reverseAvatarOrder=e,!0===Ae.settings.reverseAvatarOrder?Ae.element.setAttribute("data-avatar-reverse-order",""):Ae.element.removeAttribute("data-avatar-reverse-order")},Ae.showAvatar=(e=!0)=>{Ae.element.hasAttribute("data-with-avatar")||Ae.settings.guiMode!==K.CHAT||Ae.scrollToLastMessage(Ae.messagesElement),e?Ae.element.setAttribute("data-with-avatar",""):Ae.element.removeAttribute("data-with-avatar"),Ae.handleBotUiHeights()},Ae.handleBotUiHeights=()=>{var e=Ae.element.hasAttribute("data-with-avatar"),{height:t}=Ae.element.getBoundingClientRect(),n=t*Se[Ae.settings.guiMode],t=.25*t*-1;n=e?"".concat(n,"px"):"0px",Ae.element.style.setProperty("--bot-ui-avatar-height",n),Ae.element.style.setProperty("--bot-ui-avatar-text-overlap","".concat(t,"px"))},Ae.getInputValue=(e,t)=>t(e),Ae.getChatMicrophone=(e,t)=>{Ae.isMicrophoneEnabled?Ae.chatInputBargeElement.classList.add(Ae.settings.micIcon):Ae.chatInputBargeElement.classList.remove(Ae.settings.micIcon),t(e)},Ae._setMicrophone=()=>{Ae.isMicrophoneEnabled?Ae.chatInputMicElement.classList.add("icon--light"):Ae.chatInputMicElement.classList.remove("icon--light")},Ae.getChatMute=(e,t)=>t(e),Ae.setBackground=e=>{var{color:t=Ae.settings.backgroundColor,url:{path:n=Ae.settings.backgroundImage,blur:e=Ae.settings.backgroundImageBlur}={}}=e;Ae.settings.backgroundColor=t,Ae.settings.backgroundImageBlur=e,Ae.settings.backgroundImage=n,t&&(Ae.element.style.setProperty("--bot-ui-background-color",t),Ae.backgroundElement.classList.remove("background--image")),n&&(Ae.backgroundElement.classList.add("background--image"),Ae.element.style.setProperty("--bot-ui-background-url",'url("'.concat(n,'")')),Ae.element.style.setProperty("--bot-ui-background-url-blur","".concat(e,"px")))},Ae.scrollToLastMessage=e=>{window.setTimeout((()=>{be(e,e.scrollHeight,Ae.settings.animationSpeed)}))},Ae.setCollapsableUIHeight=()=>{var e=Ae.settings.collapsed?"collapsed":"expanded";Ae.element.setAttribute("data-collapsable",e);var{width:t,height:e}=Ae.settings.widgetSize;Ae.element.style.width=Ae.settings.collapsed?null:t,Ae.element.style.height=Ae.settings.collapsed?null:e}}],e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(e){return t[e]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=46);function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t,n}()},function(e,t,n){"use strict";(function(e){n.d(t,"e",(function(){return s})),n.d(t,"i",(function(){return a})),n.d(t,"h",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return f}));var r=n(9),i=(n(14),{});function s(){return Object(r.c)()?e:"undefined"!=typeof window?window:"undefined"!=typeof self?self:i}function a(){var e=s(),t=e.crypto||e.msCrypto;if(void 0!==t&&t.getRandomValues){var n=new Uint16Array(8);t.getRandomValues(n),n[3]=4095&n[3]|16384,n[4]=16383&n[4]|32768;var r=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return r(n[0])+r(n[1])+r(n[2])+r(n[3])+r(n[4])+r(n[5])+r(n[6])+r(n[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function o(e){if(!e)return{};var t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+r}}function c(e){if(e.message)return e.message;if(e.exception&&e.exception.values&&e.exception.values[0]){var t=e.exception.values[0];return t.type&&t.value?t.type+": "+t.value:t.type||t.value||e.event_id||"<unknown>"}return e.event_id||"<unknown>"}function u(e){var t=s();if(!("console"in t))return e();var n=t.console,r={};["debug","info","warn","error","log","assert"].forEach((function(e){e in t.console&&n[e].__sentry_original__&&(r[e]=n[e],n[e]=n[e].__sentry_original__)}));var i=e();return Object.keys(r).forEach((function(e){n[e]=r[e]})),i}function l(e,t,n){e.exception=e.exception||{},e.exception.values=e.exception.values||[],e.exception.values[0]=e.exception.values[0]||{},e.exception.values[0].value=e.exception.values[0].value||t||"",e.exception.values[0].type=e.exception.values[0].type||n||"Error"}function d(e,t){void 0===t&&(t={});try{e.exception.values[0].mechanism=e.exception.values[0].mechanism||{},Object.keys(t).forEach((function(n){e.exception.values[0].mechanism[n]=t[n]}))}catch(e){}}function h(){try{return document.location.href}catch(e){return""}}function f(e,t){if(!t)return 6e4;var n=parseInt(""+t,10);if(!isNaN(n))return 1e3*n;var r=Date.parse(""+t);return isNaN(r)?6e4:r-e}}).call(this,n(26))},function(e,t,n){"use strict";(function(e){n.d(t,"c",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return f})),n.d(t,"d",(function(){return m})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return y}));var r=n(0),i=n(24),s=n(4),a=n(32),o=n(21),c=n(14);function u(e,t,n){if(t in e){var r=e[t],i=n(r);if("function"==typeof i)try{i.prototype=i.prototype||{},Object.defineProperties(i,{__sentry_original__:{enumerable:!1,value:r}})}catch(e){}e[t]=i}}function l(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}function d(e){if(Object(s.d)(e)){var t=e,n={message:t.message,name:t.name,stack:t.stack};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}if(Object(s.f)(e)){var a=e,o={};o.type=a.type;try{o.target=Object(s.c)(a.target)?Object(i.a)(a.target):Object.prototype.toString.call(a.target)}catch(e){o.target="<unknown>"}try{o.currentTarget=Object(s.c)(a.currentTarget)?Object(i.a)(a.currentTarget):Object.prototype.toString.call(a.currentTarget)}catch(e){o.currentTarget="<unknown>"}for(var r in"undefined"!=typeof CustomEvent&&Object(s.g)(e,CustomEvent)&&(o.detail=a.detail),a)Object.prototype.hasOwnProperty.call(a,r)&&(o[r]=a);return o}return e}function h(e){return function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(e))}function f(e,t,n){void 0===t&&(t=3),void 0===n&&(n=102400);var r=m(e,t);return h(r)>n?f(e,t-1,n):r}function p(t,n){return"domain"===n&&t&&"object"==typeof t&&t._events?"[Domain]":"domainEmitter"===n?"[DomainEmitter]":void 0!==e&&t===e?"[Global]":"undefined"!=typeof window&&t===window?"[Window]":"undefined"!=typeof document&&t===document?"[Document]":Object(s.l)(t)?"[SyntheticEvent]":"number"==typeof t&&t!=t?"[NaN]":void 0===t?"[undefined]":"function"==typeof t?"[Function: "+Object(o.a)(t)+"]":"symbol"==typeof t?"["+String(t)+"]":"bigint"==typeof t?"[BigInt: "+String(t)+"]":t}function g(e,t,n,r){if(void 0===n&&(n=1/0),void 0===r&&(r=new a.a),0===n)return function(e){var t=Object.prototype.toString.call(e);if("string"==typeof e)return e;if("[object Object]"===t)return"[Object]";if("[object Array]"===t)return"[Array]";var n=p(e);return Object(s.i)(n)?n:t}(t);if(null!=t&&"function"==typeof t.toJSON)return t.toJSON();var i=p(t,e);if(Object(s.i)(i))return i;var o=d(t),c=Array.isArray(t)?[]:{};if(r.memoize(t))return"[Circular ~]";for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(c[u]=g(u,o[u],n-1,r));return r.unmemoize(t),c}function m(e,t){try{return JSON.parse(JSON.stringify(e,(function(e,n){return g(e,n,t)})))}catch(e){return"**non-serializable**"}}function v(e,t){void 0===t&&(t=40);var n=Object.keys(d(e));if(n.sort(),!n.length)return"[object has no keys]";if(n[0].length>=t)return Object(c.d)(n[0],t);for(var r=n.length;r>0;r--){var i=n.slice(0,r).join(", ");if(!(i.length>t))return r===n.length?i:Object(c.d)(i,t)}return""}function y(e){var t,n;if(Object(s.h)(e)){var i=e,a={};try{for(var o=Object(r.f)(Object.keys(i)),c=o.next();!c.done;c=o.next()){var u=c.value;void 0!==i[u]&&(a[u]=y(i[u]))}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a}return Array.isArray(e)?e.map(y):e}}).call(this,n(26))},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"}(r||(r={})),function(e){e.fromHttpCode=function(t){if(t<400)return e.Ok;if(t>=400&&t<500)switch(t){case 401:return e.Unauthenticated;case 403:return e.PermissionDenied;case 404:return e.NotFound;case 409:return e.AlreadyExists;case 413:return e.FailedPrecondition;case 429:return e.ResourceExhausted;default:return e.InvalidArgument}if(t>=500&&t<600)switch(t){case 501:return e.Unimplemented;case 503:return e.Unavailable;case 504:return e.DeadlineExceeded;default:return e.InternalError}return e.UnknownError}}(r||(r={}))},function(e,t,n){"use strict";(function(e,r){n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return u}));var i=n(4),s=n(7);function a(){return"[object process]"===Object.prototype.toString.call(void 0!==e?e:0)}function o(e,t){return e.require(t)}var c=["cookies","data","headers","method","query_string","url"];function u(e,t){if(void 0===t&&(t=c),!a())throw new Error("Can't get node request data outside of a node environment");var n={},u=e.headers||e.header||{},l=e.method,d=e.hostname||e.host||u.host||"<no host>",h="https"===e.protocol||e.secure||(e.socket||{}).encrypted?"https":"http",f=e.originalUrl||e.url||"",p=h+"://"+d+f;return t.forEach((function(t){switch(t){case"headers":n.headers=u;break;case"method":n.method=l;break;case"url":n.url=p;break;case"cookies":n.cookies=e.cookies||o(r,"cookie").parse(u.cookie||"");break;case"query_string":n.query_string=o(r,"url").parse(f||"",!1).query;break;case"data":if("GET"===l||"HEAD"===l)break;void 0!==e.body&&(n.data=Object(i.k)(e.body)?e.body:JSON.stringify(Object(s.d)(e.body)));break;default:({}).hasOwnProperty.call(e,t)&&(n[t]=e[t])}})),n}}).call(this,n(37),n(15)(e))},,,function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return y})),n.d(t,"a",(function(){return b}));var r=n(0),i=n(20),s=n(23),a=n(3),o=n(9),c=n(4),u=n(6),l=n(33),d=n(16),h=n(17),f=n(2);function p(){var e=this.getScope();if(e){var t=e.getSpan();if(t)return{"sentry-trace":t.toTraceparent()}}return{}}function g(e,t,n){var i,o,c=e.getClient(),u=c&&c.getOptions()||{};return c&&Object(f.c)(u)?void 0!==t.sampled?(t.tags=Object(r.a)(Object(r.a)({},t.tags),{__sentry_samplingMethod:s.a.Explicit}),t):("function"==typeof u.tracesSampler?(o=u.tracesSampler(n),t.tags=Object(r.a)(Object(r.a)({},t.tags),{__sentry_samplingMethod:s.a.Sampler,__sentry_sampleRate:String(Number(o))})):void 0!==n.parentSampled?(o=n.parentSampled,t.tags=Object(r.a)(Object(r.a)({},t.tags),{__sentry_samplingMethod:s.a.Inheritance})):(o=u.tracesSampleRate,t.tags=Object(r.a)(Object(r.a)({},t.tags),{__sentry_samplingMethod:s.a.Rate,__sentry_sampleRate:String(Number(o))})),function(e){if(isNaN(e)||"number"!=typeof e&&"boolean"!=typeof e)return a.a.warn("[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got "+JSON.stringify(e)+" of type "+JSON.stringify(typeof e)+"."),!1;if(e<0||e>1)return a.a.warn("[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got "+e+"."),!1;return!0}(o)?o?(t.sampled=Math.random()<o,t.sampled?(t.initSpanRecorder(null===(i=u._experiments)||void 0===i?void 0:i.maxSpans),a.a.log("[Tracing] starting "+t.op+" transaction - "+t.name),t):(a.a.log("[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = "+Number(o)+")"),t)):(a.a.log("[Tracing] Discarding transaction because "+("function"==typeof u.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),t.sampled=!1,t):(a.a.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)):(t.sampled=!1,t)}function m(t){var n={transactionContext:t,parentSampled:t.parentSampled};if(Object(o.c)()){var s=Object(i.b)();if(s){var a=Object(o.a)(e,"http").IncomingMessage,l=s.members.find((function(e){return Object(c.g)(e,a)}));l&&(n.request=Object(o.b)(l))}}else{var d=Object(u.e)();"location"in d&&(n.location=Object(r.a)({},d.location))}return n}function v(e,t){return g(this,new h.a(e,this),Object(r.a)(Object(r.a)({},m(e)),t))}function y(e,t,n,r){return g(e,new d.b(t,e,n,r),m(t))}function b(){var e;(e=Object(i.d)()).__SENTRY__&&(e.__SENTRY__.extensions=e.__SENTRY__.extensions||{},e.__SENTRY__.extensions.startTransaction||(e.__SENTRY__.extensions.startTransaction=v),e.__SENTRY__.extensions.traceHeaders||(e.__SENTRY__.extensions.traceHeaders=p)),Object(l.a)()}}).call(this,n(15)(e))},function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return u}));var r=n(0),i=n(6),s=n(18),a=n(7),o=n(8),c=function(){function e(e){void 0===e&&(e=1e3),this.spans=[],this._maxlen=e}return e.prototype.add=function(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)},e}(),u=function(){function e(e){if(this.traceId=Object(i.i)(),this.spanId=Object(i.i)().substring(16),this.startTimestamp=Object(s.c)(),this.tags={},this.data={},!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp)}return e.prototype.child=function(e){return this.startChild(e)},e.prototype.startChild=function(t){var n=new e(Object(r.a)(Object(r.a)({},t),{parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId}));return n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n),n.transaction=this.transaction,n},e.prototype.setTag=function(e,t){var n;return this.tags=Object(r.a)(Object(r.a)({},this.tags),((n={})[e]=t,n)),this},e.prototype.setData=function(e,t){var n;return this.data=Object(r.a)(Object(r.a)({},this.data),((n={})[e]=t,n)),this},e.prototype.setStatus=function(e){return this.status=e,this},e.prototype.setHttpStatus=function(e){this.setTag("http.status_code",String(e));var t=o.a.fromHttpCode(e);return t!==o.a.UnknownError&&this.setStatus(t),this},e.prototype.isSuccess=function(){return this.status===o.a.Ok},e.prototype.finish=function(e){this.endTimestamp="number"==typeof e?e:Object(s.c)()},e.prototype.toTraceparent=function(){var e="";return void 0!==this.sampled&&(e=this.sampled?"-1":"-0"),this.traceId+"-"+this.spanId+e},e.prototype.getTraceContext=function(){return Object(a.a)({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})},e.prototype.toJSON=function(){return Object(a.a)({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})},e}()},function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}));var r=n(4);function i(e,t){return void 0===t&&(t=0),"string"!=typeof e||0===t||e.length<=t?e:e.substr(0,t)+"..."}function s(e,t){var n=e,r=n.length;if(r<=150)return n;t>r&&(t=r);var i=Math.max(t-60,0);i<5&&(i=0);var s=Math.min(i+140,r);return s>r-5&&(s=r),s===r&&(i=Math.max(s-140,0)),n=n.slice(i,s),i>0&&(n="'{snip} "+n),s<r&&(n+=" {snip}"),n}function a(e,t){if(!Array.isArray(e))return"";for(var n=[],r=0;r<e.length;r++){var i=e[r];try{n.push(String(i))}catch(e){n.push("[value cannot be serialized]")}}return n.join(t)}function o(e,t){return!!Object(r.k)(e)&&(Object(r.j)(t)?t.test(e):"string"==typeof t&&-1!==e.indexOf(t))}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var r=n(0),i=n(18),s=n(3),a=n(13),o=n(8),c=n(17),u=1e3,l=function(e){function t(t,n,r,i){void 0===r&&(r="");var s=e.call(this,i)||this;return s._pushActivity=t,s._popActivity=n,s.transactionSpanId=r,s}return Object(r.b)(t,e),t.prototype.add=function(t){var n=this;t.spanId!==this.transactionSpanId&&(t.finish=function(e){t.endTimestamp="number"==typeof e?e:Object(i.c)(),n._popActivity(t.spanId)},void 0===t.endTimestamp&&this._pushActivity(t.spanId)),e.prototype.add.call(this,t)},t}(a.b),d=function(e){function t(t,n,r,i){void 0===r&&(r=u),void 0===i&&(i=!1);var a=e.call(this,t,n)||this;return a._idleHub=n,a._idleTimeout=r,a._onScope=i,a.activities={},a._heartbeatTimer=0,a._heartbeatCounter=0,a._finished=!1,a._beforeFinishCallbacks=[],n&&i&&(h(n),s.a.log("Setting idle transaction on scope. Span ID: "+a.spanId),n.configureScope((function(e){return e.setSpan(a)}))),a}return Object(r.b)(t,e),t.prototype.finish=function(t){var n,a,c=this;if(void 0===t&&(t=Object(i.c)()),this._finished=!0,this.activities={},this.spanRecorder){s.a.log("[Tracing] finishing IdleTransaction",new Date(1e3*t).toISOString(),this.op);try{for(var u=Object(r.f)(this._beforeFinishCallbacks),l=u.next();!l.done;l=u.next()){(0,l.value)(this,t)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}this.spanRecorder.spans=this.spanRecorder.spans.filter((function(e){if(e.spanId===c.spanId)return!0;e.endTimestamp||(e.endTimestamp=t,e.setStatus(o.a.Cancelled),s.a.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(e,void 0,2)));var n=e.startTimestamp<t;return n||s.a.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(e,void 0,2)),n})),this._onScope&&h(this._idleHub),s.a.log("[Tracing] flushing IdleTransaction")}else s.a.log("[Tracing] No active IdleTransaction");return e.prototype.finish.call(this,t)},t.prototype.registerBeforeFinishCallback=function(e){this._beforeFinishCallbacks.push(e)},t.prototype.initSpanRecorder=function(e){var t=this;if(!this.spanRecorder){this._initTimeout=setTimeout((function(){t._finished||t.finish()}),this._idleTimeout);this.spanRecorder=new l((function(e){t._finished||t._pushActivity(e)}),(function(e){t._finished||t._popActivity(e)}),this.spanId,e),s.a.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)},t.prototype._pushActivity=function(e){this._initTimeout&&(clearTimeout(this._initTimeout),this._initTimeout=void 0),s.a.log("[Tracing] pushActivity: "+e),this.activities[e]=!0,s.a.log("[Tracing] new activities count",Object.keys(this.activities).length)},t.prototype._popActivity=function(e){var t=this;if(this.activities[e]&&(s.a.log("[Tracing] popActivity "+e),delete this.activities[e],s.a.log("[Tracing] new activities count",Object.keys(this.activities).length)),0===Object.keys(this.activities).length){var n=this._idleTimeout,r=Object(i.c)()+n/1e3;setTimeout((function(){t._finished||t.finish(r)}),n)}},t.prototype._beat=function(){if(clearTimeout(this._heartbeatTimer),!this._finished){var e=Object.keys(this.activities),t=e.length?e.reduce((function(e,t){return e+t})):"";t===this._prevHeartbeatString?this._heartbeatCounter+=1:this._heartbeatCounter=1,this._prevHeartbeatString=t,this._heartbeatCounter>=3?(s.a.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus(o.a.DeadlineExceeded),this.setTag("heartbeat","failed"),this.finish()):this._pingHeartbeat()}},t.prototype._pingHeartbeat=function(){var e=this;s.a.log("pinging Heartbeat -> current counter: "+this._heartbeatCounter),this._heartbeatTimer=setTimeout((function(){e._beat()}),5e3)},t}(c.a);function h(e){if(e){var t=e.getScope();if(t)t.getTransaction()&&t.setSpan(void 0)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),i=n(20),s=n(4),a=n(3),o=n(13),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r._measurements={},r._hub=Object(i.c)(),Object(s.g)(n,i.a)&&(r._hub=n),r.name=t.name?t.name:"",r._trimEnd=t.trimEnd,r.transaction=r,r}return Object(r.b)(t,e),t.prototype.setName=function(e){this.name=e},t.prototype.initSpanRecorder=function(e){void 0===e&&(e=1e3),this.spanRecorder||(this.spanRecorder=new o.b(e)),this.spanRecorder.add(this)},t.prototype.setMeasurements=function(e){this._measurements=Object(r.a)({},e)},t.prototype.finish=function(t){var n=this;if(void 0===this.endTimestamp){if(this.name||(a.a.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),e.prototype.finish.call(this,t),!0===this.sampled){var r=this.spanRecorder?this.spanRecorder.spans.filter((function(e){return e!==n&&e.endTimestamp})):[];this._trimEnd&&r.length>0&&(this.endTimestamp=r.reduce((function(e,t){return e.endTimestamp&&t.endTimestamp?e.endTimestamp>t.endTimestamp?e:t:e})).endTimestamp);var i={contexts:{trace:this.getTraceContext()},spans:r,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction"};return Object.keys(this._measurements).length>0&&(a.a.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),i.measurements=this._measurements),this._hub.captureEvent(i)}a.a.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.")}},t}(o.a)},function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l}));var r=n(6),i=n(9),s={nowSeconds:function(){return Date.now()/1e3}};var a=Object(i.c)()?function(){try{return Object(i.a)(e,"perf_hooks").performance}catch(e){return}}():function(){var e=Object(r.e)().performance;if(e&&e.now)return{now:function(){return e.now()},timeOrigin:Date.now()-e.now()}}(),o=void 0===a?s:{nowSeconds:function(){return(a.timeOrigin+a.now())/1e3}},c=s.nowSeconds.bind(s),u=o.nowSeconds.bind(o),l=function(){var e=Object(r.e)().performance;if(e)return e.timeOrigin?e.timeOrigin:e.timing&&e.timing.navigationStart||Date.now()}()}).call(this,n(15)(e))},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r,i=n(4);!function(e){e.PENDING="PENDING",e.RESOLVED="RESOLVED",e.REJECTED="REJECTED"}(r||(r={}));var s=function(){function e(e){var t=this;this._state=r.PENDING,this._handlers=[],this._resolve=function(e){t._setResult(r.RESOLVED,e)},this._reject=function(e){t._setResult(r.REJECTED,e)},this._setResult=function(e,n){t._state===r.PENDING&&(Object(i.m)(n)?n.then(t._resolve,t._reject):(t._state=e,t._value=n,t._executeHandlers()))},this._attachHandler=function(e){t._handlers=t._handlers.concat(e),t._executeHandlers()},this._executeHandlers=function(){if(t._state!==r.PENDING){var e=t._handlers.slice();t._handlers=[],e.forEach((function(e){e.done||(t._state===r.RESOLVED&&e.onfulfilled&&e.onfulfilled(t._value),t._state===r.REJECTED&&e.onrejected&&e.onrejected(t._value),e.done=!0)}))}};try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}return e.resolve=function(t){return new e((function(e){e(t)}))},e.reject=function(t){return new e((function(e,n){n(t)}))},e.all=function(t){return new e((function(n,r){if(Array.isArray(t))if(0!==t.length){var i=t.length,s=[];t.forEach((function(t,a){e.resolve(t).then((function(e){s[a]=e,0===(i-=1)&&n(s)})).then(null,r)}))}else n([]);else r(new TypeError("Promise.all requires an array as input."))}))},e.prototype.then=function(t,n){var r=this;return new e((function(e,i){r._attachHandler({done:!1,onfulfilled:function(n){if(t)try{return void e(t(n))}catch(e){return void i(e)}else e(n)},onrejected:function(t){if(n)try{return void e(n(t))}catch(e){return void i(e)}else i(t)}})}))},e.prototype.catch=function(e){return this.then((function(e){return e}),e)},e.prototype.finally=function(t){var n=this;return new e((function(e,r){var i,s;return n.then((function(e){s=!1,i=e,t&&t()}),(function(e){s=!0,i=e,t&&t()})).then((function(){s?r(i):e(i)}))}))},e.prototype.toString=function(){return"[object SyncPromise]"},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"d",(function(){return f})),n.d(t,"c",(function(){return g})),n.d(t,"b",(function(){return m}));var r=n(0),i=n(6),s=n(18),a=n(3),o=n(9),c=n(22),u=n(42),l=n(7),d=function(){function e(e){this.errors=0,this.sid=Object(i.i)(),this.timestamp=Date.now(),this.started=Date.now(),this.duration=0,this.status=u.a.Ok,e&&this.update(e)}return e.prototype.update=function(e){void 0===e&&(e={}),e.user&&(e.user.ip_address&&(this.ipAddress=e.user.ip_address),e.did||(this.did=e.user.id||e.user.email||e.user.username)),this.timestamp=e.timestamp||Date.now(),e.sid&&(this.sid=32===e.sid.length?e.sid:Object(i.i)()),e.did&&(this.did=""+e.did),"number"==typeof e.started&&(this.started=e.started),"number"==typeof e.duration?this.duration=e.duration:this.duration=this.timestamp-this.started,e.release&&(this.release=e.release),e.environment&&(this.environment=e.environment),e.ipAddress&&(this.ipAddress=e.ipAddress),e.userAgent&&(this.userAgent=e.userAgent),"number"==typeof e.errors&&(this.errors=e.errors),e.status&&(this.status=e.status)},e.prototype.close=function(e){e?this.update({status:e}):this.status===u.a.Ok?this.update({status:u.a.Exited}):this.update()},e.prototype.toJSON=function(){return Object(l.a)({sid:""+this.sid,init:!0,started:new Date(this.started).toISOString(),timestamp:new Date(this.timestamp).toISOString(),status:this.status,errors:this.errors,did:"number"==typeof this.did||"string"==typeof this.did?""+this.did:void 0,duration:this.duration,attrs:Object(l.a)({release:this.release,environment:this.environment,ip_address:this.ipAddress,user_agent:this.userAgent})})},e}(),h=function(){function e(e,t,n){void 0===t&&(t=new c.a),void 0===n&&(n=3),this._version=n,this._stack=[{}],this.getStackTop().scope=t,this.bindClient(e)}return e.prototype.isOlderThan=function(e){return this._version<e},e.prototype.bindClient=function(e){this.getStackTop().client=e,e&&e.setupIntegrations&&e.setupIntegrations()},e.prototype.pushScope=function(){var e=c.a.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:e}),e},e.prototype.popScope=function(){return!(this.getStack().length<=1)&&!!this.getStack().pop()},e.prototype.withScope=function(e){var t=this.pushScope();try{e(t)}finally{this.popScope()}},e.prototype.getClient=function(){return this.getStackTop().client},e.prototype.getScope=function(){return this.getStackTop().scope},e.prototype.getStack=function(){return this._stack},e.prototype.getStackTop=function(){return this._stack[this._stack.length-1]},e.prototype.captureException=function(e,t){var n=this._lastEventId=Object(i.i)(),s=t;if(!t){var a=void 0;try{throw new Error("Sentry syntheticException")}catch(e){a=e}s={originalException:e,syntheticException:a}}return this._invokeClient("captureException",e,Object(r.a)(Object(r.a)({},s),{event_id:n})),n},e.prototype.captureMessage=function(e,t,n){var s=this._lastEventId=Object(i.i)(),a=n;if(!n){var o=void 0;try{throw new Error(e)}catch(e){o=e}a={originalException:e,syntheticException:o}}return this._invokeClient("captureMessage",e,t,Object(r.a)(Object(r.a)({},a),{event_id:s})),s},e.prototype.captureEvent=function(e,t){var n=this._lastEventId=Object(i.i)();return this._invokeClient("captureEvent",e,Object(r.a)(Object(r.a)({},t),{event_id:n})),n},e.prototype.lastEventId=function(){return this._lastEventId},e.prototype.addBreadcrumb=function(e,t){var n=this.getStackTop(),a=n.scope,o=n.client;if(a&&o){var c=o.getOptions&&o.getOptions()||{},u=c.beforeBreadcrumb,l=void 0===u?null:u,d=c.maxBreadcrumbs,h=void 0===d?100:d;if(!(h<=0)){var f=Object(s.b)(),p=Object(r.a)({timestamp:f},e),g=l?Object(i.c)((function(){return l(p,t)})):p;null!==g&&a.addBreadcrumb(g,Math.min(h,100))}}},e.prototype.setUser=function(e){var t=this.getScope();t&&t.setUser(e)},e.prototype.setTags=function(e){var t=this.getScope();t&&t.setTags(e)},e.prototype.setExtras=function(e){var t=this.getScope();t&&t.setExtras(e)},e.prototype.setTag=function(e,t){var n=this.getScope();n&&n.setTag(e,t)},e.prototype.setExtra=function(e,t){var n=this.getScope();n&&n.setExtra(e,t)},e.prototype.setContext=function(e,t){var n=this.getScope();n&&n.setContext(e,t)},e.prototype.configureScope=function(e){var t=this.getStackTop(),n=t.scope,r=t.client;n&&r&&e(n)},e.prototype.run=function(e){var t=p(this);try{e(this)}finally{p(t)}},e.prototype.getIntegration=function(e){var t=this.getClient();if(!t)return null;try{return t.getIntegration(e)}catch(t){return a.a.warn("Cannot retrieve integration "+e.id+" from the current Hub"),null}},e.prototype.startSpan=function(e){return this._callExtensionMethod("startSpan",e)},e.prototype.startTransaction=function(e,t){return this._callExtensionMethod("startTransaction",e,t)},e.prototype.traceHeaders=function(){return this._callExtensionMethod("traceHeaders")},e.prototype.startSession=function(e){this.endSession();var t=this.getStackTop(),n=t.scope,i=t.client,s=i&&i.getOptions()||{},a=s.release,o=s.environment,c=new d(Object(r.a)(Object(r.a)({release:a,environment:o},n&&{user:n.getUser()}),e));return n&&n.setSession(c),c},e.prototype.endSession=function(){var e=this.getStackTop(),t=e.scope,n=e.client;if(t){var r=t.getSession&&t.getSession();r&&(r.close(),n&&n.captureSession&&n.captureSession(r),t.setSession())}},e.prototype._invokeClient=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var s=this.getStackTop(),a=s.scope,o=s.client;o&&o[e]&&(t=o)[e].apply(t,Object(r.e)(n,[a]))},e.prototype._callExtensionMethod=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=f(),i=r.__SENTRY__;if(i&&i.extensions&&"function"==typeof i.extensions[e])return i.extensions[e].apply(this,t);a.a.warn("Extension method "+e+" couldn't be found, doing nothing.")},e}();function f(){var e=Object(i.e)();return e.__SENTRY__=e.__SENTRY__||{extensions:{},hub:void 0},e}function p(e){var t=f(),n=y(t);return b(t,e),n}function g(){var e=f();return v(e)&&!y(e).isOlderThan(3)||b(e,new h),Object(o.c)()?function(e){try{var t=m();if(!t)return y(e);if(!v(t)||y(t).isOlderThan(3)){var n=y(e).getStackTop();b(t,new h(n.client,c.a.clone(n.scope)))}return y(t)}catch(t){return y(e)}}(e):y(e)}function m(){var e=f().__SENTRY__;return e&&e.extensions&&e.extensions.domain&&e.extensions.domain.active}function v(e){return!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)}function y(e){return e&&e.__SENTRY__&&e.__SENTRY__.hub||(e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.hub=new h),e.__SENTRY__.hub}function b(e,t){return!!e&&(e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.hub=t,!0)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r="<anonymous>";function i(e){try{return e&&"function"==typeof e&&e.name||r}catch(e){return r}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l}));var r=n(0),i=n(4),s=n(18),a=n(19),o=n(6),c=function(){function e(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._user={},this._tags={},this._extra={},this._contexts={}}return e.clone=function(t){var n=new e;return t&&(n._breadcrumbs=Object(r.e)(t._breadcrumbs),n._tags=Object(r.a)({},t._tags),n._extra=Object(r.a)({},t._extra),n._contexts=Object(r.a)({},t._contexts),n._user=t._user,n._level=t._level,n._span=t._span,n._session=t._session,n._transactionName=t._transactionName,n._fingerprint=t._fingerprint,n._eventProcessors=Object(r.e)(t._eventProcessors)),n},e.prototype.addScopeListener=function(e){this._scopeListeners.push(e)},e.prototype.addEventProcessor=function(e){return this._eventProcessors.push(e),this},e.prototype.setUser=function(e){return this._user=e||{},this._session&&this._session.update({user:e}),this._notifyScopeListeners(),this},e.prototype.getUser=function(){return this._user},e.prototype.setTags=function(e){return this._tags=Object(r.a)(Object(r.a)({},this._tags),e),this._notifyScopeListeners(),this},e.prototype.setTag=function(e,t){var n;return this._tags=Object(r.a)(Object(r.a)({},this._tags),((n={})[e]=t,n)),this._notifyScopeListeners(),this},e.prototype.setExtras=function(e){return this._extra=Object(r.a)(Object(r.a)({},this._extra),e),this._notifyScopeListeners(),this},e.prototype.setExtra=function(e,t){var n;return this._extra=Object(r.a)(Object(r.a)({},this._extra),((n={})[e]=t,n)),this._notifyScopeListeners(),this},e.prototype.setFingerprint=function(e){return this._fingerprint=e,this._notifyScopeListeners(),this},e.prototype.setLevel=function(e){return this._level=e,this._notifyScopeListeners(),this},e.prototype.setTransactionName=function(e){return this._transactionName=e,this._notifyScopeListeners(),this},e.prototype.setTransaction=function(e){return this.setTransactionName(e)},e.prototype.setContext=function(e,t){var n;return null===t?delete this._contexts[e]:this._contexts=Object(r.a)(Object(r.a)({},this._contexts),((n={})[e]=t,n)),this._notifyScopeListeners(),this},e.prototype.setSpan=function(e){return this._span=e,this._notifyScopeListeners(),this},e.prototype.getSpan=function(){return this._span},e.prototype.getTransaction=function(){var e,t,n,r,i=this.getSpan();return(null===(e=i)||void 0===e?void 0:e.transaction)?null===(t=i)||void 0===t?void 0:t.transaction:(null===(r=null===(n=i)||void 0===n?void 0:n.spanRecorder)||void 0===r?void 0:r.spans[0])?i.spanRecorder.spans[0]:void 0},e.prototype.setSession=function(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this},e.prototype.getSession=function(){return this._session},e.prototype.update=function(t){if(!t)return this;if("function"==typeof t){var n=t(this);return n instanceof e?n:this}return t instanceof e?(this._tags=Object(r.a)(Object(r.a)({},this._tags),t._tags),this._extra=Object(r.a)(Object(r.a)({},this._extra),t._extra),this._contexts=Object(r.a)(Object(r.a)({},this._contexts),t._contexts),t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint)):Object(i.h)(t)&&(this._tags=Object(r.a)(Object(r.a)({},this._tags),t.tags),this._extra=Object(r.a)(Object(r.a)({},this._extra),t.extra),this._contexts=Object(r.a)(Object(r.a)({},this._contexts),t.contexts),t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint)),this},e.prototype.clear=function(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this},e.prototype.addBreadcrumb=function(e,t){var n=Object(r.a)({timestamp:Object(s.b)()},e);return this._breadcrumbs=void 0!==t&&t>=0?Object(r.e)(this._breadcrumbs,[n]).slice(-t):Object(r.e)(this._breadcrumbs,[n]),this._notifyScopeListeners(),this},e.prototype.clearBreadcrumbs=function(){return this._breadcrumbs=[],this._notifyScopeListeners(),this},e.prototype.applyToEvent=function(e,t){var n;if(this._extra&&Object.keys(this._extra).length&&(e.extra=Object(r.a)(Object(r.a)({},this._extra),e.extra)),this._tags&&Object.keys(this._tags).length&&(e.tags=Object(r.a)(Object(r.a)({},this._tags),e.tags)),this._user&&Object.keys(this._user).length&&(e.user=Object(r.a)(Object(r.a)({},this._user),e.user)),this._contexts&&Object.keys(this._contexts).length&&(e.contexts=Object(r.a)(Object(r.a)({},this._contexts),e.contexts)),this._level&&(e.level=this._level),this._transactionName&&(e.transaction=this._transactionName),this._span){e.contexts=Object(r.a)({trace:this._span.getTraceContext()},e.contexts);var i=null===(n=this._span.transaction)||void 0===n?void 0:n.name;i&&(e.tags=Object(r.a)({transaction:i},e.tags))}return this._applyFingerprint(e),e.breadcrumbs=Object(r.e)(e.breadcrumbs||[],this._breadcrumbs),e.breadcrumbs=e.breadcrumbs.length>0?e.breadcrumbs:void 0,this._notifyEventProcessors(Object(r.e)(u(),this._eventProcessors),e,t)},e.prototype._notifyEventProcessors=function(e,t,n,s){var o=this;return void 0===s&&(s=0),new a.a((function(a,c){var u=e[s];if(null===t||"function"!=typeof u)a(t);else{var l=u(Object(r.a)({},t),n);Object(i.m)(l)?l.then((function(t){return o._notifyEventProcessors(e,t,n,s+1).then(a)})).then(null,c):o._notifyEventProcessors(e,l,n,s+1).then(a).then(null,c)}}))},e.prototype._notifyScopeListeners=function(){var e=this;this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((function(t){t(e)})),this._notifyingListeners=!1)},e.prototype._applyFingerprint=function(e){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],this._fingerprint&&(e.fingerprint=e.fingerprint.concat(this._fingerprint)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint},e}();function u(){var e=Object(o.e)();return e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.globalEventProcessors=e.__SENTRY__.globalEventProcessors||[],e.__SENTRY__.globalEventProcessors}function l(e){u().push(e)}},function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Explicit="explicitly_set",e.Sampler="client_sampler",e.Rate="client_rate",e.Inheritance="inheritance"}(r||(r={}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(4);function i(e){try{for(var t=e,n=[],r=0,i=0,a=" > ".length,o=void 0;t&&r++<5&&!("html"===(o=s(t))||r>1&&i+n.length*a+o.length>=80);)n.push(o),i+=o.length,t=t.parentNode;return n.reverse().join(" > ")}catch(e){return"<unknown>"}}function s(e){var t,n,i,s,a,o=e,c=[];if(!o||!o.tagName)return"";if(c.push(o.tagName.toLowerCase()),o.id&&c.push("#"+o.id),(t=o.className)&&Object(r.k)(t))for(n=t.split(/\s+/),a=0;a<n.length;a++)c.push("."+n[a]);var u=["type","name","title","alt"];for(a=0;a<u.length;a++)i=u[a],(s=o.getAttribute(i))&&c.push("["+i+'="'+s+'"]');return c.join("")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n(3),i=n(6);function s(){if(!("fetch"in Object(i.e)()))return!1;try{return new Headers,new Request(""),new Response,!0}catch(e){return!1}}function a(e){return e&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function o(){if(!s())return!1;var e=Object(i.e)();if(a(e.fetch))return!0;var t=!1,n=e.document;if(n&&"function"==typeof n.createElement)try{var o=n.createElement("iframe");o.hidden=!0,n.head.appendChild(o),o.contentWindow&&o.contentWindow.fetch&&(t=a(o.contentWindow.fetch)),n.head.removeChild(o)}catch(e){r.a.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return t}function c(){if(!s())return!1;try{return new Request("_",{referrerPolicy:"origin"}),!0}catch(e){return!1}}function u(){var e=Object(i.e)(),t=e.chrome,n=t&&t.app&&t.app.runtime,r="history"in e&&!!e.history.pushState&&!!e.history.replaceState;return!n&&r}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r=n(9),i=n(3),s=n(7),a=function(){function t(){this.name=t.id}return t.prototype.setupOnce=function(t,n){var a;try{a=Object(r.a)(e,"pg").Client}catch(e){return void i.a.error("Postgres Integration was unable to require `pg` package.")}Object(s.c)(a.prototype,"query",(function(e){return function(t,r,i){var s,a,o=null===(a=null===(s=n().getScope())||void 0===s?void 0:s.getSpan())||void 0===a?void 0:a.startChild({description:"string"==typeof t?t:t.text,op:"db"});return"function"==typeof i?e.call(this,t,r,(function(e,t){var n;null===(n=o)||void 0===n||n.finish(),i(e,t)})):"function"==typeof r?e.call(this,t,(function(e,t){var n;null===(n=o)||void 0===n||n.finish(),r(e,t)})):e.call(this,t,r).then((function(e){var t;return null===(t=o)||void 0===t||t.finish(),e}))}}))},t.id="Postgres",t}()}).call(this,n(15)(e))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r=n(9),i=n(3),s=n(7),a=function(){function t(){this.name=t.id}return t.prototype.setupOnce=function(t,n){var a;try{a=Object(r.a)(e,"mysql/lib/Connection.js")}catch(e){return void i.a.error("Mysql Integration was unable to require `mysql` package.")}Object(s.c)(a.prototype,"query",(function(e){return function(t,r,i){var s,a,o=null===(a=null===(s=n().getScope())||void 0===s?void 0:s.getSpan())||void 0===a?void 0:a.startChild({description:"string"==typeof t?t:t.sql,op:"db"});return"function"==typeof i?e.call(this,t,r,(function(e,t,n){var r;null===(r=o)||void 0===r||r.finish(),i(e,t,n)})):"function"==typeof r?e.call(this,t,(function(e,t,n){var i;null===(i=o)||void 0===i||i.finish(),r(e,t,n)})):e.call(this,t,r,i)}}))},t.id="Mysql",t}()}).call(this,n(15)(e))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r=n(0),i=n(9),s=n(3),a=n(7),o=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],c={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]},u=function(){function t(e){void 0===e&&(e={}),this.name=t.id,this._operations=Array.isArray(e.operations)?e.operations:o,this._describeOperations=!("describeOperations"in e)||e.describeOperations}return t.prototype.setupOnce=function(t,n){var r;try{r=Object(i.a)(e,"mongodb").Collection}catch(e){return void s.a.error("Mongo Integration was unable to require `mongodb` package.")}this._instrumentOperations(r,this._operations,n)},t.prototype._instrumentOperations=function(e,t,n){var r=this;t.forEach((function(t){return r._patchOperation(e,t,n)}))},t.prototype._patchOperation=function(e,t,n){if(t in e.prototype){var i=this._getSpanContextFromOperationArguments.bind(this);Object(a.c)(e.prototype,t,(function(e){return function(){for(var s,a,o,c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];var l=c[c.length-1],d=n().getScope(),h=null===(s=d)||void 0===s?void 0:s.getSpan();if("function"!=typeof l||"mapReduce"===t&&2===c.length){var f=null===(a=h)||void 0===a?void 0:a.startChild(i(this,t,c));return e.call.apply(e,Object(r.e)([this],c)).then((function(e){var t;return null===(t=f)||void 0===t||t.finish(),e}))}var p=null===(o=h)||void 0===o?void 0:o.startChild(i(this,t,c.slice(0,-1)));return e.call.apply(e,Object(r.e)([this],c.slice(0,-1),[function(e,t){var n;null===(n=p)||void 0===n||n.finish(),l(e,t)}]))}}))}},t.prototype._getSpanContextFromOperationArguments=function(e,t,n){var i={collectionName:e.collectionName,dbName:e.dbName,namespace:e.namespace},s={op:"db",description:t,data:i},a=c[t],o=Array.isArray(this._describeOperations)?this._describeOperations.includes(t):this._describeOperations;if(!a||!o)return s;try{if("mapReduce"===t){var u=Object(r.c)(n,2),l=u[0],d=u[1];i[a[0]]="string"==typeof l?l:l.name||"<anonymous>",i[a[1]]="string"==typeof d?d:d.name||"<anonymous>"}else for(var h=0;h<a.length;h++)i[a[h]]=JSON.stringify(n[h])}catch(e){}return s},t.id="Mongo",t}()}).call(this,n(15)(e))},function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=37)}([function(e,t,n){"use strict";(function(e,r){n.d(t,"a",(function(){return k})),n.d(t,"b",(function(){return x})),n.d(t,"c",(function(){return O})),n.d(t,"d",(function(){return b})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return V})),n.d(t,"h",(function(){return R})),n.d(t,"i",(function(){return A})),n.d(t,"j",(function(){return F})),n.d(t,"k",(function(){return L})),n.d(t,"l",(function(){return c})),n.d(t,"m",(function(){return j})),n.d(t,"n",(function(){return S})),n.d(t,"o",(function(){return E})),n.d(t,"p",(function(){return T})),n.d(t,"q",(function(){return I})),n.d(t,"r",(function(){return q})),n.d(t,"s",(function(){return u})),n.d(t,"t",(function(){return h})),n.d(t,"u",(function(){return f})),n.d(t,"v",(function(){return D})),n.d(t,"w",(function(){return g})),n.d(t,"x",(function(){return v})),n.d(t,"y",(function(){return l})),n.d(t,"z",(function(){return d})),n.d(t,"A",(function(){return p})),n.d(t,"B",(function(){return m})),n.d(t,"C",(function(){return N})),n.d(t,"D",(function(){return M})),n.d(t,"E",(function(){return y}));const i=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,c=o?e[t+2]:0,u=i>>2,l=(3&i)<<4|a>>4;let d=(15&a)<<2|c>>6,h=63&c;o||(h=64,s||(d=64)),r.push(n[u],n[l],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const o=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==a){const e=s<<4&240|a>>2;if(r.push(e),64!==o){const e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},a=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=c(e[n],t[n]));return e}function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(u())}function d(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}}function h(){return"object"==typeof self&&self.self===self}function f(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function p(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function g(){const e=u();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function m(){return!d()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function v(){try{return"object"==typeof indexedDB}catch(e){return!1}}function y(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}function b(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}const w=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,_=()=>{try{return w()||(()=>{if(void 0===r||void 0===r.env)return;const e=r.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},E=e=>{var t,n;return null===(n=null===(t=_())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},T=e=>{const t=E(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},S=()=>{var e;return null===(e=_())||void 0===e?void 0:e.config},I=e=>{var t;return null===(t=_())||void 0===t?void 0:t["_"+e]};class k{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function A(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}class O extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,O.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,x.prototype.create)}}class x{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(C,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new O(r,a,n)}}const C=/\{\$([^}]+)}/g;function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function D(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function L(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(P(n)&&P(s)){if(!L(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function P(e){return null!==e&&"object"==typeof e}function N(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function M(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function j(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function F(e,t){const n=new U(e,t);return n.subscribe.bind(n)}class U{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=B),void 0===r.error&&(r.error=B),void 0===r.complete&&(r.complete=B);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function B(){}function V(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function q(e){return e&&e._delegate?e._delegate:e}}).call(this,n(19),n(27))},function(e,t,n){"use strict";var r=n(20);const{toString:i}=Object.prototype,{getPrototypeOf:s}=Object,a=(o=Object.create(null),e=>{const t=i.call(e);return o[t]||(o[t]=t.slice(8,-1).toLowerCase())});var o;const c=e=>(e=e.toLowerCase(),t=>a(t)===e),u=e=>t=>typeof t===e,{isArray:l}=Array,d=u("undefined"),h=c("ArrayBuffer"),f=u("string"),p=u("function"),g=u("number"),m=e=>null!==e&&"object"==typeof e,v=e=>{if("object"!==a(e))return!1;const t=s(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},y=c("Date"),b=c("File"),w=c("Blob"),_=c("FileList"),E=c("URLSearchParams");function T(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,i;if("object"!=typeof e&&(e=[e]),l(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{const i=n?Object.getOwnPropertyNames(e):Object.keys(e),s=i.length;let a;for(r=0;r<s;r++)a=i[r],t.call(null,e[a],a,e)}}const S=(I="undefined"!=typeof Uint8Array&&s(Uint8Array),e=>I&&e instanceof I);var I;const k=c("HTMLFormElement"),A=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),O=c("RegExp"),x=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};T(n,((n,i)=>{!1!==t(n,i,e)&&(r[i]=n)})),Object.defineProperties(e,r)};t.a={isArray:l,isArrayBuffer:h,isBuffer:function(e){return null!==e&&!d(e)&&null!==e.constructor&&!d(e.constructor)&&p(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>e&&("function"==typeof FormData&&e instanceof FormData||"[object FormData]"===i.call(e)||p(e.toString)&&"[object FormData]"===e.toString()),isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&h(e.buffer),t},isString:f,isNumber:g,isBoolean:e=>!0===e||!1===e,isObject:m,isPlainObject:v,isUndefined:d,isDate:y,isFile:b,isBlob:w,isRegExp:O,isFunction:p,isStream:e=>m(e)&&p(e.pipe),isURLSearchParams:E,isTypedArray:S,isFileList:_,forEach:T,merge:function e(){const t={},n=(n,r)=>{v(t[r])&&v(n)?t[r]=e(t[r],n):v(n)?t[r]=e({},n):l(n)?t[r]=n.slice():t[r]=n};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&T(arguments[e],n);return t},extend:(e,t,n,{allOwnKeys:i}={})=>(T(t,((t,i)=>{n&&p(t)?e[i]=Object(r.a)(t,n):e[i]=t}),{allOwnKeys:i}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,o;const c={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],r&&!r(o,e,t)||c[o]||(t[o]=e[o],c[o]=!0);e=!1!==n&&s(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:a,kindOfTest:c,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(l(e))return e;let t=e.length;if(!g(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:k,hasOwnProperty:A,hasOwnProp:A,reduceDescriptors:x,freezeMethods:e=>{x(e,((t,n)=>{const r=e[n];p(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return l(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return be})),n.d(t,"c",(function(){return xe})),n.d(t,"d",(function(){return Le})),n.d(t,"e",(function(){return Ne})),n.d(t,"f",(function(){return Pe})),n.d(t,"g",(function(){return Ie})),n.d(t,"h",(function(){return De})),n.d(t,"i",(function(){return gn})),n.d(t,"j",(function(){return ar})),n.d(t,"k",(function(){return c})),n.d(t,"l",(function(){return cn})),n.d(t,"m",(function(){return Me})),n.d(t,"n",(function(){return je})),n.d(t,"o",(function(){return Fe})),n.d(t,"p",(function(){return _})),n.d(t,"q",(function(){return pe})),n.d(t,"r",(function(){return m})),n.d(t,"s",(function(){return Bt})),n.d(t,"t",(function(){return I})),n.d(t,"u",(function(){return jn})),n.d(t,"v",(function(){return Cn})),n.d(t,"w",(function(){return Z})),n.d(t,"y",(function(){return at})),n.d(t,"z",(function(){return Mt})),n.d(t,"A",(function(){return ir})),n.d(t,"B",(function(){return Ft})),n.d(t,"C",(function(){return ot})),n.d(t,"D",(function(){return st})),n.d(t,"E",(function(){return me})),n.d(t,"G",(function(){return ut})),n.d(t,"H",(function(){return d})),n.d(t,"I",(function(){return pt})),n.d(t,"J",(function(){return At})),n.d(t,"K",(function(){return Ct})),n.d(t,"L",(function(){return Mn})),n.d(t,"M",(function(){return J})),n.d(t,"N",(function(){return Xt})),n.d(t,"O",(function(){return ht})),n.d(t,"P",(function(){return Je})),n.d(t,"Q",(function(){return dn})),n.d(t,"R",(function(){return In})),n.d(t,"S",(function(){return Nn})),n.d(t,"T",(function(){return Lt})),n.d(t,"U",(function(){return Ze})),n.d(t,"V",(function(){return hn})),n.d(t,"W",(function(){return Sn})),n.d(t,"X",(function(){return Pn})),n.d(t,"Y",(function(){return gt})),n.d(t,"Z",(function(){return it})),n.d(t,"ab",(function(){return dt})),n.d(t,"bb",(function(){return qe})),n.d(t,"cb",(function(){return Xe})),n.d(t,"db",(function(){return et})),n.d(t,"eb",(function(){return lt})),n.d(t,"fb",(function(){return ft})),n.d(t,"gb",(function(){return ln})),n.d(t,"hb",(function(){return Tn})),n.d(t,"ib",(function(){return Ln})),n.d(t,"jb",(function(){return He})),n.d(t,"kb",(function(){return yt})),n.d(t,"lb",(function(){return bt})),n.d(t,"mb",(function(){return pn})),n.d(t,"nb",(function(){return vt})),n.d(t,"ob",(function(){return mt})),n.d(t,"pb",(function(){return ct})),n.d(t,"x",(function(){return _r})),n.d(t,"F",(function(){return br}));var r=n(0),i=n(5),s=n(10);function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create,Object.create;var o=n(9);const c={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},u={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function l(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const d=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},h=l,f=new r.b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),p=new s.b("@firebase/auth");function g(e,...t){p.logLevel<=s.a.ERROR&&p.error(`Auth (${i.SDK_VERSION}): ${e}`,...t)}function m(e,...t){throw w(e,...t)}function v(e,...t){return w(e,...t)}function y(e,t,n){const i=Object.assign(Object.assign({},h()),{[t]:n});return new r.b("auth","Firebase",i).create(t,{appName:e.name})}function b(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&m(e,"argument-error"),y(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function w(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return f.create(e,...t)}function _(e,t,...n){if(!e)throw w(t,...n)}function E(e){const t="INTERNAL ASSERTION FAILED: "+e;throw g(t),new Error(t)}function T(e,t){e||E(t)}const S=new Map;function I(e){T(e instanceof Function,"Expected a class definition");let t=S.get(e);return t?(T(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,S.set(e,t),t)}function k(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function A(){return"http:"===O()||"https:"===O()}function O(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class x{constructor(e,t){this.shortDelay=e,this.longDelay=t,T(t>e,"Short delay should be less than long delay!"),this.isMobile=Object(r.y)()||Object(r.A)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(A()||Object(r.u)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function C(e,t){T(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class R{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void E("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void E("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void E("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const D={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},L=new x(3e4,6e4);function P(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function N(e,t,n,i,s={}){return M(e,s,(async()=>{let s={},a={};i&&("GET"===t?a=i:s={body:JSON.stringify(i)});const o=Object(r.C)(Object.assign({key:e.config.apiKey},a)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),R.fetch()(F(e,e.config.apiHost,n,o),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function M(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},D),t);try{const t=new U(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw B(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw B(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw B(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw B(e,"user-disabled",s);const o=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw y(e,o,a);m(e,o)}}catch(t){if(t instanceof r.c)throw t;m(e,"network-request-failed")}}async function j(e,t,n,r,i={}){const s=await N(e,t,n,r,i);return"mfaPendingCredential"in s&&m(e,"multi-factor-auth-required",{_serverResponse:s}),s}function F(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?C(e.config,i):`${e.config.apiScheme}://${i}`}class U{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(v(this.auth,"network-request-failed"))),L.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function B(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=v(e,t,r);return i.customData._tokenResponse=n,i}function V(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function q(e){return 1e3*Number(e)}function G(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return g("JWT malformed, contained fewer than 3 sections"),null;try{const e=Object(r.e)(n);return e?JSON.parse(e):(g("Failed to decode base64 JWT payload"),null)}catch(e){return g("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function K(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof r.c&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class z{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class H{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=V(this.lastLoginAt),this.creationTime=V(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function W(e){var t;const n=e.auth,r=await e.getIdToken(),i=await K(e,async function(e,t){return N(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));_(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=a(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],c=(u=e.providerData,l=o,[...u.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var u,l;const d=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==c?void 0:c.length)),f=!!d&&h,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:c,metadata:new H(s.createdAt,s.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class ${constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_(e.idToken,"internal-error"),_(void 0!==e.idToken,"internal-error"),_(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=G(e);return _(t,"internal-error"),_(void 0!==t.exp,"internal-error"),_(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return _(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await M(e,{},(async()=>{const n=Object(r.C)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,a=F(e,i,"/v1/token","key="+s),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",R.fetch()(a,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new $;return n&&(_("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(_("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(_("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new $,this.toJSON())}_performRefresh(){return E("not implemented")}}function Y(e,t){_("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Q{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=a(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new z(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new H(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await K(this,this.stsTokenManager.getToken(this.auth,e));return _(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=Object(r.r)(e),i=await n.getIdToken(t),s=G(i);_(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const a="object"==typeof s.firebase?s.firebase:void 0,o=null==a?void 0:a.sign_in_provider;return{claims:s,token:i,authTime:V(q(s.auth_time)),issuedAtTime:V(q(s.iat)),expirationTime:V(q(s.exp)),signInProvider:o||null,signInSecondFactor:(null==a?void 0:a.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Object(r.r)(e);await W(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(_(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Q(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){_(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await W(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await K(this,async function(e,t){return N(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,a,o,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(a=t.tenantId)&&void 0!==a?a:void 0,g=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:y,emailVerified:b,isAnonymous:w,providerData:E,stsTokenManager:T}=t;_(y&&T,e,"internal-error");const S=$.fromJSON(this.name,T);_("string"==typeof y,e,"internal-error"),Y(l,e.name),Y(d,e.name),_("boolean"==typeof b,e,"internal-error"),_("boolean"==typeof w,e,"internal-error"),Y(h,e.name),Y(f,e.name),Y(p,e.name),Y(g,e.name),Y(m,e.name),Y(v,e.name);const I=new Q({uid:y,auth:e,email:d,emailVerified:b,displayName:l,isAnonymous:w,photoURL:f,phoneNumber:h,tenantId:p,stsTokenManager:S,createdAt:m,lastLoginAt:v});return E&&Array.isArray(E)&&(I.providerData=E.map((e=>Object.assign({},e)))),g&&(I._redirectEventId=g),I}static async _fromIdTokenResponse(e,t,n=!1){const r=new $;r.updateFromServerResponse(t);const i=new Q({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await W(i),i}}class X{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}X.type="NONE";const J=X;function Z(e,t,n){return`firebase:${e}:${t}:${n}`}class ee{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Z(this.userKey,r.apiKey,i),this.fullPersistenceKey=Z("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Q._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ee(I(J),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||I(J);const s=Z(n,e.config.apiKey,e.name);let a=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Q._fromJSON(e,t);n!==i&&(a=r),i=n;break}}catch(e){}const o=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&o.length?(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ee(i,e,n)):new ee(i,e,n)}}function te(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(se(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ne(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(oe(t))return"Blackberry";if(ce(t))return"Webos";if(re(t))return"Safari";if((t.includes("chrome/")||ie(t))&&!t.includes("edge/"))return"Chrome";if(ae(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ne(e=Object(r.s)()){return/firefox\//i.test(e)}function re(e=Object(r.s)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ie(e=Object(r.s)()){return/crios\//i.test(e)}function se(e=Object(r.s)()){return/iemobile/i.test(e)}function ae(e=Object(r.s)()){return/android/i.test(e)}function oe(e=Object(r.s)()){return/blackberry/i.test(e)}function ce(e=Object(r.s)()){return/webos/i.test(e)}function ue(e=Object(r.s)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function le(e=Object(r.s)()){return ue(e)||ae(e)||ce(e)||oe(e)||/windows phone/i.test(e)||se(e)}function de(e,t=[]){let n;switch(e){case"Browser":n=te(Object(r.s)());break;case"Worker":n=`${te(Object(r.s)())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${i.SDK_VERSION}/${s}`}class he{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const n of t)try{n()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class fe{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ge(this),this.idTokenSubscription=new ge(this),this.beforeStateQueue=new he(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=f,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=I(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ee.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,a=await this.tryRedirectSignIn(e);n&&n!==s||!(null==a?void 0:a.user)||(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return _(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await W(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Object(r.r)(e):null;return t&&_(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(I(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r.b("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&I(e)||this._popupRedirectResolver;_(t,this,"argument-error"),this.redirectPersistenceManager=await ee.create(this,[I(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return _(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=de(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function pe(e){return Object(r.r)(e)}class ge{constructor(e){this.auth=e,this.observer=null,this.addObserver=Object(r.j)((e=>this.observer=e))}get next(){return _(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function me(e,t,n){const r=pe(e);_(r._canInitEmulator,r,"emulator-config-failed"),_(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=ve(t),{host:a,port:o}=function(e){const t=ve(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:ye(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:ye(t)}}}(t),c=null===o?"":":"+o;r.config.emulator={url:`${s}//${a}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function ve(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ye(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class be{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return E("not implemented")}_getIdTokenResponse(e){return E("not implemented")}_linkToIdToken(e,t){return E("not implemented")}_getReauthenticationResolver(e){return E("not implemented")}}async function we(e,t){return N(e,"POST","/v1/accounts:resetPassword",P(e,t))}async function _e(e,t){return N(e,"POST","/v1/accounts:update",t)}async function Ee(e,t){return N(e,"POST","/v1/accounts:sendOobCode",P(e,t))}class Te extends be{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Te(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Te(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return j(e,"POST","/v1/accounts:signInWithPassword",P(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return j(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{email:this._email,oobCode:this._password});default:m(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return _e(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return j(e,"POST","/v1/accounts:signInWithEmailLink",P(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:m(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Se(e,t){return j(e,"POST","/v1/accounts:signInWithIdp",P(e,t))}class Ie extends be{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ie(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):m("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=a(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Ie(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Se(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Se(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Se(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Object(r.C)(t)}return e}}const ke={USER_NOT_FOUND:"user-not-found"};class Ae extends be{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Ae({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Ae({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return j(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await j(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,t));if(n.temporaryProof)throw B(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return j(e,"POST","/v1/accounts:signInWithPhoneNumber",P(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ke)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Ae({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Oe{constructor(e){var t,n,i,s,a,o;const c=Object(r.D)(Object(r.m)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,l=null!==(n=c.oobCode)&&void 0!==n?n:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=c.mode)&&void 0!==i?i:null);_(u&&l&&d,"argument-error"),this.apiKey=u,this.operation=d,this.code=l,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(a=c.languageCode)&&void 0!==a?a:null,this.tenantId=null!==(o=c.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=Object(r.D)(Object(r.m)(e)).link,n=t?Object(r.D)(Object(r.m)(t)).deep_link_id:null,i=Object(r.D)(Object(r.m)(e)).deep_link_id;return(i?Object(r.D)(Object(r.m)(i)).link:null)||i||n||t||e}(e);try{return new Oe(t)}catch(e){return null}}}class xe{constructor(){this.providerId=xe.PROVIDER_ID}static credential(e,t){return Te._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Oe.parseLink(t);return _(n,"argument-error"),Te._fromEmailAndCode(e,n.code,n.tenantId)}}xe.PROVIDER_ID="password",xe.EMAIL_PASSWORD_SIGN_IN_METHOD="password",xe.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ce{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Re extends Ce{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class De extends Re{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return _("providerId"in t&&"signInMethod"in t,"argument-error"),Ie._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return _(e.idToken||e.accessToken,"argument-error"),Ie._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return De.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return De.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new De(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class Le extends Re{constructor(){super("facebook.com")}static credential(e){return Ie._fromParams({providerId:Le.PROVIDER_ID,signInMethod:Le.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Le.credentialFromTaggedObject(e)}static credentialFromError(e){return Le.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Le.credential(e.oauthAccessToken)}catch(e){return null}}}Le.FACEBOOK_SIGN_IN_METHOD="facebook.com",Le.PROVIDER_ID="facebook.com";class Pe extends Re{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ie._fromParams({providerId:Pe.PROVIDER_ID,signInMethod:Pe.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Pe.credentialFromTaggedObject(e)}static credentialFromError(e){return Pe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Pe.credential(t,n)}catch(e){return null}}}Pe.GOOGLE_SIGN_IN_METHOD="google.com",Pe.PROVIDER_ID="google.com";class Ne extends Re{constructor(){super("github.com")}static credential(e){return Ie._fromParams({providerId:Ne.PROVIDER_ID,signInMethod:Ne.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ne.credentialFromTaggedObject(e)}static credentialFromError(e){return Ne.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ne.credential(e.oauthAccessToken)}catch(e){return null}}}Ne.GITHUB_SIGN_IN_METHOD="github.com",Ne.PROVIDER_ID="github.com";class Me extends be{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Se(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Se(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Se(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Me(n,i):null}static _create(e,t){return new Me(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class je extends Ce{constructor(e){_(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return je.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return je.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Me.fromJSON(e);return _(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Me._create(n,t)}catch(e){return null}}}class Fe extends Re{constructor(){super("twitter.com")}static credential(e,t){return Ie._fromParams({providerId:Fe.PROVIDER_ID,signInMethod:Fe.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Fe.credentialFromTaggedObject(e)}static credentialFromError(e){return Fe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Fe.credential(t,n)}catch(e){return null}}}async function Ue(e,t){return j(e,"POST","/v1/accounts:signUp",P(e,t))}Fe.TWITTER_SIGN_IN_METHOD="twitter.com",Fe.PROVIDER_ID="twitter.com";class Be{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Q._fromIdTokenResponse(e,n,r),s=Ve(n);return new Be({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Ve(n);return new Be({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ve(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function qe(e){var t;const n=pe(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Be({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await Ue(n,{returnSecureToken:!0}),i=await Be._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}class Ge extends r.c{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Ge.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Ge(e,t,n,r)}}function Ke(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Ge._fromErrorAndOperation(e,n,t,r);throw n}))}function ze(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function He(e,t){const n=Object(r.r)(e);await $e(!0,n,t);const{providerUserInfo:i}=await async function(e,t){return N(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=ze(i||[]);return n.providerData=n.providerData.filter((e=>s.has(e.providerId))),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function We(e,t,n=!1){const r=await K(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Be._forOperation(e,"link",r)}async function $e(e,t,n){await W(t);const r=!1===e?"provider-already-linked":"no-such-provider";_(ze(t.providerData).has(n)===e,t.auth,r)}async function Ye(e,t,n=!1){const{auth:r}=e;try{const i=await K(e,Ke(r,"reauthenticate",t,e),n);_(i.idToken,r,"internal-error");const s=G(i.idToken);_(s,r,"internal-error");const{sub:a}=s;return _(e.uid===a,r,"user-mismatch"),Be._forOperation(e,"reauthenticate",i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&m(r,"user-mismatch"),e}}async function Qe(e,t,n=!1){const r=await Ke(e,"signIn",t),i=await Be._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(i.user),i}async function Xe(e,t){return Qe(pe(e),t)}async function Je(e,t){const n=Object(r.r)(e);return await $e(!1,n,t.providerId),We(n,t)}async function Ze(e,t){return Ye(Object(r.r)(e),t)}async function et(e,t){const n=pe(e),r=await async function(e,t){return j(e,"POST","/v1/accounts:signInWithCustomToken",P(e,t))}(n,{token:t,returnSecureToken:!0}),i=await Be._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class tt{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?nt._fromServerResponse(e,t):m(e,"internal-error")}}class nt extends tt{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new nt(t)}}function rt(e,t,n){var r;_((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),_(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(_(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(_(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function it(e,t,n){const i=Object(r.r)(e),s={requestType:"PASSWORD_RESET",email:t};n&&rt(i,s,n),await async function(e,t){return Ee(e,t)}(i,s)}async function st(e,t,n){await we(Object(r.r)(e),{oobCode:t,newPassword:n})}async function at(e,t){await async function(e,t){return N(e,"POST","/v1/accounts:update",P(e,t))}(Object(r.r)(e),{oobCode:t})}async function ot(e,t){const n=Object(r.r)(e),i=await we(n,{oobCode:t}),s=i.requestType;switch(_(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":_(i.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":_(i.mfaInfo,n,"internal-error");default:_(i.email,n,"internal-error")}let a=null;return i.mfaInfo&&(a=tt._fromServerResponse(pe(n),i.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.newEmail:i.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.email:i.newEmail)||null,multiFactorInfo:a},operation:s}}async function ct(e,t){const{data:n}=await ot(Object(r.r)(e),t);return n.email}async function ut(e,t,n){const r=pe(e),i=await Ue(r,{returnSecureToken:!0,email:t,password:n}),s=await Be._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}function lt(e,t,n){return Xe(Object(r.r)(e),xe.credential(t,n))}async function dt(e,t,n){const i=Object(r.r)(e),s={requestType:"EMAIL_SIGNIN",email:t};_(n.handleCodeInApp,i,"argument-error"),n&&rt(i,s,n),await async function(e,t){return Ee(e,t)}(i,s)}function ht(e,t){const n=Oe.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}async function ft(e,t,n){const i=Object(r.r)(e),s=xe.credentialWithLink(t,n||k());return _(s._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),Xe(i,s)}async function pt(e,t){const n={identifier:t,continueUri:A()?k():"http://localhost"},{signinMethods:i}=await async function(e,t){return N(e,"POST","/v1/accounts:createAuthUri",P(e,t))}(Object(r.r)(e),n);return i||[]}async function gt(e,t){const n=Object(r.r)(e),i={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&rt(n.auth,i,t);const{email:s}=await async function(e,t){return Ee(e,t)}(n.auth,i);s!==e.email&&await e.reload()}async function mt(e,t,n){const i=Object(r.r)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&rt(i.auth,s,n);const{email:a}=await async function(e,t){return Ee(e,t)}(i.auth,s);a!==e.email&&await e.reload()}async function vt(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const i=Object(r.r)(e),s={idToken:await i.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},a=await K(i,async function(e,t){return N(e,"POST","/v1/accounts:update",t)}(i.auth,s));i.displayName=a.displayName||null,i.photoURL=a.photoUrl||null;const o=i.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=i.displayName,o.photoURL=i.photoURL),await i._updateTokensIfNecessary(a)}function yt(e,t){return wt(Object(r.r)(e),t,null)}function bt(e,t){return wt(Object(r.r)(e),null,t)}async function wt(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await K(e,_e(r,i));await e._updateTokensIfNecessary(s,!0)}class _t{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Et extends _t{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Tt extends _t{constructor(e,t){super(e,"facebook.com",t)}}class St extends Et{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class It extends _t{constructor(e,t){super(e,"google.com",t)}}class kt extends Et{constructor(e,t,n){super(e,"twitter.com",t,n)}}function At(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=G(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new _t(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Tt(s,i);case"github.com":return new St(s,i);case"google.com":return new It(s,i);case"twitter.com":return new kt(s,i,e.screenName||null);case"custom":case"anonymous":return new _t(s,null);default:return new _t(s,r,i)}}(n)}class Ot{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new Ot("enroll",e,t)}static _fromMfaPendingCredential(e){return new Ot("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Ot._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return Ot._fromIdtoken(e.multiFactorSession.idToken)}return null}}class xt{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=pe(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>tt._fromServerResponse(n,e)));_(r.mfaPendingCredential,n,"internal-error");const s=Ot._fromMfaPendingCredential(r.mfaPendingCredential);return new xt(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const a=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Be._fromIdTokenResponse(n,t.operationType,a);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return _(t.user,n,"internal-error"),Be._forOperation(t.user,t.operationType,a);default:m(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function Ct(e,t){var n;const i=Object(r.r)(e),s=t;return _(t.customData.operationType,i,"argument-error"),_(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,i,"argument-error"),xt._fromError(i,s)}class Rt{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>tt._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Rt(e)}async getSession(){return Ot._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e,r=await this.getSession(),i=await K(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken(),r=await K(this.user,(i=this.user.auth,s={idToken:n,mfaEnrollmentId:t},N(i,"POST","/v2/accounts/mfaEnrollment:withdraw",P(i,s))));var i,s;this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==(null==e?void 0:e.code))throw e}}}const Dt=new WeakMap;function Lt(e){const t=Object(r.r)(e);return Dt.has(t)||Dt.set(t,Rt._fromUser(t)),Dt.get(t)}class Pt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem("__sak","1"),this.storage.removeItem("__sak"),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Nt extends Pt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Object(r.s)();return re(e)||ue(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=le(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);Object(r.w)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Nt.type="LOCAL";const Mt=Nt;class jt extends Pt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}jt.type="SESSION";const Ft=jt;class Ut{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Ut(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const a=Array.from(s).map((async e=>e(t.origin,i))),o=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Bt(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Ut.receivers=[];class Vt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((a,o)=>{const c=Bt("",20);r.port1.start();const u=setTimeout((()=>{o(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{o(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),a(t.data.response);break;default:clearTimeout(u),clearTimeout(i),o(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function qt(){return window}function Gt(){return void 0!==qt().WorkerGlobalScope&&"function"==typeof qt().importScripts}const Kt="firebaseLocalStorageDb";class zt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Ht(e,t){return e.transaction(["firebaseLocalStorage"],t?"readwrite":"readonly").objectStore("firebaseLocalStorage")}function Wt(){const e=indexedDB.open(Kt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains("firebaseLocalStorage")?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Kt);return new zt(e).toPromise()}(),t(await Wt()))}))}))}async function $t(e,t,n){const r=Ht(e,!0).put({fbase_key:t,value:n});return new zt(r).toPromise()}function Yt(e,t){const n=Ht(e,!0).delete(t);return new zt(n).toPromise()}class Qt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Wt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Gt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ut._getInstance(Gt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Vt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Wt();return await $t(e,"__sak","1"),await Yt(e,"__sak"),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>$t(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Ht(e,!1).get(t),r=await new zt(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Yt(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Ht(e,!1).getAll();return new zt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Qt.type="LOCAL";const Xt=Qt;function Jt(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=v("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function Zt(e){return`__${e}${Math.floor(1e6*Math.random())}`}class en{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new tn(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||1e12;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||1e12;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class tn{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;_(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const nn=Zt("rcb"),rn=new x(3e4,6e4);class sn{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(e=qt().grecaptcha)||void 0===e?void 0:e.render)}load(e,t=""){return _(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(qt().grecaptcha):new Promise(((n,i)=>{const s=qt().setTimeout((()=>{i(v(e,"network-request-failed"))}),rn.get());qt()[nn]=()=>{qt().clearTimeout(s),delete qt()[nn];const r=qt().grecaptcha;if(!r)return void i(v(e,"internal-error"));const a=r.render;r.render=(e,t)=>{const n=a(e,t);return this.counter++,n},this.hostLanguage=t,n(r)},Jt("https://www.google.com/recaptcha/api.js??"+Object(r.C)({onload:nn,render:"explicit",hl:t})).catch((()=>{clearTimeout(s),i(v(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null===(t=qt().grecaptcha)||void 0===t?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class an{async load(e){return new en(e)}clearedOneInstance(){}}const on={theme:"light",type:"image"};class cn{constructor(e,t=Object.assign({},on),n){this.parameters=t,this.type="recaptcha",this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=pe(n),this.isInvisible="invisible"===this.parameters.size,_("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;_(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new an:new sn,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){_(!this.parameters.sitekey,this.auth,"argument-error"),_(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),_("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=qt()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){_(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){_(A()&&!Gt(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await N(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);_(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return _(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class un{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Ae._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function ln(e,t,n){const i=pe(e),s=await fn(i,t,Object(r.r)(n));return new un(s,(e=>Xe(i,e)))}async function dn(e,t,n){const i=Object(r.r)(e);await $e(!1,i,"phone");const s=await fn(i.auth,t,Object(r.r)(n));return new un(s,(e=>Je(i,e)))}async function hn(e,t,n){const i=Object(r.r)(e),s=await fn(i.auth,t,Object(r.r)(n));return new un(s,(e=>Ze(i,e)))}async function fn(e,t,n){var r;const i=await n.verify();try{let s;if(_("string"==typeof i,e,"argument-error"),_("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s)return _("enroll"===t.type,e,"internal-error"),(await function(e,t){return N(e,"POST","/v2/accounts/mfaEnrollment:start",P(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{_("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;return _(n,e,"missing-multi-factor-info"),(await function(e,t){return N(e,"POST","/v2/accounts/mfaSignIn:start",P(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return N(e,"POST","/v1/accounts:sendVerificationCode",P(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}async function pn(e,t){await We(Object(r.r)(e),t)}class gn{constructor(e){this.providerId=gn.PROVIDER_ID,this.auth=pe(e)}verifyPhoneNumber(e,t){return fn(this.auth,e,Object(r.r)(t))}static credential(e,t){return Ae._fromVerification(e,t)}static credentialFromResult(e){const t=e;return gn.credentialFromTaggedObject(t)}static credentialFromError(e){return gn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Ae._fromTokenResponse(t,n):null}}function mn(e,t){return t?I(t):(_(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}gn.PROVIDER_ID="phone",gn.PHONE_SIGN_IN_METHOD="phone";class vn extends be{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Se(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Se(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Se(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function yn(e){return Qe(e.auth,new vn(e),e.bypassAuthState)}function bn(e){const{auth:t,user:n}=e;return _(n,t,"internal-error"),Ye(n,new vn(e),e.bypassAuthState)}async function wn(e){const{auth:t,user:n}=e;return _(n,t,"internal-error"),We(n,new vn(e),e.bypassAuthState)}class _n{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return yn;case"linkViaPopup":case"linkViaRedirect":return wn;case"reauthViaPopup":case"reauthViaRedirect":return bn;default:m(this.auth,"internal-error")}}resolve(e){T(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){T(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const En=new x(2e3,1e4);async function Tn(e,t,n){const r=pe(e);b(e,t,Ce);const i=mn(r,n);return new kn(r,"signInViaPopup",t,i).executeNotNull()}async function Sn(e,t,n){const i=Object(r.r)(e);b(i.auth,t,Ce);const s=mn(i.auth,n);return new kn(i.auth,"reauthViaPopup",t,s,i).executeNotNull()}async function In(e,t,n){const i=Object(r.r)(e);b(i.auth,t,Ce);const s=mn(i.auth,n);return new kn(i.auth,"linkViaPopup",t,s,i).executeNotNull()}class kn extends _n{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,kn.currentPopupAction&&kn.currentPopupAction.cancel(),kn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _(e,this.auth,"internal-error"),e}async onExecution(){T(1===this.filter.length,"Popup operations only handle one event");const e=Bt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(v(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(v(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,kn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(v(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,En.get())};e()}}kn.currentPopupAction=null;const An=new Map;class On extends _n{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=An.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Dn(t),r=Rn(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}An.set(this.auth._key(),e)}return this.bypassAuthState||An.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function xn(e,t){return Rn(e)._set(Dn(t),"true")}function Cn(e,t){An.set(e._key(),t)}function Rn(e){return I(e._redirectPersistence)}function Dn(e){return Z("pendingRedirect",e.config.apiKey,e.name)}function Ln(e,t,n){return async function(e,t,n){const r=pe(e);b(e,t,Ce);const i=mn(r,n);return await xn(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Pn(e,t,n){return async function(e,t,n){const i=Object(r.r)(e);b(i.auth,t,Ce);const s=mn(i.auth,n);await xn(s,i.auth);const a=await Fn(i);return s._openRedirect(i.auth,t,"reauthViaRedirect",a)}(e,t,n)}function Nn(e,t,n){return async function(e,t,n){const i=Object(r.r)(e);b(i.auth,t,Ce);const s=mn(i.auth,n);await $e(!1,i,t.providerId),await xn(s,i.auth);const a=await Fn(i);return s._openRedirect(i.auth,t,"linkViaRedirect",a)}(e,t,n)}async function Mn(e,t){return await pe(e)._initializationPromise,jn(e,t,!1)}async function jn(e,t,n=!1){const r=pe(e),i=mn(r,t),s=new On(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function Fn(e){const t=Bt(e.uid+":::");return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Un{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Vn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(v(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Bn(e))}saveEventToCache(e){this.cachedEventUids.add(Bn(e)),this.lastProcessedEventTime=Date.now()}}function Bn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Vn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function qn(e,t={}){return N(e,"GET","/v1/projects",t)}const Gn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Kn=/^https?/;function zn(e){const t=k(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Kn.test(n))return!1;if(Gn.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Hn=new x(3e4,6e4);function Wn(){const e=qt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let $n=null;function Yn(e){return $n=$n||function(e){return new Promise(((t,n)=>{var r,i,s;function a(){Wn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Wn(),n(v(e,"network-request-failed"))},timeout:Hn.get()})}if(null===(i=null===(r=qt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=qt().gapi)||void 0===s?void 0:s.load)){const t=Zt("iframefcb");return qt()[t]=()=>{gapi.load?a():n(v(e,"network-request-failed"))},Jt("https://apis.google.com/js/api.js?onload="+t).catch((e=>n(e)))}a()}})).catch((e=>{throw $n=null,e}))}(e),$n}const Qn=new x(5e3,15e3),Xn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Jn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zn(e){const t=e.config;_(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?C(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:i.SDK_VERSION},a=Jn.get(e.config.apiHost);a&&(s.eid=a);const o=e._getFrameworks();return o.length&&(s.fw=o.join(",")),`${n}?${Object(r.C)(s).slice(1)}`}const er={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class tr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function nr(e,t,n,i=500,s=600){const a=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const u=Object.assign(Object.assign({},er),{width:i.toString(),height:s.toString(),top:a,left:o}),l=Object(r.s)().toLowerCase();n&&(c=ie(l)?"_blank":n),ne(l)&&(t=t||"http://localhost",u.scrollbars="yes");const d=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=Object(r.s)()){var t;return ue(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new tr(null);const h=window.open(t||"",c,d);_(h,e,"popup-blocked");try{h.focus()}catch(e){}return new tr(h)}function rr(e,t,n,s,a,o){_(e.config.authDomain,e,"auth-domain-config-required"),_(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:i.SDK_VERSION,eventId:a};if(t instanceof Ce){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",Object(r.v)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(o||{}))c[e]=t}if(t instanceof Re){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];return`${function({config:e}){return e.emulator?C(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Object(r.C)(u).slice(1)}`}const ir=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ft,this._completeRedirectFn=jn,this._overrideRedirectResult=Cn}async _openPopup(e,t,n,r){var i;return T(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),nr(e,rr(e,t,n,k(),r),Bt())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=rr(e,t,n,k(),r),qt().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(T(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Yn(e),n=qt().gapi;return _(n,e,"internal-error"),t.open({where:document.body,url:Zn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Xn,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=v(e,"network-request-failed"),s=qt().setTimeout((()=>{r(i)}),Qn.get());function a(){qt().clearTimeout(s),n(t)}t.ping(a).then(a,(()=>{r(i)}))}))))}(e),n=new Un(e);return t.register("authEvent",(t=>(_(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send("webStorageSupport",{type:"webStorageSupport"},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),m(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await qn(e);for(const n of t)try{if(zn(n))return}catch(e){}m(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return le()||re()||ue()}};class sr extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return E("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new sr(e)}_finalizeEnroll(e,t,n){return function(e,t){return N(e,"POST","/v2/accounts/mfaEnrollment:finalize",P(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return N(e,"POST","/v2/accounts/mfaSignIn:finalize",P(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ar{constructor(){}static assertion(e){return sr._fromCredential(e)}}ar.FACTOR_ID="phone";class or{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}var cr;function ur(){return window}async function lr(e,t,n){var r;const{BuildInfo:i}=ur();T(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(T(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),a={};return ue()?a.ibi=i.packageName:ae()?a.apn=i.packageName:m(e,"operation-not-supported-in-this-environment"),i.displayName&&(a.appDisplayName=i.displayName),a.sessionId=s,rr(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,a)}function dr(e){const{cordova:t}=ur();return new Promise((n=>{t.plugins.browsertab.isAvailable((i=>{let s=null;i?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,function(e=Object(r.s)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(s)}))}))}Object(r.q)("authIdTokenMaxAge"),cr="Browser",Object(i._registerComponent)(new o.a("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{_(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),_(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:cr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:de(cr)},a=new fe(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(I);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(a,t),a})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Object(i._registerComponent)(new o.a("auth-internal",(e=>(e=>new or(e))(pe(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Object(i.registerVersion)("@firebase/auth","0.21.0",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(cr)),Object(i.registerVersion)("@firebase/auth","0.21.0","esm2017");class hr extends Un{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function fr(e){const t=await mr()._get(vr(e));return t&&await mr()._remove(vr(e)),t}function pr(e,t){var n,r;const i=function(e){const t=yr(e),n=t.link?decodeURIComponent(t.link):void 0,r=yr(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return yr(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=yr(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,a=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],o=a?v(a):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function gr(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function mr(){return I(Mt)}function vr(e){return Z("authEvent",e.config.apiKey,e.name)}function yr(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return Object(r.D)(n.join("?"))}const br=class{constructor(){this._redirectPersistence=Ft,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=jn,this._overrideRedirectResult=Cn}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new hr(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){m(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,a,o,c,u,l;const d=ur();_("function"==typeof(null===(t=null==d?void 0:d.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),_(void 0!==(null===(n=null==d?void 0:d.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),_("function"==typeof(null===(s=null===(i=null===(r=null==d?void 0:d.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),_("function"==typeof(null===(c=null===(o=null===(a=null==d?void 0:d.cordova)||void 0===a?void 0:a.plugins)||void 0===o?void 0:o.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),_("function"==typeof(null===(l=null===(u=null==d?void 0:d.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),An.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:gr(),postBody:null,tenantId:e.tenantId,error:v(e,"no-auth-event")}}(e,n,r);await function(e,t){return mr()._set(vr(e),t)}(e,s);const a=await lr(e,s,t);return async function(e,t,n){const{cordova:r}=ur();let i=()=>{};try{await new Promise(((s,a)=>{let o=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){o||(o=window.setTimeout((()=>{a(v(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),ae()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),o&&window.clearTimeout(o)}}))}finally{i()}}(e,i,await dr(a))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=ur(),n={};ue()?n.iosBundleId=t.packageName:ae()?n.androidPackageName=t.packageName:m(e,"operation-not-supported-in-this-environment"),await qn(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=ur(),s=setTimeout((async()=>{await fr(e),t.onEvent(wr())}),500),a=async n=>{clearTimeout(s);const r=await fr(e);let i=null;r&&(null==n?void 0:n.url)&&(i=pr(r,n.url)),t.onEvent(i||wr())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,a);const o=r,c=i.packageName.toLowerCase()+"://";ur().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function wr(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:v("no-auth-event")}}function _r(e,t){pe(e)._logFramework(t)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Tl})),n.d(t,"b",(function(){return _u})),n.d(t,"c",(function(){return ou})),n.d(t,"d",(function(){return Rc})),n.d(t,"e",(function(){return Al})),n.d(t,"f",(function(){return Eu})),n.d(t,"g",(function(){return T})),n.d(t,"h",(function(){return Su})),n.d(t,"i",(function(){return Ol})),n.d(t,"j",(function(){return xl})),n.d(t,"k",(function(){return F})),n.d(t,"l",(function(){return $l})),n.d(t,"m",(function(){return ve})),n.d(t,"n",(function(){return K})),n.d(t,"o",(function(){return G})),n.d(t,"p",(function(){return Ic})),n.d(t,"q",(function(){return w})),n.d(t,"r",(function(){return Se})),n.d(t,"s",(function(){return m})),n.d(t,"t",(function(){return _c})),n.d(t,"u",(function(){return ql})),n.d(t,"v",(function(){return td})),n.d(t,"w",(function(){return ed})),n.d(t,"x",(function(){return pu})),n.d(t,"y",(function(){return Pc})),n.d(t,"z",(function(){return Nc})),n.d(t,"A",(function(){return Cc})),n.d(t,"B",(function(){return Vl})),n.d(t,"C",(function(){return Jl})),n.d(t,"D",(function(){return vu})),n.d(t,"E",(function(){return Mc})),n.d(t,"F",(function(){return du})),n.d(t,"G",(function(){return hu})),n.d(t,"H",(function(){return mu})),n.d(t,"I",(function(){return vl})),n.d(t,"J",(function(){return ml})),n.d(t,"K",(function(){return uu})),n.d(t,"L",(function(){return zl})),n.d(t,"M",(function(){return Dl})),n.d(t,"N",(function(){return Pl})),n.d(t,"O",(function(){return Nl})),n.d(t,"P",(function(){return Ml})),n.d(t,"Q",(function(){return jl})),n.d(t,"R",(function(){return Fl})),n.d(t,"S",(function(){return nd})),n.d(t,"T",(function(){return ll})),n.d(t,"U",(function(){return dl})),n.d(t,"V",(function(){return yu})),n.d(t,"W",(function(){return bu})),n.d(t,"X",(function(){return Gl})),n.d(t,"Y",(function(){return Kl})),n.d(t,"Z",(function(){return cl})),n.d(t,"ab",(function(){return rl})),n.d(t,"bb",(function(){return Fc})),n.d(t,"cb",(function(){return jc})),n.d(t,"db",(function(){return Xl})),n.d(t,"eb",(function(){return Zl})),n.d(t,"fb",(function(){return Ul})),n.d(t,"gb",(function(){return f})),n.d(t,"hb",(function(){return Rl})),n.d(t,"ib",(function(){return pl})),n.d(t,"jb",(function(){return fl})),n.d(t,"kb",(function(){return Bl})),n.d(t,"lb",(function(){return gu})),n.d(t,"mb",(function(){return sl}));var r=n(5),i=n(9),s=n(10),a=n(0),o=n(11);const c="@firebase/firestore";class u{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}u.UNAUTHENTICATED=new u(null),u.GOOGLE_CREDENTIALS=new u("google-credentials-uid"),u.FIRST_PARTY=new u("first-party-uid"),u.MOCK_USER=new u("mock-user");let l="9.15.0";const d=new s.b("@firebase/firestore");function h(){return d.logLevel}function f(e){d.setLogLevel(e)}function p(e,...t){if(d.logLevel<=s.a.DEBUG){const n=t.map(v);d.debug(`Firestore (${l}): ${e}`,...n)}}function g(e,...t){if(d.logLevel<=s.a.ERROR){const n=t.map(v);d.error(`Firestore (${l}): ${e}`,...n)}}function m(e,...t){if(d.logLevel<=s.a.WARN){const n=t.map(v);d.warn(`Firestore (${l}): ${e}`,...n)}}function v(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function y(e="Unexpected state"){const t=`FIRESTORE (${l}) INTERNAL ASSERTION FAILED: `+e;throw g(t),new Error(t)}function b(e,t){e||y()}function w(e,t){e||y()}function _(e,t){return e}const E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class T extends a.c{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class S{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class I{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class k{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(u.UNAUTHENTICATED)))}shutdown(){}}class A{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class O{constructor(e){this.t=e,this.currentUser=u.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new S;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new S,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},a=e=>{p("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>a(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(p("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new S)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(p("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(b("string"==typeof t.accessToken),new I(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return b(null===e||"string"==typeof e),new u(e)}}class x{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=u.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(b(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class C{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new x(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable((()=>t(u.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class R{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class D{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&p("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: "+e.error.message);const n=e.token!==this.A;return this.A=e.token,p("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{p("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?r(e):p("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(b("string"==typeof e.token),this.A=e.token,new R(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function L(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class P{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=L(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function N(e,t){return e<t?-1:e>t?1:0}function M(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function j(e){return e+"\0"}class F{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new T(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new T(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new T(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new T(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return F.fromMillis(Date.now())}static fromDate(e){return F.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new F(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?N(this.nanoseconds,e.nanoseconds):N(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class U{constructor(e){this.timestamp=e}static fromTimestamp(e){return new U(e)}static min(){return new U(new F(0,0))}static max(){return new U(new F(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class B{constructor(e,t,n){void 0===t?t=0:t>e.length&&y(),void 0===n?n=e.length-t:n>e.length-t&&y(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===B.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof B?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class V extends B{construct(e,t,n){return new V(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new T(E.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new V(t)}static emptyPath(){return new V([])}}const q=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class G extends B{construct(e,t,n){return new G(e,t,n)}static isValidIdentifier(e){return q.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),G.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new G(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new T(E.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new T(E.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new T(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new T(E.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new G(t)}static emptyPath(){return new G([])}}class K{constructor(e){this.path=e}static fromPath(e){return new K(V.fromString(e))}static fromName(e){return new K(V.fromString(e).popFirst(5))}static empty(){return new K(V.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===V.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return V.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new V(e.slice()))}}class z{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function H(e){return e.fields.find((e=>2===e.kind))}function W(e){return e.fields.filter((e=>2!==e.kind))}z.UNKNOWN_ID=-1;class ${constructor(e,t){this.fieldPath=e,this.kind=t}}class Y{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Y(0,J.min())}}function Q(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=U.fromTimestamp(1e9===r?new F(n+1,0):new F(n,r));return new J(i,K.empty(),t)}function X(e){return new J(e.readTime,e.key,-1)}class J{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new J(U.min(),K.empty(),-1)}static max(){return new J(U.max(),K.empty(),-1)}}function Z(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=K.comparator(e.documentKey,t.documentKey),0!==n?n:N(e.largestBatchId,t.largestBatchId))}const ee="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class te{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ne(e){if(e.code!==E.FAILED_PRECONDITION||e.message!==ee)throw e;p("LocalStore","Unexpectedly lost primary lease")}class re{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&y(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new re(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof re?t:re.resolve(t)}catch(e){return re.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):re.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):re.reject(t)}static resolve(e){return new re(((t,n)=>{t(e)}))}static reject(e){return new re(((t,n)=>{n(e)}))}static waitFor(e){return new re(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=re.resolve(!1);for(const n of e)t=t.next((e=>e?re.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new re(((n,r)=>{const i=e.length,s=new Array(i);let a=0;for(let o=0;o<i;o++){const c=o;t(e[c]).next((e=>{s[c]=e,++a,a===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new re(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class ie{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new S,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new oe(e,t.error)):this.P.resolve()},this.transaction.onerror=t=>{const n=he(t.target.error);this.P.reject(new oe(e,n))}}static open(e,t,n,r){try{return new ie(t,e.transaction(r,n))}catch(e){throw new oe(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(p("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ue(t)}}class se{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===se.D(Object(a.s)())&&g("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return p("SimpleDb","Removing database:",e),le(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Object(a.x)())return!1;if(se.N())return!0;const e=Object(a.s)(),t=se.D(e),n=0<t&&t<10,r=se.k(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static N(){var t;return void 0!==e&&"YES"===(null===(t=e.env)||void 0===t?void 0:t.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(e){return this.db||(p("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new oe(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new T(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new T(E.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new oe(e,r))},r.onupgradeneeded=e=>{p("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.S.$(t,r.transaction,e.oldVersion,this.version).next((()=>{p("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=ie.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.V(),e))).catch((e=>(t.abort(e),re.reject(e)))).toPromise();return s.catch((()=>{})),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(p("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ae{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return le(this.q.delete())}}class oe extends T{constructor(e,t){super(E.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ce(e){return"IndexedDbTransactionError"===e.name}class ue{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(p("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),le(n)}add(e){return p("SimpleDb","ADD",this.store.name,e,e),le(this.store.add(e))}get(e){return le(this.store.get(e)).next((t=>(void 0===t&&(t=null),p("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return p("SimpleDb","DELETE",this.store.name,e),le(this.store.delete(e))}count(){return p("SimpleDb","COUNT",this.store.name),le(this.store.count())}W(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.H(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new re(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}J(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new re(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}Y(e,t){p("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;const r=this.cursor(n);return this.H(r,((e,t,n)=>n.delete()))}Z(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.H(r,t)}tt(e){const t=this.cursor({});return new re(((n,r)=>{t.onerror=e=>{const t=he(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}H(e,t){const n=[];return new re(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new ae(i),a=t(i.primaryKey,i.value,s);if(a instanceof re){const e=a.catch((e=>(s.done(),re.reject(e))));n.push(e)}s.isDone?r():null===s.G?i.continue():i.continue(s.G)}})).next((()=>re.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function le(e){return new re(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=he(e.target.error);n(t)}}))}let de=!1;function he(e){const t=se.D(Object(a.s)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new T("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return de||(de=!0,setTimeout((()=>{throw e}),0)),e}}return e}class fe{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){p("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{p("IndexBackiller","Documents written: "+await this.et.st())}catch(e){ce(e)?p("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await ne(e)}await this.nt(6e4)}))}}class pe{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.it(t,e)))}it(e,t){const n=new Set;let r=t,i=!0;return re.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return p("IndexBackiller","Processing collection: "+t),this.rt(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}rt(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.ot(r,n))).next((n=>(p("IndexBackiller","Updating offset: "+n),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}ot(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=X(t);Z(r,n)>0&&(n=r)})),new J(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ge{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}ge.at=-1;class me{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class ve{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ve("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ve&&e.projectId===this.projectId&&e.database===this.database}}function ye(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function be(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function we(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function _e(e){return null==e}function Ee(e){return 0===e&&1/e==-1/0}function Te(e){return"number"==typeof e&&Number.isInteger(e)&&!Ee(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Se(){return"undefined"!=typeof atob}class Ie{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Ie(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ie(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return N(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ie.EMPTY_BYTE_STRING=new Ie("");const ke=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ae(e){if(b(!!e),"string"==typeof e){let t=0;const n=ke.exec(e);if(b(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Oe(e.seconds),nanos:Oe(e.nanos)}}function Oe(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function xe(e){return"string"==typeof e?Ie.fromBase64String(e):Ie.fromUint8Array(e)}function Ce(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Re(e){const t=Ae(e.mapValue.fields.__local_write_time__.timestampValue);return new F(t.seconds,t.nanos)}const De={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Le={nullValue:"NULL_VALUE"};function Pe(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ce(e)?4:We(e)?9007199254740991:10:y()}function Ne(e,t){if(e===t)return!0;const n=Pe(e);if(n!==Pe(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Re(e).isEqual(Re(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ae(e.timestampValue),r=Ae(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return xe(e.bytesValue).isEqual(xe(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Oe(e.geoPointValue.latitude)===Oe(t.geoPointValue.latitude)&&Oe(e.geoPointValue.longitude)===Oe(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Oe(e.integerValue)===Oe(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Oe(e.doubleValue),r=Oe(t.doubleValue);return n===r?Ee(n)===Ee(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return M(e.arrayValue.values||[],t.arrayValue.values||[],Ne);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ye(n)!==ye(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!Ne(n[e],r[e])))return!1;return!0}(e,t);default:return y()}}function Me(e,t){return void 0!==(e.values||[]).find((e=>Ne(e,t)))}function je(e,t){if(e===t)return 0;const n=Pe(e),r=Pe(t);if(n!==r)return N(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return N(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Oe(e.integerValue||e.doubleValue),r=Oe(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Fe(e.timestampValue,t.timestampValue);case 4:return Fe(Re(e),Re(t));case 5:return N(e.stringValue,t.stringValue);case 6:return function(e,t){const n=xe(e),r=xe(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=N(n[e],r[e]);if(0!==t)return t}return N(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=N(Oe(e.latitude),Oe(t.latitude));return 0!==n?n:N(Oe(e.longitude),Oe(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=je(n[e],r[e]);if(t)return t}return N(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===De.mapValue&&t===De.mapValue)return 0;if(e===De.mapValue)return 1;if(t===De.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=N(r[e],s[e]);if(0!==t)return t;const a=je(n[r[e]],i[s[e]]);if(0!==a)return a}return N(r.length,s.length)}(e.mapValue,t.mapValue);default:throw y()}}function Fe(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return N(e,t);const n=Ae(e),r=Ae(t),i=N(n.seconds,r.seconds);return 0!==i?i:N(n.nanos,r.nanos)}function Ue(e){return function e(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(e){const t=Ae(e);return`time(${t.seconds},${t.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?xe(t.bytesValue).toBase64():"referenceValue"in t?(r=t.referenceValue,K.fromName(r).toString()):"geoPointValue"in t?`geo(${(n=t.geoPointValue).latitude},${n.longitude})`:"arrayValue"in t?function(t){let n="[",r=!0;for(const i of t.values||[])r?r=!1:n+=",",n+=e(i);return n+"]"}(t.arrayValue):"mapValue"in t?function(t){const n=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const s of n)i?i=!1:r+=",",r+=`${s}:${e(t.fields[s])}`;return r+"}"}(t.mapValue):y();var n,r}(e)}function Be(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ve(e){return!!e&&"integerValue"in e}function qe(e){return!!e&&"arrayValue"in e}function Ge(e){return!!e&&"nullValue"in e}function Ke(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ze(e){return!!e&&"mapValue"in e}function He(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return be(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=He(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=He(e.arrayValue.values[n]);return t}return Object.assign({},e)}function We(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function $e(e){return"nullValue"in e?Le:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Be(ve.empty(),K.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:y()}function Ye(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Be(ve.empty(),K.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?De:y()}function Qe(e,t){const n=je(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Xe(e,t){const n=je(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Je{constructor(e,t){this.position=e,this.inclusive=t}}function Ze(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?K.comparator(K.fromName(a.referenceValue),n.key):je(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function et(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ne(e.position[n],t.position[n]))return!1;return!0}class tt{}class nt extends tt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new dt(e,t,n):"array-contains"===t?new gt(e,n):"in"===t?new mt(e,n):"not-in"===t?new vt(e,n):"array-contains-any"===t?new yt(e,n):new nt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new ht(e,n):new ft(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(je(t,this.value)):null!==t&&Pe(this.value)===Pe(t)&&this.matchesComparison(je(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return y()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class rt extends tt{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new rt(e,t)}matches(e){return it(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt((e=>e.isInequality()));return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function it(e){return"and"===e.op}function st(e){return"or"===e.op}function at(e){return ot(e)&&it(e)}function ot(e){for(const t of e.filters)if(t instanceof rt)return!1;return!0}function ct(e,t){return e instanceof nt?function(e,t){return t instanceof nt&&e.op===t.op&&e.field.isEqual(t.field)&&Ne(e.value,t.value)}(e,t):e instanceof rt?function(e,t){return t instanceof rt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&ct(n,t.filters[r])),!0)}(e,t):void y()}function ut(e,t){const n=e.filters.concat(t);return rt.create(n,e.op)}function lt(e){return e instanceof nt?function(e){return`${e.field.canonicalString()} ${e.op} ${Ue(e.value)}`}(e):e instanceof rt?function(e){return e.op.toString()+" {"+e.getFilters().map(lt).join(" ,")+"}"}(e):"Filter"}class dt extends nt{constructor(e,t,n){super(e,t,n),this.key=K.fromName(n.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.matchesComparison(t)}}class ht extends nt{constructor(e,t){super(e,"in",t),this.keys=pt("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class ft extends nt{constructor(e,t){super(e,"not-in",t),this.keys=pt("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function pt(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>K.fromName(e.referenceValue)))}class gt extends nt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qe(t)&&Me(t.arrayValue,this.value)}}class mt extends nt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Me(this.value.arrayValue,t)}}class vt extends nt{constructor(e,t){super(e,"not-in",t)}matches(e){if(Me(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Me(this.value.arrayValue,t)}}class yt extends nt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qe(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Me(this.value.arrayValue,e)))}}class bt{constructor(e,t="asc"){this.field=e,this.dir=t}}function wt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class _t{constructor(e,t){this.comparator=e,this.root=t||Tt.EMPTY}insert(e,t){return new _t(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Tt.BLACK,null,null))}remove(e){return new _t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Tt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Et(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Et(this.root,e,this.comparator,!1)}getReverseIterator(){return new Et(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Et(this.root,e,this.comparator,!0)}}class Et{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Tt{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Tt.RED,this.left=null!=r?r:Tt.EMPTY,this.right=null!=i?i:Tt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Tt(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Tt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Tt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Tt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Tt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw y();if(this.right.isRed())throw y();const e=this.left.check();if(e!==this.right.check())throw y();return e+(this.isRed()?0:1)}}Tt.EMPTY=null,Tt.RED=!0,Tt.BLACK=!1,Tt.EMPTY=new class{constructor(){this.size=0}get key(){throw y()}get value(){throw y()}get color(){throw y()}get left(){throw y()}get right(){throw y()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Tt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class St{constructor(e){this.comparator=e,this.data=new _t(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new It(this.data.getIterator())}getIteratorFrom(e){return new It(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof St))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new St(this.comparator);return t.data=e,t}}class It{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function kt(e){return e.hasNext()?e.getNext():void 0}class At{constructor(e){this.fields=e,e.sort(G.comparator)}static empty(){return new At([])}unionWith(e){let t=new St(G.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new At(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return M(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Ot{constructor(e){this.value=e}static empty(){return new Ot({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ze(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=He(t)}setAll(e){let t=G.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=He(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());ze(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ne(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];ze(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){be(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Ot(He(this.value))}}function xt(e){const t=[];return be(e.fields,((e,n)=>{const r=new G([e]);if(ze(n)){const e=xt(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new At(t)}class Ct{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new Ct(e,0,U.min(),U.min(),U.min(),Ot.empty(),0)}static newFoundDocument(e,t,n,r){return new Ct(e,1,t,U.min(),n,r,0)}static newNoDocument(e,t){return new Ct(e,2,t,U.min(),U.min(),Ot.empty(),0)}static newUnknownDocument(e,t){return new Ct(e,3,t,U.min(),U.min(),Ot.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(U.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ot.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=U.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ct&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ct(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Rt{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ft=null}}function Dt(e,t=null,n=[],r=[],i=null,s=null,a=null){return new Rt(e,t,n,r,i,s,a)}function Lt(e){const t=_(e);if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>function e(t){if(t instanceof nt)return t.field.canonicalString()+t.op.toString()+Ue(t.value);{const n=t.filters.map((t=>e(t))).join(",");return`${t.op}(${n})`}}(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),_e(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Ue(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Ue(e))).join(",")),t.ft=e}return t.ft}function Pt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!wt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!ct(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!et(e.startAt,t.startAt)&&et(e.endAt,t.endAt)}function Nt(e){return K.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Mt(e,t){return e.filters.filter((e=>e instanceof nt&&e.field.isEqual(t)))}function jt(e,t,n){let r=Le,i=!0;for(const n of Mt(e,t)){let e=Le,t=!0;switch(n.op){case"<":case"<=":e=$e(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Le}Qe({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Qe({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Ft(e,t,n){let r=De,i=!0;for(const n of Mt(e,t)){let e=De,t=!0;switch(n.op){case">=":case">":e=Ye(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=De}Xe({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Xe({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Ut{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function Bt(e,t,n,r,i,s,a,o){return new Ut(e,t,n,r,i,s,a,o)}function Vt(e){return new Ut(e)}function qt(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Gt(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Kt(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function zt(e){return null!==e.collectionGroup}function Ht(e){const t=_(e);if(null===t.dt){t.dt=[];const e=Kt(t),n=Gt(t);if(null!==e&&null===n)e.isKeyField()||t.dt.push(new bt(e)),t.dt.push(new bt(G.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.dt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.dt.push(new bt(G.keyField(),e))}}}return t.dt}function Wt(e){const t=_(e);if(!t._t)if("F"===t.limitType)t._t=Dt(t.path,t.collectionGroup,Ht(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of Ht(t)){const t="desc"===n.dir?"asc":"desc";e.push(new bt(n.field,t))}const n=t.endAt?new Je(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Je(t.startAt.position,t.startAt.inclusive):null;t._t=Dt(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function $t(e,t){t.getFirstInequalityField(),Kt(e);const n=e.filters.concat([t]);return new Ut(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Yt(e,t,n){return new Ut(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Qt(e,t){return Pt(Wt(e),Wt(t))&&e.limitType===t.limitType}function Xt(e){return`${Lt(Wt(e))}|lt:${e.limitType}`}function Jt(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>lt(e))).join(", ")}]`),_e(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Ue(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Ue(e))).join(",")),`Target(${t})`}(Wt(e))}; limitType=${e.limitType})`}function Zt(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):K.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ht(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Ze(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Ht(e),t)||e.endAt&&!function(e,t,n){const r=Ze(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Ht(e),t))}(e,t)}function en(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function tn(e){return(t,n)=>{let r=!1;for(const i of Ht(e)){const e=nn(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function nn(e,t,n){const r=e.field.isKeyField()?K.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?je(r,i):y()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return y()}}function rn(e,t){if(e.wt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ee(t)?"-0":t}}function sn(e){return{integerValue:""+e}}function an(e,t){return Te(t)?sn(t):rn(e,t)}class on{constructor(){this._=void 0}}function cn(e,t,n){return e instanceof dn?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof hn?fn(e,t):e instanceof pn?gn(e,t):function(e,t){const n=ln(e,t),r=vn(n)+vn(e.gt);return Ve(n)&&Ve(e.gt)?sn(r):rn(e.yt,r)}(e,t)}function un(e,t,n){return e instanceof hn?fn(e,t):e instanceof pn?gn(e,t):n}function ln(e,t){return e instanceof mn?Ve(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class dn extends on{}class hn extends on{constructor(e){super(),this.elements=e}}function fn(e,t){const n=yn(t);for(const t of e.elements)n.some((e=>Ne(e,t)))||n.push(t);return{arrayValue:{values:n}}}class pn extends on{constructor(e){super(),this.elements=e}}function gn(e,t){let n=yn(t);for(const t of e.elements)n=n.filter((e=>!Ne(e,t)));return{arrayValue:{values:n}}}class mn extends on{constructor(e,t){super(),this.yt=e,this.gt=t}}function vn(e){return Oe(e.integerValue||e.doubleValue)}function yn(e){return qe(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class bn{constructor(e,t){this.field=e,this.transform=t}}class wn{constructor(e,t){this.version=e,this.transformResults=t}}class _n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new _n}static exists(e){return new _n(void 0,e)}static updateTime(e){return new _n(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function En(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Tn{}function Sn(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Pn(e.key,_n.none()):new xn(e.key,e.data,_n.none());{const n=e.data,r=Ot.empty();let i=new St(G.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Cn(e.key,r,new At(i.toArray()),_n.none())}}function In(e,t,n){e instanceof xn?function(e,t,n){const r=e.value.clone(),i=Dn(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Cn?function(e,t,n){if(!En(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Dn(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Rn(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function kn(e,t,n,r){return e instanceof xn?function(e,t,n,r){if(!En(e.precondition,t))return n;const i=e.value.clone(),s=Ln(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Cn?function(e,t,n,r){if(!En(e.precondition,t))return n;const i=Ln(e.fieldTransforms,r,t),s=t.data;return s.setAll(Rn(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return En(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function An(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=ln(r.transform,e||null);null!=i&&(null===n&&(n=Ot.empty()),n.set(r.field,i))}return n||null}function On(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&M(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof hn&&t instanceof hn||e instanceof pn&&t instanceof pn?M(e.elements,t.elements,Ne):e instanceof mn&&t instanceof mn?Ne(e.gt,t.gt):e instanceof dn&&t instanceof dn}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class xn extends Tn{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Cn extends Tn{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Rn(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Dn(e,t,n){const r=new Map;b(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,un(a,o,n[i]))}return r}function Ln(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,cn(e,s,t))}return r}class Pn extends Tn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Nn extends Tn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Mn{constructor(e){this.count=e}}var jn,Fn;function Un(e){switch(e){default:return y();case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0}}function Bn(e){if(void 0===e)return g("GRPC error has no .code"),E.UNKNOWN;switch(e){case jn.OK:return E.OK;case jn.CANCELLED:return E.CANCELLED;case jn.UNKNOWN:return E.UNKNOWN;case jn.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case jn.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case jn.INTERNAL:return E.INTERNAL;case jn.UNAVAILABLE:return E.UNAVAILABLE;case jn.UNAUTHENTICATED:return E.UNAUTHENTICATED;case jn.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case jn.NOT_FOUND:return E.NOT_FOUND;case jn.ALREADY_EXISTS:return E.ALREADY_EXISTS;case jn.PERMISSION_DENIED:return E.PERMISSION_DENIED;case jn.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case jn.ABORTED:return E.ABORTED;case jn.OUT_OF_RANGE:return E.OUT_OF_RANGE;case jn.UNIMPLEMENTED:return E.UNIMPLEMENTED;case jn.DATA_LOSS:return E.DATA_LOSS;default:return y()}}(Fn=jn||(jn={}))[Fn.OK=0]="OK",Fn[Fn.CANCELLED=1]="CANCELLED",Fn[Fn.UNKNOWN=2]="UNKNOWN",Fn[Fn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fn[Fn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fn[Fn.NOT_FOUND=5]="NOT_FOUND",Fn[Fn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fn[Fn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fn[Fn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fn[Fn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fn[Fn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fn[Fn.ABORTED=10]="ABORTED",Fn[Fn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fn[Fn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fn[Fn.INTERNAL=13]="INTERNAL",Fn[Fn.UNAVAILABLE=14]="UNAVAILABLE",Fn[Fn.DATA_LOSS=15]="DATA_LOSS";class Vn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){be(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return we(this.inner)}size(){return this.innerSize}}const qn=new _t(K.comparator);function Gn(){return qn}const Kn=new _t(K.comparator);function zn(...e){let t=Kn;for(const n of e)t=t.insert(n.key,n);return t}function Hn(e){let t=Kn;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Wn(){return Yn()}function $n(){return Yn()}function Yn(){return new Vn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Qn=new _t(K.comparator),Xn=new St(K.comparator);function Jn(...e){let t=Xn;for(const n of e)t=t.add(n);return t}const Zn=new St(N);function er(){return Zn}class tr{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,nr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new tr(U.min(),r,er(),Gn(),Jn())}}class nr{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new nr(n,t,Jn(),Jn(),Jn())}}class rr{constructor(e,t,n,r){this.It=e,this.removedTargetIds=t,this.key=n,this.Tt=r}}class ir{constructor(e,t){this.targetId=e,this.Et=t}}class sr{constructor(e,t,n=Ie.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ar{constructor(){this.At=0,this.Rt=ur(),this.bt=Ie.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=Jn(),t=Jn(),n=Jn();return this.Rt.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:y()}})),new nr(this.bt,this.Pt,e,t,n)}xt(){this.vt=!1,this.Rt=ur()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class or{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=Gn(),this.qt=cr(),this.Ut=new St(N)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,(t=>{const n=this.Wt(t);switch(e.state){case 0:this.zt(t)&&n.Dt(e.resumeToken);break;case 1:n.Mt(),n.Vt||n.xt(),n.Dt(e.resumeToken);break;case 2:n.Mt(),n.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(n.Ft(),n.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),n.Dt(e.resumeToken));break;default:y()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach(((e,n)=>{this.zt(n)&&t(n)}))}Jt(e){const t=e.targetId,n=e.Et.count,r=this.Yt(t);if(r){const e=r.target;if(Nt(e))if(0===n){const n=new K(e.path);this.Qt(t,n,Ct.newNoDocument(n,U.min()))}else b(1===n);else this.Xt(t)!==n&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach(((n,r)=>{const i=this.Yt(r);if(i){if(n.current&&Nt(i.target)){const t=new K(i.target.path);null!==this.Lt.get(t)||this.te(r,t)||this.Qt(r,t,Ct.newNoDocument(t,e))}n.St&&(t.set(r,n.Ct()),n.xt())}}));let n=Jn();this.qt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Yt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Lt.forEach(((t,n)=>n.setReadTime(e)));const r=new tr(e,t,this.Ut,this.Lt,n);return this.Lt=Gn(),this.qt=cr(),this.Ut=new St(N),r}Gt(e,t){if(!this.zt(e))return;const n=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,n),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,n){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),n&&(this.Lt=this.Lt.insert(t,n))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new ar,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new St(N),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||p("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new ar),this.$t.getRemoteKeysForTarget(e).forEach((t=>{this.Qt(e,t,null)}))}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function cr(){return new _t(K.comparator)}function ur(){return new _t(K.comparator)}const lr={asc:"ASCENDING",desc:"DESCENDING"},dr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hr={and:"AND",or:"OR"};class fr{constructor(e,t){this.databaseId=e,this.wt=t}}function pr(e,t){return e.wt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function gr(e,t){return e.wt?t.toBase64():t.toUint8Array()}function mr(e,t){return pr(e,t.toTimestamp())}function vr(e){return b(!!e),U.fromTimestamp(function(e){const t=Ae(e);return new F(t.seconds,t.nanos)}(e))}function yr(e,t){return function(e){return new V(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function br(e){const t=V.fromString(e);return b(Ur(t)),t}function wr(e,t){return yr(e.databaseId,t.path)}function _r(e,t){const n=br(t);if(n.get(1)!==e.databaseId.projectId)throw new T(E.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new T(E.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new K(Ir(n))}function Er(e,t){return yr(e.databaseId,t)}function Tr(e){const t=br(e);return 4===t.length?V.emptyPath():Ir(t)}function Sr(e){return new V(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ir(e){return b(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function kr(e,t,n){return{name:wr(e,t),fields:n.value.mapValue.fields}}function Ar(e,t,n){const r=_r(e,t.name),i=vr(t.updateTime),s=t.createTime?vr(t.createTime):U.min(),a=new Ot({mapValue:{fields:t.fields}}),o=Ct.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Or(e,t){let n;if(t instanceof xn)n={update:kr(e,t.key,t.value)};else if(t instanceof Pn)n={delete:wr(e,t.key)};else if(t instanceof Cn)n={update:kr(e,t.key,t.data),updateMask:Fr(t.fieldMask)};else{if(!(t instanceof Nn))return y();n={verify:wr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof dn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof hn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof pn)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof mn)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw y()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:mr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:y()}(e,t.precondition)),n}function xr(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?_n.updateTime(vr(e.updateTime)):void 0!==e.exists?_n.exists(e.exists):_n.none()}(t.currentDocument):_n.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)b("REQUEST_TIME"===t.setToServerValue),n=new dn;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new hn(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new pn(e)}else"increment"in t?n=new mn(e,t.increment):y();const r=G.fromServerFormat(t.fieldPath);return new bn(r,n)}(e,t))):[];if(t.update){t.update.name;const i=_r(e,t.update.name),s=new Ot({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new At(t.map((e=>G.fromServerFormat(e))))}(t.updateMask);return new Cn(i,s,e,n,r)}return new xn(i,s,n,r)}if(t.delete){const r=_r(e,t.delete);return new Pn(r,n)}if(t.verify){const r=_r(e,t.verify);return new Nn(r,n)}return y()}function Cr(e,t){return{documents:[Er(e,t.path)]}}function Rr(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Er(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Er(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return function e(t){return t instanceof nt?function(e){if("=="===e.op){if(Ke(e.value))return{unaryFilter:{field:Mr(e.field),op:"IS_NAN"}};if(Ge(e.value))return{unaryFilter:{field:Mr(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ke(e.value))return{unaryFilter:{field:Mr(e.field),op:"IS_NOT_NAN"}};if(Ge(e.value))return{unaryFilter:{field:Mr(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Mr(e.field),op:Pr(e.op),value:e.value}}}(t):t instanceof rt?function(t){const n=t.getFilters().map((t=>e(t)));return 1===n.length?n[0]:{compositeFilter:{op:Nr(t.op),filters:n}}}(t):y()}(rt.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Mr(e.field),direction:Lr(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const a=function(e,t){return e.wt||_e(t)?t:{value:t}}(e,t.limit);var o;return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(o=t.startAt).inclusive,values:o.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Dr(e){let t=Tr(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){b(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=jr(e.unaryFilter.field);return nt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=jr(e.unaryFilter.field);return nt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=jr(e.unaryFilter.field);return nt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=jr(e.unaryFilter.field);return nt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return y()}}(t):void 0!==t.fieldFilter?function(e){return nt.create(jr(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return y()}}(e.fieldFilter.op),e.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return rt.create(t.compositeFilter.filters.map((t=>e(t))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return y()}}(t.compositeFilter.op))}(t):y()}(e);return t instanceof rt&&at(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=n.orderBy.map((e=>function(e){return new bt(jr(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,_e(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Je(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Je(n,t)}(n.endAt)),Bt(t,i,a,s,o,"F",c,u)}function Lr(e){return lr[e]}function Pr(e){return dr[e]}function Nr(e){return hr[e]}function Mr(e){return{fieldPath:e.canonicalString()}}function jr(e){return G.fromServerFormat(e.fieldPath)}function Fr(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ur(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Br(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=qr(t)),t=Vr(e.get(n),t);return qr(t)}function Vr(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function qr(e){return e+""}function Gr(e){const t=e.length;if(b(t>=2),2===t)return b(""===e.charAt(0)&&""===e.charAt(1)),V.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&y(),e.charAt(t+1)){case"":const n=e.substring(s,t);let a;0===i.length?a=n:(i+=n,a=i,i=""),r.push(a);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:y()}s=t+2}return new V(r)}const Kr=["userId","batchId"];function zr(e,t){return[e,Br(t)]}function Hr(e,t,n){return[e,Br(t),n]}const Wr={},$r=["prefixPath","collectionGroup","readTime","documentId"],Yr=["prefixPath","collectionGroup","documentId"],Qr=["collectionGroup","readTime","prefixPath","documentId"],Xr=["canonicalId","targetId"],Jr=["targetId","path"],Zr=["path","targetId"],ei=["collectionId","parent"],ti=["indexId","uid"],ni=["uid","sequenceNumber"],ri=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ii=["indexId","uid","orderedDocumentKey"],si=["userId","collectionPath","documentId"],ai=["userId","collectionPath","largestBatchId"],oi=["userId","collectionGroup","largestBatchId"],ci=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ui=[...ci,"documentOverlays"],li=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],di=li,hi=[...di,"indexConfiguration","indexState","indexEntries"];class fi extends te{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function pi(e,t){const n=_(e);return se.M(n.se,t)}class gi{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&In(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=kn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=kn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=$n();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let a=this.applyToLocalView(s,i.mutatedFields);a=t.has(r.key)?null:a;const o=Sn(s,a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(U.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Jn())}isEqual(e){return this.batchId===e.batchId&&M(this.mutations,e.mutations,((e,t)=>On(e,t)))&&M(this.baseMutations,e.baseMutations,((e,t)=>On(e,t)))}}class mi{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){b(e.mutations.length===n.length);let r=Qn;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new mi(e,t,n,r)}}class vi{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class yi{constructor(e,t,n,r,i=U.min(),s=U.min(),a=Ie.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new yi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new yi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new yi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class bi{constructor(e){this.ie=e}}function wi(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:_i(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:wr(e,t.key),fields:t.data.value.mapValue.fields,updateTime:pr(e,t.version.toTimestamp()),createTime:pr(e,t.createTime.toTimestamp())}}(e.ie,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ei(t.version)};else{if(!t.isUnknownDocument())return y();r.unknownDocument={path:n.path.toArray(),version:Ei(t.version)}}return r}function _i(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ei(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Ti(e){const t=new F(e.seconds,e.nanoseconds);return U.fromTimestamp(t)}function Si(e,t){const n=(t.baseMutations||[]).map((t=>xr(e.ie,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>xr(e.ie,t))),i=F.fromMillis(t.localWriteTimeMs);return new gi(t.batchId,i,n,r)}function Ii(e){const t=Ti(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Ti(e.lastLimboFreeSnapshotVersion):U.min();let r;var i;return void 0!==e.query.documents?(b(1===(i=e.query).documents.length),r=Wt(Vt(Tr(i.documents[0])))):r=function(e){return Wt(Dr(e))}(e.query),new yi(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Ie.fromBase64String(e.resumeToken))}function ki(e,t){const n=Ei(t.snapshotVersion),r=Ei(t.lastLimboFreeSnapshotVersion);let i;i=Nt(t.target)?Cr(e.ie,t.target):Rr(e.ie,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Lt(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Ai(e){const t=Dr({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Yt(t,t.limit,"L"):t}function Oi(e,t){return new vi(t.largestBatchId,xr(e.ie,t.overlayMutation))}function xi(e,t){const n=t.path.lastSegment();return[e,Br(t.path.popLast()),n]}function Ci(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Ei(r.readTime),documentKey:Br(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ri{getBundleMetadata(e,t){return Di(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Ti(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return Di(e).put({bundleId:(n=t).id,createTime:Ei(vr(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Li(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Ai(t.bundledQuery),readTime:Ti(t.readTime)};var t}))}saveNamedQuery(e,t){return Li(e).put(function(e){return{name:e.name,readTime:Ei(vr(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function Di(e){return pi(e,"bundles")}function Li(e){return pi(e,"namedQueries")}class Pi{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){const n=t.uid||"";return new Pi(e,n)}getOverlay(e,t){return Ni(e).get(xi(this.userId,t)).next((e=>e?Oi(this.yt,e):null))}getOverlays(e,t){const n=Wn();return re.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new vi(t,i);r.push(this.oe(e,s))})),re.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(Br(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(Ni(e).Y("collectionPathOverlayIndex",r))})),re.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Wn(),i=Br(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Ni(e).W("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Oi(this.yt,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=Wn();let s;const a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ni(e).Z({index:"collectionGroupOverlayIndex",range:a},((e,t,n)=>{const a=Oi(this.yt,t);i.size()<r||a.largestBatchId===s?(i.set(a.getKey(),a),s=a.largestBatchId):n.done()})).next((()=>i))}oe(e,t){return Ni(e).put(function(e,t,n){const[r,i,s]=xi(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Or(e.ie,n.mutation)}}(this.yt,this.userId,t))}}function Ni(e){return pi(e,"documentOverlays")}class Mi{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(Oe(e.integerValue));else if("doubleValue"in e){const n=Oe(e.doubleValue);isNaN(n)?this.he(t,13):(this.he(t,15),Ee(n)?t.le(0):t.le(n))}else if("timestampValue"in e){const n=e.timestampValue;this.he(t,20),"string"==typeof n?t.fe(n):(t.fe(""+(n.seconds||"")),t.le(n.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(xe(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.he(t,45),t.le(n.latitude||0),t.le(n.longitude||0)}else"mapValue"in e?We(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):y()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const n=e.fields||{};this.he(t,55);for(const e of Object.keys(n))this.de(e,t),this.ce(n[e],t)}ye(e,t){const n=e.values||[];this.he(t,50);for(const e of n)this.ce(e,t)}me(e,t){this.he(t,37),K.fromName(e).path.forEach((e=>{this.he(t,60),this.pe(e,t)}))}he(e,t){e.le(t)}_e(e){e.le(2)}}function ji(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Fi(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=ji(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}Mi.Ie=new Mi;class Ui{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ee(n.value),n=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.be(n.value),n=t.next();this.Pe()}ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ee(e);else if(e<2048)this.Ee(960|e>>>6),this.Ee(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e);else{const e=t.codePointAt(0);this.Ee(240|e>>>18),this.Ee(128|63&e>>>12),this.Ee(128|63&e>>>6),this.Ee(128|63&e)}}this.Ae()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.be(e);else if(e<2048)this.be(960|e>>>6),this.be(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.be(480|e>>>12),this.be(128|63&e>>>6),this.be(128|63&e);else{const e=t.codePointAt(0);this.be(240|e>>>18),this.be(128|63&e>>>12),this.be(128|63&e>>>6),this.be(128|63&e)}}this.Pe()}Se(e){const t=this.De(e),n=Fi(t);this.Ce(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}xe(e){const t=this.De(e),n=Fi(t);this.Ce(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class Bi{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class Vi{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class qi{constructor(){this.$e=new Ui,this.Be=new Bi(this.$e),this.Le=new Vi(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Gi{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Gi(this.indexId,this.documentKey,this.arrayValue,n)}}function Ki(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=zi(e.arrayValue,t.arrayValue),0!==n?n:(n=zi(e.directionalValue,t.directionalValue),0!==n?n:K.comparator(e.documentKey,t.documentKey)))}function zi(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Hi{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const e=t;e.isInequality()?this.Qe=e:this.Ge.push(e)}}je(e){b(e.collectionGroup===this.collectionId);const t=H(e);if(void 0!==t&&!this.We(t))return!1;const n=W(e);let r=0,i=0;for(;r<n.length&&this.We(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Qe){const e=n[r];if(!this.ze(this.Qe,e)||!this.He(this.Ke[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ke.length||!this.He(this.Ke[i++],e))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Wi(e){if(0===e.getFilters().length)return[];const t=function e(t){if(b(t instanceof nt||t instanceof rt),t instanceof nt)return t;if(1===t.filters.length)return e(t.filters[0]);const n=t.filters.map((t=>e(t)));let r=rt.create(n,t.op);return r=Zi(r),Qi(r)?r:(b(r instanceof rt),b(it(r)),b(r.filters.length>1),r.filters.reduce(((e,t)=>Xi(e,t))))}(function e(t){var n,r;if(b(t instanceof nt||t instanceof rt),t instanceof nt){if(t instanceof mt){const e=(null===(r=null===(n=t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>nt.create(t.field,"==",e))))||[];return rt.create(e,"or")}return t}const i=t.filters.map((t=>e(t)));return rt.create(i,t.op)}(e));return b(Qi(t)),$i(t)||Yi(t)?[t]:t.getFilters()}function $i(e){return e instanceof nt}function Yi(e){return e instanceof rt&&at(e)}function Qi(e){return $i(e)||Yi(e)||function(e){if(e instanceof rt&&st(e)){for(const t of e.getFilters())if(!$i(t)&&!Yi(t))return!1;return!0}return!1}(e)}function Xi(e,t){let n;return b(e instanceof nt||e instanceof rt),b(t instanceof nt||t instanceof rt),n=e instanceof nt?t instanceof nt?function(e,t){return rt.create([e,t],"and")}(e,t):Ji(e,t):t instanceof nt?Ji(t,e):function(e,t){if(b(e.filters.length>0&&t.filters.length>0),it(e)&&it(t))return ut(e,t.getFilters());const n=st(e)?e:t,r=st(e)?t:e,i=n.filters.map((e=>Xi(e,r)));return rt.create(i,"or")}(e,t),Zi(n)}function Ji(e,t){if(it(t))return ut(t,e.getFilters());{const n=t.filters.map((t=>Xi(e,t)));return rt.create(n,"or")}}function Zi(e){if(b(e instanceof nt||e instanceof rt),e instanceof nt)return e;const t=e.getFilters();if(1===t.length)return Zi(t[0]);if(ot(e))return e;const n=t.map((e=>Zi(e))),r=[];return n.forEach((t=>{t instanceof nt?r.push(t):t instanceof rt&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:rt.create(r,e.op)}class es{constructor(){this.Je=new ts}addToCollectionParentIndex(e,t){return this.Je.add(t),re.resolve()}getCollectionParents(e,t){return re.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return re.resolve()}deleteFieldIndex(e,t){return re.resolve()}getDocumentsMatchingTarget(e,t){return re.resolve(null)}getIndexType(e,t){return re.resolve(0)}getFieldIndexes(e,t){return re.resolve([])}getNextCollectionGroupToUpdate(e){return re.resolve(null)}getMinOffset(e,t){return re.resolve(J.min())}getMinOffsetFromCollectionGroup(e,t){return re.resolve(J.min())}updateCollectionGroup(e,t,n){return re.resolve()}updateIndexEntries(e,t){return re.resolve()}}class ts{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new St(V.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new St(V.comparator)).toArray()}}const ns=new Uint8Array(0);class rs{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new ts,this.Xe=new Vn((e=>Lt(e)),((e,t)=>Pt(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Ye.add(t)}));const i={collectionId:n,parent:Br(r)};return is(e).put(i)}return re.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[j(t),""],!1,!0);return is(e).W(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Gr(r.parent))}return n}))}addFieldIndex(e,t){const n=as(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=os(e);return i.next((e=>{n.put(Ci(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=as(e),r=os(e),i=ss(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=ss(e);let r=!0;const i=new Map;return re.forEach(this.Ze(t),(t=>this.tn(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=Jn();const r=[];return re.forEach(i,((i,s)=>{var a;p("IndexedDbIndexManager",`Using index ${a=i,`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Lt(t)}`);const o=function(e,t){const n=H(t);if(void 0===n)return null;for(const t of Mt(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of W(t))for(const t of Mt(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of W(t)){const t=0===i.kind?jt(e,i.fieldPath,e.startAt):Ft(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new Je(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of W(t)){const t=0===i.kind?Ft(e,i.fieldPath,e.endAt):jt(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new Je(n,r)}(s,i),d=this.en(i,s,u),h=this.en(i,s,l),f=this.nn(i,s,c),g=this.sn(i.indexId,o,d,u.inclusive,h,l.inclusive,f);return re.forEach(g,(i=>n.J(i,t.limit).next((t=>{t.forEach((t=>{const n=K.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return re.resolve(null)}))}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:Wi(rt.create(e.filters,"and")).map((t=>Dt(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.Xe.set(e,t),t)}sn(e,t,n,r,i,s,a){const o=(null!=t?t.length:1)*Math.max(n.length,i.length),c=o/(null!=t?t.length:1),u=[];for(let l=0;l<o;++l){const o=t?this.rn(t[l/c]):ns,d=this.on(e,o,n[l%c],r),h=this.un(e,o,i[l%c],s),f=a.map((t=>this.on(e,o,t,!0)));u.push(...this.createRange(d,h,f))}return u}on(e,t,n,r){const i=new Gi(e,K.empty(),t,n);return r?i:i.Ue()}un(e,t,n,r){const i=new Gi(e,K.empty(),t,n);return r?i.Ue():i}tn(e,t){const n=new Hi(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.je(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.Ze(t);return re.forEach(r,(t=>this.tn(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new St(G.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}cn(e,t){const n=new qi;for(const r of W(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.qe(r.kind);Mi.Ie.ue(e,i)}return n.Fe()}rn(e){const t=new qi;return Mi.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const n=new qi;return Mi.Ie.ue(Be(this.databaseId,t),n.qe(function(e){const t=W(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Fe()}nn(e,t,n){if(null===n)return[];let r=[];r.push(new qi);let i=0;for(const s of W(e)){const e=n[i++];for(const n of r)if(this.hn(t,s.fieldPath)&&qe(e))r=this.ln(r,s,e);else{const t=n.qe(s.kind);Mi.Ie.ue(e,t)}}return this.fn(r)}en(e,t,n){return this.nn(e,t,n.position)}fn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Fe();return t}ln(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new qi;r.seed(n.Fe()),Mi.Ie.ue(e,r.qe(t.kind)),i.push(r)}return i}hn(e,t){return!!e.filters.find((e=>e instanceof nt&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=as(e),r=os(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next((e=>{const t=[];return re.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Y(t.sequenceNumber,new J(Ti(t.readTime),new K(Gr(t.documentKey)),t.largestBatchId)):Y.empty(),r=e.fields.map((([e,t])=>new $(G.fromServerFormat(e),t)));return new z(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:N(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=as(e),i=os(e);return this.dn(e).next((e=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>re.forEach(t,(t=>i.put(Ci(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return re.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?re.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),re.forEach(i,(n=>this._n(e,t,n).next((t=>{const i=this.wn(r,n);return t.isEqual(i)?re.resolve():this.mn(e,r,n,t,i)})))))))}))}gn(e,t,n,r){return ss(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(n,t.key),documentKey:t.key.path.toArray()})}yn(e,t,n,r){return ss(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(n,t.key),t.key.path.toArray()])}_n(e,t,n){const r=ss(e);let i=new St(Ki);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.an(n,t)])},((e,r)=>{i=i.add(new Gi(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}wn(e,t){let n=new St(Ki);const r=this.cn(t,e);if(null==r)return n;const i=H(t);if(null!=i){const s=e.data.field(i.fieldPath);if(qe(s))for(const i of s.arrayValue.values||[])n=n.add(new Gi(t.indexId,e.key,this.rn(i),r))}else n=n.add(new Gi(t.indexId,e.key,ns,r));return n}mn(e,t,n,r,i){p("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),a=t.getIterator();let o=kt(s),c=kt(a);for(;o||c;){let e=!1,t=!1;if(o&&c){const r=n(o,c);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(c),c=kt(a)):t?(i(o),o=kt(s)):(o=kt(s),c=kt(a))}}(r,i,Ki,(r=>{s.push(this.gn(e,t,n,r))}),(r=>{s.push(this.yn(e,t,n,r))})),re.waitFor(s)}dn(e){let t=1;return os(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Ki(e,t))).filter(((e,t,n)=>!t||0!==Ki(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=Ki(i,e),s=Ki(i,t);if(0===n)r[0]=e.Ue();else if(n>0&&s<0)r.push(i),r.push(i.Ue());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.pn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,ns,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,ns,[]];i.push(IDBKeyRange.bound(t,n))}return i}pn(e,t){return Ki(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(cs)}getMinOffset(e,t){return re.mapArray(this.Ze(t),(t=>this.tn(e,t).next((e=>e||y())))).next(cs)}}function is(e){return pi(e,"collectionParents")}function ss(e){return pi(e,"indexEntries")}function as(e){return pi(e,"indexConfiguration")}function os(e){return pi(e,"indexState")}function cs(e){b(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;Z(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new J(t.readTime,t.documentKey,n)}const us={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ls{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ls(e,ls.DEFAULT_COLLECTION_PERCENTILE,ls.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ds(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const c=r.Z({range:a},((e,t,n)=>(o++,n.delete())));s.push(c.next((()=>{b(1===o)})));const u=[];for(const e of n.mutations){const r=Hr(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return re.waitFor(s).next((()=>u))}function hs(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw y();t=e.noDocument}return JSON.stringify(t).length}ls.DEFAULT_COLLECTION_PERCENTILE=10,ls.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ls.DEFAULT=new ls(41943040,ls.DEFAULT_COLLECTION_PERCENTILE,ls.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ls.DISABLED=new ls(-1,0,0);class fs{constructor(e,t,n,r){this.userId=e,this.yt=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static re(e,t,n,r){b(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new fs(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return gs(e).Z({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=ms(e),s=gs(e);return s.add({}).next((a=>{b("number"==typeof a);const o=new gi(a,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Or(e.ie,t))),i=n.mutations.map((t=>Or(e.ie,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.yt,this.userId,o),u=[];let l=new St(((e,t)=>N(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Hr(this.userId,e.key.path,a);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,Wr))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.In[a]=o.keys()})),re.waitFor(u).next((()=>o))}))}lookupMutationBatch(e,t){return gs(e).get(t).next((e=>e?(b(e.userId===this.userId),Si(this.yt,e)):null))}Tn(e,t){return this.In[t]?re.resolve(this.In[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.In[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return gs(e).Z({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(b(t.batchId>=n),i=Si(this.yt,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return gs(e).Z({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return gs(e).W("userMutationsIndex",t).next((e=>e.map((e=>Si(this.yt,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=zr(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return ms(e).Z({range:r},((n,r,s)=>{const[a,o,c]=n,u=Gr(o);if(a===this.userId&&t.path.isEqual(u))return gs(e).get(c).next((e=>{if(!e)throw y();b(e.userId===this.userId),i.push(Si(this.yt,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new St(N);const r=[];return t.forEach((t=>{const i=zr(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=ms(e).Z({range:s},((e,r,i)=>{const[s,a,o]=e,c=Gr(a);s===this.userId&&t.path.isEqual(c)?n=n.add(o):i.done()}));r.push(a)})),re.waitFor(r).next((()=>this.En(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=zr(this.userId,n),s=IDBKeyRange.lowerBound(i);let a=new St(N);return ms(e).Z({range:s},((e,t,i)=>{const[s,o,c]=e,u=Gr(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(c)):i.done()})).next((()=>this.En(e,a)))}En(e,t){const n=[],r=[];return t.forEach((t=>{r.push(gs(e).get(t).next((e=>{if(null===e)throw y();b(e.userId===this.userId),n.push(Si(this.yt,e))})))})),re.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return ds(e.se,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.An(t.batchId)})),re.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return re.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return ms(e).Z({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Gr(e[1]);r.push(t)}else n.done()})).next((()=>{b(0===r.length)}))}))}containsKey(e,t){return ps(e,this.userId,t)}Rn(e){return vs(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function ps(e,t,n){const r=zr(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return ms(e).Z({range:s,X:!0},((e,n,r)=>{const[s,o,c]=e;s===t&&o===i&&(a=!0),r.done()})).next((()=>a))}function gs(e){return pi(e,"mutations")}function ms(e){return pi(e,"documentMutations")}function vs(e){return pi(e,"mutationQueues")}class ys{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new ys(0)}static vn(){return new ys(-1)}}class bs{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next((t=>{const n=new ys(t.highestTargetId);return t.highestTargetId=n.next(),this.Sn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Vn(e).next((e=>U.fromTimestamp(new F(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Vn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Vn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r))))}addTargetData(e,t){return this.Dn(e,t).next((()=>this.Vn(e).next((n=>(n.targetCount+=1,this.Cn(t,n),this.Sn(e,n))))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>ws(e).delete(t.targetId))).next((()=>this.Vn(e))).next((t=>(b(t.targetCount>0),t.targetCount-=1,this.Sn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return ws(e).Z(((s,a)=>{const o=Ii(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))})).next((()=>re.waitFor(i))).next((()=>r))}forEachTarget(e,t){return ws(e).Z(((e,n)=>{const r=Ii(n);t(r)}))}Vn(e){return _s(e).get("targetGlobalKey").next((e=>(b(null!==e),e)))}Sn(e,t){return _s(e).put("targetGlobalKey",t)}Dn(e,t){return ws(e).put(ki(this.yt,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Lt(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ws(e).Z({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=Ii(n);Pt(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Es(e);return t.forEach((t=>{const s=Br(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),re.waitFor(r)}removeMatchingKeys(e,t,n){const r=Es(e);return re.forEach(t,(t=>{const i=Br(t.path);return re.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Es(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Es(e);let i=Jn();return r.Z({range:n,X:!0},((e,t,n)=>{const r=Gr(e[1]),s=new K(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=Br(t.path),r=IDBKeyRange.bound([n],[j(n)],!1,!0);let i=0;return Es(e).Z({index:"documentTargetsIndex",X:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}ne(e,t){return ws(e).get(t).next((e=>e?Ii(e):null))}}function ws(e){return pi(e,"targets")}function _s(e){return pi(e,"targetGlobal")}function Es(e){return pi(e,"targetDocuments")}function Ts([e,t],[n,r]){const i=N(e,n);return 0===i?N(t,r):i}class Ss{constructor(e){this.xn=e,this.buffer=new St(Ts),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ts(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Is{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){p("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ce(e)?p("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ne(e)}await this.Fn(3e5)}))}}class ks{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return re.resolve(ge.at);const n=new Ss(t);return this.$n.forEachTarget(e,(e=>n.On(e.sequenceNumber))).next((()=>this.$n.Ln(e,(e=>n.On(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; disabled"),re.resolve(us)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),us):this.qn(e,t)))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let n,r,i,a,o,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),h()<=s.a.DEBUG&&p("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-l}ms\n\tDetermined least recently used ${r} in `+(o-a)+"ms\n"+`\tRemoved ${i} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),re.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class As{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new ks(e,t)}(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Un(e){let t=0;return this.Ln(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,((e,n)=>t(n)))}addReference(e,t,n){return Os(e,n)}removeReference(e,t,n){return Os(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Os(e,t)}Gn(e,t){return function(e,t){let n=!1;return vs(e).tt((r=>ps(e,r,t).next((e=>(e&&(n=!0),re.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Kn(e,((s,a)=>{if(a<=t){const t=this.Gn(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,U.min()),Es(e).delete([0,Br(s.path)]))))}));r.push(t)}})).next((()=>re.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Os(e,t)}Kn(e,t){const n=Es(e);let r,i=ge.at;return n.Z({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==ge.at&&t(new K(Gr(r)),i),i=a,r=s):i=ge.at})).next((()=>{i!==ge.at&&t(new K(Gr(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Os(e,t){return Es(e).put(function(e,t){return{targetId:0,path:Br(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class xs{constructor(){this.changes=new Vn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ct.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?re.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Cs{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Ps(e).put(n)}removeEntry(e,t,n){return Ps(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],_i(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Qn(e,n))))}getEntry(e,t){let n=Ct.newInvalidDocument(t);return Ps(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ns(t))},((e,r)=>{n=this.jn(t,r)})).next((()=>n))}Wn(e,t){let n={size:0,document:Ct.newInvalidDocument(t)};return Ps(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ns(t))},((e,r)=>{n={document:this.jn(t,r),size:hs(r)}})).next((()=>n))}getEntries(e,t){let n=Gn();return this.zn(e,t,((e,t)=>{const r=this.jn(e,t);n=n.insert(e,r)})).next((()=>n))}Hn(e,t){let n=Gn(),r=new _t(K.comparator);return this.zn(e,t,((e,t)=>{const i=this.jn(e,t);n=n.insert(e,i),r=r.insert(e,hs(t))})).next((()=>({documents:n,Jn:r})))}zn(e,t,n){if(t.isEmpty())return re.resolve();let r=new St(js);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(Ns(r.first()),Ns(r.last())),s=r.getIterator();let a=s.getNext();return Ps(e).Z({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=K.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&js(a,i)<0;)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.j(Ns(a)):r.done()})).next((()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null}))}getAllFromCollection(e,t,n){const r=[t.popLast().toArray(),t.lastSegment(),_i(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ps(e).W(IDBKeyRange.bound(r,i,!0)).next((e=>{let t=Gn();for(const n of e){const e=this.jn(K.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t}))}getAllFromCollectionGroup(e,t,n,r){let i=Gn();const s=Ms(t,n),a=Ms(t,J.max());return Ps(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},((e,t,n)=>{const s=this.jn(K.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Ds(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Ls(e).get("remoteDocumentGlobalKey").next((e=>(b(!!e),e)))}Qn(e,t){return Ls(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Ar(e.ie,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=K.fromSegments(t.noDocument.path),r=Ti(t.noDocument.readTime);n=Ct.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return y();{const e=K.fromSegments(t.unknownDocument.path),r=Ti(t.unknownDocument.version);n=Ct.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new F(e[0],e[1]);return U.fromTimestamp(t)}(t.readTime)),n}(this.yt,t);if(!e.isNoDocument()||!e.version.isEqual(U.min()))return e}return Ct.newInvalidDocument(e)}}function Rs(e){return new Cs(e)}class Ds extends xs{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Vn((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new St(((e,t)=>N(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const a=this.Xn.get(i);if(t.push(this.Yn.removeEntry(e,i,a.readTime)),s.isValidDocument()){const o=wi(this.Yn.yt,s);r=r.add(i.path.popLast());const c=hs(o);n+=c-a.size,t.push(this.Yn.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){const n=wi(this.Yn.yt,s.convertToNoDocument(U.min()));t.push(this.Yn.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Yn.updateMetadata(e,n)),re.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next((e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next((({documents:e,Jn:t})=>(t.forEach(((t,n)=>{this.Xn.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Ls(e){return pi(e,"remoteDocumentGlobal")}function Ps(e){return pi(e,"remoteDocumentsV14")}function Ns(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Ms(e,t){const n=t.documentKey.path.toArray();return[e,_i(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function js(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=N(n[e],r[e]),i)return i;return i=N(n.length,r.length),i||(i=N(n[n.length-2],r[r.length-2]),i||N(n[n.length-1],r[r.length-1]))}class Fs{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Us{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&kn(n.mutation,e,At.empty(),F.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Jn()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Jn()){const r=Wn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=zn();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Wn();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Jn())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=Gn();const s=Yn(),a=Yn();return t.forEach(((e,t)=>{const a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof Cn)?i=i.insert(t.key,t):void 0!==a&&(s.set(t.key,a.mutation.getFieldMask()),kn(a.mutation,t,a.mutation.getFieldMask(),F.now()))})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return a.set(e,new Fs(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),a)))}recalculateAndSaveOverlays(e,t){const n=Yn();let r=new _t(((e,t)=>e-t)),i=Jn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let a=n.get(e)||At.empty();a=i.applyToLocalView(s,a),n.set(e,a);const o=(r.get(i.batchId)||Jn()).add(e);r=r.insert(i.batchId,o)}))})).next((()=>{const s=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,c=r.value,u=$n();c.forEach((e=>{if(!i.has(e)){const r=Sn(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return re.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n){return function(e){return K.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):zt(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):re.resolve(Wn());let a=-1,o=i;return s.next((t=>re.forEach(t,((t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?re.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{o=o.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,o,t,Jn()))).next((e=>({batchId:a,changes:Hn(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next((e=>{let t=zn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n){const r=t.collectionGroup;let i=zn();return this.indexManager.getCollectionParents(e,r).next((s=>re.forEach(s,(s=>{const a=function(e,t){return new Ut(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.getDocumentsMatchingCollectionQuery(e,a,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next((i=>(r=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId)))).next((e=>{e.forEach(((e,t)=>{const n=t.getKey();null===r.get(n)&&(r=r.insert(n,Ct.newInvalidDocument(n)))}));let n=zn();return r.forEach(((r,i)=>{const s=e.get(r);void 0!==s&&kn(s.mutation,i,At.empty(),F.now()),Zt(t,i)&&(n=n.insert(r,i))})),n}))}}class Bs{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return re.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:vr(n.createTime)}),re.resolve()}getNamedQuery(e,t){return re.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(e){return{name:e.name,query:Ai(e.bundledQuery),readTime:vr(e.readTime)}}(t)),re.resolve()}}class Vs{constructor(){this.overlays=new _t(K.comparator),this.es=new Map}getOverlay(e,t){return re.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Wn();return re.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.oe(e,t,r)})),re.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.es.delete(n)),re.resolve()}getOverlaysForCollection(e,t,n){const r=Wn(),i=t.length+1,s=new K(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return re.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new _t(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=Wn(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Wn(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((e,t)=>a.set(e,t))),!(a.size()>=r)););return re.resolve(a)}oe(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new vi(t,n));let i=this.es.get(t);void 0===i&&(i=Jn(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class qs{constructor(){this.ns=new St(Gs.ss),this.rs=new St(Gs.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const n=new Gs(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.cs(new Gs(e,t))}hs(e,t){e.forEach((e=>this.removeReference(e,t)))}ls(e){const t=new K(new V([])),n=new Gs(t,e),r=new Gs(t,e+1),i=[];return this.rs.forEachInRange([n,r],(e=>{this.cs(e),i.push(e.key)})),i}fs(){this.ns.forEach((e=>this.cs(e)))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new K(new V([])),n=new Gs(t,e),r=new Gs(t,e+1);let i=Jn();return this.rs.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Gs(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Gs{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return K.comparator(e.key,t.key)||N(e._s,t._s)}static os(e,t){return N(e._s,t._s)||K.comparator(e.key,t.key)}}class Ks{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new St(Gs.ss)}checkEmpty(e){return re.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new gi(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.gs=this.gs.add(new Gs(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return re.resolve(s)}lookupMutationBatch(e,t){return re.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ps(n),i=r<0?0:r;return re.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return re.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return re.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Gs(t,0),r=new Gs(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],(e=>{const t=this.ys(e._s);i.push(t)})),re.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new St(N);return t.forEach((e=>{const t=new Gs(e,0),r=new Gs(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,r],(e=>{n=n.add(e._s)}))})),re.resolve(this.Is(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;K.isDocumentKey(i)||(i=i.child(""));const s=new Gs(new K(i),0);let a=new St(N);return this.gs.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e._s)),!0)}),s),re.resolve(this.Is(a))}Is(e){const t=[];return e.forEach((e=>{const n=this.ys(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){b(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let n=this.gs;return re.forEach(t.mutations,(r=>{const i=new Gs(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.gs=n}))}An(e){}containsKey(e,t){const n=new Gs(t,0),r=this.gs.firstAfterOrEqual(n);return re.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,re.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class zs{constructor(e){this.Es=e,this.docs=new _t(K.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return re.resolve(n?n.document.mutableCopy():Ct.newInvalidDocument(t))}getEntries(e,t){let n=Gn();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ct.newInvalidDocument(e))})),re.resolve(n)}getAllFromCollection(e,t,n){let r=Gn();const i=new K(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Z(X(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return re.resolve(r)}getAllFromCollectionGroup(e,t,n,r){y()}As(e,t){return re.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Hs(this)}getSize(e){return re.resolve(this.size)}}class Hs extends xs{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(n)})),re.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Ws{constructor(e){this.persistence=e,this.Rs=new Vn((e=>Lt(e)),Pt),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.bs=0,this.Ps=new qs,this.targetCount=0,this.vs=ys.Pn()}forEachTarget(e,t){return this.Rs.forEach(((e,n)=>t(n))),re.resolve()}getLastRemoteSnapshotVersion(e){return re.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return re.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),re.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),re.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new ys(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,re.resolve()}updateTargetData(e,t){return this.Dn(t),re.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,re.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Rs.forEach(((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Rs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),re.waitFor(i).next((()=>r))}getTargetCount(e){return re.resolve(this.targetCount)}getTargetData(e,t){const n=this.Rs.get(t)||null;return re.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),re.resolve()}removeMatchingKeys(e,t,n){this.Ps.hs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),re.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),re.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ps.ds(t);return re.resolve(n)}containsKey(e,t){return re.resolve(this.Ps.containsKey(t))}}class $s{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ge(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Ws(this),this.indexManager=new es,this.remoteDocumentCache=function(e){return new zs(e)}((e=>this.referenceDelegate.xs(e))),this.yt=new bi(t),this.Ns=new Bs(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Vs,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new Ks(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){p("MemoryPersistence","Starting transaction:",e);const r=new Ys(this.Ss.next());return this.referenceDelegate.ks(),n(r).next((e=>this.referenceDelegate.Os(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ms(e,t){return re.or(Object.values(this.Vs).map((n=>()=>n.containsKey(e,t))))}}class Ys extends te{constructor(e){super(),this.currentSequenceNumber=e}}class Qs{constructor(e){this.persistence=e,this.Fs=new qs,this.$s=null}static Bs(e){return new Qs(e)}get Ls(){if(this.$s)return this.$s;throw y()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),re.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),re.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),re.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach((e=>this.Ls.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Ls.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return re.forEach(this.Ls,(n=>{const r=K.fromPath(n);return this.qs(e,r).next((e=>{e||t.removeEntry(r,U.min())}))})).next((()=>(this.$s=null,t.apply(e))))}updateLimboDocument(e,t){return this.qs(e,t).next((e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())}))}xs(e){return 0}qs(e,t){return re.or([()=>re.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class Xs{constructor(e){this.yt=e}$(e,t,n,r){const i=new ie("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Kr,{unique:!0}),e.createObjectStore("documentMutations")}(e),Js(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=re.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),Js(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:U.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").W().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Kr,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return re.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Us(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(i))))),n<7&&r>=7&&(s=s.next((()=>this.Gs(i)))),n<8&&r>=8&&(s=s.next((()=>this.Qs(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.js(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:si});t.createIndex("collectionPathOverlayIndex",ai,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",oi,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:$r});t.createIndex("documentKeyIndex",Yr),t.createIndex("collectionGroupIndex",Qr)}(e))).next((()=>this.Ws(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>this.zs(e,i)))),n<15&&r>=15&&(s=s.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ti}).createIndex("sequenceNumberIndex",ni,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ri}).createIndex("documentKeyIndex",ii,{unique:!1})}(e)))),s}Ks(e){let t=0;return e.store("remoteDocuments").Z(((e,n)=>{t+=hs(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Us(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.W().next((t=>re.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.W("userMutationsIndex",r).next((n=>re.forEach(n,(n=>{b(n.userId===t.userId);const r=Si(this.yt,n);return ds(e,t.userId,r).next((()=>{}))}))))}))))}Gs(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Z(((n,i)=>{const s=new V(n),a=function(e){return[0,Br(e)]}(s);r.push(t.get(a).next((n=>n?re.resolve():(n=>t.put({targetId:0,path:Br(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>re.waitFor(r)))}))}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:ei});const n=t.store("collectionParents"),r=new ts,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Br(r)})}};return t.store("remoteDocuments").Z({X:!0},((e,t)=>{const n=new V(e);return i(n.popLast())})).next((()=>t.store("documentMutations").Z({X:!0},(([e,t,n],r)=>{const s=Gr(t);return i(s.popLast())}))))}js(e){const t=e.store("targets");return t.Z(((e,n)=>{const r=Ii(n),i=ki(this.yt,r);return t.put(i)}))}Ws(e,t){const n=t.store("remoteDocuments"),r=[];return n.Z(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(a=n,a.document?new K(V.fromString(a.document.name).popFirst(5)):a.noDocument?K.fromSegments(a.noDocument.path):a.unknownDocument?K.fromSegments(a.unknownDocument.path):y()).path.toArray();var a;const o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(o))})).next((()=>re.waitFor(r)))}zs(e,t){const n=t.store("mutations"),r=Rs(this.yt),i=new $s(Qs.Bs,this.yt.ie);return n.W().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:Jn();Si(this.yt,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),re.forEach(n,((e,n)=>{const s=new u(n),a=Pi.re(this.yt,s),o=i.getIndexManager(s),c=fs.re(s,this.yt,o,i.referenceDelegate);return new Us(r,c,a,o).recalculateAndSaveOverlaysForDocumentKeys(new fi(t,ge.at),e).next()}))}))}}function Js(e){e.createObjectStore("targetDocuments",{keyPath:Jr}).createIndex("documentTargetsIndex",Zr,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Xr,{unique:!0}),e.createObjectStore("targetGlobal")}const Zs="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ea{constructor(e,t,n,r,i,s,a,o,c,u,l=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=i,this.window=s,this.document=a,this.Js=c,this.Ys=u,this.Xs=l,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!ea.C())throw new T(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new As(this,r),this.ii=t+"main",this.yt=new bi(o),this.ri=new se(this.ii,this.Xs,new Xs(this.yt)),this.Cs=new bs(this.referenceDelegate,this.yt),this.remoteDocumentCache=Rs(this.yt),this.Ns=new Ri,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===u&&g("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new T(E.FAILED_PRECONDITION,Zs);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Cs.getHighestSequenceNumber(e)))})).then((e=>{this.Ss=new ge(e,this.Js)})).then((()=>{this.Ds=!0})).catch((e=>(this.ri&&this.ri.close(),Promise.reject(e))))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((async()=>{this.started&&await this.ui()})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>na(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.fi(e).next((e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable((()=>this.si(!1))))}))})).next((()=>this.di(e))).next((t=>this.isPrimary&&!t?this._i(e).next((()=>!1)):!!t&&this.wi(e).next((()=>!0)))))).catch((e=>{if(ce(e))return p("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return p("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable((()=>this.si(e))),this.isPrimary=e}))}fi(e){return ta(e).get("owner").next((e=>re.resolve(this.mi(e))))}gi(e){return na(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=pi(e,"clientMetadata");return t.W().next((e=>{const n=this.Ii(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return re.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.ui().then((()=>this.yi())).then((()=>this.hi()))))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?re.resolve(!0):ta(e).get("owner").next((t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new T(E.FAILED_PRECONDITION,Zs);return!1}}return!(!this.networkEnabled||!this.inForeground)||na(e).W().next((e=>void 0===this.Ii(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&p("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new fi(e,ge.at);return this._i(t).next((()=>this.gi(t)))})),this.ri.close(),this.Pi()}Ii(e,t){return e.filter((e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId)))}vi(){return this.runTransaction("getActiveClients","readonly",(e=>na(e).W().next((e=>this.Ii(e,18e5).map((e=>e.clientId))))))}get started(){return this.Ds}getMutationQueue(e,t){return fs.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new rs(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Pi.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,n){p("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=15===(s=this.Xs)?hi:14===s?di:13===s?li:12===s?ui:11===s?ci:void y();var s;let a;return this.ri.runTransaction(e,r,i,(r=>(a=new fi(r,this.Ss?this.Ss.next():ge.at),"readwrite-primary"===t?this.fi(a).next((e=>!!e||this.di(a))).next((t=>{if(!t)throw g(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable((()=>this.si(!1))),new T(E.FAILED_PRECONDITION,ee);return n(a)})).next((e=>this.wi(a).next((()=>e)))):this.Vi(a).next((()=>n(a)))))).then((e=>(a.raiseOnCommittedEvent(),e)))}Vi(e){return ta(e).get("owner").next((e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new T(E.FAILED_PRECONDITION,Zs)}))}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ta(e).put("owner",t)}static C(){return se.C()}_i(e){const t=ta(e);return t.get("owner").next((e=>this.mi(e)?(p("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):re.resolve()))}pi(e,t){const n=Date.now();return!(e<n-t||e>n&&(g(`Detected an update time that is in the future: ${e} > ${n}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.ui())))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),Object(a.B)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return p("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return g("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){g("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ta(e){return pi(e,"owner")}function na(e){return pi(e,"clientMetadata")}function ra(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class ia{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=Jn(),r=Jn();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new ia(e,t.fromCache,n,r)}}class sa{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.ki(e,t).next((i=>i||this.Oi(e,t,r,n))).next((n=>n||this.Mi(e,t)))}ki(e,t){if(qt(t))return re.resolve(null);let n=Wt(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Yt(t,null,"F"),n=Wt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Jn(...r);return this.Ni.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Fi(t,r);return this.$i(t,s,i,n.readTime)?this.ki(e,Yt(t,null,"F")):this.Bi(e,s,t,n)}))))})))))}Oi(e,t,n,r){return qt(t)||r.isEqual(U.min())?this.Mi(e,t):this.Ni.getDocuments(e,n).next((i=>{const a=this.Fi(t,i);return this.$i(t,a,n,r)?this.Mi(e,t):(h()<=s.a.DEBUG&&p("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Jt(t)),this.Bi(e,a,t,Q(r,-1)))}))}Fi(e,t){let n=new St(tn(e));return t.forEach(((t,r)=>{Zt(e,r)&&(n=n.add(r))})),n}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Mi(e,t){return h()<=s.a.DEBUG&&p("QueryEngine","Using full collection scan to execute query:",Jt(t)),this.Ni.getDocumentsMatchingQuery(e,t,J.min())}Bi(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class aa{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new _t(N),this.Ui=new Vn((e=>Lt(e)),Pt),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Us(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.qi)))}}function oa(e,t,n,r){return new aa(e,t,n,r)}async function ca(e,t){const n=_(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Qi(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let a=Jn();for(const e of r){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next((e=>({ji:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function ua(e){const t=_(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Cs.getLastRemoteSnapshotVersion(e)))}function la(e,t,n){let r=Jn(),i=Jn();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=Gn();return n.forEach(((n,s)=>{const a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(U.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):p("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),{Wi:r,zi:i}}))}function da(e,t){const n=_(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function ha(e,t){const n=_(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Cs.getTargetData(e,t).next((i=>i?(r=i,re.resolve(r)):n.Cs.allocateTargetId(e).next((i=>(r=new yi(t,i,0,e.currentSequenceNumber),n.Cs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.qi.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qi=n.qi.insert(e.targetId,e),n.Ui.set(t,e.targetId)),e}))}async function fa(e,t,n){const r=_(e),i=r.qi.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!ce(e))throw e;p("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qi=r.qi.remove(t),r.Ui.delete(i.target)}function pa(e,t,n){const r=_(e);let i=U.min(),s=Jn();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=_(e),i=r.Ui.get(n);return void 0!==i?re.resolve(r.qi.get(i)):r.Cs.getTargetData(t,n)}(r,e,Wt(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Li.getDocumentsMatchingQuery(e,t,n?i:U.min(),n?s:Jn()))).next((e=>(va(r,en(t),e),{documents:e,Hi:s})))))}function ga(e,t){const n=_(e),r=_(n.Cs),i=n.qi.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.ne(e,t).next((e=>e?e.target:null))))}function ma(e,t){const n=_(e),r=n.Ki.get(t)||U.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Gi.getAllFromCollectionGroup(e,t,Q(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(va(n,t,e),e)))}function va(e,t,n){let r=e.Ki.get(t)||U.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ki.set(t,r)}async function ya(e,t,n=Jn()){const r=await ha(e,Wt(Ai(t.bundledQuery))),i=_(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=vr(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Ns.saveNamedQuery(e,t);const a=r.withResumeToken(Ie.EMPTY_BYTE_STRING,s);return i.qi=i.qi.insert(a.targetId,a),i.Cs.updateTargetData(e,a).next((()=>i.Cs.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Cs.addMatchingKeys(e,n,r.targetId))).next((()=>i.Ns.saveNamedQuery(e,t)))}))}function ba(e,t){return`firestore_clients_${e}_${t}`}function wa(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+="_"+t.uid),r}function _a(e,t){return`firestore_targets_${e}_${t}`}class Ea{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new T(r.error.code,r.error.message))),s?new Ea(e,t,r.state,i):(g("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ta{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new T(n.error.code,n.error.message))),i?new Ta(e,n.state,r):(g("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Sa{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=er();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Te(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new Sa(e,i):(g("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ia{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ia(t.clientId,t.onlineState):(g("SharedClientState","Failed to parse online state: "+e),null)}}class ka{constructor(){this.activeTargetIds=er()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Aa{constructor(e,t,n,r,i){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new _t(N),this.started=!1,this.cr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=ba(this.persistenceKey,this.sr),this.hr=function(e){return"firestore_sequence_number_"+e}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new ka),this.lr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.wr=function(e){return"firestore_online_state_"+e}(this.persistenceKey),this.mr=function(e){return"firestore_bundle_loaded_v2_"+e}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const t of e){if(t===this.sr)continue;const e=this.getItem(ba(this.persistenceKey,t));if(e){const n=Sa.Zi(t,e);n&&(this.ur=this.ur.insert(n.clientId,n))}}this.gr();const t=this.storage.getItem(this.wr);if(t){const e=this.yr(t);e&&this.pr(e)}for(const e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(_a(this.persistenceKey,e));if(n){const r=Ta.Zi(e,n);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(_a(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Er(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return p("SharedClientState","READ",e,t),t}setItem(e,t){p("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){p("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const t=e;if(t.storageArea===this.storage){if(p("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ar)return void g("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.lr.test(t.key)){if(null==t.newValue){const e=this.vr(t.key);return this.Vr(e,null)}{const e=this.Sr(t.key,t.newValue);if(e)return this.Vr(e.clientId,e)}}else if(this.dr.test(t.key)){if(null!==t.newValue){const e=this.Dr(t.key,t.newValue);if(e)return this.Cr(e)}}else if(this._r.test(t.key)){if(null!==t.newValue){const e=this.Nr(t.key,t.newValue);if(e)return this.kr(e)}}else if(t.key===this.wr){if(null!==t.newValue){const e=this.yr(t.newValue);if(e)return this.pr(e)}}else if(t.key===this.hr){const e=function(e){let t=ge.at;if(null!=e)try{const n=JSON.parse(e);b("number"==typeof n),t=n}catch(e){g("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==ge.at&&this.sequenceNumberHandler(e)}else if(t.key===this.mr){const e=this.Or(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Mr(e))))}}else this.cr.push(t)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new Ea(this.currentUser,e,t,n),i=wa(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}Er(e){const t=wa(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){const t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,n){const r=_a(this.persistenceKey,e),i=new Ta(e,t,n);this.setItem(r,i.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const n=this.vr(e);return Sa.Zi(n,t)}Dr(e,t){const n=this.dr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ea.Zi(new u(i),r,t)}Nr(e,t){const n=this._r.exec(e),r=Number(n[1]);return Ta.Zi(r,t)}yr(e){return Ia.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);p("SharedClientState","Ignoring mutation for non-active user "+e.user.uid)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),i=this.Ir(n),s=[],a=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||a.push(e)})),this.syncEngine.Br(s,a).then((()=>{this.ur=n}))}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=er();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Oa{constructor(){this.Lr=new ka,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new ka,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class xa{Ur(e){}shutdown(){}}class Ca{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){p("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){p("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Ra={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Da{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class La extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,n,r,i){const s=this.ho(e,t);p("RestConnection","Sending: ",s,n);const a={};return this.lo(a,r,i),this.fo(e,s,a,n).then((e=>(p("RestConnection","Received: ",e),e)),(t=>{throw m("RestConnection",e+" failed with error: ",t,"url: ",s,"request:",n),t}))}_o(e,t,n,r,i,s){return this.ao(e,t,n,r,i)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+l,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}ho(e,t){const n=Ra[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,r){return new Promise(((i,s)=>{const a=new o.g;a.setWithCredentials(!0),a.listenOnce(o.c.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case o.a.NO_ERROR:const t=a.getResponseJson();p("Connection","XHR received:",JSON.stringify(t)),i(t);break;case o.a.TIMEOUT:p("Connection",'RPC "'+e+'" timed out'),s(new T(E.DEADLINE_EXCEEDED,"Request time out"));break;case o.a.HTTP_ERROR:const n=a.getStatus();if(p("Connection",'RPC "'+e+'" failed with status:',n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(E).indexOf(t)>=0?t:E.UNKNOWN}(t.status);s(new T(e,t.message))}else s(new T(E.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new T(E.UNAVAILABLE,"Connection failed."));break;default:y()}}finally{p("Connection",'RPC "'+e+'" completed.')}}));const c=JSON.stringify(r);a.send(t,"POST",c,n,15)}))}wo(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Object(o.h)(),s=Object(o.i)(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new o.d({})),this.lo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=r.join("");p("Connection","Creating WebChannel: "+c,a);const u=i.createWebChannel(c,a);let l=!1,d=!1;const h=new Da({Hr:e=>{d?p("Connection","Not sending because WebChannel is closed:",e):(l||(p("Connection","Opening WebChannel transport."),u.open(),l=!0),p("Connection","WebChannel sending:",e),u.send(e))},Jr:()=>u.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,o.f.EventType.OPEN,(()=>{d||p("Connection","WebChannel transport opened.")})),f(u,o.f.EventType.CLOSE,(()=>{d||(d=!0,p("Connection","WebChannel transport closed"),h.io())})),f(u,o.f.EventType.ERROR,(e=>{d||(d=!0,m("Connection","WebChannel transport errored:",e),h.io(new T(E.UNAVAILABLE,"The operation could not be completed")))})),f(u,o.f.EventType.MESSAGE,(e=>{var t;if(!d){const n=e.data[0];b(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){p("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=jn[e];if(void 0!==t)return Bn(t)}(e),n=i.message;void 0===t&&(t=E.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),d=!0,h.io(new T(t,n)),u.close()}else p("Connection","WebChannel received:",n),h.ro(n)}})),f(s,o.b.STAT_EVENT,(e=>{e.stat===o.e.PROXY?p("Connection","Detected buffering proxy"):e.stat===o.e.NOPROXY&&p("Connection","Detected no buffering proxy")})),setTimeout((()=>{h.so()}),0),h}}function Pa(){return"undefined"!=typeof window?window:null}function Na(){return"undefined"!=typeof document?document:null}function Ma(e){return new fr(e,!0)}class ja{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&p("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),e()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Fa{constructor(e,t,n,r,i,s,a,o){this.Hs=e,this.vo=n,this.Vo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new ja(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,(()=>this.$o())))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===E.RESOURCE_EXHAUSTED?(g(t.toString()),g("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===E.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.So===t&&this.Go(e,n)}),(t=>{e((()=>{const e=new T(E.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)}))}))}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr((()=>{n((()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,(()=>(this.ko()&&(this.state=3),Promise.resolve()))),this.listener.Yr())))})),this.stream.Zr((e=>{n((()=>this.Qo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Oo(){this.state=5,this.xo.Ro((async()=>{this.state=0,this.start()}))}Qo(e){return p("PersistentStream","close with error: "+e),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget((()=>this.So===e?t():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ua extends Fa{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.yt=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:y()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.wt?(b(void 0===t||"string"==typeof t),Ie.fromBase64String(t||"")):(b(void 0===t||t instanceof Uint8Array),Ie.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?E.UNKNOWN:Bn(e.code);return new T(t,e.message||"")}(a);n=new sr(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=_r(e,r.document.name),s=vr(r.document.updateTime),a=r.document.createTime?vr(r.document.createTime):U.min(),o=new Ot({mapValue:{fields:r.document.fields}}),c=Ct.newFoundDocument(i,s,a,o),u=r.targetIds||[],l=r.removedTargetIds||[];n=new rr(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=_r(e,r.document),s=r.readTime?vr(r.readTime):U.min(),a=Ct.newNoDocument(i,s),o=r.removedTargetIds||[];n=new rr([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=_r(e,r.document),s=r.removedTargetIds||[];n=new rr([],s,i,null)}else{if(!("filter"in t))return y();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new Mn(r),s=e.targetId;n=new ir(s,i)}}return n}(this.yt,e),n=function(e){if(!("targetChange"in e))return U.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?U.min():t.readTime?vr(t.readTime):U.min()}(e);return this.listener.Wo(t,n)}zo(e){const t={};t.database=Sr(this.yt),t.addTarget=function(e,t){let n;const r=t.target;return n=Nt(r)?{documents:Cr(e,r)}:{query:Rr(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=gr(e,t.resumeToken):t.snapshotVersion.compareTo(U.min())>0&&(n.readTime=pr(e,t.snapshotVersion.toTimestamp())),n}(this.yt,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return y()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.yt,e);n&&(t.labels=n),this.Bo(t)}Ho(e){const t={};t.database=Sr(this.yt),t.removeTarget=e,this.Bo(t)}}class Ba extends Fa{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.yt=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function(e,t){return e&&e.length>0?(b(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?vr(e.updateTime):vr(t);return n.isEqual(U.min())&&(n=vr(t)),new wn(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=vr(e.commitTime);return this.listener.Zo(n,t)}return b(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=Sr(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Or(this.yt,e)))};this.Bo(t)}}class Va extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.yt=r,this.nu=!1}su(){if(this.nu)throw new T(E.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,n){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.ao(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new T(E.UNKNOWN,e.toString())}))}_o(e,t,n,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection._o(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new T(E.UNKNOWN,e.toString())}))}terminate(){this.nu=!0}}class qa{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au("Connection failed 1 times. Most recent error: "+e.toString()),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(g(t),this.ou=!1):p("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class Ga{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.Ur((e=>{n.enqueueAndForget((async()=>{Ja(this)&&(p("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=_(e);t._u.add(4),await za(t),t.gu.set("Unknown"),t._u.delete(4),await Ka(t)}(this))}))})),this.gu=new qa(n,r)}}async function Ka(e){if(Ja(e))for(const t of e.wu)await t(!0)}async function za(e){for(const t of e.wu)await t(!1)}function Ha(e,t){const n=_(e);n.du.has(t.targetId)||(n.du.set(t.targetId,t),Xa(n)?Qa(n):vo(n).ko()&&$a(n,t))}function Wa(e,t){const n=_(e),r=vo(n);n.du.delete(t),r.ko()&&Ya(n,t),0===n.du.size&&(r.ko()?r.Fo():Ja(n)&&n.gu.set("Unknown"))}function $a(e,t){e.yu.Ot(t.targetId),vo(e).zo(t)}function Ya(e,t){e.yu.Ot(t),vo(e).Ho(t)}function Qa(e){e.yu=new or({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ne:t=>e.du.get(t)||null}),vo(e).start(),e.gu.uu()}function Xa(e){return Ja(e)&&!vo(e).No()&&e.du.size>0}function Ja(e){return 0===_(e)._u.size}function Za(e){e.yu=void 0}async function eo(e){e.du.forEach(((t,n)=>{$a(e,t)}))}async function to(e,t){Za(e),Xa(e)?(e.gu.hu(t),Qa(e)):e.gu.set("Unknown")}async function no(e,t,n){if(e.gu.set("Online"),t instanceof sr&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.du.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.du.delete(r),e.yu.removeTarget(r))}(e,t)}catch(n){p("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ro(e,n)}else if(t instanceof rr?e.yu.Kt(t):t instanceof ir?e.yu.Jt(t):e.yu.jt(t),!n.isEqual(U.min()))try{const t=await ua(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.yu.Zt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.du.get(r);i&&e.du.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.du.get(t);if(!n)return;e.du.set(t,n.withResumeToken(Ie.EMPTY_BYTE_STRING,n.snapshotVersion)),Ya(e,t);const r=new yi(n.target,t,1,n.sequenceNumber);$a(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){p("RemoteStore","Failed to raise snapshot:",t),await ro(e,t)}}async function ro(e,t,n){if(!ce(t))throw t;e._u.add(1),await za(e),e.gu.set("Offline"),n||(n=()=>ua(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{p("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await Ka(e)}))}function io(e,t){return t().catch((n=>ro(e,n,t)))}async function so(e){const t=_(e),n=yo(t);let r=t.fu.length>0?t.fu[t.fu.length-1].batchId:-1;for(;ao(t);)try{const e=await da(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId,oo(t,e)}catch(e){await ro(t,e)}co(t)&&uo(t)}function ao(e){return Ja(e)&&e.fu.length<10}function oo(e,t){e.fu.push(t);const n=yo(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}function co(e){return Ja(e)&&!yo(e).No()&&e.fu.length>0}function uo(e){yo(e).start()}async function lo(e){yo(e).eu()}async function ho(e){const t=yo(e);for(const n of e.fu)t.Xo(n.mutations)}async function fo(e,t,n){const r=e.fu.shift(),i=mi.from(r,t,n);await io(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await so(e)}async function po(e,t){t&&yo(e).Yo&&await async function(e,t){if(Un(n=t.code)&&n!==E.ABORTED){const n=e.fu.shift();yo(e).Mo(),await io(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await so(e)}var n}(e,t),co(e)&&uo(e)}async function go(e,t){const n=_(e);n.asyncQueue.verifyOperationInProgress(),p("RemoteStore","RemoteStore received new credentials");const r=Ja(n);n._u.add(3),await za(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await Ka(n)}async function mo(e,t){const n=_(e);t?(n._u.delete(2),await Ka(n)):t||(n._u.add(2),await za(n),n.gu.set("Unknown"))}function vo(e){return e.pu||(e.pu=function(e,t,n){const r=_(e);return r.su(),new Ua(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:eo.bind(null,e),Zr:to.bind(null,e),Wo:no.bind(null,e)}),e.wu.push((async t=>{t?(e.pu.Mo(),Xa(e)?Qa(e):e.gu.set("Unknown")):(await e.pu.stop(),Za(e))}))),e.pu}function yo(e){return e.Iu||(e.Iu=function(e,t,n){const r=_(e);return r.su(),new Ba(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,n)}(e.datastore,e.asyncQueue,{Yr:lo.bind(null,e),Zr:po.bind(null,e),tu:ho.bind(null,e),Zo:fo.bind(null,e)}),e.wu.push((async t=>{t?(e.Iu.Mo(),await so(e)):(await e.Iu.stop(),e.fu.length>0&&(p("RemoteStore",`Stopping write stream with ${e.fu.length} pending writes`),e.fu=[]))}))),e.Iu}class bo{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new S,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new bo(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new T(E.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wo(e,t){if(g("AsyncQueue",`${t}: ${e}`),ce(e))return new T(E.UNAVAILABLE,`${t}: ${e}`);throw e}class _o{constructor(e){this.comparator=e?(t,n)=>e(t,n)||K.comparator(t.key,n.key):(e,t)=>K.comparator(e.key,t.key),this.keyedMap=zn(),this.sortedSet=new _t(this.comparator)}static emptySet(e){return new _o(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof _o))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new _o;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Eo{constructor(){this.Tu=new _t(K.comparator)}track(e){const t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):y():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class To{constructor(e,t,n,r,i,s,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new To(e,t,_o.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Qt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class So{constructor(){this.Au=void 0,this.listeners=[]}}class Io{constructor(){this.queries=new Vn((e=>Xt(e)),Qt),this.onlineState="Unknown",this.Ru=new Set}}async function ko(e,t){const n=_(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new So),i)try{s.Au=await n.onListen(r)}catch(e){const n=wo(e,`Initialization of query '${Jt(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),s.Au&&t.Pu(s.Au)&&Co(n)}async function Ao(e,t){const n=_(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Oo(e,t){const n=_(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Pu(e)&&(r=!0);i.Au=e}}r&&Co(n)}function xo(e,t,n){const r=_(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function Co(e){e.Ru.forEach((e=>{e.next()}))}class Ro{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new To(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Nu||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=To.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Do{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Lo{constructor(e){this.yt=e}Ji(e){return _r(this.yt,e)}Yi(e){return e.metadata.exists?Ar(this.yt,e.document,!1):Ct.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return vr(e)}}class Po{constructor(e,t,n){this.Mu=e,this.localStore=t,this.yt=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=No(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const n=V.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new Lo(this.yt);for(const r of e)if(r.metadata.queries){const e=n.Ji(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Jn()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=_(e);let s=Jn(),a=Gn();for(const e of n){const n=t.Ji(e.metadata.name);e.document&&(s=s.add(n));const r=t.Yi(e);r.setReadTime(t.Xi(e.metadata.readTime)),a=a.insert(n,r)}const o=i.Gi.newChangeBuffer({trackRemovals:!0}),c=await ha(i,function(e){return Wt(Vt(V.fromString("__bundle__/docs/"+e)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>la(e,o,a).next((t=>(o.apply(e),t))).next((t=>i.Cs.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.Cs.addMatchingKeys(e,s,c.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.Wi,t.zi))).next((()=>t.Wi))))))}(this.localStore,new Lo(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const e of this.queries)await ya(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function No(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Mo{constructor(e){this.key=e}}class jo{constructor(e){this.key=e}}class Fo{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=Jn(),this.mutatedKeys=Jn(),this.Gu=tn(e),this.Qu=new _o(this.Gu)}get ju(){return this.qu}Wu(e,t){const n=t?t.zu:new Eo,r=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Zt(this.query,t)?t:null,d=!!u&&this.mutatedKeys.has(u.key),h=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?d!==h&&(n.track({type:3,doc:l}),f=!0):this.Hu(u,l)||(n.track({type:2,doc:l}),f=!0,(o&&this.Gu(l,o)>0||c&&this.Gu(l,c)<0)&&(a=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(o||c)&&(a=!0)),f&&(l?(s=s.add(l),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Qu:s,zu:n,$i:a,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return y()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc))),this.Ju(n);const s=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,o=a!==this.Uu;return this.Uu=a,0!==i.length||o?{snapshot:new To(this.query,e.Qu,r,i,e.mutatedKeys,0===a,o,!1,!!n&&n.resumeToken.approximateByteSize()>0),Xu:s}:{Xu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Eo,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach((e=>this.qu=this.qu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.qu=this.qu.delete(e))),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=Jn(),this.Qu.forEach((e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}));const t=[];return e.forEach((e=>{this.Ku.has(e)||t.push(new jo(e))})),this.Ku.forEach((n=>{e.has(n)||t.push(new Mo(n))})),t}tc(e){this.qu=e.Hi,this.Ku=Jn();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return To.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Uo{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Bo{constructor(e){this.key=e,this.nc=!1}}class Vo{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sc={},this.ic=new Vn((e=>Xt(e)),Qt),this.rc=new Map,this.oc=new Set,this.uc=new _t(K.comparator),this.cc=new Map,this.ac=new qs,this.hc={},this.lc=new Map,this.fc=ys.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}async function qo(e,t){const n=pc(e);let r,i;const s=n.ic.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const e=await ha(n.localStore,Wt(t));n.isPrimaryClient&&Ha(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Go(n,t,r,"current"===s,e.resumeToken)}return i}async function Go(e,t,n,r,i){e._c=(t,n,r)=>async function(e,t,n,r){let i=t.view.Wu(n);i.$i&&(i=await pa(e.localStore,t.query,!1).then((({documents:e})=>t.view.Wu(e,i))));const s=r&&r.targetChanges.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s);return ec(e,t.targetId,a.Xu),a.snapshot}(e,t,n,r);const s=await pa(e.localStore,t,!0),a=new Fo(t,s.Hi),o=a.Wu(s.documents),c=nr.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,c);ec(e,n,u.Xu);const l=new Uo(t,n,a);return e.ic.set(t,l),e.rc.has(n)?e.rc.get(n).push(t):e.rc.set(n,[t]),u.snapshot}async function Ko(e,t){const n=_(e),r=n.ic.get(t),i=n.rc.get(r.targetId);if(i.length>1)return n.rc.set(r.targetId,i.filter((e=>!Qt(e,t)))),void n.ic.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await fa(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Wa(n.remoteStore,r.targetId),Jo(n,r.targetId)})).catch(ne)):(Jo(n,r.targetId),await fa(n.localStore,r.targetId,!0))}async function zo(e,t){const n=_(e);try{const e=await function(e,t){const n=_(e),r=t.snapshotVersion;let i=n.qi;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Gi.newChangeBuffer({trackRemovals:!0});i=n.qi;const a=[];t.targetChanges.forEach(((s,o)=>{const c=i.get(o);if(!c)return;a.push(n.Cs.removeMatchingKeys(e,s.removedDocuments,o).next((()=>n.Cs.addMatchingKeys(e,s.addedDocuments,o))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(o)?u=u.withResumeToken(Ie.EMPTY_BYTE_STRING,U.min()).withLastLimboFreeSnapshotVersion(U.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(o,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&a.push(n.Cs.updateTargetData(e,u))}));let o=Gn(),c=Jn();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),a.push(la(e,s,t.documentUpdates).next((e=>{o=e.Wi,c=e.zi}))),!r.isEqual(U.min())){const t=n.Cs.getLastRemoteSnapshotVersion(e).next((t=>n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,r)));a.push(t)}return re.waitFor(a).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,o,c))).next((()=>o))})).then((e=>(n.qi=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.cc.get(t);r&&(b(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.nc=!0:e.modifiedDocuments.size>0?b(r.nc):e.removedDocuments.size>0&&(b(r.nc),r.nc=!1))})),await rc(n,e,t)}catch(e){await ne(e)}}function Ho(e,t,n){const r=_(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ic.forEach(((n,r)=>{const i=r.view.bu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=_(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.bu(t)&&(r=!0)})),r&&Co(n)}(r.eventManager,t),e.length&&r.sc.Wo(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Wo(e,t,n){const r=_(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.cc.get(t),s=i&&i.key;if(s){let e=new _t(K.comparator);e=e.insert(s,Ct.newNoDocument(s,U.min()));const n=Jn().add(s),i=new tr(U.min(),new Map,new St(N),e,n);await zo(r,i),r.uc=r.uc.remove(s),r.cc.delete(t),nc(r)}else await fa(r.localStore,t,!1).then((()=>Jo(r,t,n))).catch(ne)}async function $o(e,t){const n=_(e),r=t.batch.batchId;try{const e=await function(e,t){const n=_(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let a=re.resolve();return s.forEach((e=>{a=a.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);b(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),a.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Jn();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Xo(n,r,null),Qo(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await rc(n,e)}catch(e){await ne(e)}}async function Yo(e,t,n){const r=_(e);try{const e=await function(e,t){const n=_(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(b(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Xo(r,t,n),Qo(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await rc(r,e)}catch(n){await ne(n)}}function Qo(e,t){(e.lc.get(t)||[]).forEach((e=>{e.resolve()})),e.lc.delete(t)}function Xo(e,t,n){const r=_(e);let i=r.hc[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.hc[r.currentUser.toKey()]=i}}function Jo(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.rc.get(t))e.ic.delete(r),n&&e.sc.wc(r,n);e.rc.delete(t),e.isPrimaryClient&&e.ac.ls(t).forEach((t=>{e.ac.containsKey(t)||Zo(e,t)}))}function Zo(e,t){e.oc.delete(t.path.canonicalString());const n=e.uc.get(t);null!==n&&(Wa(e.remoteStore,n),e.uc=e.uc.remove(t),e.cc.delete(n),nc(e))}function ec(e,t,n){for(const r of n)r instanceof Mo?(e.ac.addReference(r.key,t),tc(e,r)):r instanceof jo?(p("SyncEngine","Document no longer in limbo: "+r.key),e.ac.removeReference(r.key,t),e.ac.containsKey(r.key)||Zo(e,r.key)):y()}function tc(e,t){const n=t.key,r=n.path.canonicalString();e.uc.get(n)||e.oc.has(r)||(p("SyncEngine","New document in limbo: "+n),e.oc.add(r),nc(e))}function nc(e){for(;e.oc.size>0&&e.uc.size<e.maxConcurrentLimboResolutions;){const t=e.oc.values().next().value;e.oc.delete(t);const n=new K(V.fromString(t)),r=e.fc.next();e.cc.set(r,new Bo(n)),e.uc=e.uc.insert(n,r),Ha(e.remoteStore,new yi(Wt(Vt(n.path)),r,2,ge.at))}}async function rc(e,t,n){const r=_(e),i=[],s=[],a=[];r.ic.isEmpty()||(r.ic.forEach(((e,o)=>{a.push(r._c(o,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(o.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=ia.Ci(o.targetId,e);s.push(t)}})))})),await Promise.all(a),r.sc.Wo(i),await async function(e,t){const n=_(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>re.forEach(t,(t=>re.forEach(t.Si,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>re.forEach(t.Di,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!ce(e))throw e;p("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.qi.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.qi=n.qi.insert(t,i)}}}(r.localStore,s))}async function ic(e,t){const n=_(e);if(!n.currentUser.isEqual(t)){p("SyncEngine","User change. New user:",t.toKey());const e=await ca(n.localStore,t);n.currentUser=t,function(e,t){e.lc.forEach((e=>{e.forEach((e=>{e.reject(new T(E.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.lc.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await rc(n,e.ji)}}function sc(e,t){const n=_(e),r=n.cc.get(t);if(r&&r.nc)return Jn().add(r.key);{let e=Jn();const r=n.rc.get(t);if(!r)return e;for(const t of r){const r=n.ic.get(t);e=e.unionWith(r.view.ju)}return e}}async function ac(e,t){const n=_(e),r=await pa(n.localStore,t.query,!0),i=t.view.tc(r);return n.isPrimaryClient&&ec(n,t.targetId,i.Xu),i}async function oc(e,t){const n=_(e);return ma(n.localStore,t).then((e=>rc(n,e)))}async function cc(e,t,n,r){const i=_(e),s=await function(e,t){const n=_(e),r=_(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Tn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):re.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await so(i.remoteStore):"acknowledged"===n||"rejected"===n?(Xo(i,t,r||null),Qo(i,t),function(e,t){_(_(e).mutationQueue).An(t)}(i.localStore,t)):y(),await rc(i,s)):p("SyncEngine","Cannot apply mutation batch with id: "+t)}async function uc(e,t,n){const r=_(e),i=[],s=[];for(const e of t){let t;const n=r.rc.get(e);if(n&&0!==n.length){t=await ha(r.localStore,Wt(n[0]));for(const e of n){const t=r.ic.get(e),n=await ac(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await ga(r.localStore,e);t=await ha(r.localStore,n),await Go(r,lc(n),e,!1,t.resumeToken)}i.push(t)}return r.sc.Wo(s),i}function lc(e){return Bt(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function dc(e){const t=_(e);return _(_(t.localStore).persistence).vi()}async function hc(e,t,n,r){const i=_(e);if(i.dc)return void p("SyncEngine","Ignoring unexpected query state notification.");const s=i.rc.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await ma(i.localStore,en(s[0])),r=tr.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Ie.EMPTY_BYTE_STRING);await rc(i,e,r);break}case"rejected":await fa(i.localStore,t,!0),Jo(i,t,r);break;default:y()}}async function fc(e,t,n){const r=pc(e);if(r.dc){for(const e of t){if(r.rc.has(e)){p("SyncEngine","Adding an already active target "+e);continue}const t=await ga(r.localStore,e),n=await ha(r.localStore,t);await Go(r,lc(t),n.targetId,!1,n.resumeToken),Ha(r.remoteStore,n)}for(const e of n)r.rc.has(e)&&await fa(r.localStore,e,!1).then((()=>{Wa(r.remoteStore,e),Jo(r,e)})).catch(ne)}}function pc(e){const t=_(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=zo.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=sc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Wo.bind(null,t),t.sc.Wo=Oo.bind(null,t.eventManager),t.sc.wc=xo.bind(null,t.eventManager),t}function gc(e){const t=_(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=$o.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Yo.bind(null,t),t}class mc{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=Ma(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return oa(this.persistence,new sa,e.initialUser,this.yt)}yc(e){return new $s(Qs.Bs,this.yt)}gc(e){return new Oa}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class vc extends mc{constructor(e,t,n){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await gc(this.Ac.syncEngine),await so(this.Ac.remoteStore),await this.persistence.li((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}Ic(e){return oa(this.persistence,new sa,e.initialUser,this.yt)}Tc(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Is(n,e.asyncQueue,t)}Ec(e,t){const n=new pe(t,this.persistence);return new fe(e.asyncQueue,n)}yc(e){const t=ra(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ls.withCacheSize(this.cacheSizeBytes):ls.DEFAULT;return new ea(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Pa(),Na(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Oa}}class yc extends vc{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ac.syncEngine;this.sharedClientState instanceof Aa&&(this.sharedClientState.syncEngine={Fr:cc.bind(null,t),$r:hc.bind(null,t),Br:fc.bind(null,t),vi:dc.bind(null,t),Mr:oc.bind(null,t)},await this.sharedClientState.start()),await this.persistence.li((async e=>{await async function(e,t){const n=_(e);if(pc(n),gc(n),!0===t&&!0!==n.dc){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await uc(n,e.toArray());n.dc=!0,await mo(n.remoteStore,!0);for(const e of t)Ha(n.remoteStore,e)}else if(!1===t&&!1!==n.dc){const e=[];let t=Promise.resolve();n.rc.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Jo(n,i),fa(n.localStore,i,!0)))),Wa(n.remoteStore,i)})),await t,await uc(n,e),function(e){const t=_(e);t.cc.forEach(((e,n)=>{Wa(t.remoteStore,n)})),t.ac.fs(),t.cc=new Map,t.uc=new _t(K.comparator)}(n),n.dc=!1,await mo(n.remoteStore,!1)}}(this.Ac.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}gc(e){const t=Pa();if(!Aa.C(t))throw new T(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=ra(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Aa(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class bc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Ho(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ic.bind(null,this.syncEngine),await mo(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Io}createDatastore(e){const t=Ma(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new La(r));var r;return function(e,t,n,r){return new Va(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Ho(this.syncEngine,e,0),s=Ca.C()?new Ca:new xa,new Ga(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new Vo(e,t,n,r,i,s);return a&&(o.dc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=_(e);p("RemoteStore","RemoteStore shutting down."),t._u.add(5),await za(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function wc(e,t,n){if(!n)throw new T(E.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function _c(e,t,n,r){if(!0===t&&!0===r)throw new T(E.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Ec(e){if(!K.isDocumentKey(e))throw new T(E.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Tc(e){if(K.isDocumentKey(e))throw new T(E.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Sc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":y()}function Ic(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new T(E.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Sc(e);throw new T(E.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function kc(e,t){if(t<=0)throw new T(E.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const Ac=new Map;class Oc{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new T(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new T(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,_c("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class xc{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Oc({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new T(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new T(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Oc(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new k;switch(e.type){case"gapi":const t=e.client;return new C(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new T(E.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Ac.get(e);t&&(p("ComponentProvider","Removing Datastore"),Ac.delete(e),t.terminate())}(this),Promise.resolve()}}function Cc(e,t,n,r={}){var i;const s=(e=Ic(e,xc))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&m("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=u.MOCK_USER;else{t=Object(a.i)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new T(E.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new u(s)}e._authCredentials=new A(new I(t,n))}}class Rc{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rc(this.firestore,e,this._key)}}class Dc{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Dc(this.firestore,e,this._query)}}class Lc extends Dc{constructor(e,t,n){super(e,t,Vt(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rc(this.firestore,null,new K(e))}withConverter(e){return new Lc(this.firestore,e,this._path)}}function Pc(e,t,...n){if(e=Object(a.r)(e),wc("collection","path",t),e instanceof xc){const r=V.fromString(t,...n);return Tc(r),new Lc(e,null,r)}{if(!(e instanceof Rc||e instanceof Lc))throw new T(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(V.fromString(t,...n));return Tc(r),new Lc(e.firestore,null,r)}}function Nc(e,t){if(e=Ic(e,xc),wc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new T(E.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Dc(e,null,function(e){return new Ut(V.emptyPath(),e)}(t))}function Mc(e,t,...n){if(e=Object(a.r)(e),1===arguments.length&&(t=P.R()),wc("doc","path",t),e instanceof xc){const r=V.fromString(t,...n);return Ec(r),new Rc(e,null,new K(r))}{if(!(e instanceof Rc||e instanceof Lc))throw new T(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(V.fromString(t,...n));return Ec(r),new Rc(e.firestore,e instanceof Lc?e.converter:null,new K(r))}}function jc(e,t){return e=Object(a.r)(e),t=Object(a.r)(t),(e instanceof Rc||e instanceof Lc)&&(t instanceof Rc||t instanceof Lc)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Fc(e,t){return e=Object(a.r)(e),t=Object(a.r)(t),e instanceof Dc&&t instanceof Dc&&e.firestore===t.firestore&&Qt(e._query,t._query)&&e.converter===t.converter}function Uc(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Bc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):g("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Vc{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new S,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then((e=>{e&&e.Ou()?this.metadata.resolve(e.ku.metadata):this.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==e?void 0:e.ku)))}),(e=>this.metadata.reject(e)))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){const e=await this.Sc();if(null===e)return null;const t=this.vc.decode(e),n=Number(t);isNaN(n)&&this.Dc(`length string (${t}) is not valid number`);const r=await this.Cc(n);return new Do(JSON.parse(r),e.length+n)}xc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(0===this.buffer.length)return null;const e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");const t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error("Invalid bundle format: "+e)}async Nc(){const e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class qc{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new T(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=_(e),r=Sr(n.yt)+"/documents",i={documents:t.map((e=>wr(n.yt,e)))},s=await n._o("BatchGetDocuments",r,i,t.length),a=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){b(!!t.found),t.found.name,t.found.updateTime;const n=_r(e,t.found.name),r=vr(t.found.updateTime),i=t.found.createTime?vr(t.found.createTime):U.min(),s=new Ot({mapValue:{fields:t.found.fields}});return Ct.newFoundDocument(n,r,i,s)}(e,t):"missing"in t?function(e,t){b(!!t.missing),b(!!t.readTime);const n=_r(e,t.missing),r=vr(t.readTime);return Ct.newNoDocument(n,r)}(e,t):y()}(n.yt,e);a.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=a.get(e.toString());b(!!t),o.push(t)})),o}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Pn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=K.fromPath(t);this.mutations.push(new Nn(n,this.precondition(n)))})),await async function(e,t){const n=_(e),r=Sr(n.yt)+"/documents",i={writes:t.map((e=>Or(n.yt,e)))};await n.ao("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw y();t=U.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new T(E.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(U.min())?_n.exists(!1):_n.updateTime(t):_n.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(U.min()))throw new T(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return _n.updateTime(t)}return _n.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Gc{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.kc=n.maxAttempts,this.xo=new ja(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro((async()=>{const e=new qc(this.datastore),t=this.Mc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Fc(e)}))))})).catch((e=>{this.Fc(e)}))}))}Mc(e){try{const t=this.updateFunction(e);return!_e(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget((()=>(this.Oc(),Promise.resolve())))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Un(t)}return!1}}class Kc{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=u.UNAUTHENTICATED,this.clientId=P.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{p("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(p("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new T(E.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new S;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=wo(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function zc(e,t){e.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await ca(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function Hc(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Wc(e);p("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>go(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>go(t.remoteStore,n))),e.onlineComponents=t}async function Wc(e){return e.offlineComponents||(p("FirestoreClient","Using default OfflineComponentProvider"),await zc(e,new mc)),e.offlineComponents}async function $c(e){return e.onlineComponents||(p("FirestoreClient","Using default OnlineComponentProvider"),await Hc(e,new bc)),e.onlineComponents}function Yc(e){return Wc(e).then((e=>e.persistence))}function Qc(e){return Wc(e).then((e=>e.localStore))}function Xc(e){return $c(e).then((e=>e.remoteStore))}function Jc(e){return $c(e).then((e=>e.syncEngine))}function Zc(e){return $c(e).then((e=>e.datastore))}async function eu(e){const t=await $c(e),n=t.eventManager;return n.onListen=qo.bind(null,t.syncEngine),n.onUnlisten=Ko.bind(null,t.syncEngine),n}function tu(e,t,n={}){const r=new S;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Bc({next:s=>{t.enqueueAndForget((()=>Ao(e,a)));const o=s.docs.has(n);!o&&s.fromCache?i.reject(new T(E.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&s.fromCache&&r&&"server"===r.source?i.reject(new T(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),a=new Ro(Vt(n.path),s,{includeMetadataChanges:!0,Nu:!0});return ko(e,a)}(await eu(e),e.asyncQueue,t,n,r))),r.promise}function nu(e,t,n={}){const r=new S;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Bc({next:n=>{t.enqueueAndForget((()=>Ao(e,a))),n.fromCache&&"server"===r.source?i.reject(new T(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new Ro(n,s,{includeMetadataChanges:!0,Nu:!0});return ko(e,a)}(await eu(e),e.asyncQueue,t,n,r))),r.promise}function ru(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new Vc(e,t)}(function(e,t){if(e instanceof Uint8Array)return Uc(e,t);if(e instanceof ArrayBuffer)return Uc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Ma(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=_(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=_(e),r=vr(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Ns.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(No(r));const i=new Po(r,e.localStore,t.yt);let s=await t.mc();for(;s;){const e=await i.Fu(s);e&&n._updateProgress(e),s=await t.mc()}const a=await i.complete();return await rc(e,a.Lu,void 0),await function(e,t){const n=_(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Ns.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(a.progress),Promise.resolve(a.Bu)}catch(e){return m("SyncEngine","Loading bundle failed with "+e),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await Jc(e),i,r)}))}class iu{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new ja(this,"async_queue_retry"),this.Wc=()=>{const e=Na();e&&p("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.Po()};const e=Na();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=Na();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise((()=>{}));const t=new S;return this.Hc((()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Lc.push(e),this.Jc())))}async Jc(){if(0!==this.Lc.length){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!ce(e))throw e;p("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro((()=>this.Jc()))}}Hc(e){const t=this.Bc.then((()=>(this.Gc=!0,e().catch((e=>{throw this.Kc=e,this.Gc=!1,g("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e})).then((e=>(this.Gc=!1,e))))));return this.Bc=t,t}enqueueAfterDelay(e,t,n){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=bo.createAndSchedule(this,e,t,n,(e=>this.Yc(e)));return this.Uc.push(r),r}zc(){this.Kc&&y()}verifyOperationInProgress(){}async Xc(){let e;do{e=this.Bc,await e}while(e!==this.Bc)}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then((()=>{this.Uc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()}))}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function su(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class au{constructor(){this._progressObserver={},this._taskCompletionResolver=new S,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const ou=-1;class cu extends xc{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new iu,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||lu(this),this._firestoreClient.terminate()}}function uu(e){return e._firestoreClient||lu(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function lu(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new me(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Kc(e._authCredentials,e._appCheckCredentials,e._queue,r)}function du(e,t){wu(e=Ic(e,cu));const n=uu(e),r=e._freezeSettings(),i=new bc;return fu(n,i,new vc(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function hu(e){wu(e=Ic(e,cu));const t=uu(e),n=e._freezeSettings(),r=new bc;return fu(t,r,new yc(r,n.cacheSizeBytes))}function fu(e,t,n){const r=new S;return e.asyncQueue.enqueue((async()=>{try{await zc(e,n),await Hc(e,t),r.resolve()}catch(e){const t=e;if(!function(e){return"FirebaseError"===e.name?e.code===E.FAILED_PRECONDITION||e.code===E.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(t))throw t;m("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}})).then((()=>r.promise))}function pu(e){if(e._initialized&&!e._terminated)throw new T(E.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new S;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!se.C())return Promise.resolve();const t=e+"main";await se.delete(t)}(ra(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function gu(e){return function(e){const t=new S;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=_(e);Ja(n.remoteStore)||p("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=_(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.lc.get(e)||[];r.push(t),n.lc.set(e,r)}catch(e){const n=wo(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Jc(e),t))),t.promise}(uu(e=Ic(e,cu)))}function mu(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Yc(e),n=await Xc(e);return t.setNetworkEnabled(!0),function(e){const t=_(e);return t._u.delete(0),Ka(t)}(n)}))}(uu(e=Ic(e,cu)))}function vu(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Yc(e),n=await Xc(e);return t.setNetworkEnabled(!1),async function(e){const t=_(e);t._u.add(0),await za(t),t.gu.set("Offline")}(n)}))}(uu(e=Ic(e,cu)))}function yu(e,t){const n=uu(e=Ic(e,cu)),r=new au;return ru(n,e._databaseId,t,r),r}function bu(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=_(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.Ns.getNamedQuery(e,t)))}(await Qc(e),t)))}(uu(e=Ic(e,cu)),t).then((t=>t?new Dc(e,null,t.query):null))}function wu(e){if(e._initialized||e._terminated)throw new T(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class _u{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _u(Ie.fromBase64String(e))}catch(e){throw new T(E.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new _u(Ie.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Eu{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new T(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new G(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Tu{constructor(e){this._methodName=e}}class Su{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new T(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new T(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return N(this._lat,e._lat)||N(this._long,e._long)}}const Iu=/^__.*__$/;class ku{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Cn(e,this.data,this.fieldMask,t,this.fieldTransforms):new xn(e,this.data,t,this.fieldTransforms)}}class Au{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Cn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ou(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw y()}}class xu{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.yt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new xu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.ua(e),r}ca(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:n,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Yu(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Ou(this.sa)&&Iu.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class Cu{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=n||Ma(e)}da(e,t,n,r=!1){return new xu({sa:e,methodName:t,fa:n,path:G.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Ru(e){const t=e._freezeSettings(),n=Ma(e._databaseId);return new Cu(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Du(e,t,n,r,i,s={}){const a=e.da(s.merge||s.mergeFields?2:0,t,n,i);zu("Data must be an object, but it was:",a,r);const o=Gu(r,a);let c,u;if(s.merge)c=new At(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Hu(t,r,n);if(!a.contains(i))throw new T(E.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Qu(e,i)||e.push(i)}c=new At(e),u=a.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=a.fieldTransforms;return new ku(new Ot(o),c,u)}class Lu extends Tu{_toFieldTransform(e){if(2!==e.sa)throw 1===e.sa?e.ha(this._methodName+"() can only appear at the top level of your update data"):e.ha(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Lu}}function Pu(e,t,n){return new xu({sa:3,fa:t.settings.fa,methodName:e._methodName,oa:n},t.databaseId,t.yt,t.ignoreUndefinedProperties)}class Nu extends Tu{_toFieldTransform(e){return new bn(e.path,new dn)}isEqual(e){return e instanceof Nu}}class Mu extends Tu{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Pu(this,e,!0),n=this._a.map((e=>qu(e,t))),r=new hn(n);return new bn(e.path,r)}isEqual(e){return this===e}}class ju extends Tu{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Pu(this,e,!0),n=this._a.map((e=>qu(e,t))),r=new pn(n);return new bn(e.path,r)}isEqual(e){return this===e}}class Fu extends Tu{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new mn(e.yt,an(e.yt,this.wa));return new bn(e.path,t)}isEqual(e){return this===e}}function Uu(e,t,n,r){const i=e.da(1,t,n);zu("Data must be an object, but it was:",i,r);const s=[],o=Ot.empty();be(r,((e,r)=>{const c=$u(t,e,n);r=Object(a.r)(r);const u=i.ca(c);if(r instanceof Lu)s.push(c);else{const e=qu(r,u);null!=e&&(s.push(c),o.set(c,e))}}));const c=new At(s);return new Au(o,c,i.fieldTransforms)}function Bu(e,t,n,r,i,s){const o=e.da(1,t,n),c=[Hu(t,r,n)],u=[i];if(s.length%2!=0)throw new T(E.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)c.push(Hu(t,s[e])),u.push(s[e+1]);const l=[],d=Ot.empty();for(let e=c.length-1;e>=0;--e)if(!Qu(l,c[e])){const t=c[e];let n=u[e];n=Object(a.r)(n);const r=o.ca(t);if(n instanceof Lu)l.push(t);else{const e=qu(n,r);null!=e&&(l.push(t),d.set(t,e))}}const h=new At(l);return new Au(d,h,o.fieldTransforms)}function Vu(e,t,n,r=!1){return qu(n,e.da(r?4:3,t))}function qu(e,t){if(Ku(e=Object(a.r)(e)))return zu("Unsupported field value:",t,e),Gu(e,t);if(e instanceof Tu)return function(e,t){if(!Ou(t.sa))throw t.ha(e._methodName+"() can only be used with update() and set()");if(!t.path)throw t.ha(e._methodName+"() is not currently supported inside arrays");const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.oa&&4!==t.sa)throw t.ha("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=qu(i,t.aa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=Object(a.r)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return an(t.yt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=F.fromDate(e);return{timestampValue:pr(t.yt,n)}}if(e instanceof F){const n=new F(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:pr(t.yt,n)}}if(e instanceof Su)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof _u)return{bytesValue:gr(t.yt,e._byteString)};if(e instanceof Rc){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:yr(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ha("Unsupported field value: "+Sc(e))}(e,t)}function Gu(e,t){const n={};return we(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):be(e,((e,r)=>{const i=qu(r,t.ra(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Ku(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof F||e instanceof Su||e instanceof _u||e instanceof Rc||e instanceof Tu)}function zu(e,t,n){if(!Ku(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Sc(n);throw"an object"===r?t.ha(e+" a custom object"):t.ha(e+" "+r)}}function Hu(e,t,n){if((t=Object(a.r)(t))instanceof Eu)return t._internalPath;if("string"==typeof t)return $u(e,t);throw Yu("Field path arguments must be of type string or ",e,!1,void 0,n)}const Wu=new RegExp("[~\\*/\\[\\]]");function $u(e,t,n){if(t.search(Wu)>=0)throw Yu(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Eu(...t.split("."))._internalPath}catch(r){throw Yu(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Yu(e,t,n,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=" in field "+r),a&&(c+=" in document "+i),c+=")"),new T(E.INVALID_ARGUMENT,o+e+c)}function Qu(e,t){return e.some((e=>e.isEqual(t)))}class Xu{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Rc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ju(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Zu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ju extends Xu{data(){return super.data()}}function Zu(e,t){return"string"==typeof t?$u(e,t):t instanceof Eu?t._internalPath:t._delegate._internalPath}function el(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new T(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tl{}class nl extends tl{}function rl(e,t,...n){let r=[];t instanceof tl&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof al)).length,n=e.filter((e=>e instanceof il)).length;if(t>1||t>0&&n>0)throw new T(E.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class il extends nl{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new il(e,t,n)}_apply(e){const t=this._parse(e);return _l(e._query,t),new Dc(e.firestore,e.converter,$t(e._query,t))}_parse(e){const t=Ru(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new T(E.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){wl(a,s);const t=[];for(const n of a)t.push(bl(r,e,n));o={arrayValue:{values:t}}}else o=bl(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||wl(a,s),o=Vu(n,"where",a,"in"===s||"not-in"===s);return nt.create(i,s,o)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function sl(e,t,n){const r=t,i=Zu("where",e);return il._create(i,r,n)}class al extends tl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new al(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:rt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)_l(n,e),n=$t(n,e)}(e._query,t),new Dc(e.firestore,e.converter,$t(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ol extends nl{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ol(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new T(E.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new T(E.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new bt(t,n);return function(e,t){if(null===Gt(e)){const n=Kt(e);null!==n&&El(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new Dc(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Ut(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function cl(e,t="asc"){const n=t,r=Zu("orderBy",e);return ol._create(r,n)}class ul extends nl{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ul(e,t,n)}_apply(e){return new Dc(e.firestore,e.converter,Yt(e._query,this._limit,this._limitType))}}function ll(e){return kc("limit",e),ul._create("limit",e,"F")}function dl(e){return kc("limitToLast",e),ul._create("limitToLast",e,"L")}class hl extends nl{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new hl(e,t,n)}_apply(e){const t=yl(e,this.type,this._docOrFields,this._inclusive);return new Dc(e.firestore,e.converter,function(e,t){return new Ut(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function fl(...e){return hl._create("startAt",e,!0)}function pl(...e){return hl._create("startAfter",e,!1)}class gl extends nl{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new gl(e,t,n)}_apply(e){const t=yl(e,this.type,this._docOrFields,this._inclusive);return new Dc(e.firestore,e.converter,function(e,t){return new Ut(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function ml(...e){return gl._create("endBefore",e,!1)}function vl(...e){return gl._create("endAt",e,!0)}function yl(e,t,n,r){if(n[0]=Object(a.r)(n[0]),n[0]instanceof Xu)return function(e,t,n,r,i){if(!r)throw new T(E.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Ht(e))if(n.field.isKeyField())s.push(Be(t,r.key));else{const e=r.data.field(n.field);if(Ce(e))throw new T(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new T(E.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Je(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Ru(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new T(E.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let s=0;s<i.length;s++){const c=i[s];if(a[s].field.isKeyField()){if("string"!=typeof c)throw new T(E.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!zt(e)&&-1!==c.indexOf("/"))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(V.fromString(c));if(!K.isDocumentKey(n))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new K(n);o.push(Be(t,i))}else{const e=Vu(n,r,c);o.push(e)}}return new Je(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function bl(e,t,n){if("string"==typeof(n=Object(a.r)(n))){if(""===n)throw new T(E.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zt(t)&&-1!==n.indexOf("/"))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(V.fromString(n));if(!K.isDocumentKey(r))throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Be(e,new K(r))}if(n instanceof Rc)return Be(e,n._key);throw new T(E.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Sc(n)}.`)}function wl(e,t){if(!Array.isArray(e)||0===e.length)throw new T(E.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new T(E.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function _l(e,t){if(t.isInequality()){const n=Kt(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new T(E.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);const i=Gt(e);null!==i&&El(e,r,i)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new T(E.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new T(E.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function El(e,t,n){if(!n.isEqual(t))throw new T(E.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Tl{convertValue(e,t="none"){switch(Pe(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Oe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(xe(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw y()}}convertObject(e,t){const n={};return be(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Su(Oe(e.latitude),Oe(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=function e(t){const n=t.mapValue.fields.__previous_value__;return Ce(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Re(e));default:return null}}convertTimestamp(e){const t=Ae(e);return new F(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=V.fromString(e);b(Ur(n));const r=new ve(n.get(1),n.get(3)),i=new K(n.popFirst(5));return r.isEqual(t)||g(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Sl(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Il extends Tl{constructor(e){super(),this.firestore=e}convertBytes(e){return new _u(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rc(this.firestore,null,t)}}class kl{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Al extends Xu{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ol(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Zu("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Ol extends Al{data(e={}){return super.data(e)}}class xl{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new kl(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Ol(this._firestore,this._userDataWriter,n.key,n,new kl(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new T(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Ol(e._firestore,e._userDataWriter,n.doc.key,n.doc,new kl(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Ol(e._firestore,e._userDataWriter,t.doc.key,t.doc,new kl(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Cl(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Cl(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return y()}}function Rl(e,t){return e instanceof Al&&t instanceof Al?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof xl&&t instanceof xl&&e._firestore===t._firestore&&Fc(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Dl(e){e=Ic(e,Rc);const t=Ic(e.firestore,cu);return tu(uu(t),e._key).then((n=>Hl(t,e,n)))}class Ll extends Tl{constructor(e){super(),this.firestore=e}convertBytes(e){return new _u(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rc(this.firestore,null,t)}}function Pl(e){e=Ic(e,Rc);const t=Ic(e.firestore,cu),n=uu(t),r=new Ll(t);return function(e,t){const n=new S;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=_(e);return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new T(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=wo(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Qc(e),t,n))),n.promise}(n,e._key).then((n=>new Al(t,r,e._key,n,new kl(null!==n&&n.hasLocalMutations,!0),e.converter)))}function Nl(e){e=Ic(e,Rc);const t=Ic(e.firestore,cu);return tu(uu(t),e._key,{source:"server"}).then((n=>Hl(t,e,n)))}function Ml(e){e=Ic(e,Dc);const t=Ic(e.firestore,cu),n=uu(t),r=new Ll(t);return el(e._query),nu(n,e._query).then((n=>new xl(t,r,e,n)))}function jl(e){e=Ic(e,Dc);const t=Ic(e.firestore,cu),n=uu(t),r=new Ll(t);return function(e,t){const n=new S;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await pa(e,t,!0),i=new Fo(t,r.Hi),s=i.Wu(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(e){const r=wo(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Qc(e),t,n))),n.promise}(n,e._query).then((n=>new xl(t,r,e,n)))}function Fl(e){e=Ic(e,Dc);const t=Ic(e.firestore,cu),n=uu(t),r=new Ll(t);return nu(n,e._query,{source:"server"}).then((n=>new xl(t,r,e,n)))}function Ul(e,t,n){e=Ic(e,Rc);const r=Ic(e.firestore,cu),i=Sl(e.converter,t,n);return zl(r,[Du(Ru(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,_n.none())])}function Bl(e,t,n,...r){e=Ic(e,Rc);const i=Ic(e.firestore,cu),s=Ru(i);let o;return o="string"==typeof(t=Object(a.r)(t))||t instanceof Eu?Bu(s,"updateDoc",e._key,t,n,r):Uu(s,"updateDoc",e._key,t),zl(i,[o.toMutation(e._key,_n.exists(!0))])}function Vl(e){return zl(Ic(e.firestore,cu),[new Pn(e._key,_n.none())])}function ql(e,t){const n=Ic(e.firestore,cu),r=Mc(e),i=Sl(e.converter,t);return zl(n,[Du(Ru(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,_n.exists(!1))]).then((()=>r))}function Gl(e,...t){var n,r,i;e=Object(a.r)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||su(t[o])||(s=t[o],o++);const c={includeMetadataChanges:s.includeMetadataChanges};if(su(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let u,l,d;if(e instanceof Rc)l=Ic(e.firestore,cu),d=Vt(e._key.path),u={next:n=>{t[o]&&t[o](Hl(l,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Ic(e,Dc);l=Ic(n.firestore,cu),d=n._query;const r=new Ll(l);u={next:e=>{t[o]&&t[o](new xl(l,r,n,e))},error:t[o+1],complete:t[o+2]},el(e._query)}return function(e,t,n,r){const i=new Bc(r),s=new Ro(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>ko(await eu(e),s))),()=>{i.bc(),e.asyncQueue.enqueueAndForget((async()=>Ao(await eu(e),s)))}}(uu(l),d,c,u)}function Kl(e,t){return function(e,t){const n=new Bc(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){_(e).Ru.add(t),t.next()}(await eu(e),n))),()=>{n.bc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){_(e).Ru.delete(t)}(await eu(e),n)))}}(uu(e=Ic(e,cu)),su(t)?t:{next:t})}function zl(e,t){return function(e,t){const n=new S;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=gc(e);try{const e=await function(e,t){const n=_(e),r=F.now(),i=t.reduce(((e,t)=>e.add(t.key)),Jn());let s,a;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let o=Gn(),c=Jn();return n.Gi.getEntries(e,i).next((e=>{o=e,o.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,o))).next((i=>{s=i;const a=[];for(const e of t){const t=An(e,s.get(e.key).overlayedDocument);null!=t&&a.push(new Cn(e.key,t,xt(t.value.mapValue),_n.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,a,t)})).next((t=>{a=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:a.batchId,changes:Hn(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.hc[e.currentUser.toKey()];r||(r=new _t(N)),r=r.insert(t,n),e.hc[e.currentUser.toKey()]=r}(r,e.batchId,n),await rc(r,e.changes),await so(r.remoteStore)}catch(e){const t=wo(e,"Failed to persist write");n.reject(t)}}(await Jc(e),t,n))),n.promise}(uu(e),t)}function Hl(e,t,n){const r=n.docs.get(t._key),i=new Ll(e);return new Al(e,i,t._key,r,new kl(n.hasPendingWrites,n.fromCache),t.converter)}const Wl={maxAttempts:5};class $l{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ru(e)}set(e,t,n){this._verifyNotCommitted();const r=Yl(e,this._firestore),i=Sl(r.converter,t,n),s=Du(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,_n.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Yl(e,this._firestore);let s;return s="string"==typeof(t=Object(a.r)(t))||t instanceof Eu?Bu(this._dataReader,"WriteBatch.update",i._key,t,n,r):Uu(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,_n.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Yl(e,this._firestore);return this._mutations=this._mutations.concat(new Pn(t._key,_n.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new T(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Yl(e,t){if((e=Object(a.r)(e)).firestore!==t)throw new T(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Ql extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ru(e)}get(e){const t=Yl(e,this._firestore),n=new Il(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return y();const r=e[0];if(r.isFoundDocument())return new Xu(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Xu(this._firestore,n,t._key,null,t.converter);throw y()}))}set(e,t,n){const r=Yl(e,this._firestore),i=Sl(r.converter,t,n),s=Du(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Yl(e,this._firestore);let s;return s="string"==typeof(t=Object(a.r)(t))||t instanceof Eu?Bu(this._dataReader,"Transaction.update",i._key,t,n,r):Uu(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Yl(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Yl(e,this._firestore),n=new Ll(this._firestore);return super.get(e).then((e=>new Al(this._firestore,n,t._key,e._document,new kl(!1,!1),t.converter)))}}function Xl(e,t,n){e=Ic(e,cu);const r=Object.assign(Object.assign({},Wl),n);return function(e){if(e.maxAttempts<1)throw new T(E.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new S;return e.asyncQueue.enqueueAndForget((async()=>{const i=await Zc(e);new Gc(e.asyncQueue,i,n,t,r).run()})),r.promise}(uu(e),(n=>t(new Ql(e,n))),r)}function Jl(){return new Lu("deleteField")}function Zl(){return new Nu("serverTimestamp")}function ed(...e){return new Mu("arrayUnion",e)}function td(...e){return new ju("arrayRemove",e)}function nd(e){return new Fu("increment",e)}!function(e,t=!0){!function(e){l=e}(r.SDK_VERSION),Object(r._registerComponent)(new i.a("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new cu(new O(e.getProvider("auth-internal")),new D(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new T(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ve(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Object(r.registerVersion)(c,"3.8.0",e),Object(r.registerVersion)(c,"3.8.0","esm2017")}()}).call(this,n(27))},function(e,t,n){e.exports=n(42)},function(e,t,n){"use strict";n.r(t),n.d(t,"SDK_VERSION",(function(){return T})),n.d(t,"_DEFAULT_ENTRY_NAME",(function(){return l})),n.d(t,"_addComponent",(function(){return p})),n.d(t,"_addOrOverwriteComponent",(function(){return g})),n.d(t,"_apps",(function(){return h})),n.d(t,"_clearComponents",(function(){return b})),n.d(t,"_components",(function(){return f})),n.d(t,"_getProvider",(function(){return v})),n.d(t,"_registerComponent",(function(){return m})),n.d(t,"_removeServiceInstance",(function(){return y})),n.d(t,"deleteApp",(function(){return A})),n.d(t,"getApp",(function(){return I})),n.d(t,"getApps",(function(){return k})),n.d(t,"initializeApp",(function(){return S})),n.d(t,"onLog",(function(){return x})),n.d(t,"registerVersion",(function(){return O})),n.d(t,"setLogLevel",(function(){return C}));var r=n(9),i=n(10),s=n(0);n.d(t,"FirebaseError",(function(){return s.c}));var a=n(26);class o{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const c="@firebase/app",u=new i.b("@firebase/app"),l="[DEFAULT]",d={[c]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},h=new Map,f=new Map;function p(e,t){try{e.container.addComponent(t)}catch(n){u.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function g(e,t){e.container.addOrOverwriteComponent(t)}function m(e){const t=e.name;if(f.has(t))return u.debug(`There were multiple attempts to register component ${t}.`),!1;f.set(t,e);for(const t of h.values())p(t,e);return!0}function v(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function y(e,t,n=l){v(e,t).clearInstance(n)}function b(){f.clear()}const w={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},_=new s.b("app","Firebase",w);class E{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.a("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _.create("app-deleted",{appName:this._name})}}const T="9.15.0";function S(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:l,automaticDataCollectionEnabled:!1},t),a=i.name;if("string"!=typeof a||!a)throw _.create("bad-app-name",{appName:String(a)});if(n||(n=Object(s.n)()),!n)throw _.create("no-options");const o=h.get(a);if(o){if(Object(s.k)(n,o.options)&&Object(s.k)(i,o.config))return o;throw _.create("duplicate-app",{appName:a})}const c=new r.b(a);for(const e of f.values())c.addComponent(e);const u=new E(n,i,c);return h.set(a,u),u}function I(e=l){const t=h.get(e);if(!t&&e===l)return S();if(!t)throw _.create("no-app",{appName:e});return t}function k(){return Array.from(h.values())}async function A(e){const t=e.name;h.has(t)&&(h.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function O(e,t,n){var i;let s=null!==(i=d[e])&&void 0!==i?i:e;n&&(s+="-"+n);const a=s.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const e=[`Unable to register library "${s}" with version "${t}":`];return a&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void u.warn(e.join(" "))}m(new r.a(s+"-version",(()=>({library:s,version:t})),"VERSION"))}function x(e,t){if(null!==e&&"function"!=typeof e)throw _.create("invalid-log-argument");Object(i.d)(e,t)}function C(e){Object(i.c)(e)}const R="firebase-heartbeat-store";let D=null;function L(){return D||(D=Object(a.a)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(R)}}).catch((e=>{throw _.create("idb-open",{originalErrorMessage:e.message})}))),D}async function P(e,t){try{const n=(await L()).transaction(R,"readwrite"),r=n.objectStore(R);return await r.put(t,N(e)),n.done}catch(e){if(e instanceof s.c)u.warn(e.message);else{const t=_.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});u.warn(t.message)}}}function N(e){return`${e.name}!${e.options.appId}`}class M{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new F(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=j();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=j(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),U(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),U(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=Object(s.f)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function j(){return(new Date).toISOString().substring(0,10)}class F{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Object(s.x)()&&Object(s.E)().then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{return(await L()).transaction(R).objectStore(R).get(N(e))}catch(e){if(e instanceof s.c)u.warn(e.message);else{const t=_.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});u.warn(t.message)}}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return P(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return P(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function U(e){return Object(s.f)(JSON.stringify({version:2,heartbeats:e})).length}var B;B="",m(new r.a("platform-logger",(e=>new o(e)),"PRIVATE")),m(new r.a("heartbeat",(e=>new M(e)),"PRIVATE")),O(c,"0.9.0",B),O(c,"0.9.0","esm2017"),O("fire-js","")},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(e,t,n,r,i,s,a){try{var o=e[s](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,s){var a=e.apply(t,r);function o(e){n(a,i,s,o,c,"next",e)}function c(e){n(a,i,s,o,c,"throw",e)}o(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";var r=n(1);function i(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}r.a.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const s=i.prototype,a={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{a[e]={value:e}})),Object.defineProperties(i,a),Object.defineProperty(s,"isAxiosError",{value:!0}),i.from=(e,t,n,a,o,c)=>{const u=Object.create(s);return r.a.toFlatObject(e,u,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),i.call(u,e.message,t,n,a,o),u.cause=e,u.name=e.name,c&&Object.assign(u,c),u},t.a=i},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var r=n(0);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}class s{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new r.a;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const e=this.getOrInitializeService({instanceIdentifier:t});e&&n.resolve(e)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,"[DEFAULT]"===r?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:"[DEFAULT]":e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new s(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return d}));const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},a=i.INFO,o={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=o[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=a,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}function l(e){r.forEach((t=>{t.setLogLevel(e)}))}function d(e,t){for(const n of r){let r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const a=s.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:a,args:s,type:t.name})}}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return $n})),n.d(t,"b",(function(){return Qn})),n.d(t,"c",(function(){return Yn})),n.d(t,"d",(function(){return Jn})),n.d(t,"e",(function(){return Xn})),n.d(t,"f",(function(){return Zn})),n.d(t,"g",(function(){return er})),n.d(t,"h",(function(){return Hn})),n.d(t,"i",(function(){return Wn}));var r,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},s={},a=a||{},o=i||self;function c(){}function u(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function l(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var d="closure_uid_"+(1e9*Math.random()>>>0),h=0;function f(e,t,n){return e.call.apply(e.bind,arguments)}function p(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function g(e,t,n){return(g=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:p).apply(null,arguments)}function m(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function y(){this.s=this.s,this.o=this.o}y.prototype.s=!1,y.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,d)&&e[d]||(e[d]=++h))},y.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const b=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function w(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function _(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(u(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function E(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var T=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{o.addEventListener("test",c,t),o.removeEventListener("test",c,t)}catch(e){}return e}();function S(e){return/^[\s\xa0]*$/.test(e)}var I=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function k(e,t){return e<t?-1:e>t?1:0}function A(){var e=o.navigator;return e&&(e=e.userAgent)?e:""}function O(e){return-1!=A().indexOf(e)}function x(e){return x[" "](e),e}x[" "]=c;var C,R,D=O("Opera"),L=O("Trident")||O("MSIE"),P=O("Edge"),N=P||L,M=O("Gecko")&&!(-1!=A().toLowerCase().indexOf("webkit")&&!O("Edge"))&&!(O("Trident")||O("MSIE"))&&!O("Edge"),j=-1!=A().toLowerCase().indexOf("webkit")&&!O("Edge");function F(){var e=o.document;return e?e.documentMode:void 0}e:{var U="",B=(R=A(),M?/rv:([^\);]+)(\)|;)/.exec(R):P?/Edge\/([\d\.]+)/.exec(R):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(R):j?/WebKit\/(\S+)/.exec(R):D?/(?:Version)[ \/]?(\S+)/.exec(R):void 0);if(B&&(U=B?B[1]:""),L){var V=F();if(null!=V&&V>parseFloat(U)){C=String(V);break e}}C=U}var q={};function G(){return function(e){var t=q;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){let e=0;const t=I(String(C)).split("."),n=I("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++){var i=t[a]||"",s=n[a]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=k(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||k(0==i[2].length,0==s[2].length)||k(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}))}var K=o.document&&L&&(F()||parseInt(C,10))||void 0;function z(e,t){if(E.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(M){e:{try{x(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:H[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.X.h.call(this)}}v(z,E);var H={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var W="closure_listenable_"+(1e6*Math.random()|0),$=0;function Y(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++$,this.ba=this.ea=!1}function Q(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function X(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function J(e){const t={};for(const n in e)t[n]=e[n];return t}const Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ee(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Z.length;t++)n=Z[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function te(e){this.src=e,this.g={},this.h=0}function ne(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=b(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function re(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}te.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=re(e,t,r,i);return-1<a?(t=e[a],n||(t.ea=!1)):((t=new Y(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var ie="closure_lm_"+(1e6*Math.random()|0),se={};function ae(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=fe(r),t&&t[W]?t.O(n,r,l(i)?!!i.capture:!!i,s):oe(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ae(e,t[s],n,r,i);return null}return n=fe(n),e&&e[W]?e.N(t,n,l(r)?!!r.capture:!!r,i):oe(e,t,n,!1,r,i)}function oe(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=l(i)?!!i.capture:!!i,o=de(e);if(o||(e[ie]=o=new te(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const e=le;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)T||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ue(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ce(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[W])ne(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ue(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=de(t))?(ne(n,e),0==n.h&&(n.src=null,t[ie]=null)):Q(e)}}}function ue(e){return e in se?se[e]:se[e]="on"+e}function le(e,t){if(e.ba)e=!0;else{t=new z(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&ce(e),e=n.call(r,t)}return e}function de(e){return(e=e[ie])instanceof te?e:null}var he="__closure_events_fn_"+(1e9*Math.random()>>>0);function fe(e){return"function"==typeof e?e:(e[he]||(e[he]=function(t){return e.handleEvent(t)}),e[he])}function pe(){y.call(this),this.i=new te(this),this.P=this,this.I=null}function ge(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new E(t,e);else if(t instanceof E)t.target=t.target||e;else{var i=t;ee(t=new E(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=me(a,r,!0,t)&&i}if(i=me(a=t.g=e,r,!0,t)&&i,i=me(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=me(a=t.g=n[s],r,!1,t)&&i}function me(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.ba&&a.capture==n){var o=a.listener,c=a.ha||a.src;a.ea&&ne(e.i,a),i=!1!==o.call(c,r)&&i}}return i&&!r.defaultPrevented}v(pe,y),pe.prototype[W]=!0,pe.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=l(i)?!!i.capture:!!i,r=fe(r),t&&t[W]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=re(a=t.g[n],r,i,s))&&(Q(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=de(t))&&(n=t.g[n.toString()],t=-1,n&&(t=re(n,r,i,s)),(r=-1<t?n[t]:null)&&ce(r))}(this,e,t,n,r)},pe.prototype.M=function(){if(pe.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Q(n[r]);delete t.g[e],t.h--}}this.I=null},pe.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},pe.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ve=o.JSON.stringify;function ye(){var e=Ie;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var be,we=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new _e),(e=>e.reset()));class _e{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ee(e){o.setTimeout((()=>{throw e}),0)}function Te(e,t){be||function(){var e=o.Promise.resolve(void 0);be=function(){e.then(ke)}}(),Se||(be(),Se=!0),Ie.add(e,t)}var Se=!1,Ie=new class{constructor(){this.h=this.g=null}add(e,t){const n=we.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function ke(){for(var e;e=ye();){try{e.h.call(e.g)}catch(e){Ee(e)}var t=we;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Se=!1}function Ae(e,t){pe.call(this),this.h=e||1,this.g=t||o,this.j=g(this.lb,this),this.l=Date.now()}function Oe(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function xe(e,t,n){if("function"==typeof e)n&&(e=g(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=g(e.handleEvent,e)}return 2147483647<Number(t)?-1:o.setTimeout(e,t||0)}v(Ae,pe),(r=Ae.prototype).ca=!1,r.R=null,r.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),ge(this,"tick"),this.ca&&(Oe(this),this.start()))}},r.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Ae.X.M.call(this),Oe(this),delete this.g};class Ce extends y{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=xe((()=>{t.g=null,t.i&&(t.i=!1,e(t))}),t.j);const n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Re(e){y.call(this),this.h=e,this.g={}}v(Re,y);var De=[];function Le(e,t,n,r){Array.isArray(n)||(n&&(De[0]=n.toString()),n=De);for(var i=0;i<n.length;i++){var s=ae(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Pe(e){X(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ce(e)}),e),e.g={}}function Ne(){this.g=!0}function Me(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return ve(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Re.prototype.M=function(){Re.X.M.call(this),Pe(this)},Re.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ne.prototype.Aa=function(){this.g=!1},Ne.prototype.info=function(){};var je={},Fe=null;function Ue(){return Fe=Fe||new pe}function Be(e){E.call(this,je.Pa,e)}function Ve(e){const t=Ue();ge(t,new Be(t))}function qe(e,t){E.call(this,je.STAT_EVENT,e),this.stat=t}function Ge(e){const t=Ue();ge(t,new qe(t,e))}function Ke(e,t){E.call(this,je.Qa,e),this.size=t}function ze(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout((function(){e()}),t)}je.Pa="serverreachability",v(Be,E),je.STAT_EVENT="statevent",v(qe,E),je.Qa="timingevent",v(Ke,E);var He={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},We={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function $e(){}function Ye(e){return e.h||(e.h=e.i())}function Qe(){}$e.prototype.h=null;var Xe,Je={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Ze(){E.call(this,"d")}function et(){E.call(this,"c")}function tt(){}function nt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new Re(this),this.O=it,e=N?125:void 0,this.T=new Ae(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new rt}function rt(){this.i=null,this.g="",this.h=!1}v(Ze,E),v(et,E),v(tt,$e),tt.prototype.g=function(){return new XMLHttpRequest},tt.prototype.i=function(){return{}},Xe=new tt;var it=45e3,st={},at={};function ot(e,t,n){e.K=1,e.v=kt(_t(t)),e.s=n,e.P=!0,ct(e,null)}function ct(e,t){e.F=Date.now(),ht(e),e.A=_t(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Ut(n.i,"t",r),e.C=0,n=e.l.H,e.h=new rt,e.g=Un(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Ce(g(e.La,e,e.g),e.N)),Le(e.S,e.g,"readystatechange",e.ib),t=e.H?J(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),Ve(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var a="",o=s.split("&"),c=0;c<o.length;c++){var u=o[c].split("=");if(1<u.length){var l=u[0];u=u[1];var d=l.split("_");a=2<=d.length&&"type"==d[1]?a+(l+"=")+u+"&":a+(l+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function ut(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function lt(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=dt(e,n),r==at){4==t&&(e.o=4,Ge(14),i=!1),Me(e.j,e.m,null,"[Incomplete Response]");break}if(r==st){e.o=4,Ge(15),Me(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Me(e.j,e.m,r,null),vt(e,r)}ut(e)&&r!=at&&r!=st&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Ge(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Rn(t),t.K=!0,Ge(11))):(Me(e.j,e.m,n,"[Invalid Chunked Response]"),mt(e),gt(e))}function dt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?at:(n=Number(t.substring(n,r)),isNaN(n)?st:(r+=1)+n>t.length?at:(t=t.substr(r,n),e.C=r+n,t))}function ht(e){e.V=Date.now()+e.O,ft(e,e.O)}function ft(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ze(g(e.gb,e),t)}function pt(e){e.B&&(o.clearTimeout(e.B),e.B=null)}function gt(e){0==e.l.G||e.I||Pn(e.l,e)}function mt(e){pt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Oe(e.T),Pe(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function vt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||zt(n.h,e)))if(!e.J&&zt(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Ln(n),Tn(n)}Cn(n),Ge(18)}}else n.Ba=i[1],0<n.Ba-n.T&&37500>i[2]&&n.L&&0==n.A&&!n.v&&(n.v=ze(g(n.cb,n),6e3));if(1>=Kt(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else Mn(n,11)}else if((e.J||n.g==e)&&Ln(n),!S(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.I=u[1],n.ka=u[2];const t=u[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const i=u[4];null!=i&&(n.Ca=i,n.j.info("SVER="+n.Ca));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ht(s,s.h),s.h=null))}if(r.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.za=e,It(r.F,r.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var a=e;if((r=n).sa=Fn(r,r.H?r.ka:null,r.V),a.J){Wt(r.h,a);var o=a,c=r.J;c&&o.setTimeout(c),o.B&&(pt(o),ht(o)),r.g=a}else xn(r);0<n.i.length&&In(n)}else"stop"!=u[0]&&"close"!=u[0]||Mn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Mn(n,7):En(n):"noop"!=u[0]&&n.l&&n.l.wa(u),n.A=0)}Ve()}catch(e){}}function yt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(u(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(u(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(u(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(r=nt.prototype).setTimeout=function(e){this.O=e},r.ib=function(e){e=e.target;const t=this.L;t&&3==mn(e)?t.l():this.La(e)},r.La=function(e){try{if(e==this.g)e:{const d=mn(this.g);var t=this.g.Ea();if(this.g.aa(),!(3>d)&&(3!=d||N||this.g&&(this.h.h||this.g.fa()||vn(this.g)))){this.I||4!=d||7==t||Ve(),pt(this);var n=this.g.aa();this.Y=n;t:if(ut(this)){var r=vn(this.g);e="";var i=r.length,s=4==mn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){mt(this),gt(this);var a="";break t}this.h.i=new o.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.fa();if(this.i=200==n,function(e,t,n,r,i,s,a){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a}))}(this.j,this.u,this.A,this.m,this.U,d,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(c)){var l=c;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,Ge(12),mt(this),gt(this);break e}Me(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,vt(this,n)}this.P?(lt(this,d,a),N&&this.i&&3==d&&(Le(this.S,this.T,"tick",this.hb),this.T.start())):(Me(this.j,this.m,a,null),vt(this,a)),4==d&&mt(this),this.i&&!this.I&&(4==d?Pn(this.l,this):(this.i=!1,ht(this)))}else 400==n&&0<a.indexOf("Unknown SID")?(this.o=3,Ge(12)):(this.o=0,Ge(13)),mt(this),gt(this)}}}catch(e){}},r.hb=function(){if(this.g){var e=mn(this.g),t=this.g.fa();this.C<t.length&&(pt(this),lt(this,e,t),this.i&&4!=e&&ht(this))}},r.cancel=function(){this.I=!0,mt(this)},r.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(Ve(),Ge(17)),mt(this),this.o=2,gt(this)):ft(this,this.V-e)};var bt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function wt(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof wt){this.h=void 0!==t?t:e.h,Et(this,e.j),this.s=e.s,this.g=e.g,Tt(this,e.m),this.l=e.l,t=e.i;var n=new Nt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),St(this,n),this.o=e.o}else e&&(n=String(e).match(bt))?(this.h=!!t,Et(this,n[1]||"",!0),this.s=At(n[2]||""),this.g=At(n[3]||"",!0),Tt(this,n[4]),this.l=At(n[5]||"",!0),St(this,n[6]||"",!0),this.o=At(n[7]||"")):(this.h=!!t,this.i=new Nt(null,this.h))}function _t(e){return new wt(e)}function Et(e,t,n){e.j=n?At(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Tt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function St(e,t,n){t instanceof Nt?(e.i=t,function(e,t){t&&!e.j&&(Mt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(jt(this,t),Ut(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Ot(t,Lt)),e.i=new Nt(t,e.h))}function It(e,t,n){e.i.set(t,n)}function kt(e){return It(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function At(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ot(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,xt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function xt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}wt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ot(t,Ct,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Ot(t,Ct,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ot(n,"/"==n.charAt(0)?Dt:Rt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ot(n,Pt)),e.join("")};var Ct=/[#\/\?@]/g,Rt=/[#\?:]/g,Dt=/[#\?]/g,Lt=/[#\?@]/g,Pt=/#/g;function Nt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Mt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function jt(e,t){Mt(e),t=Bt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ft(e,t){return Mt(e),t=Bt(e,t),e.g.has(t)}function Ut(e,t,n){jt(e,t),0<n.length&&(e.i=null,e.g.set(Bt(e,t),w(n)),e.h+=n.length)}function Bt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Vt(e){this.l=e||qt,e=o.PerformanceNavigationTiming?0<(e=o.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.g&&o.g.Ga&&o.g.Ga()&&o.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(r=Nt.prototype).add=function(e,t){Mt(this),this.i=null,e=Bt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){Mt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},r.oa=function(){Mt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},r.W=function(e){Mt(this);let t=[];if("string"==typeof e)Ft(this,e)&&(t=t.concat(this.g.get(Bt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},r.set=function(e,t){return Mt(this),this.i=null,Ft(this,e=Bt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),a=this.W(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")};var qt=10;function Gt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Kt(e){return e.h?1:e.g?e.g.size:0}function zt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ht(e,t){e.g?e.g.add(t):e.h=t}function Wt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function $t(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return w(e.i)}function Yt(){}function Qt(){this.g=new Yt}function Xt(e,t,n){const r=n||"";try{yt(e,(function(e,n){let i=e;l(e)&&(i=ve(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Jt(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Zt(e){this.l=e.ac||null,this.j=e.jb||!1}function en(e,t){pe.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=tn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Vt.prototype.cancel=function(){if(this.i=$t(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},Yt.prototype.stringify=function(e){return o.JSON.stringify(e,void 0)},Yt.prototype.parse=function(e){return o.JSON.parse(e,void 0)},v(Zt,$e),Zt.prototype.g=function(){return new en(this.l,this.j)},Zt.prototype.i=function(e){return function(){return e}}({}),v(en,pe);var tn=0;function nn(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function rn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,sn(e)}function sn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=en.prototype).open=function(e,t){if(this.readyState!=tn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,sn(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||o).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,rn(this)),this.readyState=tn},r.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,sn(this)),this.g&&(this.readyState=3,sn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;nn(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},r.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?rn(this):sn(this),3==this.readyState&&nn(this)}},r.Va=function(e){this.g&&(this.response=this.responseText=e,rn(this))},r.Ua=function(e){this.g&&(this.response=e,rn(this))},r.ga=function(){this.g&&rn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(en.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var an=o.JSON.parse;function on(e){pe.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=cn,this.K=this.L=!1}v(on,pe);var cn="",un=/^https?$/i,ln=["POST","PUT"];function dn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,hn(e),pn(e)}function hn(e){e.D||(e.D=!0,ge(e,"complete"),ge(e,"error"))}function fn(e){if(e.h&&void 0!==a&&(!e.C[1]||4!=mn(e)||2!=e.aa()))if(e.v&&4==mn(e))xe(e.Ha,0,e);else if(ge(e,"readystatechange"),4==mn(e)){e.h=!1;try{const a=e.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(bt)[1]||null;if(!i&&o.self&&o.self.location){var s=o.self.location.protocol;i=s.substr(0,s.length-1)}r=!un.test(i?i.toLowerCase():"")}n=r}if(n)ge(e,"complete"),ge(e,"success");else{e.m=6;try{var c=2<mn(e)?e.g.statusText:""}catch(e){c=""}e.j=c+" ["+e.aa()+"]",hn(e)}}finally{pn(e)}}}function pn(e,t){if(e.g){gn(e);const n=e.g,r=e.C[0]?c:null;e.g=null,e.C=null,t||ge(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function gn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(o.clearTimeout(e.A),e.A=null)}function mn(e){return e.g?e.g.readyState:0}function vn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case cn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function yn(e){let t="";return X(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function bn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=yn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):It(e,t,n))}function wn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function _n(e){this.Ca=0,this.i=[],this.j=new Ne,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=wn("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=wn("baseRetryDelayMs",5e3,e),this.bb=wn("retryDelaySeedMs",1e4,e),this.$a=wn("forwardChannelMaxRetries",2,e),this.ta=wn("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new Vt(e&&e.concurrentRequestLimit),this.Fa=new Qt,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function En(e){if(Sn(e),3==e.G){var t=e.U++,n=_t(e.F);It(n,"SID",e.I),It(n,"RID",t),It(n,"TYPE","terminate"),An(e,n),(t=new nt(e,e.j,t,void 0)).K=2,t.v=kt(_t(n)),n=!1,o.navigator&&o.navigator.sendBeacon&&(n=o.navigator.sendBeacon(t.v.toString(),"")),!n&&o.Image&&((new Image).src=t.v,n=!0),n||(t.g=Un(t.l,null),t.g.da(t.v)),t.F=Date.now(),ht(t)}jn(e)}function Tn(e){e.g&&(Rn(e),e.g.cancel(),e.g=null)}function Sn(e){Tn(e),e.u&&(o.clearTimeout(e.u),e.u=null),Ln(e),e.h.cancel(),e.m&&("number"==typeof e.m&&o.clearTimeout(e.m),e.m=null)}function In(e){Gt(e.h)||e.m||(e.m=!0,Te(e.Ja,e),e.C=0)}function kn(e,t){var n;n=t?t.m:e.U++;const r=_t(e.F);It(r,"SID",e.I),It(r,"RID",n),It(r,"AID",e.T),An(e,r),e.o&&e.s&&bn(r,e.o,e.s),n=new nt(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=On(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),Ht(e.h,n),ot(n,r,t)}function An(e,t){e.ia&&X(e.ia,(function(e,n){It(t,n,e)})),e.l&&yt({},(function(e,n){It(t,n,e)}))}function On(e,t,n){n=Math.min(e.i.length,n);var r=e.l?g(e.l.Ra,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const s=["count="+n];-1==t?0<n?(t=i[0].h,s.push("ofs="+t)):t=0:s.push("ofs="+t);let a=!0;for(let o=0;o<n;o++){let n=i[o].h;const c=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),a=!1;else try{Xt(c,s,"req"+n+"_")}catch(e){r&&r(c)}}if(a){r=s.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function xn(e){e.g||e.u||(e.Z=1,Te(e.Ia,e),e.A=0)}function Cn(e){return!(e.g||e.u||3<=e.A||(e.Z++,e.u=ze(g(e.Ia,e),Nn(e,e.A)),e.A++,0))}function Rn(e){null!=e.B&&(o.clearTimeout(e.B),e.B=null)}function Dn(e){e.g=new nt(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=_t(e.sa);It(t,"RID","rpc"),It(t,"SID",e.I),It(t,"CI",e.L?"0":"1"),It(t,"AID",e.T),It(t,"TYPE","xmlhttp"),An(e,t),e.o&&e.s&&bn(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=kt(_t(t)),n.s=null,n.P=!0,ct(n,e)}function Ln(e){null!=e.v&&(o.clearTimeout(e.v),e.v=null)}function Pn(e,t){var n=null;if(e.g==t){Ln(e),Rn(e),e.g=null;var r=2}else{if(!zt(e.h,t))return;n=t.D,Wt(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;ge(r=Ue(),new Ke(r,n)),In(e)}else xn(e);else if(3==(i=t.o)||0==i&&0<e.pa||!(1==r&&function(e,t){return!(Kt(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.C>=(e.Za?0:e.$a)||(e.m=ze(g(e.Ja,e,t),Nn(e,e.C)),e.C++,0)))}(e,t)||2==r&&Cn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:Mn(e,5);break;case 4:Mn(e,10);break;case 3:Mn(e,6);break;default:Mn(e,2)}}function Nn(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function Mn(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=g(e.kb,e);n||(n=new wt("//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||Et(n,"https"),kt(n)),function(e,t){const n=new Ne;if(o.Image){const r=new Image;r.onload=m(Jt,n,r,"TestLoadImage: loaded",!0,t),r.onerror=m(Jt,n,r,"TestLoadImage: error",!1,t),r.onabort=m(Jt,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=m(Jt,n,r,"TestLoadImage: timeout",!1,t),o.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Ge(2);e.G=0,e.l&&e.l.va(t),jn(e),Sn(e)}function jn(e){if(e.G=0,e.la=[],e.l){const t=$t(e.h);0==t.length&&0==e.i.length||(_(e.la,t),_(e.la,e.i),e.h.i.length=0,w(e.i),e.i.length=0),e.l.ua()}}function Fn(e,t,n){var r=n instanceof wt?_t(n):new wt(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Tt(r,r.m);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new wt(null,void 0);r&&Et(s,r),t&&(s.g=t),i&&Tt(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.za,n&&t&&It(r,n,t),It(r,"VER",e.ma),An(e,r),r}function Un(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new on(new Zt({jb:!0})):new on(e.ra)).Ka(e.H),t}function Bn(){}function Vn(){if(L&&!(10<=Number(K)))throw Error("Environmental error: no available transport.")}function qn(e,t){pe.call(this),this.g=new _n(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!S(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new zn(this)}function Gn(e){Ze.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Kn(){et.call(this),this.status=1}function zn(e){this.g=e}(r=on.prototype).Ka=function(e){this.L=e},r.da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Xe.g(),this.C=this.u?Ye(this.u):Ye(Xe),this.g.onreadystatechange=g(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void dn(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=o.FormData&&e instanceof o.FormData,!(0<=b(ln,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{gn(this),0<this.B&&((this.K=function(e){return L&&G()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=g(this.qa,this)):this.A=xe(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){dn(this,e)}},r.qa=function(){void 0!==a&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ge(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,ge(this,"complete"),ge(this,"abort"),pn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),pn(this,!0)),on.X.M.call(this)},r.Ha=function(){this.s||(this.F||this.v||this.l?fn(this):this.fb())},r.fb=function(){fn(this)},r.aa=function(){try{return 2<mn(this)?this.g.status:-1}catch(e){return-1}},r.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},r.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),an(t)}},r.Ea=function(){return this.m},r.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=_n.prototype).ma=8,r.G=1,r.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new nt(this,this.j,e,void 0);let s=this.s;if(this.S&&(s?(s=J(s),ee(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=On(this,i,t),It(n=_t(this.F),"RID",e),It(n,"CVER",22),this.D&&It(n,"X-HTTP-Session-Id",this.D),An(this,n),s&&(this.N?t="headers="+encodeURIComponent(String(yn(s)))+"&"+t:this.o&&bn(n,this.o,s)),Ht(this.h,i),this.Ya&&It(n,"TYPE","init"),this.O?(It(n,"$req",t),It(n,"SID","null"),i.Z=!0,ot(i,n,null)):ot(i,n,t),this.G=2}}else 3==this.G&&(e?kn(this,e):0==this.i.length||Gt(this.h)||kn(this))},r.Ia=function(){if(this.u=null,Dn(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=ze(g(this.eb,this),e)}},r.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ge(10),Tn(this),Dn(this))},r.cb=function(){null!=this.v&&(this.v=null,Tn(this),Cn(this),Ge(19))},r.kb=function(e){e?(this.j.info("Successfully pinged google.com"),Ge(2)):(this.j.info("Failed to ping google.com"),Ge(1))},(r=Bn.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Ra=function(){},Vn.prototype.g=function(e,t){return new qn(e,t)},v(qn,pe),qn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;Ge(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=Fn(e,null,e.V),In(e)},qn.prototype.close=function(){En(this.g)},qn.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ve(e),e=n);t.i.push(new class{constructor(e,t){this.h=e,this.g=t}}(t.ab++,e)),3==t.G&&In(t)},qn.prototype.M=function(){this.g.l=null,delete this.j,En(this.g),delete this.g,qn.X.M.call(this)},v(Gn,Ze),v(Kn,et),v(zn,Bn),zn.prototype.xa=function(){ge(this.g,"a")},zn.prototype.wa=function(e){ge(this.g,new Gn(e))},zn.prototype.va=function(e){ge(this.g,new Kn)},zn.prototype.ua=function(){ge(this.g,"b")},Vn.prototype.createWebChannel=Vn.prototype.g,qn.prototype.send=qn.prototype.u,qn.prototype.open=qn.prototype.m,qn.prototype.close=qn.prototype.close,He.NO_ERROR=0,He.TIMEOUT=8,He.HTTP_ERROR=6,We.COMPLETE="complete",Qe.EventType=Je,Je.OPEN="a",Je.CLOSE="b",Je.ERROR="c",Je.MESSAGE="d",pe.prototype.listen=pe.prototype.N,on.prototype.listenOnce=on.prototype.O,on.prototype.getLastError=on.prototype.Oa,on.prototype.getLastErrorCode=on.prototype.Ea,on.prototype.getStatus=on.prototype.aa,on.prototype.getResponseJson=on.prototype.Sa,on.prototype.getResponseText=on.prototype.fa,on.prototype.send=on.prototype.da,on.prototype.setWithCredentials=on.prototype.Ka;var Hn=s.createWebChannelTransport=function(){return new Vn},Wn=s.getStatEventTarget=function(){return Ue()},$n=s.ErrorCode=He,Yn=s.EventType=We,Qn=s.Event=je,Xn=s.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Jn=s.FetchXmlHttpFactory=Zt,Zn=s.WebChannel=Qe,er=s.XhrIo=on}).call(this,n(19))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(22),i="undefined"!=typeof URLSearchParams?URLSearchParams:r.a,s=FormData;const a=(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&"undefined"!=typeof window&&"undefined"!=typeof document})();var o={isBrowser:!0,classes:{URLSearchParams:i,FormData:s,Blob:Blob},isStandardBrowserEnv:a,protocols:["http","https","file","blob","url","data"]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(0),i=n(9),s=n(5),a=n(10);class o{constructor(e,t){this._delegate=e,this.firebase=t,Object(s._addComponent)(e,new i.a("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(s.deleteApp)(this._delegate))))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Object(s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){Object(s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const c={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},u=new r.b("app-compat","Firebase",c),l=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(i,a={}){const o=s.initializeApp(i,a);if(Object(r.h)(t,o.name))return t[o.name];const c=new e(o,n);return t[o.name]=c,c},app:i,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){const a=t.name,o=a.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){const s=(e=i())=>{if("function"!=typeof e[o])throw u.create("invalid-app-argument",{appName:a});return e[o]()};void 0!==t.serviceProps&&Object(r.l)(s,t.serviceProps),n[o]=s,e.prototype[o]=function(...e){return this._getService.bind(this,a).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[o]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function i(e){if(e=e||s._DEFAULT_ENTRY_NAME,!Object(r.h)(t,e))throw u.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(o);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(r.l)(t,e)},createSubscribe:r.j,ErrorFactory:r.b,deepExtend:r.l}),t}(),d=new a.b("@firebase/app-compat");if(Object(r.t)()&&void 0!==self.firebase){d.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&d.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const h=l;var f;Object(s.registerVersion)("@firebase/app-compat","0.2.0",f)},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";var r=n(1);const i=r.a.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),s=Symbol("internals"),a=Symbol("defaults");function o(e){return e&&String(e).trim().toLowerCase()}function c(e){return!1===e||null==e?e:r.a.isArray(e)?e.map(c):String(e)}function u(e,t,n,i){return r.a.isFunction(i)?i.call(this,t,n):r.a.isString(t)?r.a.isString(i)?-1!==t.indexOf(i):r.a.isRegExp(i)?i.test(t):void 0:void 0}function l(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}function d(e,t){e&&this.set(e),this[a]=t||null}Object.assign(d.prototype,{set:function(e,t,n){const i=this;function s(e,t,n){const r=o(t);if(!r)throw new Error("header name must be a non-empty string");const s=l(i,r);(!s||!0===n||!1!==i[s]&&!1!==n)&&(i[s||t]=c(e))}return r.a.isPlainObject(e)?r.a.forEach(e,((e,n)=>{s(e,n,t)})):s(t,e,n),this},get:function(e,t){if(!(e=o(e)))return;const n=l(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(r.a.isFunction(t))return t.call(this,e,n);if(r.a.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}},has:function(e,t){if(e=o(e)){const n=l(this,e);return!(!n||t&&!u(0,this[n],n,t))}return!1},delete:function(e,t){const n=this;let i=!1;function s(e){if(e=o(e)){const r=l(n,e);!r||t&&!u(0,n[r],r,t)||(delete n[r],i=!0)}}return r.a.isArray(e)?e.forEach(s):s(e),i},clear:function(){return Object.keys(this).forEach(this.delete.bind(this))},normalize:function(e){const t=this,n={};return r.a.forEach(this,((r,i)=>{const s=l(n,i);if(s)return t[s]=c(r),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();a!==i&&delete t[i],t[a]=c(r),n[a]=!0})),this},toJSON:function(e){const t=Object.create(null);return r.a.forEach(Object.assign({},this[a]||null,this),((n,i)=>{null!=n&&!1!==n&&(t[i]=e&&r.a.isArray(n)?n.join(", "):n)})),t}}),Object.assign(d,{from:function(e){return r.a.isString(e)?new this((e=>{const t={};let n,r,s;return e&&e.split("\n").forEach((function(e){s=e.indexOf(":"),n=e.substring(0,s).trim().toLowerCase(),r=e.substring(s+1).trim(),!n||t[n]&&i[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e)):e instanceof this?e:new this(e)},accessor:function(e){const t=(this[s]=this[s]={accessors:{}}).accessors,n=this.prototype;function i(e){const i=o(e);t[i]||(function(e,t){const n=r.a.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[i]=!0)}return r.a.isArray(e)?e.forEach(i):i(e),this}}),d.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]),r.a.freezeMethods(d.prototype),r.a.freezeMethods(d),t.a=d},function(e,t,n){"use strict";(function(e){var r=n(1),i=n(8),s=n(34);function a(e){return r.a.isPlainObject(e)||r.a.isArray(e)}function o(e){return r.a.endsWith(e,"[]")?e.slice(0,-2):e}function c(e,t,n){return e?e.concat(t).map((function(e,t){return e=o(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const u=r.a.toFlatObject(r.a,{},null,(function(e){return/^is[A-Z]/.test(e)}));t.a=function(t,n,l){if(!r.a.isObject(t))throw new TypeError("target must be an object");n=n||new(s.a||FormData);const d=(l=r.a.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!r.a.isUndefined(t[e])}))).metaTokens,h=l.visitor||y,f=l.dots,p=l.indexes,g=(l.Blob||"undefined"!=typeof Blob&&Blob)&&(m=n)&&r.a.isFunction(m.append)&&"FormData"===m[Symbol.toStringTag]&&m[Symbol.iterator];var m;if(!r.a.isFunction(h))throw new TypeError("visitor must be a function");function v(t){if(null===t)return"";if(r.a.isDate(t))return t.toISOString();if(!g&&r.a.isBlob(t))throw new i.a("Blob is not supported. Use a Buffer instead.");return r.a.isArrayBuffer(t)||r.a.isTypedArray(t)?g&&"function"==typeof Blob?new Blob([t]):e.from(t):t}function y(e,t,i){let s=e;if(e&&!i&&"object"==typeof e)if(r.a.endsWith(t,"{}"))t=d?t:t.slice(0,-2),e=JSON.stringify(e);else if(r.a.isArray(e)&&function(e){return r.a.isArray(e)&&!e.some(a)}(e)||r.a.isFileList(e)||r.a.endsWith(t,"[]")&&(s=r.a.toArray(e)))return t=o(t),s.forEach((function(e,i){!r.a.isUndefined(e)&&null!==e&&n.append(!0===p?c([t],i,f):null===p?t:t+"[]",v(e))})),!1;return!!a(e)||(n.append(c(i,t,f),v(e)),!1)}const b=[],w=Object.assign(u,{defaultVisitor:y,convertValue:v,isVisitable:a});if(!r.a.isObject(t))throw new TypeError("data must be an object");return function e(t,i){if(!r.a.isUndefined(t)){if(-1!==b.indexOf(t))throw Error("Circular reference detected in "+i.join("."));b.push(t),r.a.forEach(t,(function(t,s){!0===(!(r.a.isUndefined(t)||null===t)&&h.call(n,t,r.a.isString(s)?s.trim():s,i,w))&&e(t,i?i.concat(s):[s])})),b.pop()}}(t),n}}).call(this,n(44).Buffer)},function(e,t,n){"use strict";var r=n(8);function i(e,t,n){r.a.call(this,null==e?"canceled":e,r.a.ERR_CANCELED,t,n),this.name="CanceledError"}n(1).a.inherits(i,r.a,{__CANCEL__:!0}),t.a=i},function(e,t,n){"use strict";(function(e){var r=n(1),i=n(8),s=n(23),a=n(16),o=n(36),c=n(12),u=n(24),l=n(28);const d={"Content-Type":"application/x-www-form-urlencoded"},h={transitional:s.a,adapter:function(){let t;return"undefined"!=typeof XMLHttpRequest?t=l.a.getAdapter("xhr"):void 0!==e&&"process"===r.a.kindOf(e)&&(t=l.a.getAdapter("http")),t}(),transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=r.a.isObject(e);if(s&&r.a.isHTMLForm(e)&&(e=new FormData(e)),r.a.isFormData(e))return i&&i?JSON.stringify(Object(u.a)(e)):e;if(r.a.isArrayBuffer(e)||r.a.isBuffer(e)||r.a.isStream(e)||r.a.isFile(e)||r.a.isBlob(e))return e;if(r.a.isArrayBufferView(e))return e.buffer;if(r.a.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Object(o.a)(e,this.formSerializer).toString();if((c=r.a.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Object(a.a)(c?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),function(e,t,n){if(r.a.isString(e))try{return(t||JSON.parse)(e),r.a.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||h.transitional,n=t&&t.forcedJSONParsing,s="json"===this.responseType;if(e&&r.a.isString(e)&&(n&&!this.responseType||s)){const n=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw i.a.from(e,i.a.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:c.a.classes.FormData,Blob:c.a.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};r.a.forEach(["delete","get","head"],(function(e){h.headers[e]={}})),r.a.forEach(["post","put","patch"],(function(e){h.headers[e]=r.a.merge(d)})),t.a=h}).call(this,n(27))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(e,t){return function(){return e.apply(t,arguments)}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1),i=n(22);function s(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function a(e,t,n){if(!t)return e;const a=n&&n.encode||s,o=n&&n.serialize;let c;if(c=o?o(t,n):r.a.isURLSearchParams(t)?t.toString():new i.a(t,n).toString(a),c){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+c}return e}},function(e,t,n){"use strict";var r=n(16);function i(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function s(e,t){this._pairs=[],e&&Object(r.a)(e,this,t)}const a=s.prototype;a.append=function(e,t){this._pairs.push([e,t])},a.toString=function(e){const t=e?function(t){return e.call(this,t,i)}:i;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")},t.a=s},function(e,t,n){"use strict";t.a={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},function(e,t,n){"use strict";var r=n(1);t.a=function(e){function t(e,n,i,s){let a=e[s++];const o=Number.isFinite(+a),c=s>=e.length;return a=!a&&r.a.isArray(i)?i.length:a,c?(r.a.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):(i[a]&&r.a.isObject(i[a])||(i[a]=[]),t(e,n,i[a],s)&&r.a.isArray(i[a])&&(i[a]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let s;for(r=0;r<i;r++)s=n[r],t[s]=e[s];return t}(i[a])),!o)}if(r.a.isFormData(e)&&r.a.isFunction(e.entries)){const n={};return r.a.forEachEntry(e,((e,i)=>{t(function(e){return r.a.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),i,n,0)})),n}return null}},function(e,t,n){"use strict";function r(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";let r,i;n.d(t,"a",(function(){return g}));const s=new WeakMap,a=new WeakMap,o=new WeakMap,c=new WeakMap,u=new WeakMap;let l={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||o.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(p(this),t),f(s.get(this))}:function(...t){return f(e.apply(p(this),t))}:function(t,...n){const r=e.call(p(this),t,...n);return o.set(r,t.sort?t.sort():[t]),f(r)}}function h(e){return"function"==typeof e?d(e):(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));a.set(e,t)}(e),t=e,(r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,l):e);var t}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(f(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&s.set(t,e)})).catch((()=>{})),u.set(t,e),t}(e);if(c.has(e))return c.get(e);const t=h(e);return t!==e&&(c.set(e,t),u.set(t,e)),t}const p=e=>u.get(e);function g(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=f(a);return r&&a.addEventListener("upgradeneeded",(e=>{r(f(a.result),e.oldVersion,e.newVersion,f(a.transaction))})),n&&a.addEventListener("blocked",(()=>n())),o.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),o}const m=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],y=new Map;function b(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(y.get(t))return y.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!m.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return y.set(t,s),s}l=(e=>({...e,get:(t,n,r)=>b(t,n)||e.get(t,n,r),has:(t,n)=>!!b(t,n)||e.has(t,n)}))(l)},function(e,t){var n,r,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=o(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(1),i=n(8),s=n(12),a=s.a.isStandardBrowserEnv?{write:function(e,t,n,i,s,a){const o=[];o.push(e+"="+encodeURIComponent(t)),r.a.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),r.a.isString(i)&&o.push("path="+i),r.a.isString(s)&&o.push("domain="+s),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},o=n(21),c=n(25),u=s.a.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function i(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(e){const t=r.a.isString(e)?i(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0},l=n(23),d=n(17),h=n(15),f=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,s=0,a=0;return t=void 0!==t?t:1e3,function(o){const c=Date.now(),u=r[a];i||(i=c),n[s]=o,r[s]=c;let l=a,d=0;for(;l!==s;)d+=n[l++],l%=e;if(s=(s+1)%e,s===a&&(a=(a+1)%e),c-i<t)return;const h=u&&c-u;return h?Math.round(1e3*d/h):void 0}};function p(e,t){let n=0;const r=f(50,250);return i=>{const s=i.loaded,a=i.lengthComputable?i.total:void 0,o=s-n,c=r(o);n=s;const u={loaded:s,total:a,progress:a?s/a:void 0,bytes:o,rate:c||void 0,estimated:c&&a&&s<=a?(a-s)/c:void 0};u[t?"download":"upload"]=!0,e(u)}}function g(e){return new Promise((function(t,n){let f=e.data;const g=h.a.from(e.headers).normalize(),m=e.responseType;let v;function y(){e.cancelToken&&e.cancelToken.unsubscribe(v),e.signal&&e.signal.removeEventListener("abort",v)}r.a.isFormData(f)&&s.a.isStandardBrowserEnv&&g.setContentType(!1);let b=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";g.set("Authorization","Basic "+btoa(t+":"+n))}const w=Object(c.a)(e.baseURL,e.url);function _(){if(!b)return;const r=h.a.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new i.a("Request failed with status code "+n.status,[i.a.ERR_BAD_REQUEST,i.a.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),y()}),(function(e){n(e),y()}),{data:m&&"text"!==m&&"json"!==m?b.response:b.responseText,status:b.status,statusText:b.statusText,headers:r,config:e,request:b}),b=null}if(b.open(e.method.toUpperCase(),Object(o.a)(w,e.params,e.paramsSerializer),!0),b.timeout=e.timeout,"onloadend"in b?b.onloadend=_:b.onreadystatechange=function(){b&&4===b.readyState&&(0!==b.status||b.responseURL&&0===b.responseURL.indexOf("file:"))&&setTimeout(_)},b.onabort=function(){b&&(n(new i.a("Request aborted",i.a.ECONNABORTED,e,b)),b=null)},b.onerror=function(){n(new i.a("Network Error",i.a.ERR_NETWORK,e,b)),b=null},b.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||l.a;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new i.a(t,r.clarifyTimeoutError?i.a.ETIMEDOUT:i.a.ECONNABORTED,e,b)),b=null},s.a.isStandardBrowserEnv){const t=(e.withCredentials||u(w))&&e.xsrfCookieName&&a.read(e.xsrfCookieName);t&&g.set(e.xsrfHeaderName,t)}void 0===f&&g.setContentType(null),"setRequestHeader"in b&&r.a.forEach(g.toJSON(),(function(e,t){b.setRequestHeader(t,e)})),r.a.isUndefined(e.withCredentials)||(b.withCredentials=!!e.withCredentials),m&&"json"!==m&&(b.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&b.addEventListener("progress",p(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&b.upload&&b.upload.addEventListener("progress",p(e.onUploadProgress)),(e.cancelToken||e.signal)&&(v=t=>{b&&(n(!t||t.type?new d.a(null,e,b):t),b.abort(),b=null)},e.cancelToken&&e.cancelToken.subscribe(v),e.signal&&(e.signal.aborted?v():e.signal.addEventListener("abort",v)));const E=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(w);E&&-1===s.a.protocols.indexOf(E)?n(new i.a("Unsupported protocol "+E+":",i.a.ERR_BAD_REQUEST,e)):b.send(f||null)}))}const m={http:g,xhr:g};t.a={getAdapter:e=>{if(r.a.isString(e)){const t=m[e];if(!e)throw Error(r.a.hasOwnProp(e)?`Adapter '${e}' is not available in the build`:`Can not resolve adapter '${e}'`);return t}if(!r.a.isFunction(e))throw new TypeError("adapter is not a function");return e},adapters:m}},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var r=n(31);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var r=n(38),i=n(29),s=n(30),a=n(39);e.exports=function(e){return r(e)||i(e)||s(e)||a()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var r=n(40),i=n(29),s=n(30),a=n(41);e.exports=function(e){return r(e)||i(e)||s(e)||a()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";var r=n(35),i=n.n(r);t.a=i.a},function(e,t){e.exports="object"==typeof self?self.FormData:window.FormData},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(1),i=n(16),s=n(12);function a(e,t){return Object(i.a)(e,new s.a.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,i){return s.a.isNode&&r.a.isBuffer(e)?(this.append(t,e.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},t))}},function(e,t,n){e.exports=n(48)},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var r=n(31);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function o(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof d?t:d,s=Object.create(i.prototype),a=new T(r||[]);return s._invoke=function(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return I()}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=w(a,n);if(o){if(o===l)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),s}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function h(){}function f(){}var p={};p[i]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(S([])));m&&m!==t&&n.call(m,i)&&(p=m);var v=f.prototype=d.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var r;this._invoke=function(i,s){function a(){return new t((function(r,a){!function r(i,s,a,o){var c=u(e[i],e,s);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,o)}),(function(e){r("throw",e,a,o)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,o)}))}o(c.arg)}(i,s,r,a)}))}return r=r?r.then(a,a):a()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=v.constructor=f,f.constructor=h,h.displayName=o(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[s]=function(){return this},e.AsyncIterator=b,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var a=new b(c(t,n,r,i),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),o(v,a,"Generator"),v[i]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var o=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(o&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){"use strict";(function(e){var t=n(13),r=n(2),i=n(9),s=n(0);function a(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function o(e=Object(s.s)()){return!("file:"!==a()&&"ionic:"!==a()&&"capacitor:"!==a()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function c(e=Object(s.s)()){return Object(s.w)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=Object(s.s)()){return/Edge\/\d+/.test(e)}(e)}function u(){try{const e=self.localStorage,t=r.s();if(e)return e.setItem(t,"1"),e.removeItem(t),!c()||Object(s.x)()}catch(e){return l()&&Object(s.x)()}return!1}function l(){return void 0!==e&&"WorkerGlobalScope"in e&&"importScripts"in e}function d(){return("http:"===a()||"https:"===a()||Object(s.u)()||o())&&!(Object(s.A)()||Object(s.z)())&&u()&&!l()}function h(){return o()&&"undefined"!=typeof document}const f={LOCAL:"local",NONE:"none",SESSION:"session"},p=r.p;async function g(e){await e._initializationPromise;const t=m(),n=r.w("persistence",e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function m(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const v=r.p;class y{constructor(){this.browserResolver=r.t(r.A),this.cordovaResolver=r.t(r.F),this.underlyingResolver=null,this._redirectPersistence=r.B,this._completeRedirectFn=r.u,this._overrideRedirectResult=r.v}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return h()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return v(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!h()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function b(e){return e.unwrap()}function w(e){const{_tokenResponse:t}=e instanceof s.c?e.customData:e;if(!t)return null;if(!(e instanceof s.c)&&"temporaryProof"in t&&"phoneNumber"in t)return r.i.credentialFromResult(e);const n=t.providerId;if(!n||n===r.k.PASSWORD)return null;let i;switch(n){case r.k.GOOGLE:i=r.f;break;case r.k.FACEBOOK:i=r.d;break;case r.k.GITHUB:i=r.e;break;case r.k.TWITTER:i=r.o;break;default:const{oauthIdToken:e,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:c}=t;return s||a||e||o?o?n.startsWith("saml.")?r.m._create(n,o):r.g._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:s}):new r.h(n).credential({idToken:e,accessToken:s,rawNonce:c}):null}return e instanceof s.c?i.credentialFromError(e):i.credentialFromResult(e)}function _(e,t){return t.catch((t=>{throw t instanceof s.c&&function(e,t){var n;const i=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code))t.resolver=new T(e,r.K(e,t));else if(i){const e=w(t),n=t;e&&(n.credential=e,n.tenantId=i.tenantId||void 0,n.email=i.email||void 0,n.phoneNumber=i.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(i=e,w(i)),additionalUserInfo:r.J(e),user:S.getOrCreate(n)};var i}))}async function E(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>_(e,n.confirm(t))}}class T{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return _(b(this.auth),this.resolver.resolveSignIn(e))}}class S{constructor(e){this._delegate=e,this.multiFactor=r.T(e)}static getOrCreate(e){return S.USER_MAP.has(e)||S.USER_MAP.set(e,new S(e)),S.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return _(this.auth,r.P(this._delegate,e))}async linkWithPhoneNumber(e,t){return E(this.auth,r.Q(this._delegate,e,t))}async linkWithPopup(e){return _(this.auth,r.R(this._delegate,e,y))}async linkWithRedirect(e){return await g(r.q(this.auth)),r.S(this._delegate,e,y)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return _(this.auth,r.U(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return E(this.auth,r.V(this._delegate,e,t))}reauthenticateWithPopup(e){return _(this.auth,r.W(this._delegate,e,y))}async reauthenticateWithRedirect(e){return await g(r.q(this.auth)),r.X(this._delegate,e,y)}sendEmailVerification(e){return r.Y(this._delegate,e)}async unlink(e){return await r.jb(this._delegate,e),this}updateEmail(e){return r.kb(this._delegate,e)}updatePassword(e){return r.lb(this._delegate,e)}updatePhoneNumber(e){return r.mb(this._delegate,e)}updateProfile(e){return r.nb(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return r.ob(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}S.USER_MAP=new WeakMap;const I=r.p;class k{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;I(n,"invalid-api-key",{appName:e.name}),I(n,"invalid-api-key",{appName:e.name});const i="undefined"!=typeof window?y:void 0;this._delegate=t.initialize({options:{persistence:O(n,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(r.H),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?S.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){r.E(this._delegate,e,t)}applyActionCode(e){return r.y(this._delegate,e)}checkActionCode(e){return r.C(this._delegate,e)}confirmPasswordReset(e,t){return r.D(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return _(this._delegate,r.G(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return r.I(this._delegate,e)}isSignInWithEmailLink(e){return r.O(this._delegate,e)}async getRedirectResult(){I(d(),this._delegate,"operation-not-supported-in-this-environment");const e=await r.L(this._delegate,y);return e?_(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){r.x(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=A(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=A(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return r.ab(this._delegate,e,t)}sendPasswordResetEmail(e,t){return r.Z(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){p(Object.values(f).includes(t),e,"invalid-persistence-type"),Object(s.A)()?p(t!==f.SESSION,e,"unsupported-persistence-type"):Object(s.z)()?p(t===f.NONE,e,"unsupported-persistence-type"):l()?p(t===f.NONE||t===f.LOCAL&&Object(s.x)(),e,"unsupported-persistence-type"):p(t===f.NONE||u(),e,"unsupported-persistence-type")}(this._delegate,e),e){case f.SESSION:t=r.B;break;case f.LOCAL:t=await r.t(r.N)._isAvailable()?r.N:r.z;break;case f.NONE:t=r.M;break;default:return r.r("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return _(this._delegate,r.bb(this._delegate))}signInWithCredential(e){return _(this._delegate,r.cb(this._delegate,e))}signInWithCustomToken(e){return _(this._delegate,r.db(this._delegate,e))}signInWithEmailAndPassword(e,t){return _(this._delegate,r.eb(this._delegate,e,t))}signInWithEmailLink(e,t){return _(this._delegate,r.fb(this._delegate,e,t))}signInWithPhoneNumber(e,t){return E(this._delegate,r.gb(this._delegate,e,t))}async signInWithPopup(e){return I(d(),this._delegate,"operation-not-supported-in-this-environment"),_(this._delegate,r.hb(this._delegate,e,y))}async signInWithRedirect(e){return I(d(),this._delegate,"operation-not-supported-in-this-environment"),await g(this._delegate),r.ib(this._delegate,e,y)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return r.pb(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function A(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&S.getOrCreate(e)),error:t,complete:n}}function O(e,t){const n=function(e,t){const n=m();if(!n)return[];const i=r.w("persistence",e,t);switch(n.getItem(i)){case f.NONE:return[r.M];case f.LOCAL:return[r.N,r.B];case f.SESSION:return[r.B];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(r.N)||n.push(r.N),"undefined"!=typeof window)for(const e of[r.z,r.B])n.includes(e)||n.push(e);return n.includes(r.M)||n.push(r.M),n}k.Persistence=f;class x{constructor(){this.providerId="phone",this._delegate=new r.i(b(t.a.auth()))}static credential(e,t){return r.i.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}x.PHONE_SIGN_IN_METHOD=r.i.PHONE_SIGN_IN_METHOD,x.PROVIDER_ID=r.i.PROVIDER_ID;const C=r.p;class R{constructor(e,n,i=t.a.app()){var s;C(null===(s=i.options)||void 0===s?void 0:s.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new r.l(e,n,i.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var D;(D=t.a).INTERNAL.registerComponent(new i.a("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new k(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:r.a.EMAIL_SIGNIN,PASSWORD_RESET:r.a.PASSWORD_RESET,RECOVER_EMAIL:r.a.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:r.a.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:r.a.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:r.a.VERIFY_EMAIL}},EmailAuthProvider:r.c,FacebookAuthProvider:r.d,GithubAuthProvider:r.e,GoogleAuthProvider:r.f,OAuthProvider:r.h,SAMLAuthProvider:r.n,PhoneAuthProvider:x,PhoneMultiFactorGenerator:r.j,RecaptchaVerifier:R,TwitterAuthProvider:r.o,Auth:k,AuthCredential:r.b,Error:s.c}).setInstantiationMode("LAZY").setMultipleInstances(!1)),D.registerVersion("@firebase/auth-compat","0.3.0")}).call(this,n(19))},function(e,t,n){"use strict";(function(e){var r=n(45),i=n(46),s=n(47);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=o(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|f(t.length);return 0===(e=o(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?o(e,0):h(e,t);if("Buffer"===t.type&&s(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(l(t),e=o(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=o(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return B(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return I(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var s,a=1,o=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,o/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*a}else-1!==l&&(s-=s-l),l=-1}else for(n+c>o&&(n=o-c),s=n;s>=0;s--){for(var d=!0,h=0;h<c;h++)if(u(e,s+h)!==u(t,h)){d=!1;break}if(d)return s}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[n+a]=o}return a}function w(e,t,n,r){return q(B(t,e.length-n),e,n,r)}function _(e,t,n,r){return q(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function E(e,t,n,r){return _(e,t,n,r)}function T(e,t,n,r){return q(V(t),e,n,r)}function S(e,t,n,r){return q(function(e,t){for(var n,r,i,s=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,i=n%256,s.push(i),s.push(r);return s}(t,e.length-n),e,n,r)}function I(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,c,u=e[i],l=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(s=e[i+1]))&&(c=(31&u)<<6|63&s)>127&&(l=c);break;case 3:s=e[i+1],a=e[i+2],128==(192&s)&&128==(192&a)&&(c=(15&u)<<12|(63&s)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(c=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=U(e[s]);return i}function C(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function R(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,n,r,i,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function P(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,r,s){return s||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,s){return s||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?o(e,t):void 0!==n?"string"==typeof r?o(e,t).fill(n,r):o(e,t).fill(n):o(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return d(null,e)},c.allocUnsafeSlow=function(e){return d(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),o=Math.min(s,a),u=this.slice(r,i),l=e.slice(t,n),d=0;d<o;++d)if(u[d]!==l[d]){s=u[d],a=l[d];break}return s<a?-1:a<s?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||R(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||R(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||R(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||R(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||R(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||R(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||R(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||R(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||R(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||R(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||D(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||D(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);D(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);D(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=c.isBuffer(e)?e:B(new c(e,r).toString()),o=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%o]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function B(e,t){var n;t=t||1/0;for(var r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function V(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(19))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),a=r[0],o=r[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,a,o)),l=0,d=o>0?a-4:a;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;return 2===o&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[l++]=255&t),1===o&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(l(e,a,a+16383>o?o:a+16383));return 1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,c=a.length;o<c;++o)r[o]=a[o],i[a.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,s,a=[],o=t;o<n;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,c=(1<<o)-1,u=c>>1,l=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,s=f&(1<<-l)-1,f>>=-l,l+=o;l>0;s=256*s+e[t+d],d+=h,l-=8);for(a=s&(1<<-l)-1,s>>=-l,l+=r;l>0;a=256*a+e[t+d],d+=h,l-=8);if(0===s)s=1-u;else{if(s===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),s-=u}return(f?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,c,u=8*s-i-1,l=(1<<u)-1,d=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(o=0,a=l):a+d>=1?(o=(t*c-1)*Math.pow(2,i),a+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+f]=255&a,f+=p,a/=256,u-=8);e[n+f-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";n.r(t);var r=n(32),i=n.n(r),s=n(7),a=n.n(s),o=n(33),c=n.n(o),u=n(14),l=n.n(u),d=n(4),h=n.n(d),f=n(6),p=n.n(f),g=function e(t,n,r){var i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"en";l()(this,e),p()(this,"open",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.features.getSpeechRecognition().then((function(e){var t=new e;return t.lang=i.ttsLanguage,t.interimResults=!1,t.maxAlternatives=1,t.onresult=function(e){for(var t=0;t<e.results.length;t++)for(var n=e.results[t],r=n.isFinal,s=0;s<n.length&&s<1;s++){var a=n[s];i.cbx({type:"Transcript",transcript:a.transcript,confidence:a.confidence,isFinal:r})}},t.onerror=function(e){console.log("WebSpeech error: ".concat(e.error)),this.bot.audioInputCallback()},t.onnomatch=function(e){console.log("No match received"),this.bot.audioInputCallback()},t.addEventListener("audioend",(function(){console.log("Audio capturing ended"),i.bot.audioInputCallback()})),i.recognition=t,Promise.resolve()})));case 1:case"end":return e.stop()}}),e)})))),p()(this,"setLanguage",(function(e){i.recognition&&(i.ttsLanguage=e,i.recognition.lang=i.ttsLanguage,console.log("Recognition language changed to ",i.recognition.lang))})),p()(this,"start",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.recognition.start(),i.cbx({type:"Event",eventType:"InputAudioStreamOpen"}),e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),p()(this,"stop",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.recognition.stop(),e.abrupt("return",Promise.resolve());case 2:case"end":return e.stop()}}),e)})))),p()(this,"close",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.recognition=null,e.abrupt("return",Promise.resolve());case 2:case"end":return e.stop()}}),e)})))),this.features=t,this.cbx=n,this.ttsLanguage=s,this.bot=r,console.log("Google STT is being used")},m=function e(t,n,r,i){var s=this;l()(this,e),p()(this,"close",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.audioContext){e.next=4;break}return e.next=3,s.audioContext.close();case 3:s.audioContext=null;case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})))),p()(this,"streamAudioData",(function(e){var t=e.inputBuffer.getChannelData(0),n=Int16Array.from(t.map((function(e){var t=e<0?32768*e:32767*e;return Math.max(-32768,Math.min(32768,t))})));s.webSocket.send(n)})),p()(this,"event",(function(e){if("InputAudioStreamOpen"===e.type){var t=s.audioContext,n=s.stream;s.scriptProcessor=null;var r=t.createGain();if(null===n)return;var i=t.createMediaStreamSource(n),a=t.createAnalyser();s.scriptProcessor=r.context.createScriptProcessor(2048,2,2),i.connect(r),r.connect(a),r.connect(s.scriptProcessor),s.scriptProcessor.connect(r.context.destination),s.scriptProcessor.addEventListener("audioprocess",s.streamAudioData)}})),p()(this,"start",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.audioContext){e.next=8;break}if("suspended"!==s.audioContext.state){e.next=5;break}return e.abrupt("return",s.audioContext.resume().then((function(){return s.init()})));case 5:if("running"!==s.audioContext.state){e.next=7;break}return e.abrupt("return",s.init());case 7:return e.abrupt("return",Promise.reject("Unhandled AudioContext state [".concat(s.audioContext.state,"]")));case 8:return e.abrupt("return",s.features.getAudioContext().then((function(e){return s.audioContext=new e,s.sampleRate=s.audioContext.sampleRate,s.init()})));case 9:case"end":return e.stop()}}),e)})))),p()(this,"init",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.features.getUserMedia().then((function(){return navigator.mediaDevices.getUserMedia({audio:!0})})).then((function(e){return s.stream=e,s.sendAudioOpen(),Promise.resolve()})));case 1:case"end":return e.stop()}}),e)})))),p()(this,"stop",function(){var e=a()(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&s.sendAudioClose(),s.scriptProcessor&&(s.scriptProcessor.removeEventListener("audioprocess",s.streamAudioData),s.scriptProcessor=null),s.stream&&(s.stream.getTracks().forEach((function(e){e.stop()})),s.stream=null),e.abrupt("return",s.audioContext.suspend());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.webSocket=n,this.features=t,this.sendAudioOpen=r,this.sendAudioClose=i},v=function e(t,n,r,i,s,o){var c=this;l()(this,e),p()(this,"detectEngine",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.features.detect("SpeechRecognition").then((function(e){return e?Promise.resolve("web-speech-api"):Promise.resolve("audio-stream-api")})).catch((function(){return Promise.resolve("audio-stream-api")})));case 1:case"end":return e.stop()}}),e)})))),p()(this,"getEngine",(function(){return c.api})),p()(this,"selectEngine",(function(e){c.api===e&&c.stt||("audio-stream-api"===e?(c.api="audio-stream-api",c.stt=new m(c.features,c.webSocket,c.sendAudioOpen,c.sendAudioClose)):"web-speech-api"===e&&(c.api="web-speech-api",c.stt=new g(c.features,c.callback,c.bot)))})),p()(this,"selectLanguage",(function(e){"web-speech-api"===c.api&&c.stt.setLanguage(e)})),p()(this,"open",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.stt.open){e.next=2;break}return e.abrupt("return",c.stt.open());case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),p()(this,"start",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.stt.start){e.next=2;break}return e.abrupt("return",c.stt.start());case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),p()(this,"stop",function(){var e=a()(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.stt.stop){e.next=2;break}return e.abrupt("return",c.stt.stop(t));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),p()(this,"close",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.stt.close){e.next=2;break}return e.abrupt("return",c.stt.close());case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),p()(this,"event",function(){var e=a()(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.stt.event){e.next=3;break}return console.log("cross browser stt event",c.stt),e.abrupt("return",c.stt.event(t));case 3:return e.abrupt("return",Promise.resolve());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.features=t,this.webSocket=n,this.callback=r,this.sendAudioOpen=i,this.sendAudioClose=s,this.bot=o,this.api=void 0},y=Intl.DateTimeFormat,b=function e(t,n,r,i,s){var o=this,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"cs-CZ",u=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,f=arguments.length>8?arguments[8]:void 0,g=arguments.length>9?arguments[9]:void 0;l()(this,e),p()(this,"setLanguage",(function(e){o.stt.selectLanguage(e)})),p()(this,"onSttCallback",(function(e){var t=e.type,n=e.transcript,r=e.isFinal,i=e.eventType;"Transcript"===t?r&&(o.sendText(n),o.callback({type:"Recognized",message:{items:[{text:n}]}})):"Event"===t&&o.callback({type:i})})),p()(this,"open",a()(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.webSocket=new WebSocket(o.wsUrl),o.stt=new v(o.features,o.webSocket,o.onSttCallback,o.sendAudioOpen,o.sendAudioClose,o.bot),t=o.bot.botCallback.getVoice(),n=void 0===t?o.language:o.voices[t],o.stt.detectEngine().then((function(e){return o.stt.selectEngine(e)})).then((function(){o.stt.selectLanguage(n),o.stt.open()})),o.webSocket.onmessage=function(e){if(e.data instanceof ArrayBuffer)o.replay(e.data);else if(e.data instanceof Blob)new Response(e.data).arrayBuffer().then(o.replay);else if("string"==typeof e.data){var t=JSON.parse(e.data);o.stt.event(t),o.callback(t)}},o.webSocket.onerror=function(e){o.errorCallback({type:"Client",message:"Socket error:  ".concat(e)})},o.webSocket.onclose=function(e){console.log("Reason for websocket closing: ",e.reason)},e.abrupt("return",new Promise((function(e){o.webSocket.onopen=function(){o.sendPing(o),o.webSocket.send(JSON.stringify({type:"Init",key:o.key,appKey:o.key,deviceId:o.deviceId,sender:o.deviceId,token:o.token,config:{tts:"RequiredLinks",sttSampleRate:44100,ttsFileType:o.ttsFileType,locale:n,zoneId:y().resolvedOptions().timeZone,voice:t,sendResponseItems:!0,sttInterimResults:!0}})),e()}})));case 9:case"end":return e.stop()}}),e)})))),p()(this,"sendPing",(function(e){window.setTimeout((function(){e.webSocket&&null!==e.sessionId&&(e.webSocket.send(new Int16Array),e.sendPing(e))}),1e4)})),p()(this,"getStt",(function(){return o.stt})),p()(this,"close",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.stt.close();case 2:return o.webSocket&&(o.webSocket.close(),o.webSocket=null),e.abrupt("return",Promise.resolve());case 4:case"end":return e.stop()}}),e)})))),p()(this,"sendText",function(){var e=a()(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={zoneId:y().resolvedOptions().timeZone,locale:o.language,attributes:o.bot.botCallback.getAttributes(),transcript:{text:t}},!o.webSocket){e.next=8;break}if(1!==o.webSocket.readyState){e.next=7;break}return o.webSocket.send(JSON.stringify({type:"Input",input:n})),e.abrupt("return",Promise.resolve());case 7:return e.abrupt("return",Promise.reject("Incorrect websocket state"));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),p()(this,"sendLogs",(function(e){o.webSocket&&o.webSocket.send(JSON.stringify({type:"Log",entries:e}))})),p()(this,"sendAudioOpen",(function(){o.webSocket&&o.sessionId&&o.webSocket.send(JSON.stringify({type:"InputAudioStreamOpen",message:{appKey:o.key,deviceId:o.deviceId,sender:o.deviceId,token:o.token,sessionId:o.sessionId},appKey:o.key}))})),p()(this,"sendAudioClose",(function(){o.webSocket&&o.webSocket.send(JSON.stringify({type:"InputAudioStreamClose",appKey:o.key}))})),p()(this,"replay",function(){var e=a()(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.features.getAudioContext().then((function(e){var n=new e;return n.decodeAudioData(t).then((function(e){var t=n.createBufferSource();t.buffer=e,t.connect(n.destination),t.onended=function(){n.close()},t.start(0)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),p()(this,"setSessionId",(function(e){o.sessionId=e})),this.features=t,this.wsUrl=n,this.key=s,this.callback=r,this.errorCallback=i,this.language=c,this.muted=!1,this.deviceId=u,this.bot=d,this.token=f,this.ttsFileType=g,this.voices={George:"en",Grace:"en",Gordon:"en",Gwyneth:"en",Gabriela:"cs",Anthony:"en",Audrey:"en",Arthur:"en",Amy:"en",Michael:"en",Mary:"en",Milan:"cs",Victor:"en",Victoria:"en"}},w=function e(){var t=this;l()(this,e),p()(this,"getUserMedia",a()(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.getUserMedia){e.next=2;break}return e.abrupt("return",Promise.resolve(t.state.getUserMedia));case 2:if(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0!==navigator.mediaDevices.getUserMedia){e.next=8;break}if(n=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||!1){e.next=7;break}return e.abrupt("return",Promise.reject(new Error("getUserMedia is not implemented in this browser")));case 7:navigator.mediaDevices.getUserMedia=function(e){return new Promise((function(t,r){n.call(navigator,e,t,r)}))};case 8:return t.state.getUserMedia=navigator.mediaDevices.getUserMedia,e.abrupt("return",Promise.resolve(t.state.getUserMedia));case 10:case"end":return e.stop()}}),e)})))),p()(this,"getAudioContext",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.AudioContext){e.next=2;break}return e.abrupt("return",Promise.resolve(t.state.AudioContext));case 2:if(t.state.AudioContext=window.AudioContext||window.webkitAudioContext||!1,!t.state.AudioContext){e.next=5;break}return e.abrupt("return",Promise.resolve(t.state.AudioContext));case 5:return e.abrupt("return",Promise.reject("AudioContext is not implemented in this browser"));case 6:case"end":return e.stop()}}),e)})))),p()(this,"getSpeechRecognitionOld",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Promise.resolve(!1);case 1:case"end":return e.stop()}}),e)})))),p()(this,"getSpeechRecognition",a()(h.a.mark((function e(){var n,r,i,s,a,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!!document.documentMode,r=!n&&!!window.StyleMedia,!(window.chrome&&(window.chrome.webstore||window.chrome.runtime)&&-1!==navigator.userAgent.indexOf("Edg")||r)){e.next=6;break}return e.abrupt("return",Promise.reject("Web Speech API.SpeechRecognition does not work in Edge"));case 6:if(!navigator.userAgent.includes("Edg")&&!navigator.userAgent.includes("Edge")){e.next=8;break}return e.abrupt("return",Promise.reject("Web Speech API.SpeechRecognition does not work in Edge"));case 8:if(i=navigator.userAgent,s=/IEMobile|Windows Phone|Lumia/i.test(i)?"w":/iPhone|iP[oa]d/.test(i)?"i":/Android/.test(i)?"a":/BlackBerry|PlayBook|BB10/.test(i)?"b":/Mobile Safari/.test(i)?"s":/webOS|Mobile|Tablet|Opera Mini|\bCrMo\/|Opera Mobi/i.test(i)?1:0,a=/Android/.test(i)?1:0,t.state.isAndroid=a,t.state.SpeechRecognition=window.SpeechRecognition||window.speechRecognition||window.webkitSpeechRecognition||!1,o=!1,(/android/i.test(navigator.userAgent)||/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)&&(o=!0),!t.state.SpeechRecognition){e.next=17;break}return e.abrupt("return",s&&!o?Promise.resolve(!1):Promise.resolve(t.state.SpeechRecognition));case 17:return e.abrupt("return",Promise.reject("Web Speech API.SpeechRecognition is not implemented in this browser"));case 18:case"end":return e.stop()}}),e)})))),p()(this,"getSpeechSynthesis",a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.SpeechSynthesis){e.next=2;break}return e.abrupt("return",Promise.resolve(t.state.SpeechSynthesis));case 2:if(t.state.SpeechSynthesis=window.speechSynthesis||window.webkitSpeechSynthesis||!1,!t.state.SpeechSynthesis){e.next=5;break}return e.abrupt("return",Promise.resolve(t.state.SpeechSynthesis));case 5:return e.abrupt("return",Promise.reject("Web Speech API.SpeechSynthesis is not implemented in this browser"));case 6:case"end":return e.stop()}}),e)})))),p()(this,"detect",function(){var e=a()(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="getUserMedia"===e.t0?3:"AudioContext"===e.t0?4:"SpeechRecognition"===e.t0?5:"SpeechSynthesis"===e.t0?6:7;break;case 3:return e.abrupt("return",Promise.resolve(t.getUserMedia()));case 4:return e.abrupt("return",Promise.resolve(t.getAudioContext()));case 5:return e.abrupt("return",Promise.resolve(t.getSpeechRecognition()));case 6:return e.abrupt("return",Promise.resolve(t.getSpeechSynthesis()));case 7:return e.abrupt("return",Promise.resolve(!1));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.state={getUserMedia:void 0,AudioContext:void 0,SpeechRecognition:void 0,SpeechSynthesis:void 0}},_=n(13);_.a.registerVersion("firebase","9.15.0","app-compat");var E=n(5),T=n(10),S=n(0),I=n(9),k=n(26);const A={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},O=new S.b("installations","Installations",A);function x(e){return e instanceof S.c&&e.code.includes("request-failed")}function C({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function R(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function D(e,t){const n=(await t.json()).error;return O.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function L({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function P(e,{refreshToken:t}){const n=L(e);return n.append("Authorization",function(e){return"FIS_v2 "+e}(t)),n}async function N(e){const t=await e();return t.status>=500&&t.status<600?e():t}function M(e){return new Promise((t=>{setTimeout(t,e)}))}const j=/^[cdef][\w-]{21}$/;function F(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var t}(e);return j.test(t)?t:""}catch(e){return""}}function U(e){return`${e.appName}!${e.appId}`}const B=new Map;function V(e,t){const n=U(e);q(n,t),function(e,t){const n=K();n&&n.postMessage({key:e,fid:t}),z()}(n,t)}function q(e,t){const n=B.get(e);if(n)for(const e of n)e(t)}let G=null;function K(){return!G&&"BroadcastChannel"in self&&(G=new BroadcastChannel("[Firebase] FID Change"),G.onmessage=e=>{q(e.data.key,e.data.fid)}),G}function z(){0===B.size&&G&&(G.close(),G=null)}const H="firebase-installations-store";let W=null;function $(){return W||(W=Object(k.a)("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(H)}})),W}async function Y(e,t){const n=U(e),r=(await $()).transaction(H,"readwrite"),i=r.objectStore(H),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||V(e,t.fid),t}async function Q(e){const t=U(e),n=(await $()).transaction(H,"readwrite");await n.objectStore(H).delete(t),await n.done}async function X(e,t){const n=U(e),r=(await $()).transaction(H,"readwrite"),i=r.objectStore(H),s=await i.get(n),a=t(s);return void 0===a?await i.delete(n):await i.put(a,n),await r.done,!a||s&&s.fid===a.fid||V(e,a.fid),a}async function J(e){let t;const n=await X(e.appConfig,(n=>{const r=function(e){return te(e||{fid:F(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(O.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=C(e),i=L(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const a={fid:n,authVersion:"FIS_v2",appId:e.appId,sdkVersion:"w:0.6.0"},o={method:"POST",headers:i,body:JSON.stringify(a)},c=await N((()=>fetch(r,o)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:R(e.authToken)}}throw await D("Create Installation",c)}(e,t);return Y(e.appConfig,n)}catch(n){throw x(n)&&409===n.customData.serverCode?await Q(e.appConfig):await Y(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Z(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Z(e){let t=await ee(e.appConfig);for(;1===t.registrationStatus;)await M(100),t=await ee(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await J(e);return n||t}return t}function ee(e){return X(e,(e=>{if(!e)throw O.create("installation-not-found");return te(e)}))}function te(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function ne({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${C(e)}/${t}/authTokens:generate`}(e,n),i=P(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const a={installation:{sdkVersion:"w:0.6.0",appId:e.appId}},o={method:"POST",headers:i,body:JSON.stringify(a)},c=await N((()=>fetch(r,o)));if(c.ok)return R(await c.json());throw await D("Generate Auth Token",c)}async function re(e,t=!1){let n;const r=await X(e.appConfig,(r=>{if(!se(r))throw O.create("not-registered");const i=r.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(e)}(i))return r;if(1===i.requestStatus)return n=async function(e,t){let n=await ie(e.appConfig);for(;1===n.authToken.requestStatus;)await M(100),n=await ie(e.appConfig);const r=n.authToken;return 0===r.requestStatus?re(e,t):r}(e,t),r;{if(!navigator.onLine)throw O.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await ne(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await Y(e.appConfig,r),n}catch(n){if(!x(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Y(e.appConfig,n)}else await Q(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function ie(e){return X(e,(e=>{if(!se(e))throw O.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function se(e){return void 0!==e&&2===e.registrationStatus}async function ae(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await J(e);t&&await t}(n),(await re(n,t)).token}function oe(e){return O.create("missing-app-config-values",{valueName:e})}const ce=e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw oe("App Configuration");if(!e.name)throw oe("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw oe(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:Object(E._getProvider)(t,"heartbeat"),_delete:()=>Promise.resolve()}},ue=e=>{const t=e.getProvider("app").getImmediate(),n=Object(E._getProvider)(t,"installations").getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await J(t);return r?r.catch(console.error):re(t).catch(console.error),n.fid}(n),getToken:e=>ae(n,e)}};Object(E._registerComponent)(new I.a("installations",ce,"PUBLIC")),Object(E._registerComponent)(new I.a("installations-internal",ue,"PRIVATE")),Object(E.registerVersion)("@firebase/installations","0.6.0"),Object(E.registerVersion)("@firebase/installations","0.6.0","esm2017");const le="https://www.googletagmanager.com/gtag/js",de=new T.b("@firebase/analytics");function he(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}function fe(e,t,n,r){return async function(i,s,a){try{"event"===i?await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await he(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){de.error(e)}}(e,t,n,s,a):"config"===i?await async function(e,t,n,r,i,s){const a=r[i];try{if(a)await t[a];else{const e=(await he(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){de.error(e)}e("config",i,s)}(e,t,n,r,s,a):"consent"===i?e("consent","update",a):e("set",s)}catch(e){de.error(e)}}}const pe={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},ge=new S.b("analytics","Analytics",pe),me=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function ve(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function ye(e,t=me,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw ge.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw ge.create("no-api-key")}const a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new be;return setTimeout((async()=>{o.abort()}),void 0!==n?n:6e4),async function e(t,{throttleEndTimeMillis:n,backoffCount:r},i,s=me){var a;const{appId:o,measurementId:c}=t;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(ge.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,n)}catch(e){if(c)return de.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:c};throw e}try{const e=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:ve(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),a=await fetch(s,i);if(200!==a.status&&304!==a.status){let n="";try{const e=await a.json();(null===(t=e.error)||void 0===t?void 0:t.message)&&(n=e.error.message)}catch(e){}throw ge.create("config-fetch-failed",{httpStatus:a.status,responseMessage:n})}return a.json()}(t);return s.deleteThrottleMetadata(o),e}catch(n){const u=n;if(!function(e){if(!(e instanceof S.c&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(u)){if(s.deleteThrottleMetadata(o),c)return de.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+c+` provided in the "measurementId" field in the local Firebase config. [${null==u?void 0:u.message}]`),{appId:o,measurementId:c};throw n}const l=503===Number(null===(a=null==u?void 0:u.customData)||void 0===a?void 0:a.httpStatus)?Object(S.g)(r,s.intervalMillis,30):Object(S.g)(r,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+l,backoffCount:r+1};return s.setThrottleMetadata(o,d),de.debug(`Calling attemptFetch again in ${l} millis`),e(t,d,i,s)}}({appId:r,apiKey:i,measurementId:s},a,o,t)}class be{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let we,_e;function Ee(e){_e=e}function Te(e){we=e}async function Se(e,t,n,r,i,s,a){var o;const c=ye(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&de.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>de.error(e))),t.push(c);const u=async function(){if(!Object(S.x)())return de.warn(ge.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Object(S.E)()}catch(e){return de.warn(ge.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[l,d]=await Promise.all([c,u]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(le)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=document.createElement("script");n.src=`${le}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,l.measurementId),_e&&(i("consent","default",_e),Ee(void 0)),i("js",new Date);const h=null!==(o=null==a?void 0:a.config)&&void 0!==o?o:{};return h.origin="firebase",h.update=!0,null!=d&&(h.firebase_id=d),i("config",l.measurementId,h),we&&(i("set",we),Te(void 0)),l.measurementId}class Ie{constructor(e){this.app=e}_delete(){return delete ke[this.app.options.appId],Promise.resolve()}}let ke={},Ae=[];const Oe={};let xe,Ce,Re="dataLayer",De="gtag",Le=!1;function Pe(e){if(Le)throw ge.create("already-initialized");e.dataLayerName&&(Re=e.dataLayerName),e.gtagName&&(De=e.gtagName)}function Ne(e,t,n){!function(){const e=[];if(Object(S.u)()&&e.push("This is a browser extension environment."),Object(S.d)()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=ge.create("invalid-analytics-context",{errorInfo:t});de.warn(n.message)}}();const r=e.options.appId;if(!r)throw ge.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw ge.create("no-api-key");de.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=ke[r])throw ge.create("already-exists",{id:r});if(!Le){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Re);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=fe(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(ke,Ae,Oe,Re,De);Ce=e,xe=t,Le=!0}return ke[r]=Se(e,Ae,Oe,t,xe,Re,n),new Ie(e)}async function Me(){if(Object(S.u)())return!1;if(!Object(S.d)())return!1;if(!Object(S.x)())return!1;try{return await Object(S.E)()}catch(e){return!1}}function je(e,t,n){e=Object(S.r)(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(Ce,ke[e.app.options.appId],t,n).catch((e=>de.error(e)))}function Fe(e,t,n){e=Object(S.r)(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(Ce,ke[e.app.options.appId],t,n).catch((e=>de.error(e)))}function Ue(e,t,n){e=Object(S.r)(e),async function(e,t,n,r){if(r&&r.global){const t={};for(const e of Object.keys(n))t["user_properties."+e]=n[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Ce,ke[e.app.options.appId],t,n).catch((e=>de.error(e)))}function Be(e,t){e=Object(S.r)(e),async function(e,t){const n=await e;window["ga-disable-"+n]=!t}(ke[e.app.options.appId],t).catch((e=>de.error(e)))}function Ve(e,t,n,r){e=Object(S.r)(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(Ce,ke[e.app.options.appId],t,n,r).catch((e=>de.error(e)))}Object(E._registerComponent)(new I.a("analytics",((e,{options:t})=>Ne(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),Object(E._registerComponent)(new I.a("analytics-internal",(function(e){try{const t=e.getProvider("analytics").getImmediate();return{logEvent:(e,n,r)=>Ve(t,e,n,r)}}catch(e){throw ge.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Object(E.registerVersion)("@firebase/analytics","0.9.0"),Object(E.registerVersion)("@firebase/analytics","0.9.0","esm2017");class qe{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Ve(this._delegate,e,t,n)}setCurrentScreen(e,t){je(this._delegate,e,t)}setUserId(e,t){Fe(this._delegate,e,t)}setUserProperties(e,t){Ue(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Be(this._delegate,e)}}var Ge;!function(e){e.ADD_SHIPPING_INFO="add_shipping_info",e.ADD_PAYMENT_INFO="add_payment_info",e.ADD_TO_CART="add_to_cart",e.ADD_TO_WISHLIST="add_to_wishlist",e.BEGIN_CHECKOUT="begin_checkout",e.CHECKOUT_PROGRESS="checkout_progress",e.EXCEPTION="exception",e.GENERATE_LEAD="generate_lead",e.LOGIN="login",e.PAGE_VIEW="page_view",e.PURCHASE="purchase",e.REFUND="refund",e.REMOVE_FROM_CART="remove_from_cart",e.SCREEN_VIEW="screen_view",e.SEARCH="search",e.SELECT_CONTENT="select_content",e.SELECT_ITEM="select_item",e.SELECT_PROMOTION="select_promotion",e.SET_CHECKOUT_OPTION="set_checkout_option",e.SHARE="share",e.SIGN_UP="sign_up",e.TIMING_COMPLETE="timing_complete",e.VIEW_CART="view_cart",e.VIEW_ITEM="view_item",e.VIEW_ITEM_LIST="view_item_list",e.VIEW_PROMOTION="view_promotion",e.VIEW_SEARCH_RESULTS="view_search_results"}(Ge||(Ge={}));const Ke=e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new qe(t,n)};!function(){const e={Analytics:qe,settings:Pe,isSupported:Me,EventName:Ge};_.a.INTERNAL.registerComponent(new I.a("analytics-compat",Ke,"PUBLIC").setServiceProps(e).setMultipleInstances(!0))}(),_.a.registerVersion("@firebase/analytics-compat","0.2.0"),n(43);var ze=n(3);function He(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new ze.g("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function We(){if("undefined"==typeof Uint8Array)throw new ze.g("unimplemented","Uint8Arrays are not available in this environment.")}function $e(){if(!Object(ze.r)())throw new ze.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Ye{constructor(e){this._delegate=e}static fromBase64String(e){return $e(),new Ye(ze.b.fromBase64String(e))}static fromUint8Array(e){return We(),new Ye(ze.b.fromUint8Array(e))}toBase64(){return $e(),this._delegate.toBase64()}toUint8Array(){return We(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Qe(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of t)if(e in n&&"function"==typeof n[e])return!0;return!1}(e,["next","error","complete"])}class Xe{enableIndexedDbPersistence(e,t){return Object(ze.F)(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Object(ze.G)(e._delegate)}clearIndexedDbPersistence(e){return Object(ze.x)(e._delegate)}}class Je{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ze.m||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Object(ze.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Object(ze.A)(this._delegate,e,t,n)}enableNetwork(){return Object(ze.H)(this._delegate)}disableNetwork(){return Object(ze.D)(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Object(ze.t)("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(ze.lb)(this._delegate)}onSnapshotsInSync(e){return Object(ze.Y)(this._delegate,e)}get app(){if(!this._appCompat)throw new ze.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ht(this,Object(ze.y)(this._delegate,e))}catch(e){throw it(e,"collection()","Firestore.collection()")}}doc(e){try{return new rt(this,Object(ze.E)(this._delegate,e))}catch(e){throw it(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ut(this,Object(ze.z)(this._delegate,e))}catch(e){throw it(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Object(ze.db)(this._delegate,(t=>e(new et(this,t))))}batch(){return Object(ze.K)(this._delegate),new tt(new ze.l(this._delegate,(e=>Object(ze.L)(this._delegate,e))))}loadBundle(e){return Object(ze.V)(this._delegate,e)}namedQuery(e){return Object(ze.W)(this._delegate,e).then((e=>e?new ut(this,e):null))}}class Ze extends ze.a{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ye(new ze.b(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return rt.forKey(t,this.firestore,null)}}class et{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ze(e)}get(e){const t=ft(e);return this._delegate.get(t).then((e=>new ot(this._firestore,new ze.e(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=ft(e);return n?(He("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=ft(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=ft(e);return this._delegate.delete(t),this}}class tt{constructor(e){this._delegate=e}set(e,t,n){const r=ft(e);return n?(He("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=ft(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=ft(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class nt{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new ze.i(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ct(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=nt.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new nt(e,new Ze(e),t),r.set(t,i)),i}}nt.INSTANCES=new WeakMap;class rt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ze(e)}static forPath(e,t,n){if(e.length%2!=0)throw new ze.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new rt(t,new ze.d(t._delegate,n,new ze.n(e)))}static forKey(e,t,n){return new rt(t,new ze.d(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new ht(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ht(this.firestore,Object(ze.y)(this._delegate,e))}catch(e){throw it(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Object(S.r)(e))instanceof ze.d&&Object(ze.cb)(this._delegate,e)}set(e,t){t=He("DocumentReference.set",t);try{return t?Object(ze.fb)(this._delegate,e,t):Object(ze.fb)(this._delegate,e)}catch(e){throw it(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Object(ze.kb)(this._delegate,e):Object(ze.kb)(this._delegate,e,t,...n)}catch(e){throw it(e,"updateDoc()","DocumentReference.update()")}}delete(){return Object(ze.B)(this._delegate)}onSnapshot(...e){const t=st(e),n=at(e,(e=>new ot(this.firestore,new ze.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Object(ze.X)(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(ze.N)(this._delegate):"server"===(null==e?void 0:e.source)?Object(ze.O)(this._delegate):Object(ze.M)(this._delegate),t.then((e=>new ot(this.firestore,new ze.e(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new rt(this.firestore,e?this._delegate.withConverter(nt.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function it(e,t,n){return e.message=e.message.replace(t,n),e}function st(e){for(const t of e)if("object"==typeof t&&!Qe(t))return t;return{}}function at(e,t){var n,r;let i;return i=Qe(e[0])?e[0]:Qe(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class ot{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new rt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Object(ze.hb)(this._delegate,e._delegate)}}class ct extends ot{data(e){const t=this._delegate.data(e);return Object(ze.q)(void 0!==t,"Document in a QueryDocumentSnapshot should exist"),t}}class ut{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ze(e)}where(e,t,n){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.mb)(e,t,n)))}catch(e){throw it(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.Z)(e,t)))}catch(e){throw it(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.T)(e)))}catch(e){throw it(e,"limit()","Query.limit()")}}limitToLast(e){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.U)(e)))}catch(e){throw it(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.jb)(...e)))}catch(e){throw it(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.ib)(...e)))}catch(e){throw it(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.J)(...e)))}catch(e){throw it(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ut(this.firestore,Object(ze.ab)(this._delegate,Object(ze.I)(...e)))}catch(e){throw it(e,"endAt()","Query.endAt()")}}isEqual(e){return Object(ze.bb)(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?Object(ze.Q)(this._delegate):"server"===(null==e?void 0:e.source)?Object(ze.R)(this._delegate):Object(ze.P)(this._delegate),t.then((e=>new dt(this.firestore,new ze.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=st(e),n=at(e,(e=>new dt(this.firestore,new ze.j(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Object(ze.X)(this._delegate,t,n)}withConverter(e){return new ut(this.firestore,e?this._delegate.withConverter(nt.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class lt{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ct(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class dt{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ut(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new ct(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new lt(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new ct(this._firestore,n))}))}isEqual(e){return Object(ze.hb)(this._delegate,e._delegate)}}class ht extends ut{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new rt(this.firestore,e):null}doc(e){try{return new rt(this.firestore,void 0===e?Object(ze.E)(this._delegate):Object(ze.E)(this._delegate,e))}catch(e){throw it(e,"doc()","CollectionReference.doc()")}}add(e){return Object(ze.u)(this._delegate,e).then((e=>new rt(this.firestore,e)))}isEqual(e){return Object(ze.cb)(this._delegate,e._delegate)}withConverter(e){return new ht(this.firestore,e?this._delegate.withConverter(nt.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function ft(e){return Object(ze.p)(e,ze.d)}class pt{constructor(...e){this._delegate=new ze.f(...e)}static documentId(){return new pt(ze.o.keyField().canonicalString())}isEqual(e){return(e=Object(S.r)(e))instanceof ze.f&&this._delegate._internalPath.isEqual(e._internalPath)}}class gt{constructor(e){this._delegate=e}static serverTimestamp(){const e=Object(ze.eb)();return e._methodName="FieldValue.serverTimestamp",new gt(e)}static delete(){const e=Object(ze.C)();return e._methodName="FieldValue.delete",new gt(e)}static arrayUnion(...e){const t=Object(ze.w)(...e);return t._methodName="FieldValue.arrayUnion",new gt(t)}static arrayRemove(...e){const t=Object(ze.v)(...e);return t._methodName="FieldValue.arrayRemove",new gt(t)}static increment(e){const t=Object(ze.S)(e);return t._methodName="FieldValue.increment",new gt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const mt={Firestore:Je,GeoPoint:ze.h,Timestamp:ze.k,Blob:Ye,Transaction:et,WriteBatch:tt,DocumentReference:rt,DocumentSnapshot:ot,Query:ut,QueryDocumentSnapshot:ct,QuerySnapshot:dt,CollectionReference:ht,FieldPath:pt,FieldValue:gt,setLogLevel:function(e){Object(ze.gb)(e)},CACHE_SIZE_UNLIMITED:ze.c};var vt,yt;vt=_.a,yt=(e,t)=>new Je(e,t,new Xe),vt.INTERNAL.registerComponent(new I.a("firestore-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return yt(t,n)}),"PUBLIC").setServiceProps(Object.assign({},mt))),vt.registerVersion("@firebase/firestore-compat","0.3.0");var bt={},wt=void 0,_t=void 0;bt.initApp=function(){var e=_.a.initializeApp({apiKey:"AIzaSyDoCAwkF2PUX8ZW2eMbbjEeRFSGZAw1i_I",authDomain:"sop-generator.firebaseapp.com",projectId:"sop-generator",storageBucket:"sop-generator.appspot.com",messagingSenderId:"960257251812",appId:"1:960257251812:web:bd9053e7eaea74ad9c0ff1",measurementId:"G-P1HCJ2KTVM"});return wt=_.a.auth(),_t=_.a.firestore(),_.a.analytics(),{app:e}},bt.currentUser=function(){return wt.currentUser},bt.update=function(){var e=a()(h.a.mark((function e(t,n){var r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=_t.collection("Users").doc(t),e.next=3,r.update(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),bt.SignIn=a()(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _.a.auth.GoogleAuthProvider,e.next=3,wt.signInWithPopup(t);case 3:return n=e.sent,console.log(n),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)}))),bt.SignOut=function(){wt.signOut(),sessionStorage.removeItem("flowstorm-bot-user")},bt.checkExistingUser=function(){var e=a()(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get().catch((function(e){console.log("Error getting document:",e)}));case 2:if(!(n=e.sent).exists){e.next=8;break}return console.log("Document data:",n.data()),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),bt.findUser=function(){var e=a()(h.a.mark((function e(t){var n,r,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_t.collection("Users"),r=n.doc(t),e.next=4,r.get();case 4:return i=e.sent,console.log(i),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),bt.newUser=a()(h.a.mark((function e(){var t,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=bt.currentUser(),n=_t.collection("Users"),e.next=4,bt.checkExistingUser(n.doc(t._delegate.email));case 4:if(e.sent){e.next=10;break}return bt.SignOut(),e.abrupt("return",!1);case 10:return sessionStorage.setItem("flowstorm-bot-user",bt.currentUser()._delegate.email),e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})));var Et=bt,Tt=n(1),St=n(20),It=n(21),kt=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Tt.a.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},At=n(18),Ot=n(15);function xt(e,t){const n=this||At.a,r=t||n,i=Ot.a.from(r.headers);let s=r.data;return Tt.a.forEach(e,(function(e){s=e.call(n,s,i.normalize(),t?t.status:void 0)})),i.normalize(),s}function Ct(e){return!(!e||!e.__CANCEL__)}var Rt=n(17);function Dt(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Rt.a}function Lt(e){return Dt(e),e.headers=Ot.a.from(e.headers),e.data=xt.call(e,e.transformRequest),(e.adapter||At.a.adapter)(e).then((function(t){return Dt(e),t.data=xt.call(e,e.transformResponse,t),t.headers=Ot.a.from(t.headers),t}),(function(t){return Ct(t)||(Dt(e),t&&t.response&&(t.response.data=xt.call(e,e.transformResponse,t.response),t.response.headers=Ot.a.from(t.response.headers))),Promise.reject(t)}))}function Pt(e,t){t=t||{};const n={};function r(e,t){return Tt.a.isPlainObject(e)&&Tt.a.isPlainObject(t)?Tt.a.merge(e,t):Tt.a.isPlainObject(t)?Tt.a.merge({},t):Tt.a.isArray(t)?t.slice():t}function i(n){return Tt.a.isUndefined(t[n])?Tt.a.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function s(e){if(!Tt.a.isUndefined(t[e]))return r(void 0,t[e])}function a(n){return Tt.a.isUndefined(t[n])?Tt.a.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function o(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}const c={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o};return Tt.a.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){const t=c[e]||i,r=t(e);Tt.a.isUndefined(r)&&t!==o||(n[e]=r)})),n}var Nt=n(25),Mt=n(8);const jt={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{jt[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Ft={};jt.transitional=function(e,t,n){function r(e,t){return"[Axios v1.1.3] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,s)=>{if(!1===e)throw new Mt.a(r(i," has been removed"+(t?" in "+t:"")),Mt.a.ERR_DEPRECATED);return t&&!Ft[i]&&(Ft[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,s)}};var Ut={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Mt.a("options must be an object",Mt.a.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const s=r[i],a=t[s];if(a){const t=e[s],n=void 0===t||a(t,s,e);if(!0!==n)throw new Mt.a("option "+s+" must be "+n,Mt.a.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Mt.a("Unknown option "+s,Mt.a.ERR_BAD_OPTION)}},validators:jt};const Bt=Ut.validators;class Vt{constructor(e){this.defaults=e,this.interceptors={request:new kt,response:new kt}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Pt(this.defaults,t);const{transitional:n,paramsSerializer:r}=t;void 0!==n&&Ut.assertOptions(n,{silentJSONParsing:Bt.transitional(Bt.boolean),forcedJSONParsing:Bt.transitional(Bt.boolean),clarifyTimeoutError:Bt.transitional(Bt.boolean)},!1),void 0!==r&&Ut.assertOptions(r,{encode:Bt.function,serialize:Bt.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();const i=t.headers&&Tt.a.merge(t.headers.common,t.headers[t.method]);i&&Tt.a.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),t.headers=new Ot.a(t.headers,i);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const o=[];let c;this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)}));let u,l=0;if(!a){const e=[Lt.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,o),u=e.length,c=Promise.resolve(t);l<u;)c=c.then(e[l++],e[l++]);return c}u=s.length;let d=t;for(l=0;l<u;){const t=s[l++],n=s[l++];try{d=t(d)}catch(e){n.call(this,e);break}}try{c=Lt.call(this,d)}catch(e){return Promise.reject(e)}for(l=0,u=o.length;l<u;)c=c.then(o[l++],o[l++]);return c}getUri(e){e=Pt(this.defaults,e);const t=Object(Nt.a)(e.baseURL,e.url);return Object(It.a)(t,e.params,e.paramsSerializer)}}Tt.a.forEach(["delete","get","head","options"],(function(e){Vt.prototype[e]=function(t,n){return this.request(Pt(n||{},{method:e,url:t,data:(n||{}).data}))}})),Tt.a.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(Pt(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Vt.prototype[e]=t(),Vt.prototype[e+"Form"]=t(!0)}));var qt=Vt,Gt=n(24);class Kt{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new Rt.a(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new Kt((function(t){e=t})),cancel:e}}}var zt=Kt,Ht=n(16);const Wt=function e(t){const n=new qt(t),r=Object(St.a)(qt.prototype.request,n);return Tt.a.extend(r,qt.prototype,n,{allOwnKeys:!0}),Tt.a.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(Pt(t,n))},r}(At.a);Wt.Axios=qt,Wt.CanceledError=Rt.a,Wt.CancelToken=zt,Wt.isCancel=Ct,Wt.VERSION="1.1.3",Wt.toFormData=Ht.a,Wt.AxiosError=Mt.a,Wt.Cancel=Wt.CanceledError,Wt.all=function(e){return Promise.all(e)},Wt.spread=function(e){return function(t){return e.apply(null,t)}},Wt.isAxiosError=function(e){return Tt.a.isObject(e)&&!0===e.isAxiosError},Wt.formToJSON=e=>Object(Gt.a)(Tt.a.isHTMLForm(e)?new FormData(e):e);var $t=Wt;const{Axios:Yt,AxiosError:Qt,CanceledError:Xt,isCancel:Jt,CancelToken:Zt,VERSION:en,all:tn,Cancel:nn,isAxiosError:rn,spread:sn,toFormData:an}=$t;var on=$t;t.default=function(e,t,n,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mp3",o=function e(){l()(this,e)},u=null,d=[],f=void 0,p=!0,g=!0,m=!0,v=!1,y="#intro",_=void 0,E="en",T=["error"],S=void 0,I=arguments.length>4&&void 0!==arguments[4]&&!arguments[4]?new o:this;I.botCallback=r,I.sessionEnded=!1;var k=!1,A=0,O=!1,x=!1,C=!1,R=0,D=[],L="",P={listening:new Audio("https://repository.flowstorm.ai/audio/client/listening.mp3"),recognized:new Audio("https://repository.flowstorm.ai/audio/client/recognized.mp3"),waiting:new Audio("https://repository.flowstorm.ai/audio/client/waiting.mp3"),error:new Audio("https://repository.flowstorm.ai/audio/client/error.mp3"),sleep:new Audio("https://repository.flowstorm.ai/audio/client/sleep.mp3")},N=t;function M(){A=0;var t=(f=new Audio("https://repository.flowstorm.ai/audio/client/intro.mp3")).play();Et.initApp(),void 0!==t&&t.then((function(e){T.includes("intro")||(f.pause(),f.currentTime=0),console.log("Audio OK")})).catch((function(e){console.error(e)}));var n=function(e){P[e].volume=0,P[e].play().then((function(t){P[e].pause(),P[e].currentTime=0}))};for(var r in P)n(r);return R=Y(),console.log("Bot init"),j("INFO","Bot init"),(u=new b(new w,e.replace("http","ws")+"/socket/",G,U,_,E,N,I,S,s)).open().then((function(){})).catch((function(e){U({type:"Client",message:"Error opening socket:  ".concat(e)})})),this}function j(e,t){var n=new Date,r=(Y()-R)/1e3;D.push({time:n,relativeTime:r,level:e,text:t})}function F(e){j("INFO","Client status changed to "+e),r.setStatus({status:e})}function U(e){$("error"),j("ERROR",e.message),u.sendLogs(D),D=[],r.onError(e),I.onStopClick(),r.onEnd()}function B(e){return null!==e&&e}function V(){f.removeEventListener("ended",V),I.addRecord()}void 0===t&&void 0!==window.localStorage&&(null===localStorage.getItem("sender")?(N=c()(Array(16)).map((function(){return Math.floor(16*Math.random()).toString(16)})).join(""),localStorage.setItem("sender",N)):N=localStorage.getItem("sender")),I.pause=function(){F("PAUSED"),""!==f.src&&p&&f.pause()},I.resume=function(){F("RESPONDING"),""!==f.src&&p?f.play():p||(z(),F("LISTENING"))},I.inAudio=function(e){j("INFO","Input audio "+(g?"on":"off")),"LISTENING"===e&&(g?K(C):I.closeAudioStream("InputAudioEvent",!0))},I.setInAudio=function(e,t){j("INFO","Input audio "+((g=e)?"on":"off")),"LISTENING"===t&&(g?K(!0):I.closeAudioStream("InputAudioEvent",!0)),I.setInCallback()},I.setInCallback=function(){},I.setOutAudio=function(e,t){p!==e?(p?("RESPONDING"===t&&Q(),p=!1):p=!0,j("INFO","Output audio "+(p?"on":"off"))):j("INFO","Output audio "+(p?"on":"off"))},I.outAudio=function(e){p?("RESPONDING"===e&&Q(),p=!1):p=!0,j("INFO","Output audio "+(p?"on":"off"))},I.getOutAudio=function(){return p},I.click=function(e){"RESPONDING"===(j("INFO","Click on state "+e),e)&&Q()},I.playAudio=function(e){j("INFO","Playing audio file "+e),e&&p&&(f.src=e,f.addEventListener("ended",V),f.play().catch((function(e){U({type:"Client",message:"Audio error in ".concat(f.src,":  ").concat(e)})}))),""!==f.src&&p&&e||I.addRecord()},I.startTyping=function(){C=!0},window.addEventListener("message",(function(e){"BotStopEvent"===e.data&&I.onStopClick()})),I.init=function(e,t,n,r){var i=this;if(p=r,g=n,_=e,E=t,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#intro",m=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["error"],v=arguments.length>7&&void 0!==arguments[7]&&arguments[7],S=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0,A<Y()||0===A)return M();A=0,u.sendText(y).then((function(e){return R=Y(),X(y),i})).catch((function(e){M()}))},I.getFiles=function(){var e=a()(h.a.mark((function e(t){var n,r,i,s=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:"https://manual-search-develop.alquist.ai/retrieve",r={query:t},i=null,e.prev=3,e.next=6,on.post(n,r,{headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}});case 6:i=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),i={};case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),I.getPage=function(){var e=a()(h.a.mark((function e(t,n){var r,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://manual-search-develop.alquist.ai/download/".concat(n,"/").concat(t,".pdf"),i={"Content-Type":"application/json","Content-Disposition":"inline"},console.log(r),e.next=5,on.get(r,i);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),I.checkExistingUser=a()(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Et.newUser();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),I.signIn=a()(h.a.mark((function e(){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Et.SignIn();case 2:return(t=Et.currentUser())&&sessionStorage.setItem("flowstorm-bot-user",t._delegate.email),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))),I.signOut=function(){Et.signOut()},I.updateUser=function(){var e=a()(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Et.currentUser()._delegate.email,Et.update(n,t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I.getUser=a()(h.a.mark((function e(){var t,n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Et.currentUser(),n=null,!(n=null===t?sessionStorage.getItem("flowstorm-bot-user"):t._delegate.email)){e.next=12;break}return e.next=6,Et.findUser(n);case 6:if(null!==(r=e.sent)._delegate._document){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",r.data());case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),I.addRecord=function(){if(B(d)&&d.length>0){var e=d,t=i()(e),n=t[0],s=t.slice(1),a=n.audio,o=n.image,c=n.text,l=n.background,h=n.video,g=n.code,m=n.nodeId,v=n.dialogueNodeId;r.focusOnNode&&0!==m&&r.focusOnNode(m),h?r.addVideo(h,(function(){d=s,""!==f.src&&p&&a||I.addRecord()})):(d=s,c.startsWith("#")?(r.handleCommand(c,g),"#walk"!==c&&I.addRecord()):(r.addMessage("received",c,o,l,m,v),I.playAudio(a)))}else O?x=!0:(u.sessionId&&0===A?setTimeout((function(){K(!1)}),k?200:0):((I.sessionEnded||0!==A)&&($("sleep"),r.onEnd()),r.setStatus({isActive:!0,status:"SLEEPING"})),d=void 0)};var q=function(t){var n=t.audio,r=t.image,i=t.text,s=t.ssml,a=t.background,o=t.video,c=t.code,u=t.nodeId;return{audio:B(n)?n.startsWith("/")?"".concat(e).concat(n):n:B(s)&&s.includes("<audio")?s.split('"')[1]:null,image:B(r)?r.startsWith("/")?"".concat(e).concat(r):r:null,video:B(o)?o:null,text:B(i)?i:"",background:B(a)?0===a.length?null:a:null,code:B(c)?0===c.length?"{}":c:"{}",nodeId:B(u)?u:0}};function G(e){var t=e.response,i=void 0===t?[]:t.items;switch(j("INFO","Received event "+e.type),e.type){case"ResponseItem":F("RESPONDING"),H();var s=q(e.responseItem);void 0===d&&(d=[]),e.responseItem.ttsConfig&&e.responseItem.ttsConfig.locale&&u.language!==e.responseItem.ttsConfig.locale&&(u.setLanguage(e.responseItem.ttsConfig.locale),u.language=e.responseItem.ttsConfig.locale),d.push(s),O&&!x||(x=!1,O=!0,I.addRecord());break;case"Response":F("RESPONDING"),H(),u.language=t.locale,i.length,t.sleepTimeout>0&&(A=Y()+1e3*t.sleepTimeout);var a=i.map(q);d=void 0!==d?d.concat(a):a,r.addLogs(t.logs),t.sessionEnded&&(I.sessionEnded=!0,u.setSessionId(null)),!O||x?(O=!1,x=!1,I.addRecord()):O=!1;break;case"Recognized":var o=(void 0===e.message?[e]:e.message.items)[0];(o.text.length>=L.length||o.isFinal)&&(L=o.text,X(o.text)),R=Y(),L="",o.isFinal&&(F("PROCESSING"),I.closeAudioStream("recognized",!1));break;case"Ready":u.setSessionId(r.getUUID()),I.sessionEnded=!1,k=!1,n?(X(y),u.sendText(y),R=Y()):r.play("bot_ready");break;case"InputAudioStreamOpen":F("LISTENING");break;case"SessionStarted":var c=e.sessionId;L="",u.setSessionId(c),F("RESPONDING");break;case"Error":if(r.onError({type:"Server:",message:e.text}),$("error"),null===c)break;case"SessionEnded":u.sendLogs(D),D=[],R=0,I.sessionEnded=!0,I.closeAudioStream("sessionEnd",!1),u.setSessionId(null),p||(r.onEnd(),H(),$("sleep"),F("SLEEPING"))}}function K(e){u.sendLogs(D),D=[],g&&e&&!k&&A<Y()?($("listening"),u.getStt().start().then((function(){k=!0})).catch((function(e){v?F("LISTENING"):U({type:"Client",message:"Speech to text start error: ".concat(e)})}))):F("LISTENING")}function z(){var e=null;return""!==f.src&&(f.pause(),f.src="",B(d)&&d.length>0&&(d.forEach((function(t){B(d)&&d.length>0&&(t.text.startsWith("#")?(e=!0,r.handleCommand(t.text,t.code)):r.addMessage("received",t.text,t.image,t.background,t.nodeId))})),d=void 0)),e}function H(){P.waiting.removeEventListener("ended",W),P.waiting.pause(),P.waiting.currentTime=0}function W(){$("waiting")}function $(e){T.includes(e)&&(P[e].volume=1,P[e].currentTime=0,P[e].play())}function Y(){return(new Date).getTime()}function Q(){z(),A>0?(r.onEnd(),F("SLEEPING")):I.sessionEnded?(I.onStopClick(),r.onEnd()):(K(!0),F("LISTENING"))}function X(e){var t="#"===e.charAt(0)&&m?null:e,n=e;r.addMessage("sent",t,null,null,n),I.audioInputCallback()}return I.closeAudioStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"sessionEnd"!==e&&$("recognized"),k&&u.getStt().stop(t).then((function(){k=!1})).catch((function(){U({type:"Client",message:"Speech to text stop error in ".concat(e)})}))},I.audioInputCallback=function(){},I.handleOnTextInput=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=z();C=!1,A=0,I.audioInputCallback(),r||(n.sopInput||n.buttonInput||X(e),F("PROCESSING"),u.sendText(e),R=Y(),t&&g&&I.closeAudioStream("handleTextInput",!1))},I.onStopClick=function(){I.sessionEnded=!0,H(),f&&z(),u&&(u.setSessionId(null),u.close()),A=0,F("SLEEPING")},I}}])},function(e,t,n){var r;(function(){function i(e){"use strict";var t={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:"Remove only spaces, ' and \" from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids",type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,description:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,description:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,description:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,description:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,description:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",description:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,description:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,description:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,description:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,description:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,description:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},completeHTMLDocument:{defaultValue:!1,description:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,description:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,description:"Split adjacent blockquote blocks",type:"boolean"}};if(!1===e)return JSON.parse(JSON.stringify(t));var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r].defaultValue);return n}var s={},a={},o={},c=i(!0),u="vanilla",l={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:i(!0),allOn:function(){"use strict";var e=i(!0),t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=!0);return t}()};function d(e,t){"use strict";var n=t?"Error in "+t+" extension->":"Error in unnamed extension",r={valid:!0,error:""};s.helper.isArray(e)||(e=[e]);for(var i=0;i<e.length;++i){var a=n+" sub-extension "+i+": ",o=e[i];if("object"!=typeof o)return r.valid=!1,r.error=a+"must be an object, but "+typeof o+" given",r;if(!s.helper.isString(o.type))return r.valid=!1,r.error=a+'property "type" must be a string, but '+typeof o.type+" given",r;var c=o.type=o.type.toLowerCase();if("language"===c&&(c=o.type="lang"),"html"===c&&(c=o.type="output"),"lang"!==c&&"output"!==c&&"listener"!==c)return r.valid=!1,r.error=a+"type "+c+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',r;if("listener"===c){if(s.helper.isUndefined(o.listeners))return r.valid=!1,r.error=a+'. Extensions of type "listener" must have a property called "listeners"',r}else if(s.helper.isUndefined(o.filter)&&s.helper.isUndefined(o.regex))return r.valid=!1,r.error=a+c+' extensions must define either a "regex" property or a "filter" method',r;if(o.listeners){if("object"!=typeof o.listeners)return r.valid=!1,r.error=a+'"listeners" property must be an object but '+typeof o.listeners+" given",r;for(var u in o.listeners)if(o.listeners.hasOwnProperty(u)&&"function"!=typeof o.listeners[u])return r.valid=!1,r.error=a+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+u+" must be a function but "+typeof o.listeners[u]+" given",r}if(o.filter){if("function"!=typeof o.filter)return r.valid=!1,r.error=a+'"filter" must be a function, but '+typeof o.filter+" given",r}else if(o.regex){if(s.helper.isString(o.regex)&&(o.regex=new RegExp(o.regex,"g")),!(o.regex instanceof RegExp))return r.valid=!1,r.error=a+'"regex" property must either be a string or a RegExp object, but '+typeof o.regex+" given",r;if(s.helper.isUndefined(o.replace))return r.valid=!1,r.error=a+'"regex" extensions must implement a replace string or function',r}}return r}function h(e,t){"use strict";return"¨E"+t.charCodeAt(0)+"E"}s.helper={},s.extensions={},s.setOption=function(e,t){"use strict";return c[e]=t,this},s.getOption=function(e){"use strict";return c[e]},s.getOptions=function(){"use strict";return c},s.resetOptions=function(){"use strict";c=i(!0)},s.setFlavor=function(e){"use strict";if(!l.hasOwnProperty(e))throw Error(e+" flavor was not found");s.resetOptions();var t=l[e];for(var n in u=e,t)t.hasOwnProperty(n)&&(c[n]=t[n])},s.getFlavor=function(){"use strict";return u},s.getFlavorOptions=function(e){"use strict";if(l.hasOwnProperty(e))return l[e]},s.getDefaultOptions=function(e){"use strict";return i(e)},s.subParser=function(e,t){"use strict";if(s.helper.isString(e)){if(void 0===t){if(a.hasOwnProperty(e))return a[e];throw Error("SubParser named "+e+" not registered!")}a[e]=t}},s.extension=function(e,t){"use strict";if(!s.helper.isString(e))throw Error("Extension 'name' must be a string");if(e=s.helper.stdExtName(e),s.helper.isUndefined(t)){if(!o.hasOwnProperty(e))throw Error("Extension named "+e+" is not registered!");return o[e]}"function"==typeof t&&(t=t()),s.helper.isArray(t)||(t=[t]);var n=d(t,e);if(!n.valid)throw Error(n.error);o[e]=t},s.getAllExtensions=function(){"use strict";return o},s.removeExtension=function(e){"use strict";delete o[e]},s.resetExtensions=function(){"use strict";o={}},s.validateExtension=function(e){"use strict";var t=d(e,null);return!!t.valid||(console.warn(t.error),!1)},s.hasOwnProperty("helper")||(s.helper={}),s.helper.isString=function(e){"use strict";return"string"==typeof e||e instanceof String},s.helper.isFunction=function(e){"use strict";return e&&"[object Function]"==={}.toString.call(e)},s.helper.isArray=function(e){"use strict";return Array.isArray(e)},s.helper.isUndefined=function(e){"use strict";return void 0===e},s.helper.forEach=function(e,t){"use strict";if(s.helper.isUndefined(e))throw new Error("obj param is required");if(s.helper.isUndefined(t))throw new Error("callback param is required");if(!s.helper.isFunction(t))throw new Error("callback param must be a function/closure");if("function"==typeof e.forEach)e.forEach(t);else if(s.helper.isArray(e))for(var n=0;n<e.length;n++)t(e[n],n,e);else{if("object"!=typeof e)throw new Error("obj does not seem to be an array or an iterable object");for(var r in e)e.hasOwnProperty(r)&&t(e[r],r,e)}},s.helper.stdExtName=function(e){"use strict";return e.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()},s.helper.escapeCharactersCallback=h,s.helper.escapeCharacters=function(e,t,n){"use strict";var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var i=new RegExp(r,"g");return e=e.replace(i,h)},s.helper.unescapeHTMLEntities=function(e){"use strict";return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var f=function(e,t,n,r){"use strict";var i,s,a,o,c,u=r||"",l=u.indexOf("g")>-1,d=new RegExp(t+"|"+n,"g"+u.replace(/g/g,"")),h=new RegExp(t,u.replace(/g/g,"")),f=[];do{for(i=0;a=d.exec(e);)if(h.test(a[0]))i++||(o=(s=d.lastIndex)-a[0].length);else if(i&&!--i){c=a.index+a[0].length;var p={left:{start:o,end:s},match:{start:s,end:a.index},right:{start:a.index,end:c},wholeMatch:{start:o,end:c}};if(f.push(p),!l)return f}}while(i&&(d.lastIndex=s));return f};s.helper.matchRecursiveRegExp=function(e,t,n,r){"use strict";for(var i=f(e,t,n,r),s=[],a=0;a<i.length;++a)s.push([e.slice(i[a].wholeMatch.start,i[a].wholeMatch.end),e.slice(i[a].match.start,i[a].match.end),e.slice(i[a].left.start,i[a].left.end),e.slice(i[a].right.start,i[a].right.end)]);return s},s.helper.replaceRecursiveRegExp=function(e,t,n,r,i){"use strict";if(!s.helper.isFunction(t)){var a=t;t=function(){return a}}var o=f(e,n,r,i),c=e,u=o.length;if(u>0){var l=[];0!==o[0].wholeMatch.start&&l.push(e.slice(0,o[0].wholeMatch.start));for(var d=0;d<u;++d)l.push(t(e.slice(o[d].wholeMatch.start,o[d].wholeMatch.end),e.slice(o[d].match.start,o[d].match.end),e.slice(o[d].left.start,o[d].left.end),e.slice(o[d].right.start,o[d].right.end))),d<u-1&&l.push(e.slice(o[d].wholeMatch.end,o[d+1].wholeMatch.start));o[u-1].wholeMatch.end<e.length&&l.push(e.slice(o[u-1].wholeMatch.end)),c=l.join("")}return c},s.helper.regexIndexOf=function(e,t,n){"use strict";if(!s.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(t instanceof RegExp==!1)throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var r=e.substring(n||0).search(t);return r>=0?r+(n||0):r},s.helper.splitAtIndex=function(e,t){"use strict";if(!s.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[e.substring(0,t),e.substring(t)]},s.helper.encodeEmailAddress=function(e){"use strict";var t=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+e.charCodeAt(0).toString(16)+";"},function(e){return e}];return e=e.replace(/./g,(function(e){if("@"===e)e=t[Math.floor(2*Math.random())](e);else{var n=Math.random();e=n>.9?t[2](e):n>.45?t[1](e):t[0](e)}return e}))},s.helper.padEnd=function(e,t,n){"use strict";return t>>=0,n=String(n||" "),e.length>t?String(e):((t-=e.length)>n.length&&(n+=n.repeat(t/n.length)),String(e)+n.slice(0,t))},"undefined"==typeof console&&(console={warn:function(e){"use strict";alert(e)},log:function(e){"use strict";alert(e)},error:function(e){"use strict";throw e}}),s.helper.regexes={asteriskDashAndColon:/([*_:~])/g},s.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:"<span style=\"font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;\">S</span>"},s.Converter=function(e){"use strict";var t={},n=[],r=[],i={},a=u,h={parsed:{},raw:"",format:""};function f(e,t){if(t=t||null,s.helper.isString(e)){if(t=e=s.helper.stdExtName(e),s.extensions[e])return console.warn("DEPRECATION WARNING: "+e+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),void function(e,t){"function"==typeof e&&(e=e(new s.Converter));s.helper.isArray(e)||(e=[e]);var i=d(e,t);if(!i.valid)throw Error(i.error);for(var a=0;a<e.length;++a)switch(e[a].type){case"lang":n.push(e[a]);break;case"output":r.push(e[a]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}(s.extensions[e],e);if(s.helper.isUndefined(o[e]))throw Error('Extension "'+e+'" could not be loaded. It was either not found or is not a valid extension.');e=o[e]}"function"==typeof e&&(e=e()),s.helper.isArray(e)||(e=[e]);var i=d(e,t);if(!i.valid)throw Error(i.error);for(var a=0;a<e.length;++a){switch(e[a].type){case"lang":n.push(e[a]);break;case"output":r.push(e[a])}if(e[a].hasOwnProperty("listeners"))for(var c in e[a].listeners)e[a].listeners.hasOwnProperty(c)&&p(c,e[a].listeners[c])}}function p(e,t){if(!s.helper.isString(e))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof e+" given");if("function"!=typeof t)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof t+" given");i.hasOwnProperty(e)||(i[e]=[]),i[e].push(t)}!function(){for(var n in e=e||{},c)c.hasOwnProperty(n)&&(t[n]=c[n]);if("object"!=typeof e)throw Error("Converter expects the passed parameter to be an object, but "+typeof e+" was passed instead.");for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.extensions&&s.helper.forEach(t.extensions,f)}(),this._dispatch=function(e,t,n,r){if(i.hasOwnProperty(e))for(var s=0;s<i[e].length;++s){var a=i[e][s](e,t,this,n,r);a&&void 0!==a&&(t=a)}return t},this.listen=function(e,t){return p(e,t),this},this.makeHtml=function(e){if(!e)return e;var i={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:n,outputModifiers:r,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return e=(e=(e=(e=(e=e.replace(/¨/g,"¨T")).replace(/\$/g,"¨D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/\u00A0/g,"&nbsp;"),t.smartIndentationFix&&(e=function(e){var t=e.match(/^\s*/)[0].length,n=new RegExp("^\\s{0,"+t+"}","gm");return e.replace(n,"")}(e)),e="\n\n"+e+"\n\n",e=(e=s.subParser("detab")(e,t,i)).replace(/^[ \t]+$/gm,""),s.helper.forEach(n,(function(n){e=s.subParser("runExtension")(n,e,t,i)})),e=s.subParser("metadata")(e,t,i),e=s.subParser("hashPreCodeTags")(e,t,i),e=s.subParser("githubCodeBlocks")(e,t,i),e=s.subParser("hashHTMLBlocks")(e,t,i),e=s.subParser("hashCodeTags")(e,t,i),e=s.subParser("stripLinkDefinitions")(e,t,i),e=s.subParser("blockGamut")(e,t,i),e=s.subParser("unhashHTMLSpans")(e,t,i),e=(e=(e=s.subParser("unescapeSpecialChars")(e,t,i)).replace(/¨D/g,"$$")).replace(/¨T/g,"¨"),e=s.subParser("completeHTMLDocument")(e,t,i),s.helper.forEach(r,(function(n){e=s.subParser("runExtension")(n,e,t,i)})),h=i.metadata,e},this.makeMarkdown=this.makeMd=function(e,t){if(e=(e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/>[ \t]+</,">¨NBSP;<"),!t){if(!window||!window.document)throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");t=window.document}var n=t.createElement("div");n.innerHTML=e;var r={preList:function(e){for(var t=e.querySelectorAll("pre"),n=[],r=0;r<t.length;++r)if(1===t[r].childElementCount&&"code"===t[r].firstChild.tagName.toLowerCase()){var i=t[r].firstChild.innerHTML.trim(),a=t[r].firstChild.getAttribute("data-language")||"";if(""===a)for(var o=t[r].firstChild.className.split(" "),c=0;c<o.length;++c){var u=o[c].match(/^language-(.+)$/);if(null!==u){a=u[1];break}}i=s.helper.unescapeHTMLEntities(i),n.push(i),t[r].outerHTML='<precode language="'+a+'" precodenum="'+r.toString()+'"></precode>'}else n.push(t[r].innerHTML),t[r].innerHTML="",t[r].setAttribute("prenum",r.toString());return n}(n)};!function e(t){for(var n=0;n<t.childNodes.length;++n){var r=t.childNodes[n];3===r.nodeType?/\S/.test(r.nodeValue)?(r.nodeValue=r.nodeValue.split("\n").join(" "),r.nodeValue=r.nodeValue.replace(/(\s)+/g,"$1")):(t.removeChild(r),--n):1===r.nodeType&&e(r)}}(n);for(var i=n.childNodes,a="",o=0;o<i.length;o++)a+=s.subParser("makeMarkdown.node")(i[o],r);return a},this.setOption=function(e,n){t[e]=n},this.getOption=function(e){return t[e]},this.getOptions=function(){return t},this.addExtension=function(e,t){f(e,t=t||null)},this.useExtension=function(e){f(e)},this.setFlavor=function(e){if(!l.hasOwnProperty(e))throw Error(e+" flavor was not found");var n=l[e];for(var r in a=e,n)n.hasOwnProperty(r)&&(t[r]=n[r])},this.getFlavor=function(){return a},this.removeExtension=function(e){s.helper.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t){for(var i=e[t],a=0;a<n.length;++a)n[a]===i&&n[a].splice(a,1);for(;0<r.length;++a)r[0]===i&&r[0].splice(a,1)}},this.getAllExtensions=function(){return{language:n,output:r}},this.getMetadata=function(e){return e?h.raw:h.parsed},this.getMetadataFormat=function(){return h.format},this._setMetadataPair=function(e,t){h.parsed[e]=t},this._setMetadataFormat=function(e){h.format=e},this._setMetadataRaw=function(e){h.raw=e}},s.subParser("anchors",(function(e,t,n){"use strict";var r=function(e,r,i,a,o,c,u){if(s.helper.isUndefined(u)&&(u=""),i=i.toLowerCase(),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)a="";else if(!a){if(i||(i=r.toLowerCase().replace(/ ?\n/g," ")),a="#"+i,s.helper.isUndefined(n.gUrls[i]))return e;a=n.gUrls[i],s.helper.isUndefined(n.gTitles[i])||(u=n.gTitles[i])}var l='<a href="'+(a=a.replace(s.helper.regexes.asteriskDashAndColon,s.helper.escapeCharactersCallback))+'"';return""!==u&&null!==u&&(l+=' title="'+(u=(u=u.replace(/"/g,"&quot;")).replace(s.helper.regexes.asteriskDashAndColon,s.helper.escapeCharactersCallback))+'"'),t.openLinksInNewWindow&&!/^#/.test(a)&&(l+=' rel="noopener noreferrer" target="¨E95Eblank"'),l+=">"+r+"</a>"};return e=(e=(e=(e=(e=n.converter._dispatch("anchors.before",e,t,n)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,r)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,r)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,r)).replace(/\[([^\[\]]+)]()()()()()/g,r),t.ghMentions&&(e=e.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gim,(function(e,n,r,i,a){if("\\"===r)return n+i;if(!s.helper.isString(t.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var o=t.ghMentionsLink.replace(/\{u}/g,a),c="";return t.openLinksInNewWindow&&(c=' rel="noopener noreferrer" target="¨E95Eblank"'),n+'<a href="'+o+'"'+c+">"+i+"</a>"}))),e=n.converter._dispatch("anchors.after",e,t,n)}));var p=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,g=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,m=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,v=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gim,y=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,b=function(e){"use strict";return function(t,n,r,i,a,o,c){var u=r=r.replace(s.helper.regexes.asteriskDashAndColon,s.helper.escapeCharactersCallback),l="",d="",h=n||"",f=c||"";return/^www\./i.test(r)&&(r=r.replace(/^www\./i,"http://www.")),e.excludeTrailingPunctuationFromURLs&&o&&(l=o),e.openLinksInNewWindow&&(d=' rel="noopener noreferrer" target="¨E95Eblank"'),h+'<a href="'+r+'"'+d+">"+u+"</a>"+l+f}},w=function(e,t){"use strict";return function(n,r,i){var a="mailto:";return r=r||"",i=s.subParser("unescapeSpecialChars")(i,e,t),e.encodeEmails?(a=s.helper.encodeEmailAddress(a+i),i=s.helper.encodeEmailAddress(i)):a+=i,r+'<a href="'+a+'">'+i+"</a>"}};s.subParser("autoLinks",(function(e,t,n){"use strict";return e=(e=(e=n.converter._dispatch("autoLinks.before",e,t,n)).replace(m,b(t))).replace(y,w(t,n)),e=n.converter._dispatch("autoLinks.after",e,t,n)})),s.subParser("simplifiedAutoLinks",(function(e,t,n){"use strict";return t.simplifiedAutoLink?(e=n.converter._dispatch("simplifiedAutoLinks.before",e,t,n),e=(e=t.excludeTrailingPunctuationFromURLs?e.replace(g,b(t)):e.replace(p,b(t))).replace(v,w(t,n)),e=n.converter._dispatch("simplifiedAutoLinks.after",e,t,n)):e})),s.subParser("blockGamut",(function(e,t,n){"use strict";return e=n.converter._dispatch("blockGamut.before",e,t,n),e=s.subParser("blockQuotes")(e,t,n),e=s.subParser("headers")(e,t,n),e=s.subParser("horizontalRule")(e,t,n),e=s.subParser("lists")(e,t,n),e=s.subParser("codeBlocks")(e,t,n),e=s.subParser("tables")(e,t,n),e=s.subParser("hashHTMLBlocks")(e,t,n),e=s.subParser("paragraphs")(e,t,n),e=n.converter._dispatch("blockGamut.after",e,t,n)})),s.subParser("blockQuotes",(function(e,t,n){"use strict";e=n.converter._dispatch("blockQuotes.before",e,t,n),e+="\n\n";var r=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return t.splitAdjacentBlockquotes&&(r=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),e=e.replace(r,(function(e){return e=(e=(e=e.replace(/^[ \t]*>[ \t]?/gm,"")).replace(/¨0/g,"")).replace(/^[ \t]+$/gm,""),e=s.subParser("githubCodeBlocks")(e,t,n),e=(e=(e=s.subParser("blockGamut")(e,t,n)).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,(function(e,t){var n=t;return n=(n=n.replace(/^  /gm,"¨0")).replace(/¨0/g,"")})),s.subParser("hashBlock")("<blockquote>\n"+e+"\n</blockquote>",t,n)})),e=n.converter._dispatch("blockQuotes.after",e,t,n)})),s.subParser("codeBlocks",(function(e,t,n){"use strict";e=n.converter._dispatch("codeBlocks.before",e,t,n);return e=(e=(e+="¨0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g,(function(e,r,i){var a=r,o=i,c="\n";return a=s.subParser("outdent")(a,t,n),a=s.subParser("encodeCode")(a,t,n),a=(a=(a=s.subParser("detab")(a,t,n)).replace(/^\n+/g,"")).replace(/\n+$/g,""),t.omitExtraWLInCodeBlocks&&(c=""),a="<pre><code>"+a+c+"</code></pre>",s.subParser("hashBlock")(a,t,n)+o}))).replace(/¨0/,""),e=n.converter._dispatch("codeBlocks.after",e,t,n)})),s.subParser("codeSpans",(function(e,t,n){"use strict";return void 0===(e=n.converter._dispatch("codeSpans.before",e,t,n))&&(e=""),e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,(function(e,r,i,a){var o=a;return o=(o=o.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""),o=r+"<code>"+(o=s.subParser("encodeCode")(o,t,n))+"</code>",o=s.subParser("hashHTMLSpans")(o,t,n)})),e=n.converter._dispatch("codeSpans.after",e,t,n)})),s.subParser("completeHTMLDocument",(function(e,t,n){"use strict";if(!t.completeHTMLDocument)return e;e=n.converter._dispatch("completeHTMLDocument.before",e,t,n);var r="html",i="<!DOCTYPE HTML>\n",s="",a='<meta charset="utf-8">\n',o="",c="";for(var u in void 0!==n.metadata.parsed.doctype&&(i="<!DOCTYPE "+n.metadata.parsed.doctype+">\n","html"!==(r=n.metadata.parsed.doctype.toString().toLowerCase())&&"html5"!==r||(a='<meta charset="utf-8">')),n.metadata.parsed)if(n.metadata.parsed.hasOwnProperty(u))switch(u.toLowerCase()){case"doctype":break;case"title":s="<title>"+n.metadata.parsed.title+"</title>\n";break;case"charset":a="html"===r||"html5"===r?'<meta charset="'+n.metadata.parsed.charset+'">\n':'<meta name="charset" content="'+n.metadata.parsed.charset+'">\n';break;case"language":case"lang":o=' lang="'+n.metadata.parsed[u]+'"',c+='<meta name="'+u+'" content="'+n.metadata.parsed[u]+'">\n';break;default:c+='<meta name="'+u+'" content="'+n.metadata.parsed[u]+'">\n'}return e=i+"<html"+o+">\n<head>\n"+s+a+c+"</head>\n<body>\n"+e.trim()+"\n</body>\n</html>",e=n.converter._dispatch("completeHTMLDocument.after",e,t,n)})),s.subParser("detab",(function(e,t,n){"use strict";return e=(e=(e=(e=(e=(e=n.converter._dispatch("detab.before",e,t,n)).replace(/\t(?=\t)/g,"    ")).replace(/\t/g,"¨A¨B")).replace(/¨B(.+?)¨A/g,(function(e,t){for(var n=t,r=4-n.length%4,i=0;i<r;i++)n+=" ";return n}))).replace(/¨A/g,"    ")).replace(/¨B/g,""),e=n.converter._dispatch("detab.after",e,t,n)})),s.subParser("ellipsis",(function(e,t,n){"use strict";return e=(e=n.converter._dispatch("ellipsis.before",e,t,n)).replace(/\.\.\./g,"…"),e=n.converter._dispatch("ellipsis.after",e,t,n)})),s.subParser("emoji",(function(e,t,n){"use strict";if(!t.emoji)return e;return e=(e=n.converter._dispatch("emoji.before",e,t,n)).replace(/:([\S]+?):/g,(function(e,t){return s.helper.emojis.hasOwnProperty(t)?s.helper.emojis[t]:e})),e=n.converter._dispatch("emoji.after",e,t,n)})),s.subParser("encodeAmpsAndAngles",(function(e,t,n){"use strict";return e=(e=(e=(e=(e=n.converter._dispatch("encodeAmpsAndAngles.before",e,t,n)).replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?$!])/gi,"&lt;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e=n.converter._dispatch("encodeAmpsAndAngles.after",e,t,n)})),s.subParser("encodeBackslashEscapes",(function(e,t,n){"use strict";return e=(e=(e=n.converter._dispatch("encodeBackslashEscapes.before",e,t,n)).replace(/\\(\\)/g,s.helper.escapeCharactersCallback)).replace(/\\([`*_{}\[\]()>#+.!~=|-])/g,s.helper.escapeCharactersCallback),e=n.converter._dispatch("encodeBackslashEscapes.after",e,t,n)})),s.subParser("encodeCode",(function(e,t,n){"use strict";return e=(e=n.converter._dispatch("encodeCode.before",e,t,n)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,s.helper.escapeCharactersCallback),e=n.converter._dispatch("encodeCode.after",e,t,n)})),s.subParser("escapeSpecialCharsWithinTagAttributes",(function(e,t,n){"use strict";return e=(e=(e=n.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",e,t,n)).replace(/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,(function(e){return e.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,s.helper.escapeCharactersCallback)}))).replace(/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi,(function(e){return e.replace(/([\\`*_~=|])/g,s.helper.escapeCharactersCallback)})),e=n.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",e,t,n)})),s.subParser("githubCodeBlocks",(function(e,t,n){"use strict";return t.ghCodeBlocks?(e=n.converter._dispatch("githubCodeBlocks.before",e,t,n),e=(e=(e+="¨0").replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,(function(e,r,i,a){var o=t.omitExtraWLInCodeBlocks?"":"\n";return a=s.subParser("encodeCode")(a,t,n),a="<pre><code"+(i?' class="'+i+" language-"+i+'"':"")+">"+(a=(a=(a=s.subParser("detab")(a,t,n)).replace(/^\n+/g,"")).replace(/\n+$/g,""))+o+"</code></pre>",a=s.subParser("hashBlock")(a,t,n),"\n\n¨G"+(n.ghCodeBlocks.push({text:e,codeblock:a})-1)+"G\n\n"}))).replace(/¨0/,""),n.converter._dispatch("githubCodeBlocks.after",e,t,n)):e})),s.subParser("hashBlock",(function(e,t,n){"use strict";return e=(e=n.converter._dispatch("hashBlock.before",e,t,n)).replace(/(^\n+|\n+$)/g,""),e="\n\n¨K"+(n.gHtmlBlocks.push(e)-1)+"K\n\n",e=n.converter._dispatch("hashBlock.after",e,t,n)})),s.subParser("hashCodeTags",(function(e,t,n){"use strict";e=n.converter._dispatch("hashCodeTags.before",e,t,n);return e=s.helper.replaceRecursiveRegExp(e,(function(e,r,i,a){var o=i+s.subParser("encodeCode")(r,t,n)+a;return"¨C"+(n.gHtmlSpans.push(o)-1)+"C"}),"<code\\b[^>]*>","</code>","gim"),e=n.converter._dispatch("hashCodeTags.after",e,t,n)})),s.subParser("hashElement",(function(e,t,n){"use strict";return function(e,t){var r=t;return r=(r=(r=r.replace(/\n\n/g,"\n")).replace(/^\n/,"")).replace(/\n+$/g,""),r="\n\n¨K"+(n.gHtmlBlocks.push(r)-1)+"K\n\n"}})),s.subParser("hashHTMLBlocks",(function(e,t,n){"use strict";e=n.converter._dispatch("hashHTMLBlocks.before",e,t,n);var r=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],i=function(e,t,r,i){var s=e;return-1!==r.search(/\bmarkdown\b/)&&(s=r+n.converter.makeHtml(t)+i),"\n\n¨K"+(n.gHtmlBlocks.push(s)-1)+"K\n\n"};t.backslashEscapesHTMLTags&&(e=e.replace(/\\<(\/?[^>]+?)>/g,(function(e,t){return"&lt;"+t+"&gt;"})));for(var a=0;a<r.length;++a)for(var o,c=new RegExp("^ {0,3}(<"+r[a]+"\\b[^>]*>)","im"),u="<"+r[a]+"\\b[^>]*>",l="</"+r[a]+">";-1!==(o=s.helper.regexIndexOf(e,c));){var d=s.helper.splitAtIndex(e,o),h=s.helper.replaceRecursiveRegExp(d[1],i,u,l,"im");if(h===d[1])break;e=d[0].concat(h)}return e=e.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,s.subParser("hashElement")(e,t,n)),e=(e=s.helper.replaceRecursiveRegExp(e,(function(e){return"\n\n¨K"+(n.gHtmlBlocks.push(e)-1)+"K\n\n"}),"^ {0,3}\x3c!--","--\x3e","gm")).replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,s.subParser("hashElement")(e,t,n)),e=n.converter._dispatch("hashHTMLBlocks.after",e,t,n)})),s.subParser("hashHTMLSpans",(function(e,t,n){"use strict";function r(e){return"¨C"+(n.gHtmlSpans.push(e)-1)+"C"}return e=(e=(e=(e=(e=n.converter._dispatch("hashHTMLSpans.before",e,t,n)).replace(/<[^>]+?\/>/gi,(function(e){return r(e)}))).replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,(function(e){return r(e)}))).replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,(function(e){return r(e)}))).replace(/<[^>]+?>/gi,(function(e){return r(e)})),e=n.converter._dispatch("hashHTMLSpans.after",e,t,n)})),s.subParser("unhashHTMLSpans",(function(e,t,n){"use strict";e=n.converter._dispatch("unhashHTMLSpans.before",e,t,n);for(var r=0;r<n.gHtmlSpans.length;++r){for(var i=n.gHtmlSpans[r],s=0;/¨C(\d+)C/.test(i);){var a=RegExp.$1;if(i=i.replace("¨C"+a+"C",n.gHtmlSpans[a]),10===s){console.error("maximum nesting of 10 spans reached!!!");break}++s}e=e.replace("¨C"+r+"C",i)}return e=n.converter._dispatch("unhashHTMLSpans.after",e,t,n)})),s.subParser("hashPreCodeTags",(function(e,t,n){"use strict";e=n.converter._dispatch("hashPreCodeTags.before",e,t,n);return e=s.helper.replaceRecursiveRegExp(e,(function(e,r,i,a){var o=i+s.subParser("encodeCode")(r,t,n)+a;return"\n\n¨G"+(n.ghCodeBlocks.push({text:e,codeblock:o})-1)+"G\n\n"}),"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),e=n.converter._dispatch("hashPreCodeTags.after",e,t,n)})),s.subParser("headers",(function(e,t,n){"use strict";e=n.converter._dispatch("headers.before",e,t,n);var r=isNaN(parseInt(t.headerLevelStart))?1:parseInt(t.headerLevelStart),i=t.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,a=t.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;e=(e=e.replace(i,(function(e,i){var a=s.subParser("spanGamut")(i,t,n),o=t.noHeaderId?"":' id="'+c(i)+'"',u="<h"+r+o+">"+a+"</h"+r+">";return s.subParser("hashBlock")(u,t,n)}))).replace(a,(function(e,i){var a=s.subParser("spanGamut")(i,t,n),o=t.noHeaderId?"":' id="'+c(i)+'"',u=r+1,l="<h"+u+o+">"+a+"</h"+u+">";return s.subParser("hashBlock")(l,t,n)}));var o=t.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;function c(e){var r,i;if(t.customizedHeaderId){var a=e.match(/\{([^{]+?)}\s*$/);a&&a[1]&&(e=a[1])}return r=e,i=s.helper.isString(t.prefixHeaderId)?t.prefixHeaderId:!0===t.prefixHeaderId?"section-":"",t.rawPrefixHeaderId||(r=i+r),r=t.ghCompatibleHeaderId?r.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():t.rawHeaderId?r.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():r.replace(/[^\w]/g,"").toLowerCase(),t.rawPrefixHeaderId&&(r=i+r),n.hashLinkCounts[r]?r=r+"-"+n.hashLinkCounts[r]++:n.hashLinkCounts[r]=1,r}return e=e.replace(o,(function(e,i,a){var o=a;t.customizedHeaderId&&(o=a.replace(/\s?\{([^{]+?)}\s*$/,""));var u=s.subParser("spanGamut")(o,t,n),l=t.noHeaderId?"":' id="'+c(a)+'"',d=r-1+i.length,h="<h"+d+l+">"+u+"</h"+d+">";return s.subParser("hashBlock")(h,t,n)})),e=n.converter._dispatch("headers.after",e,t,n)})),s.subParser("horizontalRule",(function(e,t,n){"use strict";e=n.converter._dispatch("horizontalRule.before",e,t,n);var r=s.subParser("hashBlock")("<hr />",t,n);return e=(e=(e=e.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,r)).replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,r)).replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,r),e=n.converter._dispatch("horizontalRule.after",e,t,n)})),s.subParser("images",(function(e,t,n){"use strict";function r(e,t,r,i,a,o,c,u){var l=n.gUrls,d=n.gTitles,h=n.gDimensions;if(r=r.toLowerCase(),u||(u=""),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)i="";else if(""===i||null===i){if(""!==r&&null!==r||(r=t.toLowerCase().replace(/ ?\n/g," ")),i="#"+r,s.helper.isUndefined(l[r]))return e;i=l[r],s.helper.isUndefined(d[r])||(u=d[r]),s.helper.isUndefined(h[r])||(a=h[r].width,o=h[r].height)}t=t.replace(/"/g,"&quot;").replace(s.helper.regexes.asteriskDashAndColon,s.helper.escapeCharactersCallback);var f='<img src="'+(i=i.replace(s.helper.regexes.asteriskDashAndColon,s.helper.escapeCharactersCallback))+'" alt="'+t+'"';return u&&s.helper.isString(u)&&(f+=' title="'+(u=u.replace(/"/g,"&quot;").replace(s.helper.regexes.asteriskDashAndColon,s.helper.escapeCharactersCallback))+'"'),a&&o&&(f+=' width="'+(a="*"===a?"auto":a)+'"',f+=' height="'+(o="*"===o?"auto":o)+'"'),f+=" />"}return e=(e=(e=(e=(e=(e=n.converter._dispatch("images.before",e,t,n)).replace(/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,r)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,(function(e,t,n,i,s,a,o,c){return r(e,t,n,i=i.replace(/\s/g,""),s,a,o,c)}))).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,r)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,r)).replace(/!\[([^\[\]]+)]()()()()()/g,r),e=n.converter._dispatch("images.after",e,t,n)})),s.subParser("italicsAndBold",(function(e,t,n){"use strict";function r(e,t,n){return t+e+n}return e=n.converter._dispatch("italicsAndBold.before",e,t,n),e=t.literalMidWordUnderscores?(e=(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return r(t,"<strong><em>","</em></strong>")}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return r(t,"<strong>","</strong>")}))).replace(/\b_(\S[\s\S]*?)_\b/g,(function(e,t){return r(t,"<em>","</em>")})):(e=(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong><em>","</em></strong>"):e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong>","</strong>"):e}))).replace(/_([^\s_][\s\S]*?)_/g,(function(e,t){return/\S$/.test(t)?r(t,"<em>","</em>"):e})),e=t.literalMidWordAsterisks?(e=(e=e.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,(function(e,t,n){return r(n,t+"<strong><em>","</em></strong>")}))).replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,(function(e,t,n){return r(n,t+"<strong>","</strong>")}))).replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,(function(e,t,n){return r(n,t+"<em>","</em>")})):(e=(e=e.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong><em>","</em></strong>"):e}))).replace(/\*\*(\S[\s\S]*?)\*\*/g,(function(e,t){return/\S$/.test(t)?r(t,"<strong>","</strong>"):e}))).replace(/\*([^\s*][\s\S]*?)\*/g,(function(e,t){return/\S$/.test(t)?r(t,"<em>","</em>"):e})),e=n.converter._dispatch("italicsAndBold.after",e,t,n)})),s.subParser("lists",(function(e,t,n){"use strict";function r(e,r){n.gListLevel++,e=e.replace(/\n{2,}$/,"\n");var i=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,a=/\n[ \t]*\n(?!¨0)/.test(e+="¨0");return t.disableForced4SpacesIndentedSublists&&(i=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),e=(e=e.replace(i,(function(e,r,i,o,c,u,l){l=l&&""!==l.trim();var d=s.subParser("outdent")(c,t,n),h="";return u&&t.tasklists&&(h=' class="task-list-item" style="list-style-type: none;"',d=d.replace(/^[ \t]*\[(x|X| )?]/m,(function(){var e='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return l&&(e+=" checked"),e+=">"}))),d=d.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,(function(e){return"¨A"+e})),r||d.search(/\n{2,}/)>-1?(d=s.subParser("githubCodeBlocks")(d,t,n),d=s.subParser("blockGamut")(d,t,n)):(d=(d=s.subParser("lists")(d,t,n)).replace(/\n$/,""),d=(d=s.subParser("hashHTMLBlocks")(d,t,n)).replace(/\n\n+/g,"\n\n"),d=a?s.subParser("paragraphs")(d,t,n):s.subParser("spanGamut")(d,t,n)),d="<li"+h+">"+(d=d.replace("¨A",""))+"</li>\n"}))).replace(/¨0/g,""),n.gListLevel--,r&&(e=e.replace(/\s+$/,"")),e}function i(e,t){if("ol"===t){var n=e.match(/^ *(\d+)\./);if(n&&"1"!==n[1])return' start="'+n[1]+'"'}return""}function a(e,n,s){var a=t.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,o=t.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,c="ul"===n?a:o,u="";if(-1!==e.search(c))!function t(l){var d=l.search(c),h=i(e,n);-1!==d?(u+="\n\n<"+n+h+">\n"+r(l.slice(0,d),!!s)+"</"+n+">\n",c="ul"===(n="ul"===n?"ol":"ul")?a:o,t(l.slice(d))):u+="\n\n<"+n+h+">\n"+r(l,!!s)+"</"+n+">\n"}(e);else{var l=i(e,n);u="\n\n<"+n+l+">\n"+r(e,!!s)+"</"+n+">\n"}return u}return e=n.converter._dispatch("lists.before",e,t,n),e+="¨0",e=(e=n.gListLevel?e.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,n){return a(t,n.search(/[*+-]/g)>-1?"ul":"ol",!0)})):e.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,n,r){return a(n,r.search(/[*+-]/g)>-1?"ul":"ol",!1)}))).replace(/¨0/,""),e=n.converter._dispatch("lists.after",e,t,n)})),s.subParser("metadata",(function(e,t,n){"use strict";if(!t.metadata)return e;function r(e){n.metadata.raw=e,(e=(e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;")).replace(/\n {4}/g," ")).replace(/^([\S ]+): +([\s\S]+?)$/gm,(function(e,t,r){return n.metadata.parsed[t]=r,""}))}return e=(e=(e=(e=n.converter._dispatch("metadata.before",e,t,n)).replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,(function(e,t,n){return r(n),"¨M"}))).replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,(function(e,t,i){return t&&(n.metadata.format=t),r(i),"¨M"}))).replace(/¨M/g,""),e=n.converter._dispatch("metadata.after",e,t,n)})),s.subParser("outdent",(function(e,t,n){"use strict";return e=(e=(e=n.converter._dispatch("outdent.before",e,t,n)).replace(/^(\t|[ ]{1,4})/gm,"¨0")).replace(/¨0/g,""),e=n.converter._dispatch("outdent.after",e,t,n)})),s.subParser("paragraphs",(function(e,t,n){"use strict";for(var r=(e=(e=(e=n.converter._dispatch("paragraphs.before",e,t,n)).replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),i=[],a=r.length,o=0;o<a;o++){var c=r[o];c.search(/¨(K|G)(\d+)\1/g)>=0?i.push(c):c.search(/\S/)>=0&&(c=(c=s.subParser("spanGamut")(c,t,n)).replace(/^([ \t]*)/g,"<p>"),c+="</p>",i.push(c))}for(a=i.length,o=0;o<a;o++){for(var u="",l=i[o],d=!1;/¨(K|G)(\d+)\1/.test(l);){var h=RegExp.$1,f=RegExp.$2;u=(u="K"===h?n.gHtmlBlocks[f]:d?s.subParser("encodeCode")(n.ghCodeBlocks[f].text,t,n):n.ghCodeBlocks[f].codeblock).replace(/\$/g,"$$$$"),l=l.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,u),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(l)&&(d=!0)}i[o]=l}return e=(e=(e=i.join("\n")).replace(/^\n+/g,"")).replace(/\n+$/g,""),n.converter._dispatch("paragraphs.after",e,t,n)})),s.subParser("runExtension",(function(e,t,n,r){"use strict";if(e.filter)t=e.filter(t,r.converter,n);else if(e.regex){var i=e.regex;i instanceof RegExp||(i=new RegExp(i,"g")),t=t.replace(i,e.replace)}return t})),s.subParser("spanGamut",(function(e,t,n){"use strict";return e=n.converter._dispatch("spanGamut.before",e,t,n),e=s.subParser("codeSpans")(e,t,n),e=s.subParser("escapeSpecialCharsWithinTagAttributes")(e,t,n),e=s.subParser("encodeBackslashEscapes")(e,t,n),e=s.subParser("images")(e,t,n),e=s.subParser("anchors")(e,t,n),e=s.subParser("autoLinks")(e,t,n),e=s.subParser("simplifiedAutoLinks")(e,t,n),e=s.subParser("emoji")(e,t,n),e=s.subParser("underline")(e,t,n),e=s.subParser("italicsAndBold")(e,t,n),e=s.subParser("strikethrough")(e,t,n),e=s.subParser("ellipsis")(e,t,n),e=s.subParser("hashHTMLSpans")(e,t,n),e=s.subParser("encodeAmpsAndAngles")(e,t,n),t.simpleLineBreaks?/\n\n¨K/.test(e)||(e=e.replace(/\n+/g,"<br />\n")):e=e.replace(/  +\n/g,"<br />\n"),e=n.converter._dispatch("spanGamut.after",e,t,n)})),s.subParser("strikethrough",(function(e,t,n){"use strict";return t.strikethrough&&(e=(e=n.converter._dispatch("strikethrough.before",e,t,n)).replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,(function(e,r){return function(e){return t.simplifiedAutoLink&&(e=s.subParser("simplifiedAutoLinks")(e,t,n)),"<del>"+e+"</del>"}(r)})),e=n.converter._dispatch("strikethrough.after",e,t,n)),e})),s.subParser("stripLinkDefinitions",(function(e,t,n){"use strict";var r=function(e,r,i,a,o,c,u){return r=r.toLowerCase(),i.match(/^data:.+?\/.+?;base64,/)?n.gUrls[r]=i.replace(/\s/g,""):n.gUrls[r]=s.subParser("encodeAmpsAndAngles")(i,t,n),c?c+u:(u&&(n.gTitles[r]=u.replace(/"|'/g,"&quot;")),t.parseImgDimensions&&a&&o&&(n.gDimensions[r]={width:a,height:o}),"")};return e=(e=(e=(e+="¨0").replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm,r)).replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,r)).replace(/¨0/,"")})),s.subParser("tables",(function(e,t,n){"use strict";if(!t.tables)return e;function r(e,r){return"<td"+r+">"+s.subParser("spanGamut")(e,t,n)+"</td>\n"}function i(e){var i,a=e.split("\n");for(i=0;i<a.length;++i)/^ {0,3}\|/.test(a[i])&&(a[i]=a[i].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(a[i])&&(a[i]=a[i].replace(/\|[ \t]*$/,"")),a[i]=s.subParser("codeSpans")(a[i],t,n);var o,c,u,l,d=a[0].split("|").map((function(e){return e.trim()})),h=a[1].split("|").map((function(e){return e.trim()})),f=[],p=[],g=[],m=[];for(a.shift(),a.shift(),i=0;i<a.length;++i)""!==a[i].trim()&&f.push(a[i].split("|").map((function(e){return e.trim()})));if(d.length<h.length)return e;for(i=0;i<h.length;++i)g.push((o=h[i],/^:[ \t]*--*$/.test(o)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(o)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(o)?' style="text-align:center;"':""));for(i=0;i<d.length;++i)s.helper.isUndefined(g[i])&&(g[i]=""),p.push((c=d[i],u=g[i],l=void 0,l="",c=c.trim(),(t.tablesHeaderId||t.tableHeaderId)&&(l=' id="'+c.replace(/ /g,"_").toLowerCase()+'"'),"<th"+l+u+">"+(c=s.subParser("spanGamut")(c,t,n))+"</th>\n"));for(i=0;i<f.length;++i){for(var v=[],y=0;y<p.length;++y)s.helper.isUndefined(f[i][y]),v.push(r(f[i][y],g[y]));m.push(v)}return function(e,t){for(var n="<table>\n<thead>\n<tr>\n",r=e.length,i=0;i<r;++i)n+=e[i];for(n+="</tr>\n</thead>\n<tbody>\n",i=0;i<t.length;++i){n+="<tr>\n";for(var s=0;s<r;++s)n+=t[i][s];n+="</tr>\n"}return n+"</tbody>\n</table>\n"}(p,m)}return e=(e=(e=(e=n.converter._dispatch("tables.before",e,t,n)).replace(/\\(\|)/g,s.helper.escapeCharactersCallback)).replace(/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,i)).replace(/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm,i),e=n.converter._dispatch("tables.after",e,t,n)})),s.subParser("underline",(function(e,t,n){"use strict";return t.underline?(e=n.converter._dispatch("underline.before",e,t,n),e=(e=t.literalMidWordUnderscores?(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return"<u>"+t+"</u>"}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return"<u>"+t+"</u>"})):(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/(_)/g,s.helper.escapeCharactersCallback),e=n.converter._dispatch("underline.after",e,t,n)):e})),s.subParser("unescapeSpecialChars",(function(e,t,n){"use strict";return e=(e=n.converter._dispatch("unescapeSpecialChars.before",e,t,n)).replace(/¨E(\d+)E/g,(function(e,t){var n=parseInt(t);return String.fromCharCode(n)})),e=n.converter._dispatch("unescapeSpecialChars.after",e,t,n)})),s.subParser("makeMarkdown.blockquote",(function(e,t){"use strict";var n="";if(e.hasChildNodes())for(var r=e.childNodes,i=r.length,a=0;a<i;++a){var o=s.subParser("makeMarkdown.node")(r[a],t);""!==o&&(n+=o)}return n="> "+(n=n.trim()).split("\n").join("\n> ")})),s.subParser("makeMarkdown.codeBlock",(function(e,t){"use strict";var n=e.getAttribute("language"),r=e.getAttribute("precodenum");return"```"+n+"\n"+t.preList[r]+"\n```"})),s.subParser("makeMarkdown.codeSpan",(function(e){"use strict";return"`"+e.innerHTML+"`"})),s.subParser("makeMarkdown.emphasis",(function(e,t){"use strict";var n="";if(e.hasChildNodes()){n+="*";for(var r=e.childNodes,i=r.length,a=0;a<i;++a)n+=s.subParser("makeMarkdown.node")(r[a],t);n+="*"}return n})),s.subParser("makeMarkdown.header",(function(e,t,n){"use strict";var r=new Array(n+1).join("#"),i="";if(e.hasChildNodes()){i=r+" ";for(var a=e.childNodes,o=a.length,c=0;c<o;++c)i+=s.subParser("makeMarkdown.node")(a[c],t)}return i})),s.subParser("makeMarkdown.hr",(function(){"use strict";return"---"})),s.subParser("makeMarkdown.image",(function(e){"use strict";var t="";return e.hasAttribute("src")&&(t+="!["+e.getAttribute("alt")+"](",t+="<"+e.getAttribute("src")+">",e.hasAttribute("width")&&e.hasAttribute("height")&&(t+=" ="+e.getAttribute("width")+"x"+e.getAttribute("height")),e.hasAttribute("title")&&(t+=' "'+e.getAttribute("title")+'"'),t+=")"),t})),s.subParser("makeMarkdown.links",(function(e,t){"use strict";var n="";if(e.hasChildNodes()&&e.hasAttribute("href")){var r=e.childNodes,i=r.length;n="[";for(var a=0;a<i;++a)n+=s.subParser("makeMarkdown.node")(r[a],t);n+="](",n+="<"+e.getAttribute("href")+">",e.hasAttribute("title")&&(n+=' "'+e.getAttribute("title")+'"'),n+=")"}return n})),s.subParser("makeMarkdown.list",(function(e,t,n){"use strict";var r="";if(!e.hasChildNodes())return"";for(var i=e.childNodes,a=i.length,o=e.getAttribute("start")||1,c=0;c<a;++c)if(void 0!==i[c].tagName&&"li"===i[c].tagName.toLowerCase()){r+=("ol"===n?o.toString()+". ":"- ")+s.subParser("makeMarkdown.listItem")(i[c],t),++o}return(r+="\n\x3c!-- --\x3e\n").trim()})),s.subParser("makeMarkdown.listItem",(function(e,t){"use strict";for(var n="",r=e.childNodes,i=r.length,a=0;a<i;++a)n+=s.subParser("makeMarkdown.node")(r[a],t);return/\n$/.test(n)?n=n.split("\n").join("\n    ").replace(/^ {4}$/gm,"").replace(/\n\n+/g,"\n\n"):n+="\n",n})),s.subParser("makeMarkdown.node",(function(e,t,n){"use strict";n=n||!1;var r="";if(3===e.nodeType)return s.subParser("makeMarkdown.txt")(e,t);if(8===e.nodeType)return"\x3c!--"+e.data+"--\x3e\n\n";if(1!==e.nodeType)return"";switch(e.tagName.toLowerCase()){case"h1":n||(r=s.subParser("makeMarkdown.header")(e,t,1)+"\n\n");break;case"h2":n||(r=s.subParser("makeMarkdown.header")(e,t,2)+"\n\n");break;case"h3":n||(r=s.subParser("makeMarkdown.header")(e,t,3)+"\n\n");break;case"h4":n||(r=s.subParser("makeMarkdown.header")(e,t,4)+"\n\n");break;case"h5":n||(r=s.subParser("makeMarkdown.header")(e,t,5)+"\n\n");break;case"h6":n||(r=s.subParser("makeMarkdown.header")(e,t,6)+"\n\n");break;case"p":n||(r=s.subParser("makeMarkdown.paragraph")(e,t)+"\n\n");break;case"blockquote":n||(r=s.subParser("makeMarkdown.blockquote")(e,t)+"\n\n");break;case"hr":n||(r=s.subParser("makeMarkdown.hr")(e,t)+"\n\n");break;case"ol":n||(r=s.subParser("makeMarkdown.list")(e,t,"ol")+"\n\n");break;case"ul":n||(r=s.subParser("makeMarkdown.list")(e,t,"ul")+"\n\n");break;case"precode":n||(r=s.subParser("makeMarkdown.codeBlock")(e,t)+"\n\n");break;case"pre":n||(r=s.subParser("makeMarkdown.pre")(e,t)+"\n\n");break;case"table":n||(r=s.subParser("makeMarkdown.table")(e,t)+"\n\n");break;case"code":r=s.subParser("makeMarkdown.codeSpan")(e,t);break;case"em":case"i":r=s.subParser("makeMarkdown.emphasis")(e,t);break;case"strong":case"b":r=s.subParser("makeMarkdown.strong")(e,t);break;case"del":r=s.subParser("makeMarkdown.strikethrough")(e,t);break;case"a":r=s.subParser("makeMarkdown.links")(e,t);break;case"img":r=s.subParser("makeMarkdown.image")(e,t);break;default:r=e.outerHTML+"\n\n"}return r})),s.subParser("makeMarkdown.paragraph",(function(e,t){"use strict";var n="";if(e.hasChildNodes())for(var r=e.childNodes,i=r.length,a=0;a<i;++a)n+=s.subParser("makeMarkdown.node")(r[a],t);return n=n.trim()})),s.subParser("makeMarkdown.pre",(function(e,t){"use strict";var n=e.getAttribute("prenum");return"<pre>"+t.preList[n]+"</pre>"})),s.subParser("makeMarkdown.strikethrough",(function(e,t){"use strict";var n="";if(e.hasChildNodes()){n+="~~";for(var r=e.childNodes,i=r.length,a=0;a<i;++a)n+=s.subParser("makeMarkdown.node")(r[a],t);n+="~~"}return n})),s.subParser("makeMarkdown.strong",(function(e,t){"use strict";var n="";if(e.hasChildNodes()){n+="**";for(var r=e.childNodes,i=r.length,a=0;a<i;++a)n+=s.subParser("makeMarkdown.node")(r[a],t);n+="**"}return n})),s.subParser("makeMarkdown.table",(function(e,t){"use strict";var n,r,i="",a=[[],[]],o=e.querySelectorAll("thead>tr>th"),c=e.querySelectorAll("tbody>tr");for(n=0;n<o.length;++n){var u=s.subParser("makeMarkdown.tableCell")(o[n],t),l="---";if(o[n].hasAttribute("style"))switch(o[n].getAttribute("style").toLowerCase().replace(/\s/g,"")){case"text-align:left;":l=":---";break;case"text-align:right;":l="---:";break;case"text-align:center;":l=":---:"}a[0][n]=u.trim(),a[1][n]=l}for(n=0;n<c.length;++n){var d=a.push([])-1,h=c[n].getElementsByTagName("td");for(r=0;r<o.length;++r){var f=" ";void 0!==h[r]&&(f=s.subParser("makeMarkdown.tableCell")(h[r],t)),a[d].push(f)}}var p=3;for(n=0;n<a.length;++n)for(r=0;r<a[n].length;++r){var g=a[n][r].length;g>p&&(p=g)}for(n=0;n<a.length;++n){for(r=0;r<a[n].length;++r)1===n?":"===a[n][r].slice(-1)?a[n][r]=s.helper.padEnd(a[n][r].slice(-1),p-1,"-")+":":a[n][r]=s.helper.padEnd(a[n][r],p,"-"):a[n][r]=s.helper.padEnd(a[n][r],p);i+="| "+a[n].join(" | ")+" |\n"}return i.trim()})),s.subParser("makeMarkdown.tableCell",(function(e,t){"use strict";var n="";if(!e.hasChildNodes())return"";for(var r=e.childNodes,i=r.length,a=0;a<i;++a)n+=s.subParser("makeMarkdown.node")(r[a],t,!0);return n.trim()})),s.subParser("makeMarkdown.txt",(function(e){"use strict";var t=e.nodeValue;return t=(t=t.replace(/ +/g," ")).replace(/¨NBSP;/g," "),t=(t=(t=(t=(t=(t=(t=(t=(t=s.helper.unescapeHTMLEntities(t)).replace(/([*_~|`])/g,"\\$1")).replace(/^(\s*)>/g,"\\$1>")).replace(/^#/gm,"\\#")).replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3")).replace(/^( {0,3}\d+)\./gm,"$1\\.")).replace(/^( {0,3})([+-])/gm,"$1\\$2")).replace(/]([\s]*)\(/g,"\\]$1\\(")).replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:")}));void 0===(r=function(){"use strict";return s}.call(t,n,t,e))||(e.exports=r)}).call(this)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){this._hasWeakSet="function"==typeof WeakSet,this._inner=this._hasWeakSet?new WeakSet:[]}return e.prototype.memoize=function(e){if(this._hasWeakSet)return!!this._inner.has(e)||(this._inner.add(e),!1);for(var t=0;t<this._inner.length;t++){if(this._inner[t]===e)return!0}return this._inner.push(e),!1},e.prototype.unmemoize=function(e){if(this._hasWeakSet)this._inner.delete(e);else for(var t=0;t<this._inner.length;t++)if(this._inner[t]===e){this._inner.splice(t,1);break}},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(34),i=n(3),s=n(8),a=n(2);function o(){Object(r.a)({callback:c,type:"error"}),Object(r.a)({callback:c,type:"unhandledrejection"})}function c(){var e=Object(a.b)();e&&(i.a.log("[Tracing] Transaction: "+s.a.InternalError+" -> Global error occured"),e.setStatus(s.a.InternalError))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r,i=n(0),s=n(4),a=n(3),o=n(6),c=n(7),u=n(21),l=n(25),d=Object(o.e)(),h={},f={};function p(e){if(!f[e])switch(f[e]=!0,e){case"console":!function(){if(!("console"in d))return;["debug","info","warn","error","log","assert"].forEach((function(e){e in d.console&&Object(c.c)(d.console,e,(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];m("console",{args:n,level:e}),t&&Function.prototype.apply.call(t,d.console,n)}}))}))}();break;case"dom":!function(){if(!("document"in d))return;d.document.addEventListener("click",E("click",m.bind(null,"dom")),!1),d.document.addEventListener("keypress",T(m.bind(null,"dom")),!1),["EventTarget","Node"].forEach((function(e){var t=d[e]&&d[e].prototype;t&&t.hasOwnProperty&&t.hasOwnProperty("addEventListener")&&(Object(c.c)(t,"addEventListener",(function(e){return function(t,n,r){return n&&n.handleEvent?("click"===t&&Object(c.c)(n,"handleEvent",(function(e){return function(t){return E("click",m.bind(null,"dom"))(t),e.call(this,t)}})),"keypress"===t&&Object(c.c)(n,"handleEvent",(function(e){return function(t){return T(m.bind(null,"dom"))(t),e.call(this,t)}}))):("click"===t&&E("click",m.bind(null,"dom"),!0)(this),"keypress"===t&&T(m.bind(null,"dom"))(this)),e.call(this,t,n,r)}})),Object(c.c)(t,"removeEventListener",(function(e){return function(t,n,r){try{e.call(this,t,n.__sentry_wrapped__,r)}catch(e){}return e.call(this,t,n,r)}})))}))}();break;case"xhr":!function(){if(!("XMLHttpRequest"in d))return;var e=[],t=[],n=XMLHttpRequest.prototype;Object(c.c)(n,"open",(function(n){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=this,o=r[1];a.__sentry_xhr__={method:Object(s.k)(r[0])?r[0].toUpperCase():r[0],url:r[1]},Object(s.k)(o)&&"POST"===a.__sentry_xhr__.method&&o.match(/sentry_key/)&&(a.__sentry_own_request__=!0);var u=function(){if(4===a.readyState){try{a.__sentry_xhr__&&(a.__sentry_xhr__.status_code=a.status)}catch(e){}try{var n=e.indexOf(a);if(-1!==n){e.splice(n);var i=t.splice(n)[0];a.__sentry_xhr__&&void 0!==i[0]&&(a.__sentry_xhr__.body=i[0])}}catch(e){}m("xhr",{args:r,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:a})}};return"onreadystatechange"in a&&"function"==typeof a.onreadystatechange?Object(c.c)(a,"onreadystatechange",(function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return u(),e.apply(a,t)}})):a.addEventListener("readystatechange",u),n.apply(a,r)}})),Object(c.c)(n,"send",(function(n){return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return e.push(this),t.push(r),m("xhr",{args:r,startTimestamp:Date.now(),xhr:this}),n.apply(this,r)}}))}();break;case"fetch":!function(){if(!Object(l.c)())return;Object(c.c)(d,"fetch",(function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r={args:t,fetchData:{method:v(t),url:y(t)},startTimestamp:Date.now()};return m("fetch",Object(i.a)({},r)),e.apply(d,t).then((function(e){return m("fetch",Object(i.a)(Object(i.a)({},r),{endTimestamp:Date.now(),response:e})),e}),(function(e){throw m("fetch",Object(i.a)(Object(i.a)({},r),{endTimestamp:Date.now(),error:e})),e}))}}))}();break;case"history":!function(){if(!Object(l.b)())return;var e=d.onpopstate;function t(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t.length>2?t[2]:void 0;if(i){var s=r,a=String(i);r=a,m("history",{from:s,to:a})}return e.apply(this,t)}}d.onpopstate=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=d.location.href,s=r;if(r=i,m("history",{from:s,to:i}),e)return e.apply(this,t)},Object(c.c)(d.history,"pushState",t),Object(c.c)(d.history,"replaceState",t)}();break;case"error":S=d.onerror,d.onerror=function(e,t,n,r,i){return m("error",{column:r,error:i,line:n,msg:e,url:t}),!!S&&S.apply(this,arguments)};break;case"unhandledrejection":I=d.onunhandledrejection,d.onunhandledrejection=function(e){return m("unhandledrejection",e),!I||I.apply(this,arguments)};break;default:a.a.warn("unknown instrumentation type:",e)}}function g(e){e&&"string"==typeof e.type&&"function"==typeof e.callback&&(h[e.type]=h[e.type]||[],h[e.type].push(e.callback),p(e.type))}function m(e,t){var n,r;if(e&&h[e])try{for(var s=Object(i.f)(h[e]||[]),o=s.next();!o.done;o=s.next()){var c=o.value;try{c(t)}catch(t){a.a.error("Error while triggering instrumentation handler.\nType: "+e+"\nName: "+Object(u.a)(c)+"\nError: "+t)}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}function v(e){return void 0===e&&(e=[]),"Request"in d&&Object(s.g)(e[0],Request)&&e[0].method?String(e[0].method).toUpperCase():e[1]&&e[1].method?String(e[1].method).toUpperCase():"GET"}function y(e){return void 0===e&&(e=[]),"string"==typeof e[0]?e[0]:"Request"in d&&Object(s.g)(e[0],Request)?e[0].url:String(e[0])}var b,w,_=0;function E(e,t,n){return void 0===n&&(n=!1),function(r){b=void 0,r&&w!==r&&(w=r,_&&clearTimeout(_),n?_=setTimeout((function(){t({event:r,name:e})})):t({event:r,name:e}))}}function T(e){return function(t){var n;try{n=t.target}catch(e){return}var r=n&&n.tagName;r&&("INPUT"===r||"TEXTAREA"===r||n.isContentEditable)&&(b||E("input",e)(t),clearTimeout(b),b=setTimeout((function(){b=void 0}),1e3))}}var S=null;var I=null},,,function(e,t){var n,r,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=o(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.r(t),n.d(t,"initFSClientBot",(function(){return an}));var r={};n.r(r),n.d(r,"FunctionToString",(function(){return a})),n.d(r,"InboundFilters",(function(){return p}));var i,s={};n.r(s),n.d(s,"Express",(function(){return it})),n.d(s,"Postgres",(function(){return ct.a})),n.d(s,"Mysql",(function(){return ut.a})),n.d(s,"Mongo",(function(){return lt.a}));var a=function(){function e(){this.name=e.id}return e.prototype.setupOnce=function(){i=Function.prototype.toString,Function.prototype.toString=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this.__sentry_original__||this;return i.apply(n,e)}},e.id="FunctionToString",e}(),o=n(0),c=n(22),u=n(20),l=n(3),d=n(6),h=n(14),f=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],p=function(){function e(t){void 0===t&&(t={}),this._options=t,this.name=e.id}return e.prototype.setupOnce=function(){Object(c.b)((function(t){var n=Object(u.c)();if(!n)return t;var r=n.getIntegration(e);if(r){var i=n.getClient(),s=i?i.getOptions():{},a=r._mergeOptions(s);if(r._shouldDropEvent(t,a))return null}return t}))},e.prototype._shouldDropEvent=function(e,t){return this._isSentryError(e,t)?(l.a.warn("Event dropped due to being internal Sentry Error.\nEvent: "+Object(d.d)(e)),!0):this._isIgnoredError(e,t)?(l.a.warn("Event dropped due to being matched by `ignoreErrors` option.\nEvent: "+Object(d.d)(e)),!0):this._isDeniedUrl(e,t)?(l.a.warn("Event dropped due to being matched by `denyUrls` option.\nEvent: "+Object(d.d)(e)+".\nUrl: "+this._getEventFilterUrl(e)),!0):!this._isAllowedUrl(e,t)&&(l.a.warn("Event dropped due to not being matched by `allowUrls` option.\nEvent: "+Object(d.d)(e)+".\nUrl: "+this._getEventFilterUrl(e)),!0)},e.prototype._isSentryError=function(e,t){if(!t.ignoreInternal)return!1;try{return e&&e.exception&&e.exception.values&&e.exception.values[0]&&"SentryError"===e.exception.values[0].type||!1}catch(e){return!1}},e.prototype._isIgnoredError=function(e,t){return!(!t.ignoreErrors||!t.ignoreErrors.length)&&this._getPossibleEventMessages(e).some((function(e){return t.ignoreErrors.some((function(t){return Object(h.a)(e,t)}))}))},e.prototype._isDeniedUrl=function(e,t){if(!t.denyUrls||!t.denyUrls.length)return!1;var n=this._getEventFilterUrl(e);return!!n&&t.denyUrls.some((function(e){return Object(h.a)(n,e)}))},e.prototype._isAllowedUrl=function(e,t){if(!t.allowUrls||!t.allowUrls.length)return!0;var n=this._getEventFilterUrl(e);return!n||t.allowUrls.some((function(e){return Object(h.a)(n,e)}))},e.prototype._mergeOptions=function(e){return void 0===e&&(e={}),{allowUrls:Object(o.e)(this._options.whitelistUrls||[],this._options.allowUrls||[],e.whitelistUrls||[],e.allowUrls||[]),denyUrls:Object(o.e)(this._options.blacklistUrls||[],this._options.denyUrls||[],e.blacklistUrls||[],e.denyUrls||[]),ignoreErrors:Object(o.e)(this._options.ignoreErrors||[],e.ignoreErrors||[],f),ignoreInternal:void 0===this._options.ignoreInternal||this._options.ignoreInternal}},e.prototype._getPossibleEventMessages=function(e){if(e.message)return[e.message];if(e.exception)try{var t=e.exception.values&&e.exception.values[0]||{},n=t.type,r=void 0===n?"":n,i=t.value,s=void 0===i?"":i;return[""+s,r+": "+s]}catch(t){return l.a.error("Cannot extract message for event "+Object(d.d)(e)),[]}return[]},e.prototype._getEventFilterUrl=function(e){try{if(e.stacktrace){var t=e.stacktrace.frames;return t&&t[t.length-1].filename||null}if(e.exception){var n=e.exception.values&&e.exception.values[0].stacktrace&&e.exception.values[0].stacktrace.frames;return n&&n[n.length-1].filename||null}return null}catch(t){return l.a.error("Cannot extract url for event "+Object(d.d)(e)),null}},e.id="InboundFilters",e}();var g=n(19),m=n(42),v=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){return e.__proto__=t,e}:function(e,t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e});var y=function(e){function t(t){var n=this.constructor,r=e.call(this,t)||this;return r.message=t,r.name=n.prototype.constructor.name,v(r,n.prototype),r}return Object(o.b)(t,e),t}(Error),b=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/,w="Invalid Dsn",_=function(){function e(e){"string"==typeof e?this._fromString(e):this._fromComponents(e),this._validate()}return e.prototype.toString=function(e){void 0===e&&(e=!1);var t=this,n=t.host,r=t.path,i=t.pass,s=t.port,a=t.projectId;return t.protocol+"://"+t.user+(e&&i?":"+i:"")+"@"+n+(s?":"+s:"")+"/"+(r?r+"/":r)+a},e.prototype._fromString=function(e){var t=b.exec(e);if(!t)throw new y(w);var n=Object(o.c)(t.slice(1),6),r=n[0],i=n[1],s=n[2],a=void 0===s?"":s,c=n[3],u=n[4],l=void 0===u?"":u,d="",h=n[5],f=h.split("/");if(f.length>1&&(d=f.slice(0,-1).join("/"),h=f.pop()),h){var p=h.match(/^\d+/);p&&(h=p[0])}this._fromComponents({host:c,pass:a,path:d,projectId:h,port:l,protocol:r,user:i})},e.prototype._fromComponents=function(e){this.protocol=e.protocol,this.user=e.user,this.pass=e.pass||"",this.host=e.host,this.port=e.port||"",this.path=e.path||"",this.projectId=e.projectId},e.prototype._validate=function(){var e=this;if(["protocol","user","host","projectId"].forEach((function(t){if(!e[t])throw new y("Invalid Dsn: "+t+" missing")})),!this.projectId.match(/^\d+$/))throw new y("Invalid Dsn: Invalid projectId "+this.projectId);if("http"!==this.protocol&&"https"!==this.protocol)throw new y("Invalid Dsn: Invalid protocol "+this.protocol);if(this.port&&isNaN(parseInt(this.port,10)))throw new y("Invalid Dsn: Invalid port "+this.port)},e}(),E=n(4),T=n(18),S=n(7),I=[];function k(e){var t={};return function(e){var t=e.defaultIntegrations&&Object(o.e)(e.defaultIntegrations)||[],n=e.integrations,r=[];if(Array.isArray(n)){var i=n.map((function(e){return e.name})),s=[];t.forEach((function(e){-1===i.indexOf(e.name)&&-1===s.indexOf(e.name)&&(r.push(e),s.push(e.name))})),n.forEach((function(e){-1===s.indexOf(e.name)&&(r.push(e),s.push(e.name))}))}else"function"==typeof n?(r=n(t),r=Array.isArray(r)?r:[r]):r=Object(o.e)(t);var a=r.map((function(e){return e.name})),c="Debug";return-1!==a.indexOf(c)&&r.push.apply(r,Object(o.e)(r.splice(a.indexOf(c),1))),r}(e).forEach((function(e){t[e.name]=e,function(e){-1===I.indexOf(e.name)&&(e.setupOnce(c.b,u.c),I.push(e.name),l.a.log("Integration installed: "+e.name))}(e)})),t}var A,O=function(){function e(e,t){this._integrations={},this._processing=0,this._backend=new e(t),this._options=t,t.dsn&&(this._dsn=new _(t.dsn))}return e.prototype.captureException=function(e,t,n){var r=this,i=t&&t.event_id;return this._process(this._getBackend().eventFromException(e,t).then((function(e){return r._captureEvent(e,t,n)})).then((function(e){i=e}))),i},e.prototype.captureMessage=function(e,t,n,r){var i=this,s=n&&n.event_id,a=Object(E.i)(e)?this._getBackend().eventFromMessage(String(e),t,n):this._getBackend().eventFromException(e,n);return this._process(a.then((function(e){return i._captureEvent(e,n,r)})).then((function(e){s=e}))),s},e.prototype.captureEvent=function(e,t,n){var r=t&&t.event_id;return this._process(this._captureEvent(e,t,n).then((function(e){r=e}))),r},e.prototype.captureSession=function(e){e.release?this._sendSession(e):l.a.warn("Discarded session because of missing release")},e.prototype.getDsn=function(){return this._dsn},e.prototype.getOptions=function(){return this._options},e.prototype.flush=function(e){var t=this;return this._isClientProcessing(e).then((function(n){return t._getBackend().getTransport().close(e).then((function(e){return n&&e}))}))},e.prototype.close=function(e){var t=this;return this.flush(e).then((function(e){return t.getOptions().enabled=!1,e}))},e.prototype.setupIntegrations=function(){this._isEnabled()&&(this._integrations=k(this._options))},e.prototype.getIntegration=function(e){try{return this._integrations[e.id]||null}catch(t){return l.a.warn("Cannot retrieve integration "+e.id+" from the current Client"),null}},e.prototype._updateSessionFromEvent=function(e,t){var n,r,i,s=!1,a=!1,c=t.exception&&t.exception.values;if(c){a=!0;try{for(var u=Object(o.f)(c),l=u.next();!l.done;l=u.next()){var d=l.value.mechanism;if(d&&!1===d.handled){s=!0;break}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}var h=t.user;if(!e.userAgent){var f=t.request?t.request.headers:{};for(var p in f)if("user-agent"===p.toLowerCase()){i=f[p];break}}e.update(Object(o.a)(Object(o.a)({},s&&{status:m.a.Crashed}),{user:h,userAgent:i,errors:e.errors+Number(a||s)}))},e.prototype._sendSession=function(e){this._getBackend().sendSession(e)},e.prototype._isClientProcessing=function(e){var t=this;return new g.a((function(n){var r=0,i=setInterval((function(){0==t._processing?(clearInterval(i),n(!0)):(r+=1,e&&r>=e&&(clearInterval(i),n(!1)))}),1)}))},e.prototype._getBackend=function(){return this._backend},e.prototype._isEnabled=function(){return!1!==this.getOptions().enabled&&void 0!==this._dsn},e.prototype._prepareEvent=function(e,t,n){var r=this,i=this.getOptions().normalizeDepth,s=void 0===i?3:i,a=Object(o.a)(Object(o.a)({},e),{event_id:e.event_id||(n&&n.event_id?n.event_id:Object(d.i)()),timestamp:e.timestamp||Object(T.b)()});this._applyClientOptions(a),this._applyIntegrationsMetadata(a);var u=t;n&&n.captureContext&&(u=c.a.clone(u).update(n.captureContext));var l=g.a.resolve(a);return u&&(l=u.applyToEvent(a,n)),l.then((function(e){return"number"==typeof s&&s>0?r._normalizeEvent(e,s):e}))},e.prototype._normalizeEvent=function(e,t){if(!e)return null;var n=Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)({},e),e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map((function(e){return Object(o.a)(Object(o.a)({},e),e.data&&{data:Object(S.d)(e.data,t)})}))}),e.user&&{user:Object(S.d)(e.user,t)}),e.contexts&&{contexts:Object(S.d)(e.contexts,t)}),e.extra&&{extra:Object(S.d)(e.extra,t)});return e.contexts&&e.contexts.trace&&(n.contexts.trace=e.contexts.trace),n},e.prototype._applyClientOptions=function(e){var t=this.getOptions(),n=t.environment,r=t.release,i=t.dist,s=t.maxValueLength,a=void 0===s?250:s;"environment"in e||(e.environment="environment"in t?n:"production"),void 0===e.release&&void 0!==r&&(e.release=r),void 0===e.dist&&void 0!==i&&(e.dist=i),e.message&&(e.message=Object(h.d)(e.message,a));var o=e.exception&&e.exception.values&&e.exception.values[0];o&&o.value&&(o.value=Object(h.d)(o.value,a));var c=e.request;c&&c.url&&(c.url=Object(h.d)(c.url,a))},e.prototype._applyIntegrationsMetadata=function(e){var t=e.sdk,n=Object.keys(this._integrations);t&&n.length>0&&(t.integrations=n)},e.prototype._sendEvent=function(e){this._getBackend().sendEvent(e)},e.prototype._captureEvent=function(e,t,n){return this._processEvent(e,t,n).then((function(e){return e.event_id}),(function(e){l.a.error(e)}))},e.prototype._processEvent=function(e,t,n){var r=this,i=this.getOptions(),s=i.beforeSend,a=i.sampleRate;if(!this._isEnabled())return g.a.reject(new y("SDK not enabled, will not send event."));var o="transaction"===e.type;return!o&&"number"==typeof a&&Math.random()>a?g.a.reject(new y("Discarding event because it's not included in the random sample (sampling rate = "+a+")")):this._prepareEvent(e,n,t).then((function(e){if(null===e)throw new y("An event processor returned null, will not send event.");if(t&&t.data&&!0===t.data.__sentry__||o||!s)return e;var n=s(e,t);if(void 0===n)throw new y("`beforeSend` method has to return `null` or a valid event.");return Object(E.m)(n)?n.then((function(e){return e}),(function(e){throw new y("beforeSend rejected with "+e)})):n})).then((function(e){if(null===e)throw new y("`beforeSend` returned `null`, will not send event.");var t=n&&n.getSession&&n.getSession();return!o&&t&&r._updateSessionFromEvent(t,e),r._sendEvent(e),e})).then(null,(function(e){if(e instanceof y)throw e;throw r.captureException(e,{data:{__sentry__:!0},originalException:e}),new y("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+e)}))},e.prototype._process=function(e){var t=this;this._processing+=1,e.then((function(e){return t._processing-=1,e}),(function(e){return t._processing-=1,e}))},e}();!function(e){e.Unknown="unknown",e.Skipped="skipped",e.Success="success",e.RateLimit="rate_limit",e.Invalid="invalid",e.Failed="failed"}(A||(A={})),function(e){e.fromHttpCode=function(t){return t>=200&&t<300?e.Success:429===t?e.RateLimit:t>=400&&t<500?e.Invalid:t>=500?e.Failed:e.Unknown}}(A||(A={}));var x,C=function(){function e(){}return e.prototype.sendEvent=function(e){return g.a.resolve({reason:"NoopTransport: Event has been skipped because no Dsn is configured.",status:A.Skipped})},e.prototype.close=function(e){return g.a.resolve(!0)},e}(),R=function(){function e(e){this._options=e,this._options.dsn||l.a.warn("No DSN provided, backend will not do anything."),this._transport=this._setupTransport()}return e.prototype.eventFromException=function(e,t){throw new y("Backend has to implement `eventFromException` method")},e.prototype.eventFromMessage=function(e,t,n){throw new y("Backend has to implement `eventFromMessage` method")},e.prototype.sendEvent=function(e){this._transport.sendEvent(e).then(null,(function(e){l.a.error("Error while sending event: "+e)}))},e.prototype.sendSession=function(e){this._transport.sendSession?this._transport.sendSession(e).then(null,(function(e){l.a.error("Error while sending session: "+e)})):l.a.warn("Dropping session because custom transport doesn't implement sendSession")},e.prototype.getTransport=function(){return this._transport},e.prototype._setupTransport=function(){return new C},e}();!function(e){e.Fatal="fatal",e.Error="error",e.Warning="warning",e.Log="log",e.Info="info",e.Debug="debug",e.Critical="critical"}(x||(x={})),function(e){e.fromString=function(t){switch(t){case"debug":return e.Debug;case"info":return e.Info;case"warn":case"warning":return e.Warning;case"error":return e.Error;case"fatal":return e.Fatal;case"critical":return e.Critical;default:return e.Log}}}(x||(x={}));var D=n(25),L="?",P=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,N=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|capacitor).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,M=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,j=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,F=/\((\S*)(?::(\d+))(?::(\d+))\)/,U=/Minified React error #\d+;/i;function B(e){var t=null,n=0;e&&("number"==typeof e.framesToPop?n=e.framesToPop:U.test(e.message)&&(n=1));try{if(t=function(e){if(!e||!e.stacktrace)return null;for(var t,n=e.stacktrace,r=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,i=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\((.*)\))? in (.*):\s*$/i,s=n.split("\n"),a=[],o=0;o<s.length;o+=2){var c=null;(t=r.exec(s[o]))?c={url:t[2],func:t[3],args:[],line:+t[1],column:null}:(t=i.exec(s[o]))&&(c={url:t[6],func:t[3]||t[4],args:t[5]?t[5].split(","):[],line:+t[1],column:+t[2]}),c&&(!c.func&&c.line&&(c.func=L),a.push(c))}if(!a.length)return null;return{message:q(e),name:e.name,stack:a}}(e),t)return V(t,n)}catch(e){}try{if(t=function(e){if(!e||!e.stack)return null;for(var t,n,r,i=[],s=e.stack.split("\n"),a=0;a<s.length;++a){if(n=P.exec(s[a])){var o=n[2]&&0===n[2].indexOf("native");n[2]&&0===n[2].indexOf("eval")&&(t=F.exec(n[2]))&&(n[2]=t[1],n[3]=t[2],n[4]=t[3]),r={url:n[2]&&0===n[2].indexOf("address at ")?n[2].substr("address at ".length):n[2],func:n[1]||L,args:o?[n[2]]:[],line:n[3]?+n[3]:null,column:n[4]?+n[4]:null}}else if(n=M.exec(s[a]))r={url:n[2],func:n[1]||L,args:[],line:+n[3],column:n[4]?+n[4]:null};else{if(!(n=N.exec(s[a])))continue;n[3]&&n[3].indexOf(" > eval")>-1&&(t=j.exec(n[3]))?(n[1]=n[1]||"eval",n[3]=t[1],n[4]=t[2],n[5]=""):0!==a||n[5]||void 0===e.columnNumber||(i[0].column=e.columnNumber+1),r={url:n[3],func:n[1]||L,args:n[2]?n[2].split(","):[],line:n[4]?+n[4]:null,column:n[5]?+n[5]:null}}!r.func&&r.line&&(r.func=L),i.push(r)}if(!i.length)return null;return{message:q(e),name:e.name,stack:i}}(e),t)return V(t,n)}catch(e){}return{message:q(e),name:e&&e.name,stack:[],failed:!0}}function V(e,t){try{return Object(o.a)(Object(o.a)({},e),{stack:e.stack.slice(t)})}catch(t){return e}}function q(e){var t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:t:"No error message"}function G(e){var t=z(e.stack),n={type:e.name,value:e.message};return t&&t.length&&(n.stacktrace={frames:t}),void 0===n.type&&""===n.value&&(n.value="Unrecoverable error caught"),n}function K(e){return{exception:{values:[G(e)]}}}function z(e){if(!e||!e.length)return[];var t=e,n=t[0].func||"",r=t[t.length-1].func||"";return-1===n.indexOf("captureMessage")&&-1===n.indexOf("captureException")||(t=t.slice(1)),-1!==r.indexOf("sentryWrapped")&&(t=t.slice(0,-1)),t.slice(0,50).map((function(e){return{colno:null===e.column?void 0:e.column,filename:e.url||t[0].url,function:e.func||"?",in_app:!0,lineno:null===e.line?void 0:e.line}})).reverse()}function H(e,t,n){var r;if(void 0===n&&(n={}),Object(E.e)(e)&&e.error)return r=K(B(e=e.error));if(Object(E.a)(e)||Object(E.b)(e)){var i=e,s=i.name||(Object(E.a)(i)?"DOMError":"DOMException"),a=i.message?s+": "+i.message:s;return r=W(a,t,n),Object(d.b)(r,a),"code"in i&&(r.tags=Object(o.a)(Object(o.a)({},r.tags),{"DOMException.code":""+i.code})),r}return Object(E.d)(e)?r=K(B(e)):Object(E.h)(e)||Object(E.f)(e)?(r=function(e,t,n){var r={exception:{values:[{type:Object(E.f)(e)?e.constructor.name:n?"UnhandledRejection":"Error",value:"Non-Error "+(n?"promise rejection":"exception")+" captured with keys: "+Object(S.b)(e)}]},extra:{__serialized__:Object(S.e)(e)}};if(t){var i=z(B(t).stack);r.stacktrace={frames:i}}return r}(e,t,n.rejection),Object(d.a)(r,{synthetic:!0}),r):(r=W(e,t,n),Object(d.b)(r,""+e,void 0),Object(d.a)(r,{synthetic:!0}),r)}function W(e,t,n){void 0===n&&(n={});var r={message:e};if(n.attachStacktrace&&t){var i=z(B(t).stack);r.stacktrace={frames:i}}return r}function $(e,t){return{body:JSON.stringify({sent_at:(new Date).toISOString()})+"\n"+JSON.stringify({type:"session"})+"\n"+JSON.stringify(e),type:"session",url:t.getEnvelopeEndpointWithUrlEncodedAuth()}}function Y(e,t){var n=e.tags||{},r=n.__sentry_samplingMethod,i=n.__sentry_sampleRate,s=Object(o.d)(n,["__sentry_samplingMethod","__sentry_sampleRate"]);e.tags=s;var a="transaction"===e.type,c={body:JSON.stringify(e),type:e.type||"event",url:a?t.getEnvelopeEndpointWithUrlEncodedAuth():t.getStoreEndpointWithUrlEncodedAuth()};if(a){var u=JSON.stringify({event_id:e.event_id,sent_at:(new Date).toISOString()})+"\n"+JSON.stringify({type:e.type,sample_rates:[{id:r,rate:i}]})+"\n"+c.body;c.body=u}return c}var Q=function(){function e(e){this.dsn=e,this._dsnObject=new _(e)}return e.prototype.getDsn=function(){return this._dsnObject},e.prototype.getBaseApiEndpoint=function(){var e=this._dsnObject,t=e.protocol?e.protocol+":":"",n=e.port?":"+e.port:"";return t+"//"+e.host+n+(e.path?"/"+e.path:"")+"/api/"},e.prototype.getStoreEndpoint=function(){return this._getIngestEndpoint("store")},e.prototype.getStoreEndpointWithUrlEncodedAuth=function(){return this.getStoreEndpoint()+"?"+this._encodedAuth()},e.prototype.getEnvelopeEndpointWithUrlEncodedAuth=function(){return this._getEnvelopeEndpoint()+"?"+this._encodedAuth()},e.prototype.getStoreEndpointPath=function(){var e=this._dsnObject;return(e.path?"/"+e.path:"")+"/api/"+e.projectId+"/store/"},e.prototype.getRequestHeaders=function(e,t){var n=this._dsnObject,r=["Sentry sentry_version=7"];return r.push("sentry_client="+e+"/"+t),r.push("sentry_key="+n.user),n.pass&&r.push("sentry_secret="+n.pass),{"Content-Type":"application/json","X-Sentry-Auth":r.join(", ")}},e.prototype.getReportDialogEndpoint=function(e){void 0===e&&(e={});var t=this._dsnObject,n=this.getBaseApiEndpoint()+"embed/error-page/",r=[];for(var i in r.push("dsn="+t.toString()),e)if("dsn"!==i)if("user"===i){if(!e.user)continue;e.user.name&&r.push("name="+encodeURIComponent(e.user.name)),e.user.email&&r.push("email="+encodeURIComponent(e.user.email))}else r.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return r.length?n+"?"+r.join("&"):n},e.prototype._getEnvelopeEndpoint=function(){return this._getIngestEndpoint("envelope")},e.prototype._getIngestEndpoint=function(e){return""+this.getBaseApiEndpoint()+this._dsnObject.projectId+"/"+e+"/"},e.prototype._encodedAuth=function(){var e={sentry_key:this._dsnObject.user,sentry_version:"7"};return Object(S.f)(e)},e}(),X=function(){function e(e){this._limit=e,this._buffer=[]}return e.prototype.isReady=function(){return void 0===this._limit||this.length()<this._limit},e.prototype.add=function(e){var t=this;return this.isReady()?(-1===this._buffer.indexOf(e)&&this._buffer.push(e),e.then((function(){return t.remove(e)})).then(null,(function(){return t.remove(e).then(null,(function(){}))})),e):g.a.reject(new y("Not adding Promise due to buffer limit reached."))},e.prototype.remove=function(e){return this._buffer.splice(this._buffer.indexOf(e),1)[0]},e.prototype.length=function(){return this._buffer.length},e.prototype.drain=function(e){var t=this;return new g.a((function(n){var r=setTimeout((function(){e&&e>0&&n(!1)}),e);g.a.all(t._buffer).then((function(){clearTimeout(r),n(!0)})).then(null,(function(){n(!0)}))}))},e}(),J=function(){function e(e){this.options=e,this._buffer=new X(30),this._rateLimits={},this._api=new Q(this.options.dsn),this.url=this._api.getStoreEndpointWithUrlEncodedAuth()}return e.prototype.sendEvent=function(e){throw new y("Transport Class has to implement `sendEvent` method")},e.prototype.close=function(e){return this._buffer.drain(e)},e.prototype._handleResponse=function(e){var t=e.requestType,n=e.response,r=e.headers,i=e.resolve,s=e.reject,a=A.fromHttpCode(n.status);this._handleRateLimit(r)&&l.a.warn("Too many requests, backing off until: "+this._disabledUntil(t)),a!==A.Success?s(n):i({status:a})},e.prototype._disabledUntil=function(e){return this._rateLimits[e]||this._rateLimits.all},e.prototype._isRateLimited=function(e){return this._disabledUntil(e)>new Date(Date.now())},e.prototype._handleRateLimit=function(e){var t,n,r,i,s=Date.now(),a=e["x-sentry-rate-limits"],c=e["retry-after"];if(a){try{for(var u=Object(o.f)(a.trim().split(",")),l=u.next();!l.done;l=u.next()){var h=l.value.split(":",2),f=parseInt(h[0],10),p=1e3*(isNaN(f)?60:f);try{for(var g=(r=void 0,Object(o.f)(h[1].split(";"))),m=g.next();!m.done;m=g.next()){var v=m.value;this._rateLimits[v||"all"]=new Date(s+p)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(i=g.return)&&i.call(g)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return!0}return!!c&&(this._rateLimits.all=new Date(s+Object(d.g)(s,c)),!0)},e}(),Z=Object(d.e)(),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.b)(t,e),t.prototype.sendEvent=function(e){return this._sendRequest(Y(e,this._api),e)},t.prototype.sendSession=function(e){return this._sendRequest($(e,this._api),e)},t.prototype._sendRequest=function(e,t){var n=this;if(this._isRateLimited(e.type))return Promise.reject({event:t,type:e.type,reason:"Transport locked till "+this._disabledUntil(e.type)+" due to too many requests.",status:429});var r={body:e.body,method:"POST",referrerPolicy:Object(D.d)()?"origin":""};return void 0!==this.options.fetchParameters&&Object.assign(r,this.options.fetchParameters),void 0!==this.options.headers&&(r.headers=this.options.headers),this._buffer.add(new g.a((function(t,i){Z.fetch(e.url,r).then((function(r){var s={"x-sentry-rate-limits":r.headers.get("X-Sentry-Rate-Limits"),"retry-after":r.headers.get("Retry-After")};n._handleResponse({requestType:e.type,response:r,headers:s,resolve:t,reject:i})})).catch(i)})))},t}(J),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.b)(t,e),t.prototype.sendEvent=function(e){return this._sendRequest(Y(e,this._api),e)},t.prototype.sendSession=function(e){return this._sendRequest($(e,this._api),e)},t.prototype._sendRequest=function(e,t){var n=this;return this._isRateLimited(e.type)?Promise.reject({event:t,type:e.type,reason:"Transport locked till "+this._disabledUntil(e.type)+" due to too many requests.",status:429}):this._buffer.add(new g.a((function(t,r){var i=new XMLHttpRequest;for(var s in i.onreadystatechange=function(){if(4===i.readyState){var s={"x-sentry-rate-limits":i.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":i.getResponseHeader("Retry-After")};n._handleResponse({requestType:e.type,response:i,headers:s,resolve:t,reject:r})}},i.open("POST",e.url),n.options.headers)n.options.headers.hasOwnProperty(s)&&i.setRequestHeader(s,n.options.headers[s]);i.send(e.body)})))},t}(J),ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.b)(t,e),t.prototype.eventFromException=function(e,t){return function(e,t,n){var r=H(t,n&&n.syntheticException||void 0,{attachStacktrace:e.attachStacktrace});return Object(d.a)(r,{handled:!0,type:"generic"}),r.level=x.Error,n&&n.event_id&&(r.event_id=n.event_id),g.a.resolve(r)}(this._options,e,t)},t.prototype.eventFromMessage=function(e,t,n){return void 0===t&&(t=x.Info),function(e,t,n,r){void 0===n&&(n=x.Info);var i=W(t,r&&r.syntheticException||void 0,{attachStacktrace:e.attachStacktrace});return i.level=n,r&&r.event_id&&(i.event_id=r.event_id),g.a.resolve(i)}(this._options,e,t,n)},t.prototype._setupTransport=function(){if(!this._options.dsn)return e.prototype._setupTransport.call(this);var t=Object(o.a)(Object(o.a)({},this._options.transportOptions),{dsn:this._options.dsn});return this._options.transport?new this._options.transport(t):Object(D.a)()?new ee(t):new te(t)},t}(R);function re(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Object(u.c)();if(r&&r[e])return r[e].apply(r,Object(o.e)(t));throw new Error("No hub defined or "+e+" was not found on the hub, please open a bug report.")}function ie(e,t){var n;try{throw new Error("Sentry syntheticException")}catch(e){n=e}return re("captureException",e,{captureContext:t,originalException:e,syntheticException:n})}function se(e){re("withScope",e)}var ae=0;function oe(){return ae>0}function ce(){ae+=1,setTimeout((function(){ae-=1}))}function ue(e,t,n){if(void 0===t&&(t={}),"function"!=typeof e)return e;try{if(e.__sentry__)return e;if(e.__sentry_wrapped__)return e.__sentry_wrapped__}catch(t){return e}var r=function(){var r=Array.prototype.slice.call(arguments);try{n&&"function"==typeof n&&n.apply(this,arguments);var i=r.map((function(e){return ue(e,t)}));return e.handleEvent?e.handleEvent.apply(this,i):e.apply(this,i)}catch(e){throw ce(),se((function(n){n.addEventProcessor((function(e){var n=Object(o.a)({},e);return t.mechanism&&(Object(d.b)(n,void 0,void 0),Object(d.a)(n,t.mechanism)),n.extra=Object(o.a)(Object(o.a)({},n.extra),{arguments:r}),n})),ie(e)})),e}};try{for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}catch(e){}e.prototype=e.prototype||{},r.prototype=e.prototype,Object.defineProperty(e,"__sentry_wrapped__",{enumerable:!1,value:r}),Object.defineProperties(r,{__sentry__:{enumerable:!1,value:!0},__sentry_original__:{enumerable:!1,value:e}});try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:function(){return e.name}})}catch(e){}return r}function le(e){if(void 0===e&&(e={}),e.eventId)if(e.dsn){var t=document.createElement("script");t.async=!0,t.src=new Q(e.dsn).getReportDialogEndpoint(e),e.onLoad&&(t.onload=e.onLoad),(document.head||document.body).appendChild(t)}else l.a.error("Missing dsn option in showReportDialog call");else l.a.error("Missing eventId option in showReportDialog call")}var de=n(34),he=n(24),fe=function(){function e(t){this.name=e.id,this._options=Object(o.a)({console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0},t)}return e.prototype.addSentryBreadcrumb=function(e){this._options.sentry&&Object(u.c)().addBreadcrumb({category:"sentry."+("transaction"===e.type?"transaction":"event"),event_id:e.event_id,level:e.level,message:Object(d.d)(e)},{event:e})},e.prototype.setupOnce=function(){var e=this;this._options.console&&Object(de.a)({callback:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._consoleBreadcrumb.apply(e,Object(o.e)(t))},type:"console"}),this._options.dom&&Object(de.a)({callback:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._domBreadcrumb.apply(e,Object(o.e)(t))},type:"dom"}),this._options.xhr&&Object(de.a)({callback:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._xhrBreadcrumb.apply(e,Object(o.e)(t))},type:"xhr"}),this._options.fetch&&Object(de.a)({callback:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._fetchBreadcrumb.apply(e,Object(o.e)(t))},type:"fetch"}),this._options.history&&Object(de.a)({callback:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e._historyBreadcrumb.apply(e,Object(o.e)(t))},type:"history"})},e.prototype._consoleBreadcrumb=function(e){var t={category:"console",data:{arguments:e.args,logger:"console"},level:x.fromString(e.level),message:Object(h.b)(e.args," ")};if("assert"===e.level){if(!1!==e.args[0])return;t.message="Assertion failed: "+(Object(h.b)(e.args.slice(1)," ")||"console.assert"),t.data.arguments=e.args.slice(1)}Object(u.c)().addBreadcrumb(t,{input:e.args,level:e.level})},e.prototype._domBreadcrumb=function(e){var t;try{t=e.event.target?Object(he.a)(e.event.target):Object(he.a)(e.event)}catch(e){t="<unknown>"}0!==t.length&&Object(u.c)().addBreadcrumb({category:"ui."+e.name,message:t},{event:e.event,name:e.name})},e.prototype._xhrBreadcrumb=function(e){if(e.endTimestamp){if(e.xhr.__sentry_own_request__)return;var t=e.xhr.__sentry_xhr__||{},n=t.method,r=t.url,i=t.status_code,s=t.body;Object(u.c)().addBreadcrumb({category:"xhr",data:{method:n,url:r,status_code:i},type:"http"},{xhr:e.xhr,input:s})}else;},e.prototype._fetchBreadcrumb=function(e){e.endTimestamp&&(e.fetchData.url.match(/sentry_key/)&&"POST"===e.fetchData.method||(e.error?Object(u.c)().addBreadcrumb({category:"fetch",data:e.fetchData,level:x.Error,type:"http"},{data:e.error,input:e.args}):Object(u.c)().addBreadcrumb({category:"fetch",data:Object(o.a)(Object(o.a)({},e.fetchData),{status_code:e.response.status}),type:"http"},{input:e.args,response:e.response})))},e.prototype._historyBreadcrumb=function(e){var t=Object(d.e)(),n=e.from,r=e.to,i=Object(d.h)(t.location.href),s=Object(d.h)(n),a=Object(d.h)(r);s.path||(s=i),i.protocol===a.protocol&&i.host===a.host&&(r=a.relative),i.protocol===s.protocol&&i.host===s.host&&(n=s.relative),Object(u.c)().addBreadcrumb({category:"navigation",data:{from:n,to:r}})},e.id="Breadcrumbs",e}(),pe="5.30.0",ge=function(e){function t(t){return void 0===t&&(t={}),e.call(this,ne,t)||this}return Object(o.b)(t,e),t.prototype.showReportDialog=function(e){void 0===e&&(e={}),Object(d.e)().document&&(this._isEnabled()?le(Object(o.a)(Object(o.a)({},e),{dsn:e.dsn||this.getDsn()})):l.a.error("Trying to call showReportDialog with Sentry Client disabled"))},t.prototype._prepareEvent=function(t,n,r){return t.platform=t.platform||"javascript",t.sdk=Object(o.a)(Object(o.a)({},t.sdk),{name:"sentry.javascript.browser",packages:Object(o.e)(t.sdk&&t.sdk.packages||[],[{name:"npm:@sentry/browser",version:pe}]),version:pe}),e.prototype._prepareEvent.call(this,t,n,r)},t.prototype._sendEvent=function(t){var n=this.getIntegration(fe);n&&n.addSentryBreadcrumb(t),e.prototype._sendEvent.call(this,t)},t}(O),me=n(21),ve=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],ye=function(){function e(t){this.name=e.id,this._options=Object(o.a)({XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0},t)}return e.prototype.setupOnce=function(){var e=Object(d.e)();(this._options.setTimeout&&Object(S.c)(e,"setTimeout",this._wrapTimeFunction.bind(this)),this._options.setInterval&&Object(S.c)(e,"setInterval",this._wrapTimeFunction.bind(this)),this._options.requestAnimationFrame&&Object(S.c)(e,"requestAnimationFrame",this._wrapRAF.bind(this)),this._options.XMLHttpRequest&&"XMLHttpRequest"in e&&Object(S.c)(XMLHttpRequest.prototype,"send",this._wrapXHR.bind(this)),this._options.eventTarget)&&(Array.isArray(this._options.eventTarget)?this._options.eventTarget:ve).forEach(this._wrapEventTarget.bind(this))},e.prototype._wrapTimeFunction=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t[0];return t[0]=ue(r,{mechanism:{data:{function:Object(me.a)(e)},handled:!0,type:"instrument"}}),e.apply(this,t)}},e.prototype._wrapRAF=function(e){return function(t){return e.call(this,ue(t,{mechanism:{data:{function:"requestAnimationFrame",handler:Object(me.a)(e)},handled:!0,type:"instrument"}}))}},e.prototype._wrapEventTarget=function(e){var t=Object(d.e)(),n=t[e]&&t[e].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(Object(S.c)(n,"addEventListener",(function(t){return function(n,r,i){try{"function"==typeof r.handleEvent&&(r.handleEvent=ue(r.handleEvent.bind(r),{mechanism:{data:{function:"handleEvent",handler:Object(me.a)(r),target:e},handled:!0,type:"instrument"}}))}catch(e){}return t.call(this,n,ue(r,{mechanism:{data:{function:"addEventListener",handler:Object(me.a)(r),target:e},handled:!0,type:"instrument"}}),i)}})),Object(S.c)(n,"removeEventListener",(function(e){return function(t,n,r){var i,s=n;try{var a=null===(i=s)||void 0===i?void 0:i.__sentry_wrapped__;a&&e.call(this,t,a,r)}catch(e){}return e.call(this,t,s,r)}})))},e.prototype._wrapXHR=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this,i=["onload","onerror","onprogress","onreadystatechange"];return i.forEach((function(e){e in r&&"function"==typeof r[e]&&Object(S.c)(r,e,(function(t){var n={mechanism:{data:{function:e,handler:Object(me.a)(t)},handled:!0,type:"instrument"}};return t.__sentry_original__&&(n.mechanism.data.handler=Object(me.a)(t.__sentry_original__)),ue(t,n)}))})),e.apply(this,t)}},e.id="TryCatch",e}(),be=function(){function e(t){this.name=e.id,this._onErrorHandlerInstalled=!1,this._onUnhandledRejectionHandlerInstalled=!1,this._options=Object(o.a)({onerror:!0,onunhandledrejection:!0},t)}return e.prototype.setupOnce=function(){Error.stackTraceLimit=50,this._options.onerror&&(l.a.log("Global Handler attached: onerror"),this._installGlobalOnErrorHandler()),this._options.onunhandledrejection&&(l.a.log("Global Handler attached: onunhandledrejection"),this._installGlobalOnUnhandledRejectionHandler())},e.prototype._installGlobalOnErrorHandler=function(){var t=this;this._onErrorHandlerInstalled||(Object(de.a)({callback:function(n){var r=n.error,i=Object(u.c)(),s=i.getIntegration(e),a=r&&!0===r.__sentry_own_request__;if(s&&!oe()&&!a){var o=i.getClient(),c=Object(E.i)(r)?t._eventFromIncompleteOnError(n.msg,n.url,n.line,n.column):t._enhanceEventWithInitialFrame(H(r,void 0,{attachStacktrace:o&&o.getOptions().attachStacktrace,rejection:!1}),n.url,n.line,n.column);Object(d.a)(c,{handled:!1,type:"onerror"}),i.captureEvent(c,{originalException:r})}},type:"error"}),this._onErrorHandlerInstalled=!0)},e.prototype._installGlobalOnUnhandledRejectionHandler=function(){var t=this;this._onUnhandledRejectionHandlerInstalled||(Object(de.a)({callback:function(n){var r=n;try{"reason"in n?r=n.reason:"detail"in n&&"reason"in n.detail&&(r=n.detail.reason)}catch(e){}var i=Object(u.c)(),s=i.getIntegration(e),a=r&&!0===r.__sentry_own_request__;if(!s||oe()||a)return!0;var o=i.getClient(),c=Object(E.i)(r)?t._eventFromRejectionWithPrimitive(r):H(r,void 0,{attachStacktrace:o&&o.getOptions().attachStacktrace,rejection:!0});c.level=x.Error,Object(d.a)(c,{handled:!1,type:"onunhandledrejection"}),i.captureEvent(c,{originalException:r})},type:"unhandledrejection"}),this._onUnhandledRejectionHandlerInstalled=!0)},e.prototype._eventFromIncompleteOnError=function(e,t,n,r){var i,s=Object(E.e)(e)?e.message:e;if(Object(E.k)(s)){var a=s.match(/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i);a&&(i=a[1],s=a[2])}var o={exception:{values:[{type:i||"Error",value:s}]}};return this._enhanceEventWithInitialFrame(o,t,n,r)},e.prototype._eventFromRejectionWithPrimitive=function(e){return{exception:{values:[{type:"UnhandledRejection",value:"Non-Error promise rejection captured with value: "+String(e)}]}}},e.prototype._enhanceEventWithInitialFrame=function(e,t,n,r){e.exception=e.exception||{},e.exception.values=e.exception.values||[],e.exception.values[0]=e.exception.values[0]||{},e.exception.values[0].stacktrace=e.exception.values[0].stacktrace||{},e.exception.values[0].stacktrace.frames=e.exception.values[0].stacktrace.frames||[];var i=isNaN(parseInt(r,10))?void 0:r,s=isNaN(parseInt(n,10))?void 0:n,a=Object(E.k)(t)&&t.length>0?t:Object(d.f)();return 0===e.exception.values[0].stacktrace.frames.length&&e.exception.values[0].stacktrace.frames.push({colno:i,filename:a,function:"?",in_app:!0,lineno:s}),e},e.id="GlobalHandlers",e}(),we=function(){function e(t){void 0===t&&(t={}),this.name=e.id,this._key=t.key||"cause",this._limit=t.limit||5}return e.prototype.setupOnce=function(){Object(c.b)((function(t,n){var r=Object(u.c)().getIntegration(e);return r?r._handler(t,n):t}))},e.prototype._handler=function(e,t){if(!(e.exception&&e.exception.values&&t&&Object(E.g)(t.originalException,Error)))return e;var n=this._walkErrorTree(t.originalException,this._key);return e.exception.values=Object(o.e)(n,e.exception.values),e},e.prototype._walkErrorTree=function(e,t,n){if(void 0===n&&(n=[]),!Object(E.g)(e[t],Error)||n.length+1>=this._limit)return n;var r=G(B(e[t]));return this._walkErrorTree(e[t],t,Object(o.e)([r],n))},e.id="LinkedErrors",e}(),_e=Object(d.e)(),Ee=function(){function e(){this.name=e.id}return e.prototype.setupOnce=function(){Object(c.b)((function(t){var n,r,i;if(Object(u.c)().getIntegration(e)){if(!_e.navigator&&!_e.location&&!_e.document)return t;var s=(null===(n=t.request)||void 0===n?void 0:n.url)||(null===(r=_e.location)||void 0===r?void 0:r.href),a=(_e.document||{}).referrer,c=(_e.navigator||{}).userAgent,l=Object(o.a)(Object(o.a)(Object(o.a)({},null===(i=t.request)||void 0===i?void 0:i.headers),a&&{Referer:a}),c&&{"User-Agent":c}),d=Object(o.a)(Object(o.a)({},s&&{url:s}),{headers:l});return Object(o.a)(Object(o.a)({},t),{request:d})}return t}))},e.id="UserAgent",e}(),Te=[new r.InboundFilters,new r.FunctionToString,new ye,new fe,new be,new we,new Ee];function Se(e){if(void 0===e&&(e={}),void 0===e.defaultIntegrations&&(e.defaultIntegrations=Te),void 0===e.release){var t=Object(d.e)();t.SENTRY_RELEASE&&t.SENTRY_RELEASE.id&&(e.release=t.SENTRY_RELEASE.id)}void 0===e.autoSessionTracking&&(e.autoSessionTracking=!1),function(e,t){!0===t.debug&&l.a.enable();var n=Object(u.c)(),r=new e(t);n.bindClient(r)}(ge,e),e.autoSessionTracking&&function(){var e=Object(d.e)(),t=Object(u.c)(),n="complete"===document.readyState,r=!1,i=function(){r&&n&&t.endSession()},s=function(){n=!0,i(),e.removeEventListener("load",s)};t.startSession(),n||e.addEventListener("load",s);try{var a=new PerformanceObserver((function(e,t){e.getEntries().forEach((function(e){"first-contentful-paint"===e.name&&e.startTime<o&&(t.disconnect(),r=!0,i())}))})),o="hidden"===document.visibilityState?0:1/0;document.addEventListener("visibilitychange",(function(e){o=Math.min(o,e.timeStamp)}),{once:!0}),a.observe({type:"paint",buffered:!0})}catch(e){r=!0,i()}}()}var Ie=n(30),ke=n.n(Ie),Ae=n(5),Oe=n.n(Ae),xe=n(31),Ce=n(12),Re=n(16),De=n(8),Le=n(2),Pe=Object(d.e)();var Ne,Me,je=function(e,t,n,r){var i;return function(){n&&t.isFinal&&n.disconnect(),t.value>=0&&(r||t.isFinal||"hidden"===document.visibilityState)&&(t.delta=t.value-(i||0),(t.delta||t.isFinal||void 0===i)&&(e(t),i=t.value))}},Fe=function(e,t){return void 0===t&&(t=-1),{name:e,value:t,delta:0,entries:[],id:Date.now()+"-"+(Math.floor(8999999999999*Math.random())+1e12),isFinal:!1}},Ue=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}},Be=!1,Ve=!1,qe=function(e){Be=!e.persisted},Ge=function(e,t){void 0===t&&(t=!1),Ve||(addEventListener("pagehide",qe),addEventListener("beforeunload",(function(){})),Ve=!0),addEventListener("visibilitychange",(function(t){var n=t.timeStamp;"hidden"===document.visibilityState&&e({timeStamp:n,isUnloading:Be})}),{capture:!0,once:t})},Ke=function(){return void 0===Ne&&(Ne="hidden"===document.visibilityState?0:1/0,Ge((function(e){var t=e.timeStamp;return Ne=t}),!0)),{get timeStamp(){return Ne}}},ze=function(e,t){void 0===t&&(t=!1);var n,r=Fe("LCP"),i=Ke(),s=function(e){var t=e.startTime;t<i.timeStamp?(r.value=t,r.entries.push(e)):r.isFinal=!0,n()},a=Ue("largest-contentful-paint",s);if(a){n=je(e,r,a,t);var o=function(){r.isFinal||(a.takeRecords().map(s),r.isFinal=!0,n())};(Me||(Me=new Promise((function(e){return["scroll","keydown","pointerdown"].map((function(t){addEventListener(t,e,{once:!0,passive:!0,capture:!0})}))}))),Me).then(o),Ge(o,!0)}},He=Object(d.e)(),We=function(e){var t,n=Fe("TTFB");t=function(){try{var t=He.performance.getEntriesByType("navigation")[0]||function(){var e=He.performance.timing,t={entryType:"navigation",startTime:0};for(var n in e)"navigationStart"!==n&&"toJSON"!==n&&(t[n]=Math.max(e[n]-e.navigationStart,0));return t}();n.value=n.delta=t.responseStart,n.entries=[t],e(n)}catch(e){}},"complete"===document.readyState?setTimeout(t,0):addEventListener("pageshow",t)},$e=Object(d.e)(),Ye=function(){function e(){this._measurements={},this._performanceCursor=0,$e&&$e.performance&&($e.performance.mark&&$e.performance.mark("sentry-tracing-init"),this._trackCLS(),this._trackLCP(),this._trackFID(),this._trackTTFB())}return e.prototype.addPerformanceEntries=function(e){var t=this;if($e&&$e.performance&&$e.performance.getEntries&&T.a){l.a.log("[Tracing] Adding & adjusting spans using Performance API");var n,r,i,s=Object(Le.d)(T.a);if($e.document)for(var a=0;a<document.scripts.length;a++)if("true"===document.scripts[a].dataset.entry){n=document.scripts[a].src;break}if($e.performance.getEntries().slice(this._performanceCursor).forEach((function(a){var o=Object(Le.d)(a.startTime),c=Object(Le.d)(a.duration);if(!("navigation"===e.op&&s+o<e.startTimestamp))switch(a.entryType){case"navigation":!function(e,t,n){Qe(e,t,"unloadEvent",n),Qe(e,t,"redirect",n),Qe(e,t,"domContentLoadedEvent",n),Qe(e,t,"loadEvent",n),Qe(e,t,"connect",n),Qe(e,t,"secureConnection",n,"connectEnd"),Qe(e,t,"fetch",n,"domainLookupStart"),Qe(e,t,"domainLookup",n),function(e,t,n){Xe(e,{op:"browser",description:"request",startTimestamp:n+Object(Le.d)(t.requestStart),endTimestamp:n+Object(Le.d)(t.responseEnd)}),Xe(e,{op:"browser",description:"response",startTimestamp:n+Object(Le.d)(t.responseStart),endTimestamp:n+Object(Le.d)(t.responseEnd)})}(e,t,n)}(e,a,s);break;case"mark":case"paint":case"measure":var u=function(e,t,n,r,i){var s=i+n,a=s+r;return Xe(e,{description:t.name,endTimestamp:a,op:t.entryType,startTimestamp:s}),s}(e,a,o,c,s);void 0===i&&"sentry-tracing-init"===a.name&&(i=u);var d=Ke(),h=a.startTime<d.timeStamp;"first-paint"===a.name&&h&&(l.a.log("[Measurements] Adding FP"),t._measurements.fp={value:a.startTime},t._measurements["mark.fp"]={value:u}),"first-contentful-paint"===a.name&&h&&(l.a.log("[Measurements] Adding FCP"),t._measurements.fcp={value:a.startTime},t._measurements["mark.fcp"]={value:u});break;case"resource":var f=a.name.replace(window.location.origin,""),p=function(e,t,n,r,i,s){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;var a={};"transferSize"in t&&(a["Transfer Size"]=t.transferSize);"encodedBodySize"in t&&(a["Encoded Body Size"]=t.encodedBodySize);"decodedBodySize"in t&&(a["Decoded Body Size"]=t.decodedBodySize);var o=s+r,c=o+i;return Xe(e,{description:n,endTimestamp:c,op:t.initiatorType?"resource."+t.initiatorType:"resource",startTimestamp:o,data:a}),c}(e,a,f,o,c,s);void 0===r&&(n||"").indexOf(f)>-1&&(r=p)}})),void 0!==r&&void 0!==i&&Xe(e,{description:"evaluation",endTimestamp:i,op:"script",startTimestamp:r}),this._performanceCursor=Math.max(performance.getEntries().length-1,0),this._trackNavigator(e),"pageload"===e.op){var o=Object(Le.d)(T.a);["fcp","fp","lcp","ttfb"].forEach((function(n){if(t._measurements[n]&&!(o>=e.startTimestamp)){var r=t._measurements[n].value,i=o+Object(Le.d)(r),s=Math.abs(1e3*(i-e.startTimestamp)),a=s-r;l.a.log("[Measurements] Normalized "+n+" from "+r+" to "+s+" ("+a+")"),t._measurements[n].value=s}})),this._measurements["mark.fid"]&&this._measurements.fid&&Xe(e,{description:"first input delay",endTimestamp:this._measurements["mark.fid"].value+Object(Le.d)(this._measurements.fid.value),op:"web.vitals",startTimestamp:this._measurements["mark.fid"].value}),e.setMeasurements(this._measurements)}}},e.prototype._trackCLS=function(){var e=this;!function(e,t){void 0===t&&(t=!1);var n,r=Fe("CLS",0),i=function(e){e.hadRecentInput||(r.value+=e.value,r.entries.push(e),n())},s=Ue("layout-shift",i);s&&(n=je(e,r,s,t),Ge((function(e){var t=e.isUnloading;s.takeRecords().map(i),t&&(r.isFinal=!0),n()})))}((function(t){t.entries.pop()&&(l.a.log("[Measurements] Adding CLS"),e._measurements.cls={value:t.value})}))},e.prototype._trackNavigator=function(e){var t=$e.navigator;if(t){var n=t.connection;n&&(n.effectiveType&&e.setTag("effectiveConnectionType",n.effectiveType),n.type&&e.setTag("connectionType",n.type),Je(n.rtt)&&(this._measurements["connection.rtt"]={value:n.rtt}),Je(n.downlink)&&(this._measurements["connection.downlink"]={value:n.downlink})),Je(t.deviceMemory)&&e.setTag("deviceMemory",String(t.deviceMemory)),Je(t.hardwareConcurrency)&&e.setTag("hardwareConcurrency",String(t.hardwareConcurrency))}},e.prototype._trackLCP=function(){var e=this;ze((function(t){var n=t.entries.pop();if(n){var r=Object(Le.d)(performance.timeOrigin),i=Object(Le.d)(n.startTime);l.a.log("[Measurements] Adding LCP"),e._measurements.lcp={value:t.value},e._measurements["mark.lcp"]={value:r+i}}}))},e.prototype._trackFID=function(){var e,t,n,r,i,s,a=this;e=function(e){var t=e.entries.pop();if(t){var n=Object(Le.d)(performance.timeOrigin),r=Object(Le.d)(t.startTime);l.a.log("[Measurements] Adding FID"),a._measurements.fid={value:e.value},a._measurements["mark.fid"]={value:n+r}}},t=Fe("FID"),n=Ke(),i=Ue("first-input",r=function(e){e.startTime<n.timeStamp&&(t.value=e.processingStart-e.startTime,t.entries.push(e),t.isFinal=!0,s())}),s=je(e,t,i),i?Ge((function(){i.takeRecords().map(r),i.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(e,r){r.timeStamp<n.timeStamp&&(t.value=e,t.isFinal=!0,t.entries=[{entryType:"first-input",name:r.type,target:r.target,cancelable:r.cancelable,startTime:r.timeStamp,processingStart:r.timeStamp+e}],s())}))},e.prototype._trackTTFB=function(){var e=this;We((function(t){var n,r=t.entries.pop();if(r){l.a.log("[Measurements] Adding TTFB"),e._measurements.ttfb={value:t.value};var i=t.value-(n=t.entries[0],null!=n?n:r).requestStart;e._measurements["ttfb.requestTime"]={value:i}}}))},e}();function Qe(e,t,n,r,i){var s=i?t[i]:t[n+"End"],a=t[n+"Start"];a&&s&&Xe(e,{op:"browser",description:n,startTimestamp:r+Object(Le.d)(a),endTimestamp:r+Object(Le.d)(s)})}function Xe(e,t){var n=t.startTimestamp,r=Object(o.d)(t,["startTimestamp"]);return n&&e.startTimestamp>n&&(e.startTimestamp=n),e.startChild(Object(o.a)({startTimestamp:n},r))}function Je(e){return"number"==typeof e&&isFinite(e)}var Ze={traceFetch:!0,traceXHR:!0,tracingOrigins:["localhost",/^\//]};function et(e){var t=Object(o.a)(Object(o.a)({},Ze),e),n=t.traceFetch,r=t.traceXHR,i=t.tracingOrigins,s=t.shouldCreateSpanForRequest,a={},c=function(e){if(a[e])return a[e];var t=i;return a[e]=t.some((function(t){return Object(h.a)(e,t)}))&&!Object(h.a)(e,"sentry_key"),a[e]},l=c;"function"==typeof s&&(l=function(e){return c(e)&&s(e)});var d={};n&&Object(de.a)({callback:function(e){!function(e,t,n){var r,i=null===(r=Object(u.c)().getClient())||void 0===r?void 0:r.getOptions();if(!(i&&Object(Le.c)(i)&&e.fetchData&&t(e.fetchData.url)))return;if(e.endTimestamp&&e.fetchData.__span){if(c=n[e.fetchData.__span]){var s=e.response;s&&c.setHttpStatus(s.status),c.finish(),delete n[e.fetchData.__span]}return}var a=Object(Le.b)();if(a){var c=a.startChild({data:Object(o.a)(Object(o.a)({},e.fetchData),{type:"fetch"}),description:e.fetchData.method+" "+e.fetchData.url,op:"http"});e.fetchData.__span=c.spanId,n[c.spanId]=c;var l=e.args[0]=e.args[0],d=e.args[1]=e.args[1]||{},h=d.headers;Object(E.g)(l,Request)&&(h=l.headers),h?"function"==typeof h.append?h.append("sentry-trace",c.toTraceparent()):h=Array.isArray(h)?Object(o.e)(h,[["sentry-trace",c.toTraceparent()]]):Object(o.a)(Object(o.a)({},h),{"sentry-trace":c.toTraceparent()}):h={"sentry-trace":c.toTraceparent()},d.headers=h}}(e,l,d)},type:"fetch"}),r&&Object(de.a)({callback:function(e){!function(e,t,n){var r,i=null===(r=Object(u.c)().getClient())||void 0===r?void 0:r.getOptions();if(!i||!Object(Le.c)(i)||!(e.xhr&&e.xhr.__sentry_xhr__&&t(e.xhr.__sentry_xhr__.url))||e.xhr.__sentry_own_request__)return;var s=e.xhr.__sentry_xhr__;if(e.endTimestamp&&e.xhr.__sentry_xhr_span_id__){return void((c=n[e.xhr.__sentry_xhr_span_id__])&&(c.setHttpStatus(s.status_code),c.finish(),delete n[e.xhr.__sentry_xhr_span_id__]))}var a=Object(Le.b)();if(a){var c=a.startChild({data:Object(o.a)(Object(o.a)({},s.data),{type:"xhr",method:s.method,url:s.url}),description:s.method+" "+s.url,op:"http"});if(e.xhr.__sentry_xhr_span_id__=c.spanId,n[e.xhr.__sentry_xhr_span_id__]=c,e.xhr.setRequestHeader)try{e.xhr.setRequestHeader("sentry-trace",c.toTraceparent())}catch(e){}}}(e,l,d)},type:"xhr"})}var tt=Object(d.e)();var nt=Object(o.a)({idleTimeout:Re.a,markBackgroundTransactions:!0,maxTransactionDuration:600,routingInstrumentation:function(e,t,n){if(void 0===t&&(t=!0),void 0===n&&(n=!0),tt&&tt.location){var r,i=tt.location.href;t&&(r=e({name:tt.location.pathname,op:"pageload"})),n&&Object(de.a)({callback:function(t){var n=t.to,s=t.from;void 0===s&&i&&-1!==i.indexOf(n)?i=void 0:s!==n&&(i=void 0,r&&(l.a.log("[Tracing] Finishing current transaction with op: "+r.op),r.finish()),r=e({name:tt.location.pathname,op:"navigation"}))},type:"history"})}else l.a.warn("Could not initialize routing instrumentation due to invalid location")},startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0},Ze),rt=function(){function e(t){this.name=e.id,this._metrics=new Ye,this._emitOptionsWarning=!1;var n=Ze.tracingOrigins;t&&t.tracingOrigins&&Array.isArray(t.tracingOrigins)&&0!==t.tracingOrigins.length?n=t.tracingOrigins:this._emitOptionsWarning=!0,this.options=Object(o.a)(Object(o.a)(Object(o.a)({},nt),t),{tracingOrigins:n})}return e.prototype.setupOnce=function(e,t){var n=this;this._getCurrentHub=t,this._emitOptionsWarning&&(l.a.warn("[Tracing] You need to define `tracingOrigins` in the options. Set an array of urls or patterns to trace."),l.a.warn("[Tracing] We added a reasonable default for you: "+Ze.tracingOrigins));var r=this.options,i=r.routingInstrumentation,s=r.startTransactionOnLocationChange,a=r.startTransactionOnPageLoad,o=r.markBackgroundTransactions,c=r.traceFetch,u=r.traceXHR,d=r.tracingOrigins,h=r.shouldCreateSpanForRequest;i((function(e){return n._createRouteTransaction(e)}),a,s),o&&(Pe&&Pe.document?Pe.document.addEventListener("visibilitychange",(function(){var e=Object(Le.b)();Pe.document.hidden&&e&&(l.a.log("[Tracing] Transaction: "+De.a.Cancelled+" -> since tab moved to the background, op: "+e.op),e.status||e.setStatus(De.a.Cancelled),e.setTag("visibilitychange","document.hidden"),e.finish())})):l.a.warn("[Tracing] Could not set up background tab detection due to lack of global document")),et({traceFetch:c,traceXHR:u,tracingOrigins:d,shouldCreateSpanForRequest:h})},e.prototype._createRouteTransaction=function(e){var t=this;if(this._getCurrentHub){var n=this.options,r=n.beforeNavigate,i=n.idleTimeout,s=n.maxTransactionDuration,a="pageload"===e.op?function(){var e=(t="sentry-trace",n=document.querySelector("meta[name="+t+"]"),n?n.getAttribute("content"):null);var t,n;if(e)return Object(Le.a)(e);return}():void 0,c=Object(o.a)(Object(o.a)(Object(o.a)({},e),a),{trimEnd:!0}),u="function"==typeof r?r(c):c,d=void 0===u?Object(o.a)(Object(o.a)({},c),{sampled:!1}):u;!1===d.sampled&&l.a.log("[Tracing] Will not send "+d.op+" transaction because of beforeNavigate.");var h=this._getCurrentHub(),f=Object(Ce.b)(h,d,i,!0);return l.a.log("[Tracing] Starting "+d.op+" transaction on scope"),f.registerBeforeFinishCallback((function(e,n){t._metrics.addPerformanceEntries(e),function(e,t,n){var r=n-t.startTimestamp;n&&(r>e||r<0)&&(t.setStatus(De.a.DeadlineExceeded),t.setTag("maxTransactionDurationExceeded","true"))}(Object(Le.e)(s),e,n)})),f}l.a.warn("[Tracing] Did not create "+e.op+" transaction because _getCurrentHub is invalid.")},e.id="BrowserTracing",e}();var it=function(){function e(t){void 0===t&&(t={}),this.name=e.id,this._router=t.router||t.app,this._methods=(Array.isArray(t.methods)?t.methods:[]).concat("use")}return e.prototype.setupOnce=function(){this._router?function(e,t){void 0===t&&(t=[]);t.forEach((function(t){return function(e,t){var n=e[t];return e[t]=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return n.call.apply(n,Object(o.e)([this],at(e,t)))},e}(e,t)}))}(this._router,this._methods):l.a.error("ExpressIntegration is missing an Express instance")},e.id="Express",e}();function st(e,t){var n=e.length;switch(n){case 2:return function(n,r){var i=r.__sentry_transaction;if(i){var s=i.startChild({description:e.name,op:"middleware."+t});r.once("finish",(function(){s.finish()}))}return e.call(this,n,r)};case 3:return function(n,r,i){var s,a=null===(s=r.__sentry_transaction)||void 0===s?void 0:s.startChild({description:e.name,op:"middleware."+t});e.call(this,n,r,(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];null===(e=a)||void 0===e||e.finish(),i.call.apply(i,Object(o.e)([this],t))}))};case 4:return function(n,r,i,s){var a,c=null===(a=i.__sentry_transaction)||void 0===a?void 0:a.startChild({description:e.name,op:"middleware."+t});e.call(this,n,r,i,(function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];null===(e=c)||void 0===e||e.finish(),s.call.apply(s,Object(o.e)([this],t))}))};default:throw new Error("Express middleware takes 2-4 arguments. Got: "+n)}}function at(e,t){return e.map((function(e){return"function"==typeof e?st(e,t):Array.isArray(e)?e.map((function(e){return"function"==typeof e?st(e,t):e})):e}))}var ot,ct=n(27),ut=n(28),lt=n(29),dt=Object(o.a)(Object(o.a)({},s),{BrowserTracing:rt});Object(Ce.a)();var ht=new Uint8Array(16);function ft(){if(!ot&&!(ot="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ot(ht)}var pt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var gt=function(e){return"string"==typeof e&&pt.test(e)},mt=[],vt=0;vt<256;++vt)mt.push((vt+256).toString(16).substr(1));var yt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(mt[e[t+0]]+mt[e[t+1]]+mt[e[t+2]]+mt[e[t+3]]+"-"+mt[e[t+4]]+mt[e[t+5]]+"-"+mt[e[t+6]]+mt[e[t+7]]+"-"+mt[e[t+8]]+mt[e[t+9]]+"-"+mt[e[t+10]]+mt[e[t+11]]+mt[e[t+12]]+mt[e[t+13]]+mt[e[t+14]]+mt[e[t+15]]).toLowerCase();if(!gt(n))throw TypeError("Stringified UUID is invalid");return n};var bt=function(e,t,n){var r=(e=e||{}).random||(e.rng||ft)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return yt(r)},wt=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t},_t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){console.log("Not found")},a=new XMLHttpRequest;a.responseType="json",a.onreadystatechange=function(){4!==a.readyState||200!==a.status&&204!==a.status?4===a.readyState&&s():n(a.response)},a.open(t,e,!0),null!==r&&a.setRequestHeader("Authorization","Bearer "+r),a.send(i)};function Et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return s}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function It(e,t,n){return t&&St(e.prototype,t),n&&St(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function kt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var At=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=It((function e(){kt(this,e)})),r=new n;return r.startMessage=e,r.defaultStartMessage=e,r.addAttribute=function(e,t){r.attributes[e]=t},r.addAttributes=function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var i=Et(n[t],2),s=i[0],a=i[1];r.attributes[s]=a}},r.resetAttributes=function(){r.attributes={clientType:"web",clientScreen:!0},r.addAttributes(t)},r.resetAttributes(),r.getAttribute=function(e){return r.attributes[e]},r.getAttributes=function(){return r.attributes},r.setMessage=function(e){r.startMessage=e},r.getMessage=function(){return r.startMessage},r};function Ot(e){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ot(e)}function xt(){xt=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function o(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof d?t:d,s=Object.create(i.prototype),a=new T(r||[]);return s._invoke=function(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return I()}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=w(a,n);if(o){if(o===l)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),s}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function h(){}function f(){}var p={};o(p,i,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(S([])));m&&m!==t&&n.call(m,i)&&(p=m);var v=f.prototype=d.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(i,s,a,o){var c=u(e[i],e,s);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==Ot(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,a,o)}),(function(e){r("throw",e,a,o)})):t.resolve(d).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,o)}))}o(c.arg)}var i;this._invoke=function(e,n){function s(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(s,s):s()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function S(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:I}}function I(){return{value:void 0,done:!0}}return h.prototype=f,o(v,"constructor",f),o(f,"constructor",h),h.displayName=o(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),o(b.prototype,s,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var a=new b(c(t,n,r,i),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),o(v,a,"Generator"),o(v,i,(function(){return this})),o(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var o=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(o&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function Ct(e,t,n,r,i,s,a){try{var o=e[s](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,i)}function Rt(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){Ct(s,r,i,a,o,"next",e)}function o(e){Ct(s,r,i,a,o,"throw",e)}a(void 0)}))}}function Dt(e){return function(e){if(Array.isArray(e))return Lt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(n),!0).forEach((function(t){Mt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var jt,Ft,Ut,Bt="5f7db5f1e662e830b20dbe7c",Vt="",qt=Bt,Gt="https://studio".concat(Vt,".flowstorm.ai"),Kt="https://core".concat(Vt,".flowstorm.ai"),zt=void 0,Ht=void 0,Wt=new xe.Converter,$t=new At,Yt=!1,Qt={},Xt=/https:\/\/core(-([0-9]+|preview)){0,1}.flowstorm.ai\/file\/tts\/[0-9a-f]+\.wav/g,Jt={guiMode:"chat",fullScreen:!1,widgetSize:{width:"400px",height:"700px"},imageAverageColorOpacity:.5,backgroundImageBlur:0,textInputEnabled:!0,collapsable:!0,backgroundAdvancedAnimationParticlesCount:5,animationSpeed:500,backgroundSimpleAnimation:!0,collapsed:!0,interactionMode:"GUIDE",sound:!0,goTo:!0},Zt={allowUrlParams:!1,botKey:qt,customCssClass:null,domain:"",startMessage:void 0,jwtToken:null,attributes:{},callback:{},coreUrl:Kt,autoStart:!1,ttsFileType:"mp3"},en=void 0,tn=void 0,nn={},rn=!0,sn=!1,an=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Se({dsn:"https://da1caa885aee4032898d553d1129571b@o318069.ingest.sentry.io/5438705",integrations:[new dt.BrowserTracing],tracesSampleRate:1,environment:Vt});var t=new URLSearchParams(window.location.search),n=Nt(Nt(Nt({},Zt),Jt),e),r=n,i=r.allowUrlParams,s=r.startMessage;if(qt=n.botKey,sn=n.textInputEnabled,n.textInputEnabled=!1,$t=new At(s,n.attributes),i){var a={};Dt(t.entries()).forEach((function(e){return a[e[0]]=e[1]}));var o=t.get("key"),c=localStorage.getItem("bot-app-active");25===window.location.pathname.length&&n.botKey===Bt?qt=window.location.pathname.substring(1):c?qt=c:null!==o&&24===o.length&&(qt=o);var u=new URL(window.location.href),l=u.searchParams.get("m");"guide"!==l&&"sop"!==l||(n.interactionMode=l.toUpperCase());var d=null===t.get("animObjects")?5:parseInt(t.get("animObjects")),h=null===t.get("animate")||"true"===t.get("animate"),f=t.get("avatarURL"),p=h?500:0;n=Nt(Nt({},n),{},{backgroundAdvancedAnimationParticlesCount:d,backgroundSimpleAnimation:h,animationSpeed:p,avatarURL:f},a)}var g=on(n);if(g)un(g,n),pn(),en.stateHandler=Ut,en.setInCallback=function(){n.inputAudio?document.querySelector("[data-chat-input-keyboard]").classList.add("icon-sop--keyboard-active"):(document.querySelector("[data-chat-input-keyboard]").classList.remove("icon-sop--keyboard-active"),g.removeOverlay())},en.audioInputCallback=function(){n.inputAudio&&(n.inputAudio=!1,en.setInAudio(n.inputAudio,dn()),g.removeOverlay())},"SOP"===n.interactionMode?en.getUser().then((function(e){if(console.log("User: ",e),null===e)g.setSection("LOGIN");else{var t=e.inputMode;void 0===t?g.setSection("INPUTSELECT"):(console.log(t),g.setInputMode(t.stringValue))}})):"GUIDE"!==n.interactionMode&&"SOP"!==n.interactionMode||en.setInAudio(!1,dn());else{var m=n,v=m.elementId,y=void 0===v?null:v;console.error('Element with ID "'.concat(y,'" was not found in DOM. Cannot initialize BOT UI. Use existing element with ID or remove elementId property from initialization.'))}return fn},on=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.elementId,n=void 0===t?null:t,r=e.customCssClass,i=void 0===r?null:r;if(null===n){var s=document.createElement("div");n="fs-client-".concat(bt()),s.setAttribute("id",n),document.body.appendChild(s)}if(null!==i){i=i.toString().split(/[ ,;]+/);var a,o=document.getElementById(n);if(o)(a=o.classList).add.apply(a,Dt(i))}var c=new Oe.a(n,e);if(c.setUserText(),!(jt=Oe.a.element))return null;var u=new MutationObserver((function(e){e.forEach((function(e){"attributes"===e.type&&cn(e.target)}))}));return u.observe(jt,{attributes:!0}),e.avatarURL&&(c.setWebRtcAvatar(e.avatarURL),e.ttsFileType="wav"),c},cn=function(e){var t=e.dataset.collapsable,n=jt.querySelector("[data-play]");if("collapsed"===t)Ft&&(Ft.style.display="none"),n&&(n.style.display="none");else{if(Ft){var r=Ft.querySelector("[data-fs-bot-modal-consent]"),i=jt.getBoundingClientRect().height,s=getComputedStyle(jt).paddingBottom;r.style.height=3*(i-parseInt(s,10))/5+"px",Ft.style.display="block"}n&&(n.style.display="block")}},un=function(e,t){var n=nn.status,r=void 0===n?void 0:n;window.addEventListener("message",(function(e){"BotStopEvent"===e.data&&g.onEnd()})),e.disableStop("SLEEPING"===r||!r);var i={setStatus:function(t){nn=t,"LISTENING"===t.status?e.setOutputAudio(1):e.setInputAudio(1),En("SLEEPING"===t.status||"PAUSED"===t.status||!t.status,e),e.disableStop("SLEEPING"===t.status),"SLEEPING"===t.status?(e.toggleRestart(!0),e.setMicIcon(!1)):void 0!==t.status&&e.toggleRestart(!1)},getStatusString:function(e){return e},addMessage:function(n,r,i,s,a,o){if(console.log("dialogue node id: ",o),"sent"===n)null!==r&&e.setUserText(r);else{rn=!0,e.expand(),rn=!1,Oe.a.botTextKioskElement&&(Oe.a.botTextKioskElement.style.transition="transform 0s linear 0s",Oe.a.botTextKioskElement.style.transform="translateY(0px)");var c=jt.querySelector("[data-play]");null!==c&&c.remove(),e.setBotText(r,a),window.setTimeout((function(){var e="portrait"===Oe.a.orientation?window.innerHeight/2:window.innerHeight;if(Oe.a.botTextKioskElement&&Oe.a.botTextKioskElement.scrollHeight>e){var t=e-Oe.a.botTextKioskElement.scrollHeight;Oe.a.botTextKioskElement.style.transition="transform "+-t/120+"s linear 3s",Oe.a.botTextKioskElement.style.transform="translateY("+t+"px)"}}),Oe.a.settings.animationSpeed+5)}null!=i&&e.setImage(i,a),null!=s&&s!==tn&&(tn=s,t.avatarURL?e.sendRTCData({Background:s}):s.startsWith("#")?e.setBackgroundColor(s):e.setBackgroundImage(s))}};Ut=function(t,n){console.log(t),"SOP"!==t&&"QUESTION"!==t||void 0!==n&&"SLEEPING"!==n||(e.removeOverlay(),h())},i.addVideo=function(t,n){e.setVideo(t,n)},i.addLogs=function(e){e.forEach((function(e){console.log(e.text)}))},i.onError=function(e){console.log(e),ie(e.message)},i.onEnd=function(){e.setBotText(),e.setUserText(),e.setInputAudio(null),e.setImage(null),yn(e),e.sendRTCData({Expression:{Name:"neutral"}}),en.sessionEnded&&pn()};var s=function(){};function a(){return(a=Rt(xt().mark((function t(n,r,i){var s,a;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=function(e,t){console.log("titleAndContext",e,{content:t});var n,r=e.h1_b=e.h1_b.split(" |"),i=e.h2_b=e.h2_b.split(" |"),s=e.h3_b=e.h3_b.split(" |");if(r.forEach((function(e,t){""===e&&r.splice(t,1)})),i.forEach((function(e,t){""===e&&i.splice(t,1)})),s.forEach((function(e,t){""===e&&s.splice(t,1)})),r.length>1)n=r[0];else if(i.length>0)n=i[0],i.shift();else{if(!(s.length>0))return{title:n=t.slice(0,10),secondary:t.slice(10,20)};n=s[0],s.shift()}return{title:n,secondary:i.length>0?i.join("\n"):s.length>0?s.join("\n"):t.slice(0,20)}},e.toggleLoader(!0),t.next=4,en.getFiles(i,url="https://upv-search-develop.alquist.ai/v2/models/upv-search/infer");case 4:a=t.sent.data,e.toggleLoader(!1),console.log("search results: ",a),void 0===a?(en.handleOnTextInput("ERROR",!1,{sopInput:!0}),en.audioInputCallback()):0===a.result.length?(en.handleOnTextInput("NO_SOLUTION",!1,{sopInput:!0}),en.audioInputCallback()):a.result.forEach((function(t){var n=s(t.meta.backup,t.meta.backup.cnt),r=n.title,i=n.secondary;e.setSnippet(t.meta.pagelink,r,i)}));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}i.handleCommand=function(n,r,i){var o=JSON.parse(r);switch(console.log(o),n){case"#expression":e.sendRTCData({Expression:{Name:o.name}});break;case"#animation":case"#gesture":e.sendRTCData({Animation:o.name});break;case"#snow":e.sendRTCData({Snowing:o.snowing});break;case"#transition":e.sendRTCData({Transition:""});break;case"#shirt":e.sendRTCData({ChangeShirt:o.state});break;case"#level":e.sendRTCData({Level:o.name+"Level"});break;case"#avatar":e.sendRTCData({Character:o.name});break;case"#walk":e.sendRTCData({Walk:o.action});break;case"#actions":Yt=!0;var c=e.getInputMode();o.tiles.forEach((function(t){var n=Nt({oldMode:c,groupName:o.title,disableGroup:!0,appSelect:o.appSelect,solutions:o.solutions},t);s=function(){e.disableButtonGroup(n,(function(){}),"buttons")},e.setButton(n,(function(){"LISTENING"!==dn()&&"RESPONDING"!==dn()||en.handleOnTextInput("#".concat(t.action),!1,{buttonInput:!0}),Yt=!1})),en.audioInputCallback()}));break;case"#search":case"#pdf":var u=e.getLastUserMessage().children[0].textContent;!function(e,t,n){a.apply(this,arguments)}(c,o.index.toLowerCase(),u),en.audioInputCallback();break;case"#suggestions":if(o.nodes){var l=[];o.nodes.forEach((function(e){l.push(e.text)})),e.setSuggestion(l)}else e.setSuggestion(o.suggestions);break;case"#media":o.videos.forEach((function(n){e.setMedia({sound:t.sound,src:n})}))}},i.getAttributes=function(){var e=$t.getAttributes();$t.resetAttributes();var t=function(e){return Object.keys(o).forEach((function(t){e[t]=o[t]})),e}(e);return t};var o={};i.getUUID=function(){return bt()},i.getVoice=function(){},i.focusOnNode=function(){},i.play=function(e){"in"!==e&&"out"!==e||Qt[e].play()};var c,u,l=function(e){var n=dn();if(null!=en){if("Input"===e)return;t.sound=!t.sound,en.setOutAudio(t.sound,n)}},d=function(){en.onStopClick(),t.avatarURL&&e.sendRTCData({Stop:""}),g.onEnd()},h=function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=dn();console.log(r);var i=!1;switch(en.setOutAudio(t.sound,r),r){case"SLEEPING":n||(e.setMicIcon(!0),hn());break;case"LISTENING":"SOP"!==t.interactionMode&&(en.setInAudio(!1,dn()),En(i=!i,e));break;case"RESPONDING":"SOP"!==t.interactionMode&&(en.pause(),t.avatarURL&&(e.sendRTCData({Pause:"true"}),e.removeOverlay()));break;case"PAUSED":en.resume(),t.avatarURL&&(e.sendRTCData({Pause:"false"}),en.setInAudio("voice"===e.getInputMode(),dn()),e.resume(e.getInputMode,Yt));break;case void 0:e.setMicIcon(!0),Oe.a.avatarElement.children[0]&&Oe.a.avatarElement.children[0].play(),hn()}},f=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}("deviceId");if(null===f){var p=t.domain;(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"/",i=new Date(Date.now()+31556952e4).toUTCString();document.cookie="".concat(e,"=").concat(t,";expires=").concat(i,";domain=").concat(n,";path=").concat(r)})("deviceId",f=Math.abs((c=Number.MIN_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER,Math.floor(Math.random()*(u-c))+c)).toString(36),p)}t.jwtToken?(zt=t.jwtToken,mn(e)):gn(f,(function(t){t.id,zt=t.access,mn(e)})),e.inputModeCallback=function(t){e.setInputMode(t),en.updateUser({inputMode:t}),"voice"===t?e.setSection("QUESTION"):e.setSectionByIndex(0)},e.botMessagesCallback=function(t){var n,r;"button"===e.getInputMode()&&s(),console.log(t),console.log("go to"),n="nodeId",r=t,console.log(n,r),o[n]=r,e.removeSuggestions(),en.handleOnTextInput("#go_to",!1,{sopInput:!0})},e.chatInputCallback=function(t){"SLEEPING"===dn()||function(t){t=t.trim();var n=dn();if(""!==t&&("LISTENING"===n||"RESPONDING"===n)){var r="LISTENING"===n&&"voice"==e.getInputMode;en.handleOnTextInput(t,r)}}(t)},e.chatMicrophoneCallback=function(e){return l("Input")},e.chatMuteCallback=function(e){return l("Output")},e.chatArrowCallback=function(n){return function(){var n=dn();t.avatarURL&&e.sendRTCData({Stop:""}),en.click(n)}()},e.chatPlayCallback=function(e){rn=!rn,h()},e.chatRestartCallback=function(){h(),en.audioInputCallback()},e.sectionChangeCallback=function(e){Ut(e,dn())},e.chatSopNextCallback=function(t){var n=dn();console.log(n),void 0!==n&&"SLEEPING"!==n?(e.removeSuggestions(),en.handleOnTextInput("yes",!1,{sopInput:!0})):"SLEEPING"!==n&&void 0!==n||(e.appSelectToggle(!1),e.removeAllMessages(),h())},e.chatBackCallback=function(n){"SOP"===t.interactionMode&&(e.previousSection(),en.setInAudio("voice"===e.getInputMode(),dn()))},e.suggestionsCallback=function(t){en.handleOnTextInput(t.target.innerHTML,!1),e.removeSuggestions()},e.setModeCallback=function(t){"voice"===t?(en.setInAudio(!0,dn()),"LISTENING"===dn()&&(en.inAudio("LISTENING"),e.addOverlay())):"sop"===t&&en.setInAudio(!1,dn())},e.chatMicCallback=function(n){if("SOP"===t.interactionMode||"GUIDE"===t.interactionMode){var r=dn();"SLEEPING"===r||void 0===r?(h(),e.setMicIcon(!0)):d()}else e.setMicIcon(Oe.a.chatInputMicElement.classList.contains("icon--light")),e.chatMicrophoneCallback()},e.chatSopQuestionCallback=function(t){e.setSection("QUESTION")},e.loginCallback=Rt(xt().mark((function t(){var n;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,en.signIn();case 2:return t.next=4,en.checkExistingUser();case 4:if(!t.sent){t.next=13;break}return t.next=8,en.getUser();case 8:n=t.sent,console.log(n),void 0===n.inputMode?e.setSection("INPUTSELECT"):e.setSectionByIndex(0),t.next=15;break;case 13:e.loginPop(),console.log("account doesn't exist");case 15:case"end":return t.stop()}}),t)}))),e.chatKeyboardCallback=function(n){"LISTENING"===dn()&&(t.inputAudio=!t.inputAudio,en.setInAudio(t.inputAudio,dn()),t.inputAudio&&e.addOverlay())},e.getSettings=function(){return t},e.chatStopCallback=function(e){return d()},e.chatTextInputElementCallback=function(e){var t=dn();"LISTENING"===t?en.closeAudioStream("User started typing",!0):"RESPONDING"===t&&en.startTyping()},e.dataChannelMessageCallback=function(e){1===e[0]&&function(e){switch(e){case"AudioEnded":case"AnimEnded":en.addRecord();break;default:console.log("Received data channel response",e)}}(new TextDecoder("utf-16").decode(e.slice(1)))},e.collapsableTriggerCallback=function(t){var n=dn(),r=e.getSection();void 0!==n&&"SLEEPING"!==n||t||"SOP"!==r&&"QUESTION"!==r||h(!0)};var g=Nt(Nt({},i),t.callback);return en=ke()(t.coreUrl,f,t.autoStart,g,!1,t.ttsFileType),t.avatarURL&&(en.playAudio=function(t){if(null===t)en.addRecord();else if(t.match(Xt))e.sendRTCData({PCM:t});else{var n=new Audio(t);n.onended=en.addRecord,n.play()}}),en},ln=function(){var e=$t.getMessage(),t=new URLSearchParams(window.location.search);return e?($t.setMessage($t.defaultStartMessage),e):window.location.hash?window.location.hash:null!==t.get("text")?"#".concat(t.get("text")):"#intro"},dn=function(){var e=nn.status;return void 0===e?void 0:e},hn=function(){var e=dn();void 0!==e&&"SLEEPING"!==e||en.handleOnTextInput(ln(),!1)},fn=function(e,t){$t.addAttributes(t),$t.setMessage(e),hn()},pn=function(){en?en.init(qt,"en",!0,!0,ln(),void 0,void 0,void 0,zt):(!function(e,t){var n;try{throw new Error(e)}catch(e){n=e}var r="string"!=typeof t?{captureContext:t}:void 0;re("captureMessage",e,"string"==typeof t?t:void 0,Object(o.a)({originalException:e,syntheticException:n},r))}("Bot is undefined"),console.error("There was an unexpected error with the bot. Please try reloading the page."))},gn=function(e,t){_t(Gt+"/auth/"+e,"GET",t)},mn=function(e){_t(Gt+"/user/signupAnonymous","POST",(function(){vn(qt,e)}),zt,null,(function(){vn(qt,e)}))},vn=function(e,t){_t(Gt+"/terms/application/"+e,"GET",(function(e){null===e?yn(t):(Ht=e._id,bn(t))}),zt,null,(function(){yn(t)}))},yn=function(e){if(sn)e.setTextInputEnabled(sn),En(!0,e);else{Oe.a.element.style.setProperty("--bot-ui-chat-input-height",Oe.a.element.style.getPropertyValue("--bot-ui-chat-pcm-height"));var t=wt('\n    <div class="fs-client-play" title="Start" data-play></div>\n');jt.append(t),jt.querySelector("[data-play]").onclick=function(e){_n()&&Oe.a.settings.fullScreen&&(document.body.requestFullScreen?document.body.requestFullScreen():document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullScreen&&document.body.webkitRequestFullScreen()),Oe.a.avatarElement.children[0]&&Oe.a.avatarElement.children[0].play(),hn(),e.target.remove()},jt.querySelector("[data-play]").style.display="block",cn(jt)}},bn=function(e){var t=wt('\n    <div class="fs-client-modal" data-fs-bot-modal>\n        <div class="fs-client-modal-content">\n            <div class="fs-client-modal-header"></div>\n            <div class="fs-client-consent" data-fs-bot-modal-consent></div>\n            <div class="fs-client-modal-body fs-client-consent-text">\n                <strong>Do you consent to these terms?</strong>\n            </div>\n            <div class="fs-client-modal-footer fs-client-consent-buttons">\n                <button class="fs-client-consent-button" data-fs-bot-consent-button>I consent</button>\n            </div>\n        </div>\n    </div>\n');jt.append(t),Ft=t.querySelector("[data-fs-bot-modal]");var n=function(){Ft.remove(),Ft=null,yn(e)};t.querySelector("[data-fs-bot-consent-button]").onclick=function(){wn((function(){n()}))},_t(Gt+"/terms/"+Ht+"/consent","GET",(function(e){n()}),zt,null,(function(){_t(Gt+"/terms/"+Ht,"GET",(function(e){var t=Ft.querySelector("[data-fs-bot-modal-consent]"),n=Wt.makeHtml(e.text);t.innerHTML=n,cn(jt)}),zt)}))},wn=function(e){_t(Gt+"/terms/"+Ht+"/consent","POST",e,zt)},_n=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},En=function(e,t){e?t.setPlayIcon("icon--content--play"):t.setPlayIcon("icon--content--pause")}},,,,function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Ok="ok",e.Exited="exited",e.Crashed="crashed",e.Abnormal="abnormal"}(r||(r={}))}]));