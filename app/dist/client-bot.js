/*! For license information please see client-bot.js.LICENSE.txt?996f086987e27e05493f */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=38)}([function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"f",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"e",(function(){return u}));var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)};function i(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var a=function(){return a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a.apply(this,arguments)};function o(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}},,function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return u}));var n=r(20),i=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function a(e){return"tracesSampleRate"in e||"tracesSampler"in e}function o(e){var t=e.match(i);if(t){var r=void 0;return"1"===t[3]?r=!0:"0"===t[3]&&(r=!1),{traceId:t[1],parentSampled:r,parentSpanId:t[2]}}}function s(e){var t,r;return void 0===e&&(e=Object(n.c)()),null===(r=null===(t=e)||void 0===t?void 0:t.getScope())||void 0===r?void 0:r.getTransaction()}function c(e){return e/1e3}function u(e){return 1e3*e}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(5),i=Object(n.e)(),a="Sentry Logger ",o=function(){function e(){this._enabled=!1}return e.prototype.disable=function(){this._enabled=!1},e.prototype.enable=function(){this._enabled=!0},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&Object(n.c)((function(){i.console.log(a+"[Log]: "+e.join(" "))}))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&Object(n.c)((function(){i.console.warn(a+"[Warn]: "+e.join(" "))}))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._enabled&&Object(n.c)((function(){i.console.error(a+"[Error]: "+e.join(" "))}))},e}();i.__SENTRY__=i.__SENTRY__||{};var s=i.__SENTRY__.logger||(i.__SENTRY__.logger=new o)},function(e,t,r){"use strict";function n(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return g(e,Error)}}function i(e){return"[object ErrorEvent]"===Object.prototype.toString.call(e)}function a(e){return"[object DOMError]"===Object.prototype.toString.call(e)}function o(e){return"[object DOMException]"===Object.prototype.toString.call(e)}function s(e){return"[object String]"===Object.prototype.toString.call(e)}function c(e){return null===e||"object"!=typeof e&&"function"!=typeof e}function u(e){return"[object Object]"===Object.prototype.toString.call(e)}function l(e){return"undefined"!=typeof Event&&g(e,Event)}function d(e){return"undefined"!=typeof Element&&g(e,Element)}function h(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function f(e){return Boolean(e&&e.then&&"function"==typeof e.then)}function p(e){return u(e)&&"nativeEvent"in e&&"preventDefault"in e&&"stopPropagation"in e}function g(e,t){try{return e instanceof t}catch(e){return!1}}r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return i})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"k",(function(){return s})),r.d(t,"i",(function(){return c})),r.d(t,"h",(function(){return u})),r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return d})),r.d(t,"j",(function(){return h})),r.d(t,"m",(function(){return f})),r.d(t,"l",(function(){return p})),r.d(t,"g",(function(){return g}))},function(e,t,r){"use strict";(function(e){r.d(t,"e",(function(){return a})),r.d(t,"i",(function(){return o})),r.d(t,"h",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"a",(function(){return d})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return f}));var n=r(9),i=(r(14),{});function a(){return Object(n.c)()?e:"undefined"!=typeof window?window:"undefined"!=typeof self?self:i}function o(){var e=a(),t=e.crypto||e.msCrypto;if(void 0!==t&&t.getRandomValues){var r=new Uint16Array(8);t.getRandomValues(r),r[3]=4095&r[3]|16384,r[4]=16383&r[4]|32768;var n=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return n(r[0])+n(r[1])+n(r[2])+n(r[3])+n(r[4])+n(r[5])+n(r[6])+n(r[7])}return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function s(e){if(!e)return{};var t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var r=t[6]||"",n=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+r+n}}function c(e){if(e.message)return e.message;if(e.exception&&e.exception.values&&e.exception.values[0]){var t=e.exception.values[0];return t.type&&t.value?t.type+": "+t.value:t.type||t.value||e.event_id||"<unknown>"}return e.event_id||"<unknown>"}function u(e){var t=a();if(!("console"in t))return e();var r=t.console,n={};["debug","info","warn","error","log","assert"].forEach((function(e){e in t.console&&r[e].__sentry_original__&&(n[e]=r[e],r[e]=r[e].__sentry_original__)}));var i=e();return Object.keys(n).forEach((function(e){r[e]=n[e]})),i}function l(e,t,r){e.exception=e.exception||{},e.exception.values=e.exception.values||[],e.exception.values[0]=e.exception.values[0]||{},e.exception.values[0].value=e.exception.values[0].value||t||"",e.exception.values[0].type=e.exception.values[0].type||r||"Error"}function d(e,t){void 0===t&&(t={});try{e.exception.values[0].mechanism=e.exception.values[0].mechanism||{},Object.keys(t).forEach((function(r){e.exception.values[0].mechanism[r]=t[r]}))}catch(e){}}function h(){try{return document.location.href}catch(e){return""}}function f(e,t){if(!t)return 6e4;var r=parseInt(""+t,10);if(!isNaN(r))return 1e3*r;var n=Date.parse(""+t);return isNaN(n)?6e4:n-e}}).call(this,r(26))},function(e,t,r){window,e.exports=function(){return r={},e.m=t=[function(e,t,r){(function(t){function r(e){return e&&e.Math==Math&&e}e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||Function("return this")()}).call(this,r(50))},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){r=r(5),e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(0),i=r(36),a=r(1),o=r(23),s=r(39),c=(r=r(62),i("wks")),u=n.Symbol,l=r?u:u&&u.withoutSetter||o;e.exports=function(e){return a(c,e)||(s&&a(u,e)?c[e]=u[e]:c[e]=l("Symbol."+e)),c[e]}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){var n=r(2),i=r(32),a=r(10),o=r(18),s=Object.defineProperty;t.f=n?s:function(e,t,r){if(a(e),t=o(t,!0),a(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(2),i=r(6),a=r(15);e.exports=n?function(e,t,r){return i.f(e,t,a(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){var n=r(11),i=Math.min;e.exports=function(e){return 0<e?i(n(e),9007199254740991):0}},function(e,t,r){var n;"undefined"!=typeof window&&(n=function(){return r={},e.m=t={"./node_modules/eventemitter3/index.js":function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function a(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function s(e,t,r,n,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");return a=new o(r,n||e,a),t=i?i+t:t,e._events[t]?e._events[t].fn?e._events[t]=[e._events[t],a]:e._events[t].push(a):(e._events[t]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=this._events[i?i+e:e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,n=t.length,a=new Array(n);r<n;r++)a[r]=t[r].fn;return a},u.prototype.listenerCount=function(e){return(e=this._events[i?i+e:e])?e.fn?1:e.length:0},u.prototype.emit=function(e,t,r,n,a,o){var s=i?i+e:e;if(!this._events[s])return!1;var c,u=this._events[s],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,a),!0;case 6:return u.fn.call(u.context,t,r,n,a,o),!0}for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];u.fn.apply(u.context,c)}else for(var d,h=u.length,f=0;f<h;f++)switch(u[f].once&&this.removeListener(e,u[f].fn,void 0,!0),l){case 1:u[f].fn.call(u[f].context);break;case 2:u[f].fn.call(u[f].context,t);break;case 3:u[f].fn.call(u[f].context,t,r);break;case 4:u[f].fn.call(u[f].context,t,r,n);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u[f].fn.apply(u[f].context,c)}return!0},u.prototype.on=function(e,t,r){return s(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return s(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,n){if(e=i?i+e:e,!this._events[e])return this;if(!t)return c(this,e),this;var a=this._events[e];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||c(this,e);else{for(var o=0,s=[],u=a.length;o<u;o++)(a[o].fn!==t||n&&!a[o].once||r&&a[o].context!==r)&&s.push(a[o]);s.length?this._events[e]=1===s.length?s[0]:s:c(this,e)}return this},u.prototype.removeAllListeners=function(e){return e?this._events[e=i?i+e:e]&&c(this,e):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,e.exports=u.EventEmitter=u},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,r){var n,i,a,o,s;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=s.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}if(!(n=s.parseURL(t)))throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=s.normalizePath(n.path),s.buildURLFromParts(n)):t;if(!(t=s.parseURL(e)))throw new Error("Error trying to parse base URL.");var a;return!t.netLoc&&t.path&&"/"!==t.path[0]&&(a=i.exec(t.path),t.netLoc=a[1],t.path=a[2]),t.netLoc&&!t.path&&(t.path="/"),e={scheme:t.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment},n.netLoc||(e.netLoc=t.netLoc,"/"!==n.path[0]&&(n.path?(a=(a=t.path).substring(0,a.lastIndexOf("/")+1)+n.path,e.path=s.normalizePath(a)):(e.path=t.path,n.params||(e.params=t.params,n.query||(e.query=t.query))))),null===e.path&&(e.path=r.alwaysNormalize?s.normalizePath(n.path):n.path),s.buildURLFromParts(e)},parseURL:function(e){return(e=n.exec(e))?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(o,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=s},"./node_modules/webworkify-webpack/index.js":function(e,t,r){function n(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var n=r(r.s=ENTRY_MODULE);return n.default||n}var i="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function o(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,n){var s={};s[n]=[];var c=t.toString();if(!(t=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)))return s;t=t[1];for(var u,l=new RegExp("(\\\\n|\\W)"+o(t)+a,"g");u=l.exec(c);)"dll-reference"!==u[3]&&s[n].push(u[3]);for(l=new RegExp("\\("+o(t)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+a,"g");u=l.exec(c);)e[u[2]]||(s[n].push(u[1]),e[u[2]]=r(u[1]).m),s[u[2]]=s[u[2]]||[],s[u[2]].push(u[4]);for(var d,h=Object.keys(s),f=0;f<h.length;f++)for(var p=0;p<s[h[f]].length;p++)d=s[h[f]][p],isNaN(+d)||(s[h[f]][p]=+s[h[f]][p]);return s}function c(e,t){for(var r={main:[t]},n={main:[]},i={main:{}};function(e){return Object.keys(e).reduce((function(t,r){return t||0<e[r].length}),!1)}(r);)for(var a=Object.keys(r),o=0;o<a.length;o++){var c=a[o],u=r[c].pop();if(i[c]=i[c]||{},!i[c][u]&&e[c][u]){i[c][u]=!0,n[c]=n[c]||[],n[c].push(u);for(var l=s(e,e[c][u],c),d=Object.keys(l),h=0;h<d.length;h++)r[d[h]]=r[d[h]]||[],r[d[h]]=r[d[h]].concat(l[d[h]])}}return n}e.exports=function(e,t){var i={main:r.m},a=(t=t||{}).all?{main:Object.keys(i.main)}:c(i,e),o="";return Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),o=o+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);",e=new window.Blob([o],{type:"text/javascript"}),t.bare||(t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(e),(e=new window.Worker(t)).objectURL=t),e}},"./src/crypt/decrypter.js":function(e,t,r){"use strict";r.r(t);var n=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),i=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),n=0;n<4;n++)r[n]=t.getUint32(4*n);return r},t.initTable=function(){var e,t=this.sBox,r=this.invSBox,n=(e=this.subMix)[0],i=e[1],a=e[2],o=e[3],s=(e=this.invSubMix)[0],c=e[1],u=e[2],l=e[3],d=new Uint32Array(256),h=0,f=0,p=0;for(p=0;p<256;p++)d[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var g=f^f<<1^f<<2^f<<3^f<<4;t[h]=g=g>>>8^255&g^99;var m=d[r[g]=h],v=d[m],y=d[v],b=257*d[g]^16843008*g;n[h]=b<<24|b>>>8,i[h]=b<<16|b>>>16,a[h]=b<<8|b>>>24,o[h]=b,s[g]=(b=16843009*y^65537*v^257*m^16843008*h)<<24|b>>>8,c[g]=b<<16|b>>>16,u[g]=b<<8|b>>>24,l[g]=b,h?(h=m^d[d[d[y^m]]],f^=d[d[f]]):h=f=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,n=0;n<t.length&&r;)r=t[n]===this.key[n],n++;if(!r){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);for(var a,o,s,c=this.ksRows=4*(i+6+1),u=this.keySchedule=new Uint32Array(c),l=this.invKeySchedule=new Uint32Array(c),d=this.sBox,h=this.rcon,f=(e=this.invSubMix)[0],p=e[1],g=e[2],m=e[3],v=0;v<c;v++)v<i?o=u[v]=t[v]:(s=o,v%i==0?(s=d[(s=s<<8|s>>>24)>>>24]<<24|d[s>>>16&255]<<16|d[s>>>8&255]<<8|d[255&s],s^=h[v/i|0]<<24):6<i&&v%i==4&&(s=d[s>>>24]<<24|d[s>>>16&255]<<16|d[s>>>8&255]<<8|d[255&s]),u[v]=o=(u[v-i]^s)>>>0);for(a=0;a<c;a++)v=c-a,s=3&a?u[v]:u[v-4],l[a]=a<4||v<=4?s:f[d[s>>>24]]^p[d[s>>>16&255]]^g[d[s>>>8&255]]^m[d[255&s]],l[a]=l[a]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,r,n){for(var i,a,o,s,c,u,l,d,h,f,p,g,m,v,y=this.keySize+6,b=this.invKeySchedule,_=this.invSBox,w=this.invSubMix,E=w[0],S=w[1],T=w[2],k=w[3],O=(r=this.uint8ArrayToUint32Array_(r))[0],A=r[1],x=r[2],R=r[3],C=new Int32Array(e),L=new Int32Array(C.length),I=this.networkToHostOrderSwap;t<C.length;){for(h=I(C[t]),f=I(C[t+1]),p=I(C[t+2]),g=I(C[t+3]),c=h^b[0],u=g^b[1],l=p^b[2],d=f^b[3],m=4,v=1;v<y;v++)i=E[c>>>24]^S[u>>16&255]^T[l>>8&255]^k[255&d]^b[m],a=E[u>>>24]^S[l>>16&255]^T[d>>8&255]^k[255&c]^b[m+1],o=E[l>>>24]^S[d>>16&255]^T[c>>8&255]^k[255&u]^b[m+2],s=E[d>>>24]^S[c>>16&255]^T[u>>8&255]^k[255&l]^b[m+3],c=i,u=a,l=o,d=s,m+=4;i=_[c>>>24]<<24^_[u>>16&255]<<16^_[l>>8&255]<<8^_[255&d]^b[m],a=_[u>>>24]<<24^_[l>>16&255]<<16^_[d>>8&255]<<8^_[255&c]^b[m+1],o=_[l>>>24]<<24^_[d>>16&255]<<16^_[c>>8&255]<<8^_[255&u]^b[m+2],s=_[d>>>24]<<24^_[c>>16&255]<<16^_[u>>8&255]<<8^_[255&l]^b[m+3],m+=3,L[t]=I(i^O),L[t+1]=I(s^A),L[t+2]=I(o^x),L[t+3]=I(a^R),O=h,A=f,x=p,R=g,t+=4}return n?(n=(e=(r=L.buffer).byteLength)&&new DataView(r).getUint8(e-1))?r.slice(0,e-n):r:L.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),o=r("./src/errors.ts"),s=r("./src/utils/logger.js"),c=r("./src/events.js"),u=(r=r("./src/utils/get-self-scope.js"),Object(r.getSelfScope)());t.default=function(){function e(e,t,r){if(r=void 0===(r=(void 0===r?{}:r).removePKCS7Padding)||r,this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=r)try{var n=u.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,r,o){var c,u,l=this;this.disableWebCrypto&&this.config.enableSoftwareAES?(this.logEnabled&&(s.logger.log("JS AES decrypt"),this.logEnabled=!1),(c=this.decryptor)||(this.decryptor=c=new a),c.expandKey(t),o(c.decrypt(e,0,r,this.removePKCS7Padding))):(this.logEnabled&&(s.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1),u=this.subtle,this.key!==t&&(this.key=t,this.fastAesKey=new i(u,t)),this.fastAesKey.expandKey().then((function(i){new n(u,r).decrypt(e,i).catch((function(n){l.onWebCryptoError(n,e,t,r,o)})).then((function(e){o(e)}))})).catch((function(n){l.onWebCryptoError(n,e,t,r,o)})))},t.onWebCryptoError=function(e,t,r,n,i){this.config.enableSoftwareAES?(s.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,n,i)):(s.logger.error("decrypting error : "+e.message),this.observer.trigger(c.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}()},"./src/demux/demuxer-inline.js":function(e,t,r){"use strict";r.r(t);var n=r("./src/events.js"),i=r("./src/errors.ts"),a=r("./src/crypt/decrypter.js"),o=r("./src/polyfills/number.js"),s=r("./src/utils/logger.js"),c=r("./src/utils/get-self-scope.js");function u(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function h(e,t){return!!(t+1<e.length&&u(e,t))}function f(e,t,r,a,o){e.samplerate||(o=function(e,t,r,a){var o,c,u=navigator.userAgent.toLowerCase(),l=a,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],h=1+((192&t[r+2])>>>6),f=(60&t[r+2])>>>2;if(!(d.length-1<f))return o=(1&t[r+2])<<2,o|=(192&t[r+3])>>>6,s.logger.log("manifest codec:"+a+",ADTS data:type:"+h+",sampleingIndex:"+f+"["+d[f]+"Hz],channelConfig:"+o),a=/firefox/i.test(u)?6<=f?(h=5,c=new Array(4),f-3):(h=2,c=new Array(2),f):-1!==u.indexOf("android")?(h=2,c=new Array(2),f):(h=5,c=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&6<=f?f-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(6<=f&&1==o||/vivaldi/i.test(u))||!a&&1==o)&&(h=2,c=new Array(2)),f)),c[0]=h<<3,c[0]|=(14&f)>>1,c[1]|=(1&f)<<7,c[1]|=o<<3,5===h&&(c[1]|=(14&a)>>1,c[2]=(1&a)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:d[f],channelCount:o,codec:"mp4a.40."+h,manifestCodec:l};e.trigger(n.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f})}(t,r,a,o),e.config=o.config,e.samplerate=o.samplerate,e.channelCount=o.channelCount,e.codec=o.codec,e.manifestCodec=o.manifestCodec,s.logger.log("parsed codec:"+e.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount))}function p(e){return 9216e4/e}function g(e,t,r,n,i){var a=function(e,t,r,n,i){var a=e.length,o=l(e,t);if(e=d(e,t),0<(e-=o)&&t+o+e<=a)return{headerLength:o,frameLength:e,stamp:r+n*i}}(t,r,n,i,p(e.samplerate));if(a)return n=a.stamp,i=a.headerLength,a=a.frameLength,n={unit:t.subarray(r+i,r+i+a),pts:n,dts:n},e.samples.push(n),{sample:n,length:a+i}}var m=r("./src/demux/id3.js"),v=function(){function e(e,t,r){this.observer=e,this.config=r,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(m.default.getID3Data(e,0)||[]).length,r=e.length;t<r;t++)if(function(e,t){if(h(e,t)){var r=l(e,t);if(t+r>=e.length)return;var n=d(e,t);if(n<=r)return;if((n=t+n)===e.length||n+1<e.length&&u(e,n))return 1}}(e,t))return s.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,r,n){for(var i=this._audioTrack,a=m.default.getID3Data(e,0)||[],c=m.default.getTimeStamp(a),u=Object(o.isFiniteNumber)(c)?90*c:9e4*t,l=0,d=u,p=e.length,v=a.length,y=[{pts:d,dts:d,data:a}];v<p-1;)if(h(e,v)&&v+5<p){f(i,this.observer,e,v,i.manifestCodec);var b=g(i,e,v,u,l);if(!b){s.logger.log("Unable to parse AAC frame");break}v+=b.length,d=b.sample.pts,l++}else m.default.isHeader(e,v)?(a=m.default.getID3Data(e,v),y.push({pts:d,dts:d,data:a}),v+=a.length):v++;this.remuxer.remux(i,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,r,n)},t.destroy=function(){},e}(),y=r("./src/demux/mp4demuxer.js"),b={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,r,n,i){if(!(r+24>t.length)){var a=this.parseHeader(t,r);if(a&&r+a.frameLength<=t.length)return i=n+i*(9e4*a.samplesPerFrame/a.sampleRate),i={unit:t.subarray(r,r+a.frameLength),pts:i,dts:i},e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(i),{sample:i,length:a.frameLength}}},parseHeader:function(e,t){var r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3,o=e[t+2]>>1&1;if(1!=r&&0!=i&&15!=i&&3!=a)return i=1e3*b.BitratesMap[14*(3==r?3-n:3==n?3:4)+i-1],a=b.SamplingRateMap[3*(3==r?0:2==r?1:2)+a],e=e[t+3]>>6==3?1:2,n=8*(t=b.SamplesCoefficients[r][n])*(r=b.BytesInSlot[n]),{sampleRate:a,channelCount:e,frameLength:parseInt(t*i/a+o,10)*r,samplesPerFrame:n}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var r=this.parseHeader(e,t),n=4;if((n=t+(n=r&&r.frameLength?r.frameLength:n))===e.length||n+1<e.length&&this.isHeaderPattern(e,n))return!0}return!1}},_=b,w=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4);if(0===(t=Math.min(4,t)))throw new Error("no bytes available");n.set(e.subarray(r,r+t)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t},t.skipBits=function(e){var t;this.bitsAvailable>e||(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord()),this.word<<=e,this.bitsAvailable-=e},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return 32<e&&s.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,0<this.bitsAvailable?this.word<<=t:0<this.bytesAvailable&&this.loadWord(),0<(t=e-t)&&this.bitsAvailable?r<<t|this.readBits(t):r},t.skipLZ=function(){for(var e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t=8,r=8,n=0;n<e;n++)t=0===(r=0!==r?(t+this.readEG()+256)%256:r)?t:r},t.readSPS=function(){var e,t,r,n,i,a=0,o=0,s=0,c=0,u=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),h=this.readBoolean.bind(this),f=this.skipBits.bind(this),p=this.skipEG.bind(this),g=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(u(),e=u(),l(5),f(3),u(),g(),(100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e)&&(3===(i=d())&&f(1),g(),g(),f(1),h()))for(r=3!==i?8:12,n=0;n<r;n++)h()&&m(n<6?16:64);if(g(),0===(i=d()))d();else if(1===i)for(f(1),p(),p(),t=d(),n=0;n<t;n++)p();g(),f(1),i=d(),g=d(),0===(l=l(1))&&f(1),f(1),h()&&(a=d(),o=d(),s=d(),c=d());var v=[1,1];if(h()&&h())switch(u()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil(16*(i+1)-2*a-2*o),height:(2-l)*(g+1)*16-(l?2:4)*(s+c),pixelRatio:v}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),E=function(){function e(e,t,r,n){this.decryptdata=r,this.discardEPB=n,this.decrypter=new a.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,r,n){var i=e[t].unit,a=(a=i.subarray(16,i.length-i.length%16)).buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(a,(function(a){a=new Uint8Array(a),i.set(a,16),n||o.decryptAacSamples(e,t+1,r)}))},t.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,n),!n)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),n=0,i=32;i<=e.length-16;i+=160,n+=16)r.set(e.subarray(i,i+16),n);return r},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var r=0,n=32;n<=e.length-16;n+=160,r+=16)e.set(t.subarray(r,r+16),n);return e},t.decryptAvcSample=function(e,t,r,n,i,a){var o=this.discardEPB(i.data),s=this.getAvcEncryptedData(o),c=this;this.decryptBuffer(s.buffer,(function(s){i.data=c.getAvcDecryptedUnit(o,s),a||c.decryptAvcSamples(e,t,r+1,n)}))},t.decryptAvcSamples=function(e,t,r,n){for(;;t++,r=0){if(t>=e.length)return void n();for(var i=e[t].units;!(r>=i.length);r++){var a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,n,a,o),!o)return}}}},e}(),S={video:1,audio:2,id3:3,text:4},T=function(){function e(e,t,r,n){this.observer=e,this.config=r,this.typeSupported=n,this.remuxer=t,this.sampleAes=null,this.pmtUnknownTypes={}}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new E(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){return!((t=e._syncOffset(t))<0||(t&&s.logger.warn("MPEG2-TS detected but first sync word found @ offset "+t+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),r=0;r<t;){if(71===e[r]&&71===e[r+188]&&71===e[r+376])return r;r++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:S[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,r,n,i){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=n,this._duration=i},t.resetTimeStamp=function(){},t.append=function(t,r,a,o){var c,u,l,d,h,f=t.length,p=!1;this.pmtUnknownTypes={},this.contiguous=a;var g=this.pmtParsed,m=this._avcTrack,v=this._audioTrack,y=this._id3Track,b=m.pid,_=v.pid,w=y.pid,E=this._pmtId,S=m.pesData,T=v.pesData,k=y.pesData,O=this._parsePAT,A=this._parsePMT.bind(this),x=this._parsePES,R=this._parseAVCPES.bind(this),C=this._parseAACPES.bind(this),L=this._parseMPEGPES.bind(this),I=this._parseID3PES.bind(this),P=e._syncOffset(t);for(f-=(f+P)%188,c=P;c<f;c+=188)if(71===t[c]){if(u=!!(64&t[c+1]),l=((31&t[c+1])<<8)+t[c+2],1<(48&t[c+3])>>4){if((d=c+5+t[c+4])===c+188)continue}else d=c+4;switch(l){case b:u&&(S&&(h=x(S))&&R(h,!1),S={data:[],size:0}),S&&(S.data.push(t.subarray(d,c+188)),S.size+=c+188-d);break;case _:u&&(T&&(h=x(T))&&(v.isAAC?C:L)(h),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,c+188)),T.size+=c+188-d);break;case w:u&&(k&&(h=x(k))&&I(h),k={data:[],size:0}),k&&(k.data.push(t.subarray(d,c+188)),k.size+=c+188-d);break;case 0:u&&(d+=t[d]+1),E=this._pmtId=O(t,d);break;case E:u&&(d+=t[d]+1);var D=A(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);0<(b=D.avc)&&(m.pid=b),0<(_=D.audio)&&(v.pid=_,v.isAAC=D.isAAC),0<(w=D.id3)&&(y.pid=w),p&&!g&&(s.logger.log("reparse from beginning"),p=!1,c=P-188),g=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(n.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});S&&(h=x(S))?(R(h,!0),m.pesData=null):m.pesData=S,T&&(h=x(T))?((v.isAAC?C:L)(h),v.pesData=null):(T&&T.size&&s.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=T),k&&(h=x(k))?(I(h),y.pesData=null):y.pesData=k,null==this.sampleAes?this.remuxer.remux(v,m,y,this._txtTrack,r,a,o):this.decryptAndRemux(v,m,y,this._txtTrack,r,a,o)},t.decryptAndRemux=function(e,t,r,n,i,a,o){var s;e.samples&&e.isAAC?(s=this).sampleAes.decryptAacSamples(e.samples,0,(function(){s.decryptAndRemuxAvc(e,t,r,n,i,a,o)})):this.decryptAndRemuxAvc(e,t,r,n,i,a,o)},t.decryptAndRemuxAvc=function(e,t,r,n,i,a,o){var s;t.samples?(s=this).sampleAes.decryptAvcSamples(t.samples,0,0,(function(){s.remuxer.remux(e,t,r,n,i,a,o)})):this.remuxer.remux(e,t,r,n,i,a,o)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._trackUnknownPmt=function(e,t,r){var n=this.pmtUnknownTypes[e]||0;return 0===n&&(this.pmtUnknownTypes[e]=0,t.call(s.logger,r)),this.pmtUnknownTypes[e]++,n},t._parsePMT=function(e,t,r,n){var i,a={audio:-1,avc:-1,id3:-1,isAAC:!0},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){switch(i=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){this._trackUnknownPmt(e[t],s.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===a.audio&&(a.audio=i);break;case 21:-1===a.id3&&(a.id3=i);break;case 219:if(!n){this._trackUnknownPmt(e[t],s.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===a.avc&&(a.avc=i);break;case 3:case 4:r?-1===a.audio&&(a.audio=i,a.isAAC=!1):this._trackUnknownPmt(e[t],s.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(e[t],s.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(e[t],s.logger.log,"Unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return a},t._parsePES=function(e){var t,r,n,i,a,o=0,c=e.data;if(!e||0===e.size)return null;for(;c[0].length<19&&1<c.length;){var u=new Uint8Array(c[0].length+c[1].length);u.set(c[0]),u.set(c[1],c[0].length),c[0]=u,c.splice(1,1)}if(1!==((f=c[0])[0]<<16)+(f[1]<<8)+f[2])return null;if((t=(f[4]<<8)+f[5])&&t>e.size-6)return null;if(192&(r=f[7])&&(n=536870912*(14&f[9])+4194304*(255&f[10])+16384*(254&f[11])+128*(255&f[12])+(254&f[13])/2,64&r?54e5<n-(i=536870912*(14&f[14])+4194304*(255&f[15])+16384*(254&f[16])+128*(255&f[17])+(254&f[18])/2)&&(s.logger.warn(Math.round((n-i)/9e4)+"s delta between PTS and DTS, align them"),n=i):i=n),r=f[8],e.size<=(a=r+9))return null;e.size-=a;for(var l=new Uint8Array(e.size),d=0,h=c.length;d<h;d++){var f,p=(f=c[d]).byteLength;if(a){if(p<a){a-=p;continue}f=f.subarray(a),p-=a,a=0}l.set(f,o),o+=p}return t&&(t-=r+3),{data:l,pts:n,dts:i,len:t}},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var r=t.samples,n=r.length;if(isNaN(e.pts)){if(!n)return void t.dropped++;var i=r[n-1];e.pts=i.pts,e.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(n||this.contiguous)?(e.id=n,r.push(e)):t.dropped++}e.debug.length&&s.logger.log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){function r(e,t,r,n){return{key:e,pts:t,dts:r,units:[],debug:n}}var n,i,a,o=this,s=this._avcTrack,c=this._parseAVCNALu(e.data),u=this.avcSample,l=!1,d=this.pushAccesUnit.bind(this);e.data=null,u&&c.length&&!s.audFound&&(d(u,s),u=this.avcSample=r(!1,e.pts,e.dts,"")),c.forEach((function(t){switch(t.type){case 1:i=!0,(u=u||(o.avcSample=r(!0,e.pts,e.dts,""))).frame=!0;var c=t.data;l&&4<c.length&&(2!==(T=new w(c).readSliceType())&&4!==T&&7!==T&&9!==T||(u.key=!0));break;case 5:i=!0,(u=u||(o.avcSample=r(!0,e.pts,e.dts,""))).key=!0,u.frame=!0;break;case 6:i=!0,(n=new w(o.discardEPB(t.data))).readUByte();for(var h=0,f=0,p=!1,g=0;!p&&1<n.bytesAvailable;){for(h=0;h+=g=n.readUByte(),255===g;);for(f=0;f+=g=n.readUByte(),255===g;);if(4===h&&0!==n.bytesAvailable){if(p=!0,181===(v=n.readUByte())&&49===n.readUShort()&&1195456820===(v=n.readUInt())&&3===n.readUByte()){var v,y=31&(v=n.readUByte()),b=[v,n.readUByte()];for(a=0;a<y;a++)b.push(n.readUByte()),b.push(n.readUByte()),b.push(n.readUByte());o._insertSampleInOrder(o._txtTrack.samples,{type:3,pts:e.pts,bytes:b})}}else if(5===h&&0!==n.bytesAvailable){if(p=!0,16<f){var _=[];for(a=0;a<16;a++)_.push(n.readUByte().toString(16)),3!==a&&5!==a&&7!==a&&9!==a||_.push("-");var E=f-16,S=new Uint8Array(E);for(a=0;a<E;a++)S[a]=n.readUByte();o._insertSampleInOrder(o._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:_.join(""),userDataBytes:S,userData:Object(m.utf8ArrayToStr)(S.buffer)})}}else if(f<n.bytesAvailable)for(a=0;a<f;a++)n.readUByte()}break;case 7:if(l=i=!0,!s.sps){var T=(n=new w(t.data)).readSPS();s.width=T.width,s.height=T.height,s.pixelRatio=T.pixelRatio,s.sps=[t.data],s.duration=o._duration;var k=t.data.subarray(1,4),O="avc1.";for(a=0;a<3;a++){var A=k[a].toString(16);O+=A=A.length<2?"0"+A:A}s.codec=O}break;case 8:i=!0,s.pps||(s.pps=[t.data]);break;case 9:i=!1,s.audFound=!0,u&&d(u,s),u=o.avcSample=r(!1,e.pts,e.dts,"");break;case 12:i=!1;break;default:i=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}u&&i&&u.units.push(t)})),t&&u&&(d(u,s),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var r=e.length;if(0<r){if(t.pts>=e[r-1].pts)e.push(t);else for(var n=r-1;0<=n;n--)if(t.pts<e[n].pts){e.splice(n,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t,r=this.avcSample;return(r=r&&0!==r.units.length?r:(e=this._avcTrack.samples)[e.length-1])?(r=r.units)[r.length-1]:t},t._parseAVCNALu=function(e){var t,r,n,i,a,o=0,s=e.byteLength,c=this._avcTrack,u=p=c.naluState||0,l=[],d=-1;for(-1===p&&(n=31&e[d=0],p=0,o=1);o<s;){var h,f,p,g=e[o++];p=p?1!==p?g?1===g?(0<=d?(r={data:e.subarray(d,o-p-1),type:n},l.push(r)):(h=this._getLastNalUnit())&&(u&&o<=4-u&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-u)),0<(t=o-p-1)&&((f=new Uint8Array(h.data.byteLength+t)).set(h.data,0),f.set(e.subarray(0,t),h.data.byteLength),h.data=f)),o<s?(n=31&e[d=o],0):-1):0:3:g?0:2:g?0:1}return 0<=d&&0<=p&&(r={data:e.subarray(d,s),type:n,state:p},l.push(r)),0!==l.length||(i=this._getLastNalUnit())&&((a=new Uint8Array(i.data.byteLength+e.byteLength)).set(i.data,0),a.set(e,i.data.byteLength),i.data=a),c.naluState=p,l},t.discardEPB=function(e){for(var t=e.byteLength,r=[],n=1;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;var i=t-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=e[o];return a},t._parseAACPES=function(e){var t,r,a,o,c=this._audioTrack,u=e.data,l=e.pts,d=this.aacOverFlow,m=this.aacLastPTS;for(d&&((e=new Uint8Array(d.byteLength+u.byteLength)).set(d,0),e.set(u,d.byteLength),u=e),r=0,o=u.length;r<o-1&&!h(u,r);r++);if(r){var v,y=r<o-1?(v="AAC PES did not start with ADTS header,offset:"+r,!1):(v="no ADTS header found in AAC PES",!0);if(s.logger.warn("parsing error:"+v),this.observer.trigger(n.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:y,reason:v}),y)return}for(f(c,this.observer,u,r,this.audioCodec),t=0,y=p(c.samplerate),d&&m&&(y=m+y,1<Math.abs(y-l)&&(s.logger.log("AAC: align PTS for overlapping frames by "+Math.round((y-l)/90)),l=y));r<o;){if(h(u,r)){if(r+5<o){var b=g(c,u,r,l,t);if(b){r+=b.length,a=b.sample.pts,t++;continue}}break}r++}d=r<o?u.subarray(r,o):null,this.aacOverFlow=d,this.aacLastPTS=a},t._parseMPEGPES=function(e){for(var t=e.data,r=t.length,n=0,i=0,a=e.pts;i<r;)if(_.isHeader(t,i)){var o=_.appendFrame(this._audioTrack,t,i,a,n);if(!o)break;i+=o.length,n++}else i++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),k=function(){function e(e,t,r){this.observer=e,this.config=r,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,r,n){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:n,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,r,n=m.default.getID3Data(e,0);if(n&&void 0!==m.default.getTimeStamp(n))for(t=n.length,r=Math.min(e.length-1,t+100);t<r;t++)if(_.probe(e,t))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,r,n){for(var i=m.default.getID3Data(e,0)||[],a=m.default.getTimeStamp(i),o=void 0!==a?90*a:9e4*t,s=i.length,c=e.length,u=0,l=0,d=this._audioTrack,h=[{pts:o,dts:o,data:i}];s<c;)if(_.isHeader(e,s)){var f=_.appendFrame(d,e,s,o,u);if(!f)break;s+=f.length,l=f.sample.pts,u++}else m.default.isHeader(e,s)?(i=m.default.getID3Data(e,s),h.push({pts:l,dts:l,data:i}),s+=i.length):s++;this.remuxer.remux(d,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},t,r,n)},t.destroy=function(){},e}(),O=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),A=Math.pow(2,32)-1,x=function(){function e(){}return e.init=function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]),r=new Uint8Array([105,115,111,109]),n=new Uint8Array([97,118,99,49]),a=new Uint8Array([0,0,0,1]),e.FTYP=e.box(e.types.ftyp,r,a,r,n),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t,r=Array.prototype.slice.call(arguments,1),n=8,i=r.length,a=i;i--;)n+=r[i].byteLength;for((t=new Uint8Array(n))[0]=n>>24&255,t[1]=n>>16&255,t[2]=n>>8&255,t[3]=255&n,t.set(e,4),i=0,n=8;i<a;i++)t.set(r[i],n),n+=r[i].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,r){r*=t;var n=Math.floor(r/(1+A));return r=Math.floor(r%(1+A)),e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,r,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,r))},e.moov=function(t){for(var r=t.length,n=[];r--;)n[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function(t){for(var r=t.length,n=[];r--;)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function(t,r){r*=t;var n=Math.floor(r/(1+A));return r=Math.floor(r%(1+A)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),e.box(e.types.mvhd,r)},e.sdtp=function(t){for(var r,n=t.samples||[],i=new Uint8Array(4+n.length),a=0;a<n.length;a++)r=n[a].flags,i[a+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,i)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){for(var r,n,i=[],a=[],o=0;o<t.sps.length;o++)n=(r=t.sps[o]).byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(r));for(o=0;o<t.pps.length;o++)n=(r=t.pps[o]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));var s=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(a))),c=t.width,u=t.height,l=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var r=t.id,n=t.duration*t.timescale,i=t.width,a=t.height;return t=Math.floor(n/(1+A)),n=Math.floor(n%(1+A)),e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,r){var n=e.sdtp(t),i=t.id,a=Math.floor(r/(1+A));return r=Math.floor(r%(1+A)),e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,r>>24,r>>16&255,r>>8&255,255&r])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){return t=t.id,e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,r){var n,i,a,o,s,c=t.samples||[],u=c.length,l=(t=12+16*u,new Uint8Array(t));for(l.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,(r+=8+t)>>>24&255,r>>>16&255,r>>>8&255,255&r],0),n=0;n<u;n++)i=(s=c[n]).duration,a=s.size,o=s.flags,s=s.cts,l.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,s>>>24&255,s>>>16&255,s>>>8&255,255&s],12+16*n);return e.box(e.types.trun,l)},e.initSegment=function(t){e.types||e.init();var r=e.moov(t);return(t=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),t.set(r,e.FTYP.byteLength),t},e}();function R(e,t,r,n){return r=e*t*(r=void 0===r?1:r),(n=void 0!==n&&n)?Math.round(r):r}function C(e,t){return R(e,1e3,1/9e4,t=void 0!==t&&t)}function L(e,t){return R(e,9e4,1/(t=void 0===t?1:t))}var I=L(10),P=L(.2),D=null;function j(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;4294967296<Math.abs(e-t);)e+=r;return e}var M,N=function(){function e(e,t,r,n){this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===D&&(r=navigator.userAgent.match(/Chrome\/(\d+)/i),D=r?parseInt(r[1]):0)}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1;return e=e.reduce((function(e,r){var n=r.pts-e;return n<-4294967296?(t=!0,j(e,r.pts)):0<n?e:r.pts}),e[0].pts),t&&s.logger.debug("PTS rollover detected"),e},t.remux=function(e,t,r,i,a,o,c){var u,l,d,h,f,p;this.ISGenerated||this.generateIS(e,t,a),this.ISGenerated&&(f=e.samples.length,u=t.samples.length,d=l=a,f&&u&&(h=this.getVideoStartPts(t.samples),h=(j(e.samples[0].pts,h)-h)/t.inputTimeScale,l+=Math.max(0,h),d+=Math.max(0,-h)),f?(e.timescale||(s.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,a)),f=this.remuxAudio(e,l,o,c),u&&(f&&(p=f.endPTS-f.startPTS),t.timescale||(s.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,a)),this.remuxVideo(t,d,o,p))):!u||(c=this.remuxVideo(t,d,o,0,c))&&e.codec&&this.remuxEmptyAudio(e,l,o,c)),r.samples.length&&this.remuxID3(r,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(n.default.FRAG_PARSED)},t.generateIS=function(e,t,r){var a,o,c=this.observer,u=e.samples,l=t.samples,d=this.typeSupported,h="audio/mp4",f={},p={tracks:f},g=void 0===this._initPTS;g&&(o=a=1/0),e.config&&u.length&&(e.timescale=e.samplerate,s.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(d.mpeg?(h="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3")),f.audio={container:h,codec:e.codec,initSegment:!e.isAAC&&d.mpeg?new Uint8Array:x.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(o=a=u[0].pts-Math.round(e.inputTimeScale*r))),t.sps&&t.pps&&l.length?(e=t.inputTimeScale,t.timescale=e,f.video={container:"video/mp4",codec:t.codec,initSegment:x.initSegment([t]),metadata:{width:t.width,height:t.height}},g&&(t=this.getVideoStartPts(l),r=Math.round(e*r),a=Math.min(a,j(l[0].dts,t)-r),o=Math.min(o,t-r),this.observer.trigger(n.default.INIT_PTS_FOUND,{initPTS:o}))):g&&f.audio&&this.observer.trigger(n.default.INIT_PTS_FOUND,{initPTS:o}),Object.keys(f).length?(c.trigger(n.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,g&&(this._initPTS=o,this._initDTS=a)):c.trigger(n.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,r,a){var o,c,u=e.timescale,l=e.samples,d=[],h=l.length,f=this._initPTS,p=8,g=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=0,y=!1,b=this.nextAvcDts;if(0!==h){r||(b=t*u-(l[0].pts-j(l[0].dts,l[0].pts)));for(var _=0;_<h;_++){var w=l[_];w.pts=j(w.pts-f,b),w.dts=j(w.dts-f,b),w.dts>w.pts&&(v=Math.max(Math.min(v,w.pts-w.dts),-1*P)),w.dts<l[0<_?_-1:_].dts&&(y=!0)}y&&l.sort((function(e,t){var r=e.dts-t.dts,n=e.pts-t.pts;return r||n||e.id-t.id})),E=l[0].dts,t=l[h-1].dts;var E,S=Math.round((t-E)/(h-1));if(v<0){if(v<-2*S){s.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+C(-S,!0)+" ms");for(var T=v,k=0;k<h;k++)l[k].dts=T=Math.max(T,l[k].pts-S),l[k].pts=Math.max(T,l[k].pts)}else{s.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+C(v,!0)+" ms to overcome this issue");for(var O=0;O<h;O++)l[O].dts=l[O].dts+v}E=l[0].dts,t=l[h-1].dts}!r||((r=S<(B=E-b))||B<-1)&&(r?s.logger.warn("AVC: "+C(B,!0)+" ms ("+B+"dts) hole between fragments detected, filling it"):s.logger.warn("AVC: "+C(-B,!0)+" ms ("+B+"dts) overlapping between fragments detected"),r=l[0].pts-B,l[0].dts=E=b,l[0].pts=r,s.logger.log("Video: First PTS/DTS adjusted: "+C(r,!0)+"/"+C(E,!0)+", delta: "+C(B,!0)+" ms")),D&&D<75&&(E=Math.max(0,E));for(var A=0,R=0,L=0;L<h;L++){for(var I=l[L],M=I.units,N=M.length,F=0,U=0;U<N;U++)F+=M[U].data.length;R+=F,A+=N,I.length=F,I.dts=Math.max(I.dts,E),I.pts=Math.max(I.pts,I.dts,0),g=Math.min(I.pts,g),m=Math.max(I.pts,m)}t=l[h-1].dts;var B=R+4*A+8;try{c=new Uint8Array(B)}catch(e){return void this.observer.trigger(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating video mdat "+B})}var G,H=new DataView(c.buffer);H.setUint32(0,B),c.set(x.types.mdat,4);for(var z=0;z<h;z++){for(var K,q,V,W=l[z],Y=W.units,X=0,$=0,J=Y.length;$<J;$++){var Q=(Z=Y[$]).data,Z=Z.data.byteLength;H.setUint32(p,Z),p+=4,c.set(Q,p),p+=Z,X+=4+Z}z<h-1?o=l[z+1].dts-W.dts:(V=this.config,q=W.dts-l[0<z?z-1:z].dts,V.stretchShortVideoTrack?(V=V.maxBufferHole,Math.floor(V*u)<(V=(a?g+a*u:this.nextAudioPts)-W.pts)?((o=V-q)<0&&(o=q),s.logger.log("It is approximately "+C(V,!1)+" ms to the next segment; using duration "+C(o,!1)+" ms for the last video frame.")):o=q):o=q),K=Math.round(W.pts-W.dts),d.push({size:X,duration:o,cts:K,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:W.key?2:1,isNonSync:W.key?0:1}})}return this.nextAvcDts=t+o,t=e.dropped,e.nbNalu=0,e.dropped=0,d.length&&-1<navigator.userAgent.toLowerCase().indexOf("chrome")&&((G=d[0].flags).dependsOn=2,G.isNonSync=0),e.samples=d,G=x.moof(e.sequenceNumber++,E,e),e.samples=[],t={data1:G,data2:c,startPTS:g/u,endPTS:(m+o)/u,startDTS:E/u,endDTS:this.nextAvcDts/u,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:t},this.observer.trigger(n.default.FRAG_PARSING_DATA,t),t}},t.remuxAudio=function(e,t,r,a){var o,c,u,l,d=e.inputTimeScale,h=e.timescale,f=d/h,p=(e.isAAC?1024:1152)*f,g=this._initPTS,m=!e.isAAC&&this.typeSupported.mpeg,v=m?0:8,y=e.samples,b=[],_=this.nextAudioPts;if(r|=y.length&&_&&(a&&Math.abs(t-_/d)<.1||Math.abs(y[0].pts-_-g)<20*p),y.forEach((function(e){e.pts=e.dts=j(e.pts-g,t*d)})),0!==(y=y.filter((function(e){return 0<=e.pts}))).length){if(r||(_=a?Math.max(0,t*d):y[0].pts),e.isAAC)for(var w=this.config.maxAudioFramesDrift,E=0,S=_;E<y.length;){var T=y[E],k=T.pts,A=k-S;if(A<=-w*p)r||0<E?(s.logger.warn("Dropping 1 audio frame @ "+C(S,!0)/1e3+"s due to "+C(A,!0)+" ms overlap."),y.splice(E,1)):(s.logger.warn("Audio frame @ "+C(k,!0)/1e3+"s overlaps nextAudioPts by "+C(A,!0)+" ms."),S=k+p,E++);else if(w*p<=A&&A<I&&S){var R=Math.round(A/p);s.logger.warn("Injecting "+R+" audio frames @ "+C(S,!0)/1e3+"s due to "+C(A,!0)+" ms gap.");for(var L=0;L<R;L++){var P,D=Math.max(S,0);(P=O.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),P=T.unit.subarray()),y.splice(E,0,{unit:P,pts:D,dts:D}),S+=p,E++}T.pts=T.dts=S,S+=p,E++}else Math.abs(A),T.pts=T.dts=S,S+=p,E++}for(var M=y.length,N=0;M--;)N+=y[M].unit.byteLength;for(var F=0,U=y.length;F<U;F++){var B=(G=y[F]).unit,G=G.pts;if(void 0!==l&&o)o.duration=Math.round((G-l)/f);else{var H=G-_,z=0;if(r&&e.isAAC&&H){if(0<H&&H<I)z=Math.round((G-_)/p),s.logger.log(C(H,!0)+" ms hole between AAC samples detected,filling it"),0<z&&(N+=z*(P=(P=O.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||B.subarray()).length);else if(H<-12){s.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+C(_,!0)+" ms / "+C(G,!0)+" ms / "+C(-H,!0)+" ms"),N-=B.byteLength;continue}G=_}if(u=G,!(0<N))return;N+=v;try{c=new Uint8Array(N)}catch(e){return void this.observer.trigger(n.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating audio mdat "+N})}m||(new DataView(c.buffer).setUint32(0,N),c.set(x.types.mdat,4));for(var K=0;K<z;K++)(P=O.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(s.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),P=B.subarray()),c.set(P,v),v+=P.byteLength,o={size:P.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(o)}c.set(B,v),v+=H=B.byteLength,b.push(o={size:H,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}}),l=G}var q=0;return 2<=(M=b.length)&&(q=b[M-2].duration,o.duration=q),M?(this.nextAudioPts=_=l+f*q,e.samples=b,h=m?new Uint8Array:x.moof(e.sequenceNumber++,u/f,e),e.samples=[],q={data1:h,data2:c,startPTS:a=u/d,endPTS:q=_/d,startDTS:a,endDTS:q,type:"audio",hasAudio:!0,hasVideo:!1,nb:M},this.observer.trigger(n.default.FRAG_PARSING_DATA,q),q):null}},t.remuxEmptyAudio=function(e,t,r,n){var i=e.inputTimeScale,a=e.samplerate||i,o=this.nextAudioPts,c=(void 0!==o?o:n.startDTS*i)+this._initDTS,u=(n=n.endDTS*i+this._initDTS,i/a*1024),l=Math.ceil((n-c)/u),d=O.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(s.logger.warn("remux empty Audio"),d){for(var h=[],f=0;f<l;f++){var p=c+f*u;h.push({unit:d,pts:p,dts:p})}e.samples=h,this.remuxAudio(e,t,r)}else s.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e,t){var r=e.samples.length;if(r){for(var i=e.inputTimeScale,a=this._initPTS,o=this._initDTS,s=0;s<r;s++){var c=e.samples[s];c.pts=j(c.pts-a,t*i)/i,c.dts=j(c.dts-o,t*i)/i}this.observer.trigger(n.default.FRAG_PARSING_METADATA,{samples:e.samples}),e.samples=[]}},t.remuxText=function(e,t){var r=e.samples.length,i=e.inputTimeScale,a=this._initPTS;if(r){for(var o=0;o<r;o++){var s=e.samples[o];s.pts=j(s.pts-a,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts})),this.observer.trigger(n.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e}(),F=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,r,i,a,o,s,c){var u=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),u.trigger(n.default.FRAG_PARSING_DATA,{data1:c,startPTS:a,startDTS:a,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(n.default.FRAG_PARSED)},e}();c=Object(c.getSelfScope)();try{M=c.performance.now.bind(c.performance)}catch(e){s.logger.debug("Unable to use Performance API on this environment"),M=c.Date.now}t.default=function(){function e(e,t,r,n){this.observer=e,this.typeSupported=t,this.config=r,this.vendor=n}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,r,i,o,s,c,u,l,d,h,f){var p,g,m=this;0<e.byteLength&&null!=t&&null!=t.key&&"AES-128"===t.method?(null==(p=this.decrypter)&&(p=this.decrypter=new a.default(this.observer,this.config)),g=M(),p.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var a=M();m.observer.trigger(n.default.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:a}}),m.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),i,o,s,c,u,l,d,h,f)}))):this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),i,o,s,c,u,l,d,h,f)},t.pushDecrypted=function(e,t,r,a,o,s,c,u,l,d,h,f){var p=this.demuxer,g=this.remuxer;if(!p||c||u){for(var m,b=this.observer,_=this.typeSupported,w=this.config,E=[{demux:T,remux:N},{demux:y.default,remux:F},{demux:v,remux:N},{demux:k,remux:N}],S=0,O=E.length;S<O&&!(m=E[S]).demux.probe(e);S++);if(!m)return void b.trigger(n.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});g&&g instanceof m.remux||(g=new m.remux(b,w,_,this.vendor)),p&&p instanceof m.demux||(p=new m.demux(b,g,w,_),this.probe=m.demux.probe),this.demuxer=p,this.remuxer=g}(c||u)&&(p.resetInitSegment(r,a,o,d),g.resetInitSegment()),c&&(p.resetTimeStamp(f),g.resetTimeStamp(f)),"function"==typeof p.setDecryptData&&p.setDecryptData(t),p.append(e,s,l,h)},e}()},"./src/demux/demuxer-worker.js":function(e,t,r){"use strict";r.r(t);var n=r("./src/demux/demuxer-inline.js"),i=r("./src/events.js"),a=r("./src/utils/logger.js"),o=r("./node_modules/eventemitter3/index.js");t.default=function(e){var t=new o.EventEmitter;function r(t,r){e.postMessage({event:t,data:r})}t.trigger=function(e){for(var r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(n))},t.off=function(e){for(var r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(n))},e.addEventListener("message",(function(i){var o=i.data;switch(o.cmd){case"init":var s=JSON.parse(o.config);e.demuxer=new n.default(t,o.typeSupported,s,o.vendor),Object(a.enableLogs)(s.debug),r("init",null);break;case"demux":e.demuxer.push(o.data,o.decryptdata,o.initSegment,o.audioCodec,o.videoCodec,o.timeOffset,o.discontinuity,o.trackSwitch,o.contiguous,o.duration,o.accurateTimeOffset,o.defaultInitPTS)}})),t.on(i.default.FRAG_DECRYPTED,r),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,r),t.on(i.default.FRAG_PARSED,r),t.on(i.default.ERROR,r),t.on(i.default.FRAG_PARSING_METADATA,r),t.on(i.default.FRAG_PARSING_USERDATA,r),t.on(i.default.INIT_PTS_FOUND,r),t.on(i.default.FRAG_PARSING_DATA,(function(t,r){var n=[];t={event:t,data:r},r.data1&&(t.data1=r.data1.buffer,n.push(r.data1.buffer),delete r.data1),r.data2&&(t.data2=r.data2.buffer,n.push(r.data2.buffer),delete r.data2),e.postMessage(t,n)}))}},"./src/demux/id3.js":function(e,t,r){"use strict";r.r(t),r.d(t,"utf8ArrayToStr",(function(){return a}));var n,i=r("./src/utils/get-self-scope.js"),a=(r=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,r){for(var n=r,i=0;e.isHeader(t,r);)i+=10,i+=e._readSize(t,r+6),e.isFooter(t,r+10)&&(i+=10),r+=i;if(0<i)return t.subarray(n,n+i)},e._readSize=function(e,t){var r=(127&e[t])<<21;return r|=(127&e[t+1])<<14,(r|=(127&e[t+2])<<7)|127&e[t+3]},e.getTimeStamp=function(t){for(var r=e.getID3Frames(t),n=0;n<r.length;n++){var i=r[n];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var r=String.fromCharCode(t[0],t[1],t[2],t[3]),n=e._readSize(t,4);return{type:r,size:n,data:t.subarray(10,10+n)}},e.getID3Frames=function(t){for(var r=0,n=[];e.isHeader(t,r);){for(var i=e._readSize(t,r+6),a=(r+=10)+i;r+8<a;){var o=e._getFrameData(t.subarray(r)),s=e._decodeFrame(o);s&&n.push(s),r+=o.size+10}e.isFooter(t,r)&&(r+=10)}return n},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):e._decodeTextFrame(t)},e._readTimeStamp=function(e){if(8===e.data.byteLength){e=1&(t=new Uint8Array(e.data))[3];var t=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return t/=45,e&&(t+=47721858.84),Math.round(t)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var r=e._utf8ArrayToStr(t.data,!0),n=new Uint8Array(t.data.subarray(r.length+1));return{key:t.type,info:r,data:n.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var r=1,n=e._utf8ArrayToStr(t.data.subarray(1),!0);return r+=n.length+1,r=e._utf8ArrayToStr(t.data.subarray(r)),{key:t.type,info:n,data:r}}return r=e._utf8ArrayToStr(t.data.subarray(1)),{key:t.type,data:r}}},e._decodeURLFrame=function(t){if("WXXX"!==t.type){var r=e._utf8ArrayToStr(t.data);return{key:t.type,data:r}}if(!(t.size<2)){var n=1;return n+=(r=e._utf8ArrayToStr(t.data.subarray(1),!0)).length+1,n=e._utf8ArrayToStr(t.data.subarray(n)),{key:t.type,info:r,data:n}}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var r=function(){var e=Object(i.getSelfScope)();return n||void 0===e.TextDecoder||(n=new e.TextDecoder("utf-8")),n}();if(r){var a=r.decode(e);return t?-1!==(r=a.indexOf("\0"))?a.substring(0,r):a:a.replace(/\0/g,"")}for(var o,s,c,u=e.length,l="",d=0;d<u;){if(0===(o=e[d++])&&t)return l;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(o);break;case 12:case 13:s=e[d++],l+=String.fromCharCode((31&o)<<6|63&s);break;case 14:s=e[d++],c=e[d++],l+=String.fromCharCode((15&o)<<12|(63&s)<<6|(63&c)<<0)}}return l},e}(),r._utf8ArrayToStr);t.default=r},"./src/demux/mp4demuxer.js":function(e,t,r){"use strict";r.r(t);var n=r("./src/utils/logger.js"),i=r("./src/events.js"),a=Math.pow(2,32)-1;t.default=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,r,n,a){var o,s;t&&t.byteLength?(null==r&&(r="mp4a.40.5"),null==n&&(n="avc1.42e01e"),s={},(o=this.initData=e.parseInitSegment(t)).audio&&o.video?s.audiovideo={container:"video/mp4",codec:r+","+n,initSegment:a?t:null}:(o.audio&&(s.audio={container:"audio/mp4",codec:r,initSegment:a?t:null}),o.video&&(s.video={container:"video/mp4",codec:n,initSegment:a?t:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:s})):(r&&(this.audioCodec=r),n&&(this.videoCodec=n))},e.probe=function(t){return 0<e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){return e.data&&(t+=e.start,e=e.data),(t=e[t]<<8|e[t+1])<0?65536+t:t},e.readUint32=function(e,t){return e.data&&(t+=e.start,e=e.data),(t=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])<0?4294967296+t:t},e.writeUint32=function(e,t,r){e.data&&(t+=e.start,e=e.data),e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},e.findBox=function(t,r){var n,i,a,o,s,c=[];if(t.data?(o=t.start,i=t.end,t=t.data):(o=0,i=t.byteLength),!r.length)return null;for(n=o;n<i;)s=1<(a=e.readUint32(t,n))?n+a:i,e.bin2str(t.subarray(n+4,n+8))===r[0]&&(1===r.length?c.push({data:t,start:n+8,end:s}):(a=e.findBox({data:t,start:n+8,end:s},r.slice(1))).length&&(c=c.concat(a))),n=s;return c},e.parseSegmentIndex=function(t){var r=(r=e.findBox(t,["moov"])[0])?r.end:null,n=0,i=e.findBox(t,["sidx"]);if(!i||!i[0])return null;var a=[],o=(t=(i=i[0]).data[0],e.readUint32(i,n=0===t?8:16));n+=4,n+=0===t?8:16;var s=i.end+0,c=e.readUint16(i,n+=2);n+=2;for(var u=0;u<c;u++){var l=n,d=e.readUint32(i,l);l+=4;var h=2147483647&d;if(1==(2147483648&d)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");d=e.readUint32(i,l),l+=4,a.push({referenceSize:h,subsegmentDuration:d,info:{duration:d/o,start:s,end:s+h-1}}),s+=h,n=l+=4}return{earliestPresentationTime:0,timescale:o,version:t,referencesCount:c,references:a,moovEndOffset:r}},e.parseInitSegment=function(t){var r=[];return e.findBox(t,["moov","trak"]).forEach((function(t){var i,a,o=e.findBox(t,["tkhd"])[0];o&&(a=o.data[o.start],i=e.readUint32(o,0===a?12:20),(o=e.findBox(t,["mdia","mdhd"])[0])&&(a=o.data[o.start],o=e.readUint32(o,0===a?12:20),!(a=e.findBox(t,["mdia","hdlr"])[0])||(a={soun:"audio",vide:"video"}[e.bin2str(a.data.subarray(a.start+8,a.start+12))])&&((t=e.findBox(t,["mdia","minf","stbl","stsd"])).length&&(t=t[0],t=e.bin2str(t.data.subarray(t.start+12,t.start+16)),n.logger.log("MP4Demuxer:"+a+":"+t+" found")),r[i]={timescale:o,type:a},r[a]={timescale:o,id:i})))})),r},e.getStartDTS=function(t,r){return r=e.findBox(r,["moof","traf"]),r=[].concat.apply([],r.map((function(r){return e.findBox(r,["tfhd"]).map((function(n){return n=e.readUint32(n,4),n=t[n].timescale||9e4,e.findBox(r,["tfdt"]).map((function(t){var r=t.data[t.start],n=e.readUint32(t,4);return 1===r&&(n*=Math.pow(2,32),n+=e.readUint32(t,8)),n}))[0]/n}))}))),r=Math.min.apply(null,r),isFinite(r)?r:0},e.offsetStartDTS=function(t,r,n){e.findBox(r,["moof","traf"]).map((function(r){return e.findBox(r,["tfhd"]).map((function(i){i=e.readUint32(i,4);var o=t[i].timescale||9e4;e.findBox(r,["tfdt"]).map((function(t){var r=t.data[t.start],i=e.readUint32(t,4);0===r?e.writeUint32(t,4,i-n*o):(i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=n*o,i=Math.max(i,0),r=Math.floor(i/(1+a)),i=Math.floor(i%(1+a)),e.writeUint32(t,4,r),e.writeUint32(t,8,i))}))}))}))},t.append=function(t,r,n,a){var o=this.initData;o||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),o=this.initData);var s,c=this.initPTS;void 0===c&&(s=e.getStartDTS(o,t),this.initPTS=c=s-r,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:c})),e.offsetStartDTS(o,t,c),c=e.getStartDTS(o,t),this.remuxer.remux(o.audio,o.video,null,null,c,n,a,t)},t.destroy=function(){},e}()},"./src/errors.ts":function(e,t,r){"use strict";var n,i;r.r(t),r.d(t,"ErrorTypes",(function(){return n})),r.d(t,"ErrorDetails",(function(){return i})),(t=n=n||{}).NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",(t=i=i||{}).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException"},"./src/events.js":function(e,t,r){"use strict";r.r(t),t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Jt}));var n={};r.r(n),r.d(n,"newCue",(function(){return lt}));var i,a,o=r("./node_modules/url-toolkit/src/url-toolkit.js"),s=r("./src/errors.ts"),c=r("./src/polyfills/number.js"),u=r("./src/events.js"),l=r("./src/utils/logger.js"),d={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if(d[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)}),this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}),this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){try{(function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)}).call(this,e,t).call()}catch(t){l.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}();(Ye=i=i||{}).MANIFEST="manifest",Ye.LEVEL="level",Ye.AUDIO_TRACK="audioTrack",Ye.SUBTITLE_TRACK="subtitleTrack",($e=a=a||{}).MAIN="main",$e.AUDIO="audio",$e.SUBTITLE="subtitle";var f=r("./src/demux/mp4demuxer.js");function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g,m=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}var t,r,n;return t=e,(r=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(o.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&p(t.prototype,r),n&&p(t,n),e}();function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(et=g=g||{}).AUDIO="audio",et.VIDEO="video";var y=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[g.AUDIO]=!1,e[g.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t,r,n=e.prototype;return n.setByteRange=function(e,t){var r=e.split("@",2);e=[],1===r.length?e[0]=t?t.byteRangeEndOffset:0:e[0]=parseInt(r[1]),e[1]=parseInt(r[0])+e[0],this._byteRange=e},n.addElementaryStream=function(e){this._elementaryStreams[e]=!0},n.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},n.createInitializationVector=function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t},n.setDecryptDataFromLevelKey=function(e,t){var r=e;return null!=e&&e.method&&e.uri&&!e.iv&&((r=new m(e.baseuri,e.reluri)).method=e.method,r.iv=this.createInitializationVector(t)),r},t=e,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(o.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange||[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this.levelkey||this._decryptdata?(!this._decryptdata&&this.levelkey&&("number"!=typeof(e=this.sn)&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&l.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)),this._decryptdata):null;var e}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(c.isFiniteNumber)(this.programDateTime))return null;var e=Object(c.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&v(t.prototype,n),r&&v(t,r),e}();function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var _=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}var t,r,n;return t=e,(r=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(c.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&b(t.prototype,r),n&&b(t,n),e}(),w=/^(\d+)x(\d+)$/,E=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,S=function(){function e(t){for(var r in t="string"==typeof t?e.parseAttrList(t):t)t.hasOwnProperty(r)&&(this[r]=t[r])}var t=e.prototype;return t.decimalInteger=function(e){return(e=parseInt(this[e],10))>Number.MAX_SAFE_INTEGER?1/0:e},t.hexadecimalInteger=function(e){if(this[e]){for(var t=(1&(t=(this[e]||"0x").slice(2)).length?"0":"")+t,r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function(e){return(e=parseInt(this[e],16))>Number.MAX_SAFE_INTEGER?1/0:e},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){if(null!==(e=w.exec(this[e])))return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},e.parseAttrList=function(e){var t,r={};for(E.lastIndex=0;null!==(t=E.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[t[1]]=n}return r},e}(),T={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function k(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var O=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,A=/#EXT-X-MEDIA:(.*)/g,x=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),R=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,C=/\.(mp4|m4s|m4v|m4a)$/i,L=function(){function e(){}return e.findGroup=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.id===t)return n}},e.convertAVC1ToAVCOTI=function(e){var t,r=e.split(".");return 2<r.length?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return o.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,r){var n,i,a,o,s=[],c={},u=!1;function l(e,t){["video","audio"].forEach((function(r){var n,i=e.filter((function(e){return t=e,!!(e=T[e=r])&&!0===e[t.slice(0,4)];var t}));i.length&&(n=i.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)})),t[r+"Codec"]=(0<n.length?n:i)[0],e=e.filter((function(e){return-1===i.indexOf(e)})))})),t.unknownCodecs=e}for(O.lastIndex=0;null!=(o=O.exec(t));)o[1]?(i=(n={}).attrs=new S(o[1]),n.url=e.resolve(o[2],r),(a=i.decimalResolution("RESOLUTION"))&&(n.width=a.width,n.height=a.height),n.bitrate=i.decimalInteger("AVERAGE-BANDWIDTH")||i.decimalInteger("BANDWIDTH"),n.name=i.NAME,l([].concat((i.CODECS||"").split(/[ ,]+/)),n),n.videoCodec&&-1!==n.videoCodec.indexOf("avc1")&&(n.videoCodec=e.convertAVC1ToAVCOTI(n.videoCodec)),s.push(n)):!o[3]||(o=new S(o[3]))["DATA-ID"]&&(u=!0,c[o["DATA-ID"]]=o);return{levels:s,sessionData:u?c:null}},e.parseMasterPlaylistMedia=function(t,r,n,i){void 0===i&&(i=[]);var a=[],o=0;for(A.lastIndex=0;null!==(s=A.exec(t));){var s,c=new S(s[1]);c.TYPE===n&&(s={attrs:c,id:o++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE,type:n,default:"YES"===c.DEFAULT,autoselect:"YES"===c.AUTOSELECT,forced:"YES"===c.FORCED,lang:c.LANGUAGE},c.URI&&(s.url=e.resolve(c.URI,r)),i.length&&(c=e.findGroup(i,s.groupId),s.audioCodec=(c||i[0]).codec),a.push(s))}return a},e.parseLevelPlaylist=function(e,t,r,n,i){var a,o,s,u=0,d=0,h=new _(t),f=0,p=null,g=new y,v=null;for(x.lastIndex=0;null!==(a=x.exec(e));){var b=a[1];if(b){g.duration=parseFloat(b);var w=(" "+a[2]).slice(1);g.title=w||null,g.tagList.push(w?["INF",b,w]:["INF",b])}else if(a[3])Object(c.isFiniteNumber)(g.duration)&&(E=u++,g.type=n,g.start=d,s&&(g.levelkey=s),g.sn=E,g.level=r,g.cc=f,g.urlId=i,g.baseurl=t,g.relurl=(" "+a[3]).slice(1),function(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Object(c.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}(g,p),h.fragments.push(g),d+=(p=g).duration,g=new y);else if(a[4]){var E=(" "+a[4]).slice(1);p?g.setByteRange(E,p):g.setByteRange(E)}else if(a[5])g.rawProgramDateTime=(" "+a[5]).slice(1),g.tagList.push(["PROGRAM-DATE-TIME",g.rawProgramDateTime]),null===v&&(v=h.fragments.length);else if(a=a[0].match(R)){for(o=1;o<a.length&&void 0===a[o];o++);var T=(" "+a[o+1]).slice(1),k=(" "+a[o+2]).slice(1);switch(a[o]){case"#":g.tagList.push(k?[T,k]:[T]);break;case"PLAYLIST-TYPE":h.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":u=h.startSN=parseInt(T);break;case"TARGETDURATION":h.targetduration=parseFloat(T);break;case"VERSION":h.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":f++,g.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":f=parseInt(T);break;case"KEY":var O=new S(T),A=O.enumeratedString("METHOD"),L=O.URI,I=O.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(O.KEYFORMAT||"identity")){l.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}A&&(s=new m(t,L),L&&0<=["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(A)&&(s.method=A,s.key=null,s.iv=I));break;case"START":var P=new S(T).decimalFloatingPoint("TIME-OFFSET");Object(c.isFiniteNumber)(P)&&(h.startTimeOffset=P);break;case"MAP":P=new S(T),g.relurl=P.URI,P.BYTERANGE&&g.setByteRange(P.BYTERANGE),g.baseurl=t,g.level=r,g.type=n,g.sn="initSegment",h.initSegment=g,(g=new y).rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:l.logger.warn("line parsed but not handled: "+a)}}else l.logger.warn("No matches on slow regex match for level playlist!")}return(g=p)&&!g.relurl&&(h.fragments.pop(),d-=g.duration),h.totalduration=d,h.averagetargetduration=d/h.fragments.length,h.endSN=u-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=f,!h.initSegment&&h.fragments.length&&h.fragments.every((function(e){return C.test(e.relurl)}))&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(g=new y).relurl=h.fragments[0].relurl,g.baseurl=t,g.level=r,g.type=n,g.sn="initSegment",h.initSegment=g,h.needSidxRanges=!0),v&&function(e,t){for(var r=e[t],n=t-1;0<=n;n--){var i=e[n];i.programDateTime=r.programDateTime-1e3*i.duration,r=i}}(h.fragments,v),h},e}(),I=window.performance,P=function(e){var t;function r(t){return(t=e.call(this,t,u.default.MANIFEST_LOADING,u.default.LEVEL_LOADING,u.default.AUDIO_TRACK_LOADING,u.default.SUBTITLE_TRACK_LOADING)||this).loaders={},t}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n,r.canHaveQualityLevels=function(e){return e!==i.AUDIO_TRACK&&e!==i.SUBTITLE_TRACK},r.mapContextToLevelType=function(e){switch(e.type){case i.AUDIO_TRACK:return a.AUDIO;case i.SUBTITLE_TRACK:return a.SUBTITLE;default:return a.MAIN}},r.getResponseUrl=function(e,t){return void 0===(e=e.url)||0===e.indexOf("data:")?t.url:e};var n=r.prototype;return n.createInternalLoader=function(e){var t=(n=this.hls.config).pLoader,r=n.loader,n=new(t||r)(n);return e.loader=n,this.loaders[e.type]=n},n.getInternalLoader=function(e){return this.loaders[e.type]},n.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},n.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},n.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},n.onManifestLoading=function(e){this.load({url:e.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},n.onLevelLoading=function(e){this.load({url:e.url,type:i.LEVEL,level:e.level,id:e.id,responseType:"text"})},n.onAudioTrackLoading=function(e){this.load({url:e.url,type:i.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},n.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:i.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},n.load=function(e){var t,r,n,a,o=this.hls.config;if(l.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id),s=this.getInternalLoader(e)){if((u=s.context)&&u.url===e.url)return l.logger.trace("playlist request ongoing"),!1;l.logger.warn("aborting previous loader for type: "+e.type),s.abort()}switch(e.type){case i.MANIFEST:t=o.manifestLoadingMaxRetry,r=o.manifestLoadingTimeOut,n=o.manifestLoadingRetryDelay,a=o.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:n=a=t=0,r=o.levelLoadingTimeOut;break;default:t=o.levelLoadingMaxRetry,r=o.levelLoadingTimeOut,n=o.levelLoadingRetryDelay,a=o.levelLoadingMaxRetryTimeout}var s=this.createInternalLoader(e),c={timeout:r,maxRetry:t,retryDelay:n,maxRetryDelay:a},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return l.logger.debug("Calling internal loader delegate for URL: "+e.url),s.load(e,c,u),!0},n.loadsuccess=function(e,t,r,n){if(void 0===n&&(n=null),r.isSidxRequest)return this._handleSidxRequest(e,r),void this._handlePlaylistLoaded(e,t,r,n);if(this.resetInternalLoader(r.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=e.data;t.tload=I.now(),0===i.indexOf("#EXTM3U")?0<i.indexOf("#EXTINF:")||0<i.indexOf("#EXT-X-TARGETDURATION:")?this._handleTrackOrLevelPlaylist(e,t,r,n):this._handleMasterPlaylist(e,t,r,n):this._handleManifestParsingError(e,r,"no EXTM3U delimiter",n)},n.loaderror=function(e,t,r){this._handleNetworkError(t,r=void 0===r?null:r,!1,e)},n.loadtimeout=function(e,t,r){this._handleNetworkError(t,r=void 0===r?null:r,!0)},n._handleMasterPlaylist=function(e,t,n,i){var a,o,s=this.hls,c=e.data,d=r.getResponseUrl(e,n),h=L.parseMasterPlaylist(c,d),f=h.levels,p=h.sessionData;f.length?(a=f.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),h=L.parseMasterPlaylistMedia(c,d,"AUDIO",a),a=L.parseMasterPlaylistMedia(c,d,"SUBTITLES"),c=L.parseMasterPlaylistMedia(c,d,"CLOSED-CAPTIONS"),h.length&&(o=!1,h.forEach((function(e){e.url||(o=!0)})),!1===o&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(l.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))),s.trigger(u.default.MANIFEST_LOADED,{levels:f,audioTracks:h,subtitles:a,captions:c,url:d,stats:t,networkDetails:i,sessionData:p})):this._handleManifestParsingError(e,n,"no level found in manifest",i)},n._handleTrackOrLevelPlaylist=function(e,t,n,a){var o=this.hls,l=n.id,d=n.level,h=n.type,f=r.getResponseUrl(e,n),p=Object(c.isFiniteNumber)(l)?l:0,g=Object(c.isFiniteNumber)(d)?d:p,m=r.mapContextToLevelType(n);(m=L.parseLevelPlaylist(e.data,f,g,m,p)).tload=t.tload,m.fragments.length?(h===i.MANIFEST&&o.trigger(u.default.MANIFEST_LOADED,{levels:[{url:f,details:m}],audioTracks:[],url:f,stats:t,networkDetails:a,sessionData:null}),t.tparsed=I.now(),m.needSidxRanges?(p=m.initSegment.url,this.load({url:p,isSidxRequest:!0,type:h,level:d,levelDetails:m,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})):(n.levelDetails=m,this._handlePlaylistLoaded(e,t,n,a))):o.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},n._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var r,n=f.default.parseSegmentIndex(new Uint8Array(e.data));n&&(e=n.references,r=t.levelDetails,e.forEach((function(e,t){e=e.info,!r||0===(t=r.fragments[t]).byteRange.length&&t.setByteRange(String(1+e.end-e.start)+"@"+String(e.start))})),r&&r.initSegment.setByteRange(String(n.moovEndOffset)+"@0"))},n._handleManifestParsingError=function(e,t,r,n){this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:r,networkDetails:n})},n._handleNetworkError=function(e,t,r,n){var a,o;void 0===r&&(r=!1),void 0===n&&(n=null),l.logger.info("A network error occured while loading a "+e.type+"-type playlist");var c=this.getInternalLoader(e);switch(e.type){case i.MANIFEST:a=r?s.ErrorDetails.MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.MANIFEST_LOAD_ERROR,o=!0;break;case i.LEVEL:a=r?s.ErrorDetails.LEVEL_LOAD_TIMEOUT:s.ErrorDetails.LEVEL_LOAD_ERROR,o=!1;break;case i.AUDIO_TRACK:a=r?s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,o=!1;break;default:o=!1}c&&(c.abort(),this.resetInternalLoader(e.type)),t={type:s.ErrorTypes.NETWORK_ERROR,details:a,fatal:o,url:e.url,loader:c,context:e,networkDetails:t},n&&(t.response=n),this.hls.trigger(u.default.ERROR,t)},n._handlePlaylistLoaded=function(e,t,n,a){var o=n.type,s=n.level,c=n.id,l=n.levelDetails;if(l&&l.targetduration)if(r.canHaveQualityLevels(n.type))this.hls.trigger(u.default.LEVEL_LOADED,{details:l,level:s||0,id:c||0,stats:t,networkDetails:a});else switch(o){case i.AUDIO_TRACK:this.hls.trigger(u.default.AUDIO_TRACK_LOADED,{details:l,id:c,stats:t,networkDetails:a});break;case i.SUBTITLE_TRACK:this.hls.trigger(u.default.SUBTITLE_TRACK_LOADED,{details:l,id:c,stats:t,networkDetails:a})}else this._handleManifestParsingError(e,n,"invalid target duration",a)},r}(h),D=function(e){var t;function r(t){return(t=e.call(this,t,u.default.FRAG_LOADING)||this).loaders={},t}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.destroy=function(){var t,r=this.loaders;for(t in r){var n=r[t];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},n.onFragLoading=function(e){var t=(o=e.frag).type,r=this.loaders,n=this.hls.config,i=n.fLoader,a=n.loader;o.loaded=0,(e=r[t])&&(l.logger.warn("abort previous fragment loader for type: "+t),e.abort()),e=r[t]=o.loader=new(n.fLoader?i:a)(n),i={url:o.url,frag:o,responseType:"arraybuffer",progressData:!1},a=o.byteRangeStartOffset;var o=o.byteRangeEndOffset;Object(c.isFiniteNumber)(a)&&Object(c.isFiniteNumber)(o)&&(i.rangeStart=a,i.rangeEnd=o),o={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},e.load(i,o,n)},n.loadsuccess=function(e,t,r,n){void 0===n&&(n=null),e=e.data,(r=r.frag).loader=void 0,this.loaders[r.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:e,frag:r,stats:t,networkDetails:n})},n.loaderror=function(e,t,r){void 0===r&&(r=null);var n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]=void 0,this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:r})},n.loadtimeout=function(e,t,r){void 0===r&&(r=null);var n=t.frag,i=n.loader;i&&i.abort(),this.loaders[n.type]=void 0,this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:r})},n.loadprogress=function(e,t,r,n){void 0===n&&(n=null),(t=t.frag).loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:t,stats:e,networkDetails:n})},r}(h),j=function(e){var t;function r(t){return(t=e.call(this,t,u.default.KEY_LOADING)||this).loaders={},t.decryptkey=null,t.decrypturl=null,t}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.destroy=function(){for(var t in this.loaders)(t=this.loaders[t])&&t.destroy();this.loaders={},e.prototype.destroy.call(this)},n.onKeyLoading=function(e){var t,r=e.frag,n=r.type,i=this.loaders[n];r.decryptdata?(t=r.decryptdata.uri)!==this.decrypturl||null===this.decryptkey?(e=this.hls.config,i&&(l.logger.warn("abort previous key loader for type:"+n),i.abort()),t?(r.loader=this.loaders[n]=new e.loader(e),this.decrypturl=t,this.decryptkey=null,n={url:t,frag:r,responseType:"arraybuffer"},t={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:e.fragLoadingRetryDelay,maxRetryDelay:e.fragLoadingMaxRetryTimeout},e={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.loader.load(n,t,e)):l.logger.warn("key uri is falsy")):this.decryptkey&&(r.decryptdata.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:r})):l.logger.warn("Missing decryption data on fragment in onKeyLoading")},n.loadsuccess=function(e,t,r){(r=r.frag).decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,delete this.loaders[r.type],this.hls.trigger(u.default.KEY_LOADED,{frag:r})):l.logger.error("after key load, decryptdata unset")},n.loaderror=function(e,t){var r=t.frag;(t=r.loader)&&t.abort(),delete this.loaders[r.type],this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})},n.loadtimeout=function(e,t){var r=t.frag;(t=r.loader)&&t.abort(),delete this.loaders[r.type],this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},r}(h),M="NOT_LOADED",N="APPENDING",F="PARTIAL",U="OK",B=function(e){var t;function r(t){var r=e.call(this,t,u.default.BUFFER_APPENDED,u.default.FRAG_BUFFERED,u.default.FRAG_LOADED)||this;return r.bufferPadding=.2,r.fragments=Object.create(null),r.timeRanges=Object.create(null),r.config=t.config,r}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,h.prototype.destroy.call(this),e.prototype.destroy.call(this)},n.getBufferedFrag=function(e,t){var r=this.fragments,n=Object.keys(r).filter((function(n){return(n=r[n]).body.type===t&&!!n.buffered&&(n=n.body).startPTS<=e&&e<=n.endPTS}));return 0===n.length?null:(n=n.pop(),r[n].body)},n.detectEvictedFragments=function(e,t){var r=this;Object.keys(this.fragments).forEach((function(n){var i=r.fragments[n];if(i&&i.buffered&&(n=i.range[e]))for(var a=n.time,o=0;o<a.length;o++){var s=a[o];if(!r.isTimeBuffered(s.startPTS,s.endPTS,t)){r.removeFragment(i.body);break}}}))},n.detectPartialFragments=function(e){var t=this,r=this.getFragmentKey(e),n=this.fragments[r];n&&(n.buffered=!0,Object.keys(this.timeRanges).forEach((function(r){var i;e.hasElementaryStream(r)&&(i=t.timeRanges[r],n.range[r]=t.getBufferedTimes(e.startPTS,e.endPTS,i))})))},n.getBufferedTimes=function(e,t,r){for(var n,i,a=[],o=!1,s=0;s<r.length;s++){if(n=r.start(s)-this.bufferPadding,i=r.end(s)+this.bufferPadding,n<=e&&t<=i){a.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))});break}if(e<i&&n<t)a.push({startPTS:Math.max(e,r.start(s)),endPTS:Math.min(t,r.end(s))}),o=!0;else if(t<=n)break}return{time:a,partial:o}},n.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},n.getPartialFragment=function(e){var t,r,n=this,i=null,a=0;return Object.keys(this.fragments).forEach((function(o){o=n.fragments[o],n.isPartial(o)&&(t=o.body.startPTS-n.bufferPadding,r=o.body.endPTS+n.bufferPadding,t<=e&&e<=r&&(r=Math.min(e-t,r-e),a<=r&&(i=o.body,a=r)))})),i},n.getState=function(e){var t=this.getFragmentKey(e);return e=this.fragments[t],t=M,void 0!==e?e.buffered?!0===this.isPartial(e)?F:U:N:t},n.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},n.isTimeBuffered=function(e,t,r){for(var n,i,a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,n<=e&&t<=i)return!0;if(t<=n)return!1}return!1},n.onFragLoaded=function(e){e=e.frag,Object(c.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.fragments[this.getFragmentKey(e)]={body:e,range:Object.create(null),buffered:!1})},n.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(e){var r=t.timeRanges[e];t.detectEvictedFragments(e,r)}))},n.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},n.hasFragment=function(e){return e=this.getFragmentKey(e),void 0!==this.fragments[e]},n.removeFragment=function(e){e=this.getFragmentKey(e),delete this.fragments[e]},n.removeAllFragments=function(){this.fragments=Object.create(null)},r}(h),G={search:function(e,t){for(var r=0,n=e.length-1,i=null,a=null;r<=n;){var o=t(a=e[i=(r+n)/2|0]);if(0<o)r=1+i;else{if(!(o<0))return a;n=i-1}}return null}},H=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var r=e.buffered,n=0;n<r.length;n++)if(t>=r.start(n)&&t<=r.end(n))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,r){try{if(e){for(var n=e.buffered,i=[],a=0;a<n.length;a++)i.push({start:n.start(a),end:n.end(a)});return this.bufferedInfo(i,t,r)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,r){e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var n=[];if(r)for(var i=0;i<e.length;i++){var a,o=n.length;o?(a=n[o-1].end,e[i].start-a<r?e[i].end>a&&(n[o-1].end=e[i].end):n.push(e[i])):n.push(e[i])}else n=e;for(var s,c=0,u=t,l=t,d=0;d<n.length;d++){var h=n[d].start,f=n[d].end;if(h<=t+r&&t<f)u=h,c=(l=f)-t;else if(t+r<h){s=h;break}}return{len:c,start:u,end:l,nextStart:s}},e}(),z=r("./node_modules/eventemitter3/index.js"),K=r("./node_modules/webworkify-webpack/index.js"),q=r("./src/demux/demuxer-inline.js");function V(){return window.MediaSource||window.WebKitMediaSource}var W=r("./src/utils/get-self-scope.js"),Y=function(e){var t,r;function n(){return e.apply(this,arguments)||this}return r=e,(t=n).prototype=Object.create(r.prototype),(t.prototype.constructor=t).__proto__=r,n.prototype.trigger=function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e,e].concat(r))},n}(z.EventEmitter),X=Object(W.getSelfScope)(),$=V()||{isTypeSupported:function(){return!1}},J=function(){function e(e,t){var r=this;this.hls=e,this.id=t;var n=this.observer=new Y,i=e.config,a=function(t,n){(n=n||{}).frag=r.frag,n.id=r.id,e.trigger(t,n)};n.on(u.default.FRAG_DECRYPTED,a),n.on(u.default.FRAG_PARSING_INIT_SEGMENT,a),n.on(u.default.FRAG_PARSING_DATA,a),n.on(u.default.FRAG_PARSED,a),n.on(u.default.ERROR,a),n.on(u.default.FRAG_PARSING_METADATA,a),n.on(u.default.FRAG_PARSING_USERDATA,a),n.on(u.default.INIT_PTS_FOUND,a);var o,c={mp4:$.isTypeSupported("video/mp4"),mpeg:$.isTypeSupported("audio/mpeg"),mp3:$.isTypeSupported('audio/mp4; codecs="mp3"')};if(a=navigator.vendor,i.enableWorker&&"undefined"!=typeof Worker){l.logger.log("demuxing in webworker");try{o=this.w=K("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(t){e.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},o.postMessage({cmd:"init",typeSupported:c,vendor:a,id:t,config:JSON.stringify(i)})}catch(t){l.logger.warn("Error in worker:",t),l.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),o&&X.URL.revokeObjectURL(o.objectURL),this.demuxer=new q.default(n,c,i,a),this.w=void 0}}else this.demuxer=new q.default(n,c,i,a)}var t=e.prototype;return t.destroy=function(){var e=this.w;e?(e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null):(t=this.demuxer)&&(t.destroy(),this.demuxer=null);var t=this.observer;t&&(t.removeAllListeners(),this.observer=null)},t.push=function(e,t,r,n,i,a,o,s){var u=this.w,d=Object(c.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,h=i.decryptdata,f=!((g=this.frag)&&i.cc===g.cc),p=!(g&&i.level===g.level),g=g&&i.sn===g.sn+1;g=!p&&g,f&&l.logger.log(this.id+":discontinuity detected"),p&&l.logger.log(this.id+":switch detected"),this.frag=i,u?u.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:t,audioCodec:r,videoCodec:n,timeOffset:d,discontinuity:f,trackSwitch:p,contiguous:g,duration:a,accurateTimeOffset:o,defaultInitPTS:s},e instanceof ArrayBuffer?[e]:[]):(u=this.demuxer)&&u.push(e,h,t,r,n,d,f,p,g,a,o,s)},t.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":X.URL.revokeObjectURL(this.w.objectURL);break;case u.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},e}();function Q(e,t,r){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(r);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(r)}}function Z(e,t,r){var n=e[t],i=e[r];e=i.startPTS,Object(c.isFiniteNumber)(e)?t<r?(n.duration=e-n.start,n.duration<0&&l.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(i.duration=n.start-e,i.duration<0&&l.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):t<r?(r=n.cc===i.cc,i.start=n.start+(r&&n.minEndPTS?n.minEndPTS-n.start:n.duration)):i.start=Math.max(n.start-i.duration,0)}function ee(e,t,r,n,i,a){var o=r,s=n;Object(c.isFiniteNumber)(t.startPTS)&&(d=Math.abs(t.startPTS-r),Object(c.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(r,t.startPTS),r=Math.min(r,t.startPTS),s=Math.min(n,t.endPTS),n=Math.max(n,t.endPTS),i=Math.min(i,t.startDTS),a=Math.max(a,t.endDTS));var u,l,d=r-t.start;if(t.start=t.startPTS=r,t.maxStartPTS=o,t.endPTS=n,t.minEndPTS=s,t.startDTS=i,t.endDTS=a,t.duration=n-r,r=t.sn,!e||r<e.startSN||r>e.endSN)return 0;for(r-=e.startSN,(u=e.fragments)[r]=t,l=r;0<l;l--)Z(u,l,l-1);for(l=r;l<u.length-1;l++)Z(u,l,l+1);return e.PTSKnown=!0,d}function te(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var r,n=0;if(re(e,t,(function(e,i){n=e.cc-i.cc,Object(c.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,r=i),t.PTSKnown=!0})),t.PTSKnown){if(n){l.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=t.fragments,a=0;a<i.length;a++)i[a].cc+=n}r?ee(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):function(e,t){var r=t.startSN-e.startSN,n=e.fragments,i=t.fragments;if(!(r<0||r>n.length))for(var a=0;a<i.length;a++)i[a].start+=n[r].start}(e,t),t.PTSKnown=e.PTSKnown}}function re(e,t,r){if(e&&t)for(var n=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,o=n;o<=i;o++){var s=e.fragments[a+o],c=t.fragments[o];if(!s||!c)break;r(s,c,o)}}function ne(e,t,r){var n=1e3*(t.averagetargetduration||t.targetduration),i=n/2;return e&&t.endSN===e.endSN&&(n=i),r&&(n=Math.max(i,n-(window.performance.now()-r))),Math.round(n)}var ie={toString:function(e){for(var t="",r=e.length,n=0;n<r;n++)t+="["+e.start(n).toFixed(3)+","+e.end(n).toFixed(3)+"]";return t}};function ae(e,t){if(e=e.fragments,(t=t.fragments).length&&e.length){if(t=function(e,t){for(var r=null,n=0;n<e.length;n+=1){var i=e[n];if(i&&i.cc===t){r=i;break}}return r}(e,t[0].cc),t&&(!t||t.startPTS))return t;l.logger.log("No frag in previous level to align on")}else l.logger.log("No fragments to align")}function oe(e,t){t.fragments.forEach((function(t){var r;t&&(r=t.start+e,t.start=t.startPTS=r,t.endPTS=r+t.duration)})),t.PTSKnown=!0}function se(e,t,r){var n;!function(e,t,r){var n=!1;return!!(t&&t.details&&r&&(r.endCC>r.startCC||e&&e.cc<r.startCC))||n}(e,n=t,e=r)||(n=ae(n.details,e))&&(l.logger.log("Adjusting PTS using last level due to CC increase within current level"),oe(n.start,e)),!r.PTSKnown&&t&&function(e,t){var r;t&&t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime&&(r=t.fragments[0].programDateTime,t=(e.fragments[0].programDateTime-r)/1e3+t.fragments[0].start,Object(c.isFiniteNumber)(t)&&(l.logger.log("adjusting PTS using programDateTime delta, sliding:"+t.toFixed(3)),oe(t,e)))}(r,t.details)}function ce(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Object(c.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if((e[e.length-1].endProgramDateTime||0)<=t)return null;r=r||0;for(var n=0;n<e.length;++n){var i=e[n];if(function(e,t,r){return t=1e3*Math.min(t,r.duration+(r.deltaPTS||0)),(r.endProgramDateTime||0)-t>e}(t,r,i))return i}return null}function ue(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=null;return e?i=t[e.sn-t[0].sn+1]:0===r&&0===t[0].start&&(i=t[0]),i&&0===le(r,n,i)?i:(n=G.search(t,le.bind(null,r,n)))||i}function le(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=0),t=Math.min(t,r.duration+(r.deltaPTS||0)),r.start+r.duration-t<=e?1:r.start-t>e&&r.start?-1:0}var de=function(){function e(e,t,r,n){this.config=e,this.media=t,this.fragmentTracker=r,this.hls=n,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,r=this.media,n=this.stalled,i=r.currentTime,a=r.seeking,o=this.seeking&&!a,s=!this.seeking&&a;if(this.seeking=a,i!==e)return this.moved=!0,void(null!==n&&(this.stallReported&&(c=self.performance.now()-n,l.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(c)+"ms"),this.stallReported=!1),this.stalled=null,this.nudgeRetry=0));if((s||o)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&r.buffered.length){var c=0<(e=H.bufferInfo(r,i,0)).len;if(s=e.nextStart||0,c||s){if(a){if(o=2<e.len,c=!s||2<s-i&&!this.fragmentTracker.getPartialFragment(i),o||c)return;this.moved=!1}if(!this.moved&&this.stalled){var u=Math.max(s,e.start||0)-i;if(0<u&&u<=2)return void this._trySkipBufferHole(null)}u=self.performance.now(),null!==n?(n=u-n,!a&&250<=n&&this._reportStall(e.len),t=H.bufferInfo(r,i,t.maxBufferHole),this._tryFixBufferStall(t,n)):this.stalled=u}}},t._tryFixBufferStall=function(e,t){var r=this.config,n=this.fragmentTracker,i=this.media.currentTime;(i=n.getPartialFragment(i))&&this._trySkipBufferHole(i)||e.len>r.maxBufferHole&&t>1e3*r.highBufferWatchdogPeriod&&(l.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,l.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,r=this.hls,n=this.media,i=n.currentTime,a=0,o=0;o<n.buffered.length;o++){var c=n.buffered.start(o);if(i+t.maxBufferHole>=a&&i<c)return c=Math.max(c+.05,n.currentTime+.1),l.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+c),this.moved=!0,this.stalled=null,n.currentTime=c,e&&r.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+c,frag:e}),c;a=n.buffered.end(o)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,n=r.currentTime,i=(this.nudgeRetry||0)+1;(this.nudgeRetry=i)<e.nudgeMaxRetry?(i=n+i*e.nudgeOffset,l.logger.warn("Nudging 'currentTime' from "+n+" to "+i),r.currentTime=i,t.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})):(l.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0}))},e}(),he=function(e){var t;function r(t){for(var r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(t=e.call.apply(e,[this,t].concat(n))||this)._boundTick=void 0,t._tickTimer=null,t._tickInterval=null,t._tickCallCount=0,t._boundTick=t.tick.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)),t}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},n.hasInterval=function(){return!!this._tickInterval},n.hasNextTick=function(){return!!this._tickTimer},n.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},n.clearInterval=function(){return!(!this._tickInterval||(self.clearInterval(this._tickInterval),this._tickInterval=null))},n.clearNextTick=function(){return!(!this._tickTimer||(self.clearTimeout(this._tickTimer),this._tickTimer=null))},n.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},n.doTick=function(){},r}(h),fe="STOPPED",pe="STARTING",ge="IDLE",me="PAUSED",ve="KEY_LOADING",ye="FRAG_LOADING",be="FRAG_LOADING_WAITING_RETRY",_e="WAITING_TRACK",we="PARSING",Ee="PARSED",Se="BUFFER_FLUSHING",Te="ENDED",ke="ERROR",Oe="WAITING_INIT_PTS",Ae="WAITING_LEVEL",xe=function(e){var t;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.doTick=function(){},n.startLoad=function(){},n.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=fe},n._streamEnded=function(e,t){var r=this.fragCurrent,n=this.fragmentTracker;return!(t.live||!r||r.backtracked||r.sn!==t.endSN||e.nextStart||(r=n.getState(r))!==F&&r!==U)},n.onMediaSeeking=function(){var e,t=this.config,r=this.media,n=this.mediaBuffer,i=this.state,a=r?r.currentTime:null,o=H.bufferInfo(n||r,a,this.config.maxBufferHole);l.logger.log("media seeking to "+(Object(c.isFiniteNumber)(a)?a.toFixed(3):a)),i===ye?(e=this.fragCurrent,0===o.len&&e&&(n=t.maxFragLookUpTolerance,t=e.start-n,n=e.start+e.duration+n,a<t||n<a?(e.loader&&(l.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ge):l.logger.log("seeking outside of buffer but within currently loaded fragment range"))):i===Te&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=ge),r&&(this.lastCurrentTime=a),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=a),this.tick()},n.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},n.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},n.onHandlerDestroyed=function(){this.state=fe,this.fragmentTracker=null},n.computeLivePosition=function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)},r}(he);function Re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ce,Le=function(e){function t(t,r){var n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.LEVEL_LOADED,u.default.LEVELS_UPDATED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_LOAD_EMERGENCY_ABORTED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_SWITCHED,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED)||this;return n.fragmentTracker=r,n.config=t.config,n.audioCodecSwap=!1,n._state=fe,n.stallReported=!1,n.gapController=null,n.altAudio=!1,n.audioOnly=!1,n.bitrateTest=!1,n}r=e,(i=t).prototype=Object.create(r.prototype),(i.prototype.constructor=i).__proto__=r;var r,n,i=t.prototype;return i.startLoad=function(e){var t,r,n;this.levels?(t=this.lastCurrentTime,r=this.hls,this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,this.startFragRequested||(-1===(n=r.startLevel)&&(r.config.testBandwidth?this.bitrateTest=!(n=0):n=r.nextAutoLevel),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1),0<t&&-1===e&&(l.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=ge,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()):(this.forceStartLoad=!0,this.state=fe)},i.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case Se:this.fragLoadError=0;break;case ge:this._doTickIdle();break;case Ae:(e=this.levels[this.level])&&e.details&&(this.state=ge);break;case be:var e,t=window.performance.now();(!(e=this.retryDate)||e<=t||this.media&&this.media.seeking)&&(l.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ge)}this._checkBuffer(),this._checkFragmentChanged()},i._doTickIdle=function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&t.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var n=this.loadedmetadata?r.currentTime:this.nextLoadPosition,i=e.nextLoadLevel,a=this.levels[i];if(a){var o=(o=a.bitrate)?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength;if(o=Math.min(o,t.maxMaxBufferLength),t=n<t.maxBufferHole?Math.max(2,t.maxBufferHole):t.maxBufferHole,!(o<=(t=(r=H.bufferInfo(this.mediaBuffer||r,n,t)).len)))if(l.logger.trace("buffer length of "+t.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i,!(a=a.details)||a.live&&this.levelLastLoaded!==i)this.state=Ae;else{if(this._streamEnded(r,a))return i={},this.altAudio&&(i.type="video"),this.hls.trigger(u.default.BUFFER_EOS,i),void(this.state=Te);this._fetchPayloadOrEos(n,r,a)}}}},i._fetchPayloadOrEos=function(e,t,r){var n=this.fragPrevious,i=(this.level,r.fragments),a=i.length;if(0!==a){var o,s=i[0].start,c=i[a-1].start+i[a-1].duration,u=t.end;if(r.initSegment&&!r.initSegment.data)o=r.initSegment;else if(r.live){if(a<(t=this.config.initialLiveManifestSize))return void l.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+t);if(null===(o=this._ensureFragmentAtLivePoint(r,u,s,c,n,i)))return}else u<s&&(o=i[0]);(o=o||this._findFragment(s,n,a,i,u,c,r))&&(o.encrypted?this._loadKey(o,r):this._loadFragment(o,r,e,u))}},i._ensureFragmentAtLivePoint=function(e,t,r,n,i,a){var o,s=this.hls.config,u=this.media,d=1/0;return void 0!==s.liveMaxLatencyDuration?d=s.liveMaxLatencyDuration:Object(c.isFiniteNumber)(s.liveMaxLatencyDurationCount)&&(d=s.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(r-s.maxFragLookUpTolerance,n-d)&&(t=r=this.liveSyncPosition=this.computeLivePosition(r,e),u&&!u.paused&&u.readyState&&u.duration>r&&r>u.currentTime&&(l.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+r.toFixed(3)),u.currentTime=r),this.nextLoadPosition=r),e.PTSKnown&&n<t&&u&&u.readyState?null:(this.startFragRequested&&!e.PTSKnown&&i&&(e.hasProgramDateTime?(l.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),o=ce(a,i.endProgramDateTime,s.maxFragLookUpTolerance)):((s=i.sn+1)>=e.startSN&&s<=e.endSN&&(e=a[s-e.startSN],i.cc===e.cc&&l.logger.log("live playlist, switching playlist, load frag with next SN: "+(o=e).sn)),o||(o=G.search(a,(function(e){return i.cc-e.cc})))&&l.logger.log("live playlist, switching playlist, load frag with same CC: "+o.sn))),o)},i._findFragment=function(e,t,r,n,i,a,o){var s,c=this.hls.config;return(s=i<a?ue(t,n,i,i>a-c.maxFragLookUpTolerance?0:c.maxFragLookUpTolerance):n[r-1])&&(i=s.sn-o.startSN,a=t&&s.level===t.level,r=n[i-1],n=n[1+i],t&&s.sn===t.sn&&(a&&!s.backtracked?s.sn<o.endSN?(o=t.deltaPTS)&&o>c.maxBufferHole&&t.dropped&&i?(s=r,l.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):this.fragmentTracker.getState(s=n)!==U&&l.logger.log("Re-loading fragment with SN: "+s.sn):s=null:s.backtracked&&(n&&n.backtracked?(l.logger.warn("Already backtracked from fragment "+n.sn+", will not backtrack to fragment "+s.sn+". Loading fragment "+n.sn),s=n):(l.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),s.dropped=0,r?(s=r).backtracked=!0:i&&(s=null))))),s},i._loadKey=function(e,t){l.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=ve,this.hls.trigger(u.default.KEY_LOADING,{frag:e})},i._loadFragment=function(e,t,r,n){var i=this.fragmentTracker.getState(e);"initSegment"!==(this.fragCurrent=e).sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===M||i===F?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,l.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(r.toFixed(3))+", bufferEnd: "+parseFloat(n.toFixed(3))),this.hls.trigger(u.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new J(this.hls,"main")),this.state=ye):i===N&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,a.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},i._checkFragmentChanged=function(){var e,t,r=this.media;r&&r.readyState&&!1===r.seeking&&((t=r.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),H.isBuffered(r,t)?e=this.getBufferedFrag(t):H.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),!e||(t=e)!==this.fragPlaying&&(this.hls.trigger(u.default.FRAG_CHANGED,{frag:t}),e=t.level,this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(u.default.LEVEL_SWITCHED,{level:e}),this.fragPlaying=t))},i.immediateLevelSwitch=function(){var e;l.logger.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,(e=this.media)?(t=e.paused)||e.pause():t=!0,this.previouslyPaused=t);var t=this.fragCurrent;t&&t.loader&&t.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,0<e.currentTime&&H.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},i.nextLevelSwitch=function(){var e,t,r,n=this.media;n&&n.readyState&&((e=this.getBufferedFrag(n.currentTime))&&1<e.startPTS&&this.flushMainBuffer(0,e.startPTS-1),r=n.paused?0:(t=this.hls.nextLoadLevel,r=this.levels[t],(t=this.fragLastKbps)&&this.fragCurrent?this.fragCurrent.duration*r.bitrate/(1e3*t)+1:0),!(t=this.getBufferedFrag(n.currentTime+r))||(n=this.followingBufferedFrag(t))&&((r=this.fragCurrent)&&r.loader&&r.loader.abort(),this.fragCurrent=null,n=Math.max(t.endPTS,n.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,n.duration)),this.flushMainBuffer(n,Number.POSITIVE_INFINITY)))},i.flushMainBuffer=function(e,t){this.state=Se,t={startOffset:e,endOffset:t},this.altAudio&&(t.type="video"),this.hls.trigger(u.default.BUFFER_FLUSHING,t)},i.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended),e=this.config,this.levels&&e.autoStartLoad&&this.hls.startLoad(e.startPosition),this.gapController=new de(e,t,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach((function(e){e.details&&e.details.fragments.forEach((function(e){e.backtracked=void 0}))})),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},i.onMediaSeeked=function(){var e=(e=this.media)?e.currentTime:void 0;Object(c.isFiniteNumber)(e)&&l.logger.log("media seeked to "+e.toFixed(3)),this.tick()},i.onManifestLoading=function(){l.logger.log("trigger BUFFER_RESET"),this.hls.trigger(u.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},i.onManifestParsed=function(e){var t,r=!1,n=!1;e.levels.forEach((function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(r=!0),-1!==t.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=r&&n,this.audioCodecSwitch&&l.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1,((e=this.config).autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},i.onLevelLoaded=function(e){var t=e.details,r=e.level,n=this.levels[this.levelLastLoaded],i=this.levels[r],a=t.totalduration,o=0;l.logger.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live||i.details&&i.details.live?(e=i.details)&&0<t.fragments.length?(te(e,t),o=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,e),t.PTSKnown&&Object(c.isFiniteNumber)(o)?l.logger.log("live playlist sliding:"+o.toFixed(3)):(l.logger.log("live playlist - outdated PTS, unknown sliding"),se(this.fragPrevious,n,t))):(l.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,se(this.fragPrevious,n,t)):t.PTSKnown=!1,i.details=t,this.levelLastLoaded=r,this.hls.trigger(u.default.LEVEL_UPDATED,{details:t,level:r}),!1===this.startFragRequested&&(-1!==this.startPosition&&-1!==this.lastCurrentTime||(r=t.startTimeOffset,Object(c.isFiniteNumber)(r)?(r<0&&(l.logger.log("negative start time offset "+r+", count from end of last fragment"),r=o+a+r),l.logger.log("start time offset found in playlist, adjust startPosition to "+r),this.startPosition=r):t.live?(this.startPosition=this.computeLivePosition(o,t),l.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition),this.nextLoadPosition=this.startPosition),this.state===Ae&&(this.state=ge),this.tick()},i.onKeyLoaded=function(){this.state===ve&&(this.state=ge,this.tick())},i.onFragLoaded=function(e){var t,r,n=this.fragCurrent,i=this.hls,a=this.levels,o=this.media,s=e.frag;this.state===ye&&n&&"main"===s.type&&s.level===n.level&&s.sn===n.sn&&(r=e.stats,a=(t=a[n.level]).details,this.bitrateTest=!1,this.stats=r,l.logger.log("Loaded "+n.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+n.level),s.bitrateTest&&i.nextLoadLevel?(this.state=ge,this.startFragRequested=!1,r.tparsed=r.tbuffered=window.performance.now(),i.trigger(u.default.FRAG_BUFFERED,{stats:r,frag:n,id:"main"}),this.tick()):"initSegment"===s.sn?(this.state=ge,r.tparsed=r.tbuffered=window.performance.now(),a.initSegment.data=e.payload,i.trigger(u.default.FRAG_BUFFERED,{stats:r,frag:n,id:"main"}),this.tick()):(l.logger.log("Parsing "+n.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+n.level+", cc "+n.cc),this.state=we,this.pendingBuffering=!0,this.appended=!1,s.bitrateTest&&(s.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:s})),r=!(o&&o.seeking)&&(a.PTSKnown||!a.live),s=a.initSegment?a.initSegment.data:[],o=this._getAudioCodec(t),(this.demuxer=this.demuxer||new J(this.hls,"main")).push(e.payload,s,o,t.videoCodec,n,a.totalduration,r))),this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;if(t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===we){var n,i,a=e.tracks;for(n in this.audioOnly=a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio,(i=a.audio)&&(r=this.levels[this.level].audioCodec,t=navigator.userAgent.toLowerCase(),r&&this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),r=-1!==r.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===t.indexOf("firefox")&&(r="mp4a.40.5"),-1!==t.indexOf("android")&&"audio/mpeg"!==i.container&&l.logger.log("Android: force audio codec to "+(r="mp4a.40.2")),i.levelCodec=r,i.id=e.id),(i=a.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),this.hls.trigger(u.default.BUFFER_CODECS,a),a){i=a[n],l.logger.log("main track:"+n+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var o=i.initSegment;o&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,{type:n,data:o,parent:"main",content:"initSegment"}))}this.tick()}},i.onFragParsingData=function(e){var t=this,r=this.fragCurrent,n=e.frag;if(r&&"main"===e.id&&n.sn===r.sn&&n.level===r.level&&("audio"!==e.type||!this.altAudio)&&this.state===we){var i=this.levels[this.level];if(n=r,Object(c.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),!0===e.hasAudio&&n.addElementaryStream(g.AUDIO),!0===e.hasVideo&&n.addElementaryStream(g.VIDEO),l.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(n.dropped=e.dropped,n.dropped)if(n.backtracked)l.logger.warn("Already backtracked on this fragment, appending with the gap",n.sn);else{if(!(r=i.details)||n.sn!==r.startSN)return l.logger.warn("missing video frame(s), backtracking fragment",n.sn),this.fragmentTracker.removeFragment(n),n.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=ge,this.fragPrevious=n,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();l.logger.warn("missing video frame(s) on first frag, appending with gap",n.sn)}else n.backtracked=!1;n=ee(i.details,n,e.startPTS,e.endPTS,e.startDTS,e.endDTS);var a=this.hls;a.trigger(u.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:n,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach((function(r){r&&r.length&&t.state===we&&(t.appended=!0,t.pendingBuffering=!0,a.trigger(u.default.BUFFER_APPENDING,{type:e.type,data:r,parent:"main",content:"data"}))})),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"main"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===we&&(this.stats.tparsed=window.performance.now(),this.state=Ee,this._checkAppendedParsed())},i.onAudioTrackSwitching=function(e){var t,r=this.altAudio,n=!!e.url;e=e.id,n||(this.mediaBuffer!==this.media&&(l.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media,(t=this.fragCurrent).loader&&(l.logger.log("switching to main audio track, cancel main fragment load"),t.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ge),t=this.hls,r&&t.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),t.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:e}))},i.onAudioTrackSwitched=function(e){var t=e.id;!(e=!!this.hls.audioTracks[t].url)||(t=this.videoBuffer)&&this.mediaBuffer!==t&&(l.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=t),this.altAudio=e,this.tick()},i.onBufferCreated=function(e){var t,r,n,i=e.tracks,a=!1;for(n in i){var o=i[n];"main"===o.id?(t=o,"video"===(r=n)&&(this.videoBuffer=i[n].buffer)):a=!0}a&&t?(l.logger.log("alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},i.onBufferAppended=function(e){var t;"main"===e.parent&&((t=this.state)!==we&&t!==Ee||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed()))},i._checkAppendedParsed=function(){var e,t;this.state!==Ee||this.appended&&this.pendingBuffering||((e=this.fragCurrent)&&(t=this.mediaBuffer||this.media,l.logger.log("main buffered : "+ie.toString(t.buffered)),this.fragPrevious=e,(t=this.stats).tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*t.total/(t.tbuffered-t.tfirst)),this.hls.trigger(u.default.FRAG_BUFFERED,{stats:t,frag:e,id:"main"}),this.state=ge),(this.loadedmetadata||this.startPosition<=0)&&this.tick())},i.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r,n=!!this.media&&H.isBuffered(this.media,this.media.currentTime)&&H.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:e.fatal||(this.fragLoadError+1<=this.config.fragLoadingMaxRetry?(r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout),l.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=be):(l.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=ke));break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==ke&&(e.fatal?(this.state=ke,l.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==Ae||(this.state=ge));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==we&&this.state!==Ee||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ge):(l.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},i._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,l.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},i._checkBuffer=function(){var e=this.media;e&&0!==e.readyState&&(e=(this.mediaBuffer||e).buffered,!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e))},i.onFragLoadEmergencyAborted=function(){this.state=ge,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},i.onBufferFlushed=function(){var e,t=this.mediaBuffer||this.media;t&&(e=this.audioOnly?g.AUDIO:g.VIDEO,this.fragmentTracker.detectEvictedFragments(e,t.buffered)),this.state=ge,this.fragPrevious=null},i.onLevelsUpdated=function(e){this.levels=e.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i._seekToStartPos=function(){var e,t=this.media,r=t.currentTime,n=this.startPosition;r!==n&&0<=n&&(t.seeking?l.logger.log("could not seek to "+n+", already seeking at "+r):(0<(e=(t.buffered.length?t.buffered.start(0):0)-n)&&e<this.config.maxBufferHole&&(l.logger.log("adjusting start position by "+e+" to match buffer start"),this.startPosition=n+=e),l.logger.log("seek to target start position "+n+" from current time "+r+". ready state "+t.readyState),t.currentTime=n))},i._getAudioCodec=function(e){return e=this.config.defaultAudioCodec||e.audioCodec,this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),e=e&&(-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},r=t,(i=[{key:"state",set:function(e){var t;this.state!==e&&(t=this.state,this._state=e,l.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(u.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e}))},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;return e&&(e=this.getBufferedFrag(e.currentTime))?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}])&&Re(r.prototype,i),n&&Re(r,n),t}(xe);function Ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pe=function(e){function t(t){return(t=e.call(this,t,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this).canload=!1,t.currentLevelIndex=null,t.manualLevelIndex=-1,t.timer=null,Ce=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t}r=e,(i=t).prototype=Object.create(r.prototype),(i.prototype.constructor=i).__proto__=r;var r,n,i=t.prototype;return i.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},i.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},i.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach((function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)})),null!==this.timer&&this.loadLevel()},i.stopLoad=function(){this.canload=!1},i.onManifestLoaded=function(e){var t,r=[],n=[],i={},a=null,o=!1,c=!1;if(e.levels.forEach((function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,o=o||!!e.videoCodec,c=c||!!e.audioCodec,Ce&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=i[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,r.push(e)),t&&(t.AUDIO&&Q(a||e,"audio",t.AUDIO),t.SUBTITLES&&Q(a||e,"text",t.SUBTITLES))})),r=(r=o&&c?r.filter((function(e){return!!e.videoCodec})):r).filter((function(e){var t=e.audioCodec;return e=e.videoCodec,(!t||k(t,"audio"))&&(!e||k(e,"video"))})),e.audioTracks&&(n=e.audioTracks.filter((function(e){return!e.audioCodec||k(e.audioCodec,"audio")}))).forEach((function(e,t){e.id=t})),0<r.length){t=r[0].bitrate,r.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=r;for(var d=0;d<r.length;d++)if(r[d].bitrate===t){this._firstLevel=d,l.logger.log("manifest loaded,"+r.length+" level(s) found, first bitrate:"+t);break}this.hls.trigger(u.default.MANIFEST_PARSED,{levels:r,audioTracks:n,firstLevel:this._firstLevel,stats:e.stats,audio:c,video:o,altAudio:!(c&&!o)&&n.some((function(e){return!!e.url}))})}else this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},i.setLevelInternal=function(e){var t,r=this._levels,n=this.hls;0<=e&&e<r.length?(this.clearTimer(),this.currentLevelIndex!==e&&(l.logger.log("switching to level "+e),(t=r[this.currentLevelIndex=e]).level=e,n.trigger(u.default.LEVEL_SWITCHING,t)),(r=(t=r[e]).details)&&!r.live||(r=t.urlId,n.trigger(u.default.LEVEL_LOADING,{url:t.url[r],level:e,id:r}))):n.trigger(u.default.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},i.onError=function(e){if(e.fatal)e.type===s.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,r=!1,n=!1;switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,n=!0;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,r=!0;break;case s.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,r=!0}void 0!==t&&this.recoverLevel(e,t,r,n)}},i.recoverLevel=function(e,t,r,n){var i=this,a=this.hls.config,o=e.details,s=this._levels[t];if(s.loadError++,s.fragmentError=n,r){if(!(this.levelRetryCount+1<=a.levelLoadingMaxRetry))return l.logger.error("level controller, cannot recover from "+o+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*a.levelLoadingRetryDelay,a.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return i.loadLevel()}),a),e.levelRetry=!0,this.levelRetryCount++,l.logger.warn("level controller, "+o+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(r||n)&&(1<(r=s.url.length)&&s.loadError<r?(s.urlId=(s.urlId+1)%r,s.details=void 0,l.logger.warn("level controller, "+o+" for level "+t+": switching to redundant URL-id "+s.urlId)):-1===this.manualLevelIndex?(t=0===t?this._levels.length-1:t-1,l.logger.warn("level controller, "+o+": switch to "+t),this.hls.nextAutoLevel=this.currentLevelIndex=t):n&&(l.logger.warn("level controller, "+o+": reload a fragment"),this.currentLevelIndex=null))},i.onFragLoaded=function(e){void 0===(e=e.frag)||"main"!==e.type||void 0!==(e=this._levels[e.level])&&(e.fragmentError=!1,e.loadError=0,this.levelRetryCount=0)},i.onLevelLoaded=function(e){var t=this,r=e.level,n=e.details;r===this.currentLevelIndex&&((r=this._levels[r]).fragmentError||(r.loadError=0,this.levelRetryCount=0),n.live?(e=ne(r.details,n,e.stats.trequest),l.logger.log("live playlist, reload in "+Math.round(e)+" ms"),this.timer=setTimeout((function(){return t.loadLevel()}),e)):this.clearTimer())},i.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var n=-1,i=0;i<r.audioGroupIds.length;i++)if(r.audioGroupIds[i]===t){n=i;break}n!==r.urlId&&(r.urlId=n,this.startLoad())}},i.loadLevel=function(){var e,t,r;l.logger.debug("call to loadLevel"),null===this.currentLevelIndex||!this.canload||"object"==typeof(r=this._levels[this.currentLevelIndex])&&0<r.url.length&&(e=this.currentLevelIndex,t=r.urlId,r=r.url[t],l.logger.log("Attempt loading level index "+e+" with URL-id "+t),this.hls.trigger(u.default.LEVEL_LOADING,{url:r,level:e,id:t}))},i.removeLevel=function(e,t){var r=this.levels.filter((function(r,n){return n!==e||1<r.url.length&&void 0!==t&&(r.url=r.url.filter((function(e,r){return r!==t})),!(r.urlId=0))})).map((function(e,t){var r=e.details;return r&&r.fragments&&r.fragments.forEach((function(e){e.level=t})),e}));this._levels=r,this.hls.trigger(u.default.LEVELS_UPDATED,{levels:r})},r=t,(i=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0!==this._startLevel)return this._startLevel;var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&Ie(r.prototype,i),n&&Ie(r,n),t}(h),De=r("./src/demux/id3.js");function je(e,t){var r;try{r=new Event("addtrack")}catch(e){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function Me(e){if(null!=e&&e.cues)for(;0<e.cues.length;)e.removeCue(e.cues[0])}var Ne=function(e){var t;function r(t){return(t=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA,u.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,t.media=void 0,t}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.destroy=function(){h.prototype.destroy.call(this)},n.onMediaAttached=function(e){this.media=e.media,this.media},n.onMediaDetaching=function(){Me(this.id3Track),this.id3Track=void 0,this.media=void 0},n.getID3Track=function(e){for(var t=0;t<e.length;t++){var r=e[t];if("metadata"===r.kind&&"id3"===r.label)return je(r,this.media),r}return this.media.addTextTrack("metadata","id3")},n.onFragParsingMetadata=function(e){var t=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<r.length;i++){var a=De.default.getID3Frames(r[i].data);if(a){var o=Math.max(r[i].pts,0),s=i<r.length-1?r[i+1].pts:t.endPTS;(s=s||t.start+t.duration)-o<=0&&(s=o+.25);for(var c=0;c<a.length;c++){var u,l=a[c];De.default.isTimeStampFrame(l)||((u=new n(o,s,"")).value=l,this.id3Track.addCue(u))}}}},n.onLiveBackBufferReached=function(e){e=e.bufferEnd;var t=this.id3Track;if(t&&t.cues&&t.cues.length){var r=function(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var r=0,n=e.length-1;r<=n;){var i=Math.floor((n+r)/2);if(t<e[i].endTime)n=i-1;else{if(!(t>e[i].endTime))return e[i];r=i+1}}return e[r].endTime-t<t-e[n].endTime?e[r]:e[n]}(t.cues,e);if(r)for(;t.cues[0]!==r;)t.removeCue(t.cues[0])}},r}(h),Fe=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),Ue=function(){function e(e,t,r,n){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Fe(t),this.fast_=new Fe(r)}var t=e.prototype;return t.sample=function(e,t){t=8*t/(e=(e=Math.max(e,this.minDelayMs_))/1e3),this.fast_.sample(e,t),this.slow_.sample(e,t)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();function Be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ge=window.performance,He=function(e){function t(t){var r=e.call(this,t,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR)||this;return r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=t,r.timer=null,r._bwEstimator=null,r.onCheck=r._abandonRulesCheck.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}r=e,(i=t).prototype=Object.create(r.prototype),(i.prototype.constructor=i).__proto__=r;var r,n,i=t.prototype;return i.destroy=function(){this.clearTimer(),h.prototype.destroy.call(this)},i.onFragLoading=function(e){var t,r,n=e.frag;"main"===n.type&&(this.timer||(this.fragCurrent=n,this.timer=setInterval(this.onCheck,100)),this._bwEstimator||(e=(t=this.hls).config,n=n.level,n=t.levels[n].details.live?(r=e.abrEwmaFastLive,e.abrEwmaSlowLive):(r=e.abrEwmaFastVoD,e.abrEwmaSlowVoD),this._bwEstimator=new Ue(t,n,r,e.abrEwmaDefaultEstimate)))},i._abandonRulesCheck=function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(r){var n=r.loader;if(!n||n.stats&&n.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var i=n.stats;if(t&&i&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var a=Ge.now()-i.trequest,o=Math.abs(t.playbackRate);if(a>500*r.duration/o){var s=e.levels,c=Math.max(1,i.bw?i.bw/8:1e3*i.loaded/a);if(h=s[r.level]){var d=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,h=i.total||Math.max(i.loaded,Math.round(r.duration*d/8)),f=(d=t.currentTime,h=(h-i.loaded)/c,(H.bufferInfo(t,d,e.config.maxBufferHole).end-d)/o);if(f<2*r.duration/o&&f<h){for(var p=e.minAutoLevel,g=r.level-1;p<g;g--){var m=s[g].realBitrate?Math.max(s[g].realBitrate,s[g].bitrate):s[g].bitrate;if(r.duration*m/(6.4*c)<f)break}void 0<h&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+g+":fragLoadedDelay["+g+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+(void 0).toFixed(1)+"<"+h.toFixed(1)+":"+f.toFixed(1)),e.nextLoadLevel=g,this._bwEstimator.sample(a,i.loaded),n.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:i}))}}}}}},i.onFragLoaded=function(e){var t,r,n=e.frag;"main"===n.type&&Object(c.isFiniteNumber)(n.sn)&&(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate&&(n=((t=this.hls.levels[n.level]).loaded?t.loaded.bytes:0)+e.stats.loaded,r=(t.loaded?t.loaded.duration:0)+e.frag.duration,t.loaded={bytes:n,duration:r},t.realBitrate=Math.round(8*n/r)),e.frag.bitrateTest&&((r=e.stats).tparsed=r.tbuffered=r.tload,this.onFragBuffered(e)))},i.onFragBuffered=function(e){var t=e.stats,r=e.frag;!0===t.aborted||"main"!==r.type||!Object(c.isFiniteNumber)(r.sn)||r.bitrateTest&&t.tload!==t.tbuffered||(e=t.tparsed-t.trequest,l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(e,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0)},i.onError=function(e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},i.clearTimer=function(){clearInterval(this.timer),this.timer=null},i._findBestLevel=function(e,t,r,n,i,a,o,s,c){for(var u=i;n<=u;u--)if(d=c[u]){var d,h=(g=d.details)?g.totalduration/g.fragments.length:t,f=!!g&&g.live,p=void 0,g=(p=u<=e?o*r:s*r,(d=c[u].realBitrate?Math.max(c[u].realBitrate,c[u].bitrate):c[u].bitrate)*h/p);if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+d+"/"+h+"/"+a+"/"+g),d<p&&(!g||f&&!this.bitrateTestDelay||g<a))return u}return-1},r=t,(i=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;return-1===e||t&&t.canEstimate()?(t=this._nextABRAutoLevel,-1!==e?Math.min(e,t):t):e},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,n=e.config,i=e.minAutoLevel,a=e.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,c=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,h=(H.bufferInfo(a,c,n.maxBufferHole).end-c)/u,f=this._findBestLevel(o,s,d,i,t,h,n.abrBandWidthFactor,n.abrBandWidthUpFactor,r);return 0<=f?f:(l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering"),e=s?Math.min(s,n.maxStarvationDelay):n.maxStarvationDelay,a=n.abrBandWidthFactor,c=n.abrBandWidthUpFactor,0!=h||(u=this.bitrateTestDelay)&&(e=(s?Math.min(s,n.maxLoadingDelay):n.maxLoadingDelay)-u,l.logger.trace("bitrate test took "+Math.round(1e3*u)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*e)+" ms"),a=c=1),f=this._findBestLevel(o,s,d,i,t,h+e,a,c,r),Math.max(f,0))}}])&&Be(r.prototype,i),n&&Be(r,n),t}(h),ze=V(),Ke=function(e){var t;function r(t){var r=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED)||this;return r._msDuration=null,r._levelDuration=null,r._levelTargetDuration=10,r._live=null,r._objectUrl=null,r._needsFlush=!1,r._needsEos=!1,r.config=void 0,r.audioTimestampOffset=void 0,r.bufferCodecEventsExpected=0,r._bufferCodecEventsTotal=0,r.media=null,r.mediaSource=null,r.segments=[],r.parent=void 0,r.appending=!1,r.appended=0,r.appendError=0,r.flushBufferCounter=0,r.tracks={},r.pendingTracks={},r.sourceBuffer={},r.flushRange=[],r._onMediaSourceOpen=function(){l.logger.log("media source opened"),r.hls.trigger(u.default.MEDIA_ATTACHED,{media:r.media});var e=r.mediaSource;e&&e.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},r._onMediaSourceClose=function(){l.logger.log("media source closed")},r._onMediaSourceEnded=function(){l.logger.log("media source ended")},r._onSBUpdateEnd=function(){r.audioTimestampOffset&&r.sourceBuffer.audio&&(n=r.sourceBuffer.audio,l.logger.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+r.audioTimestampOffset),n.timestampOffset=r.audioTimestampOffset,delete r.audioTimestampOffset),r._needsFlush&&r.doFlush(),r._needsEos&&r.checkEos(),r.appending=!1;var e,t=r.parent,n=r.segments.reduce((function(e,r){return r.parent===t?e+1:e}),0),i={},a=r.sourceBuffer;for(e in a){var o=a[e];if(!o)throw Error("handling source buffer update end error: source buffer for "+e+" uninitilized and unable to update buffered TimeRanges.");i[e]=o.buffered}r.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:n,timeRanges:i}),r._needsFlush||r.doAppending(),r.updateMediaElementDuration(),0===n&&r.flushLiveBackBuffer()},r._onSBUpdateError=function(e){l.logger.error("sourceBuffer error:",e),r.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},r.config=t.config,r}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.destroy=function(){h.prototype.destroy.call(this)},n.onLevelPtsUpdated=function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){if(!(t=this.sourceBuffer.audio))throw Error("Level PTS Updated and source buffer for audio uninitalized");if(.1<Math.abs(t.timestampOffset-e.start)){r=t.updating;try{t.abort()}catch(e){l.logger.warn("can not abort audio buffer: "+e)}r?this.audioTimestampOffset=e.start:(l.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+e.start),t.timestampOffset=e.start)}}},n.onManifestParsed=function(e){var t=2;(!e.audio||e.video)&&e.altAudio||(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,l.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},n.onMediaAttaching=function(e){var t=this.media=e.media;t&&ze&&((e=this.mediaSource=new ze).addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(e),this._objectUrl=t.src)},n.onMediaDetaching=function(){l.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){l.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):l.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(u.default.MEDIA_DETACHED)},n.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,r=Object.keys(t).length;(r&&!e||2===r)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},n.onBufferReset=function(){var e,t=this.sourceBuffer;for(e in t){var r=t[e];try{r&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this._onSBUpdateEnd),r.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},n.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach((function(r){t.pendingTracks[r]=e[r]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},n.createSourceBuffers=function(e){var t,r=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(t in e)if(!r[t]){var i=e[t];if(!i)throw Error("source buffer exists for track "+t+", however track does not");var a=i.levelCodec||i.codec,o=i.container+";codecs="+a;l.logger.log("creating sourceBuffer("+o+")");try{var c=r[t]=n.addSourceBuffer(o);c.addEventListener("updateend",this._onSBUpdateEnd),c.addEventListener("error",this._onSBUpdateError),this.tracks[t]={buffer:c,codec:a,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(e){l.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:o})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:this.tracks})},n.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},n.onBufferEos=function(e){for(var t in this.sourceBuffer){var r;e.type&&e.type!==t||(r=this.sourceBuffer[t])&&!r.ended&&(r.ended=!0,l.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},n.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var r in e)if(r=e[r]){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}l.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},n.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},n.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,r=this.sourceBuffer,n=Object.keys(r),i=t-Math.max(e,this._levelTargetDuration),a=n.length-1;0<=a;a--){var o,s=n[a],c=r[s];!c||0<(o=c.buffered).length&&i>o.start(0)&&this.removeBufferRange(s,c,0,i)&&this.hls.trigger(u.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}else l.logger.error("flushLiveBackBuffer called without attaching media")}},n.onLevelUpdated=function(e){0<(e=e.details).fragments.length&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._levelTargetDuration=e.averagetargetduration||e.targetduration||10,this._live=e.live,this.updateMediaElementDuration())},n.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if((r=this.sourceBuffer[r])&&!0===r.updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(l.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(c.isFiniteNumber)(e))&&(l.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},n.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var n in r){var i=r[n];i&&(t+=i.buffered.length)}}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}},n.doAppending=function(){var e=this.config,t=this.hls,r=this.segments,n=this.sourceBuffer;if(Object.keys(n).length){if(!this.media||this.media.error)return this.segments=[],void l.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=r.shift();if(i)try{var a=n[i.type];if(!a)return void this._onSBUpdateEnd();if(a.updating)return void r.unshift(i);a.ended=!1,this.parent=i.parent,a.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(n){l.logger.error("error while trying to append buffer:"+n.message),r.unshift(i),i={type:s.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1},22===n.code?(this.segments=[],i.details=s.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,i.details=s.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(l.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],i.fatal=!0)),t.trigger(u.default.ERROR,i)}}}},n.flushBuffer=function(e,t,r){var n=this.sourceBuffer;if(!Object.keys(n).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),l.logger.log("flushBuffer,pos/start/end: "+i+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return l.logger.warn("abort flushing too many retries"),!0;if(n=n[r]){if(n.ended=!1,n.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(r,n,e,t))return this.flushBufferCounter++,!1}return l.logger.log("buffer flushed"),!0},n.removeBufferRange=function(e,t,r,n){try{for(var i=0;i<t.buffered.length;i++){var a=t.buffered.start(i),o=t.buffered.end(i),s=Math.max(a,r),c=Math.min(o,n);if(.5<Math.min(c,o)-s){var u="null";return this.media&&(u=this.media.currentTime.toString()),l.logger.log("sb remove "+e+" ["+s+","+c+"], of ["+a+","+o+"], pos:"+u),t.remove(s,c),!0}}}catch(e){l.logger.warn("removeBufferRange failed",e)}return!1},r}(h);function qe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ve=function(e){function t(t){return(t=e.call(this,t,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED,u.default.LEVELS_UPDATED,u.default.BUFFER_CODECS,u.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,t.firstLevel=null,t.levels=[],t.media=null,t.restrictedLevels=[],t.timer=null,t.clientRect=null,t}n=e,(r=t).prototype=Object.create(n.prototype),(r.prototype.constructor=r).__proto__=n;var r,n,i=t.prototype;return i.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},i.onFpsDropLevelCapping=function(e){t.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},i.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},i.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},i.onLevelsUpdated=function(e){this.levels=e.levels},i.onMediaDetaching=function(){this.stopCapping()},i.detectPlayerSize=function(){var e,t;!this.media||(e=this.levels?this.levels.length:0)&&((t=this.hls).autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping)},i.getMaxLevel=function(e){var r=this;if(!this.levels)return-1;var n=this.levels.filter((function(n,i){return t.isLevelAllowed(i,r.restrictedLevels)&&i<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},i.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},i.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},i.getDimensions=function(){if(this.clientRect)return this.clientRect;var e,t=this.media,r={width:0,height:0};return t&&(e=t.getBoundingClientRect(),r.width=e.width,r.height=e.height,r.width||r.height||(r.width=e.right-e.left||t.width||0,r.height=e.bottom-e.top||t.height||0)),this.clientRect=r},t.isLevelAllowed=function(e,t){return-1===(t=void 0===t?[]:t).indexOf(e)},t.getMaxLevelByMediaSize=function(e,t,r){if(!e||e&&!e.length)return-1;for(var n,i,a=e.length-1,o=0;o<e.length;o+=1){var s=e[o];if((s.width>=t||s.height>=r)&&(n=s,!(i=e[o+1])||n.width!==i.width||n.height!==i.height)){a=o;break}}return a},r=t,n=[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}],(i=[{key:"mediaWidth",get:function(){return this.getDimensions().width*t.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*t.contentScaleFactor}}])&&qe(r.prototype,i),n&&qe(r,n),t}(h),We=window.performance,Ye=(t=function(e){var t;function r(t){return e.call(this,t,u.default.MEDIA_ATTACHING)||this}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},n.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},n.checkFPS=function(e,t,r){var n,i,a,o,s=We.now();t&&(this.lastTime&&(a=s-this.lastTime,n=r-this.lastDroppedFrames,o=t-this.lastDecodedFrames,i=1e3*n/a,(a=this.hls).trigger(u.default.FPS_DROP,{currentDropped:n,currentDecoded:o,totalDroppedFrames:r}),0<i&&n>a.config.fpsDroppedMonitoringThreshold*o&&(o=a.currentLevel,l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+o),0<o&&(-1===a.autoLevelCapping||a.autoLevelCapping>=o)&&(a.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:o-=1,droppedLevel:a.currentLevel}),a.autoLevelCapping=o,a.streamController.nextLevelSwitch()))),this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=t)},n.checkFPSInterval=function(){var e,t=this.video;t&&(this.isVideoPlaybackQualityAvailable?(e=t.getVideoPlaybackQuality(),this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)):this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount))},r}(h),function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e=this.context,t=this.loader=new window.XMLHttpRequest,r=this.stats;r.tfirst=0,r.loaded=0,r=this.xhrSetup;try{if(r)try{r(t,e.url)}catch(n){t.open("GET",e.url,!0),r(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(r){return void this.callbacks.onError({code:t.status,text:r.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.readystatechange=function(e){var t,r=e.currentTarget,n=r.readyState,i=this.stats,a=this.context,o=this.config;i.aborted||2<=n&&(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(window.performance.now(),i.trequest)),4===n?200<=(e=r.status)&&e<300?(i.tload=Math.max(i.tfirst,window.performance.now()),n="arraybuffer"===a.responseType?(t=r.response).byteLength:(t=r.responseText).length,i.loaded=i.total=n,t={url:r.responseURL,data:t},this.callbacks.onSuccess(t,i,a,r)):i.retry>=o.maxRetry||400<=e&&e<499?(l.logger.error(e+" while loading "+a.url),this.callbacks.onError({code:e,text:r.statusText},a,r)):(l.logger.warn(e+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),i.retry++):this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout))},t.loadtimeout=function(){l.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,r=this.stats;r.loaded=e.loaded,e.lengthComputable&&(r.total=e.total),(e=this.callbacks.onProgress)&&e(r,this.context,null,t)},e}());function Xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $e=function(e){function t(t){return(t=e.call(this,t,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.AUDIO_TRACK_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.LEVEL_LOADED,u.default.ERROR)||this)._trackId=-1,t._selectDefaultTrack=!0,t.tracks=[],t.trackIdBlacklist=Object.create(null),t.audioGroupId=null,t}r=e,(i=t).prototype=Object.create(r.prototype),(i.prototype.constructor=i).__proto__=r;var r,n,i=t.prototype;return i.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},i.onManifestParsed=function(e){e=this.tracks=e.audioTracks||[],this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:e}),this._selectAudioGroup(this.hls.nextLoadLevel)},i.onAudioTrackLoaded=function(e){var t;e.id>=this.tracks.length?l.logger.warn("Invalid audio track id:",e.id):(l.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()&&(t=1e3*e.details.targetduration,this.setInterval(t)),!e.details.live&&this.hasInterval()&&this.clearInterval())},i.onAudioTrackSwitched=function(e){(e=this.tracks[e.id].groupId)&&this.audioGroupId!==e&&(this.audioGroupId=e)},i.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},i.onError=function(e){e.type===s.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(l.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},i._setAudioTrack=function(e){var t,r,n;this._trackId===e&&this.tracks[this._trackId].details?l.logger.debug("Same id as current audio-track passed, and track details available -> no-op"):e<0||e>=this.tracks.length?l.logger.warn("Invalid id passed to audio-track controller"):(t=this.tracks[e],l.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e,r=t.url,n=t.type,e=t.id,this.hls.trigger(u.default.AUDIO_TRACK_SWITCHING,{id:e,type:n,url:r}),this._loadTrackDetailsIfNeeded(t))},i.doTick=function(){this._updateTrack(this._trackId)},i._selectAudioGroup=function(e){(e=this.hls.levels[e])&&e.audioGroupIds&&(e=e.audioGroupIds[e.urlId],this.audioGroupId!==e&&(this.audioGroupId=e,this._selectInitialAudioTrack()))},i._selectInitialAudioTrack=function(){var e,t,r,n,i=this,a=this.tracks;a.length&&(e=this.tracks[this._trackId],t=null,e&&(t=e.name),this._selectDefaultTrack&&((n=a.filter((function(e){return e.default}))).length?a=n:l.logger.warn("No default audio tracks defined")),r=!1,(n=function(){a.forEach((function(e){r||i.audioGroupId&&e.groupId!==i.audioGroupId||t&&t!==e.name||(i._setAudioTrack(e.id),r=!0)}))})(),r||(t=null,n()),r||(l.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0})))},i._needsTrackLoading=function(e){var t=e.details;return e=e.url,!(t&&!t.live||!e)},i._loadTrackDetailsIfNeeded=function(e){var t;this._needsTrackLoading(e)&&(t=e.url,e=e.id,l.logger.log("loading audio-track playlist for id: "+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:t,id:e}))},i._updateTrack=function(e){e<0||e>=this.tracks.length||(this.clearInterval(),this._trackId=e,l.logger.log("trying to update audio-track "+e),e=this.tracks[e],this._loadTrackDetailsIfNeeded(e))},i._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=(n=this.tracks[e]).name,r=n.language,n=n.groupId;l.logger.warn("Loading failed on audio track id: "+e+", group-id: "+n+', name/language: "'+t+'" / "'+r+'"');for(var i=e,a=0;a<this.tracks.length;a++)if(!this.trackIdBlacklist[a]&&this.tracks[a].name===t){i=a;break}i!==e?(l.logger.log("Attempting audio-track fallback id:",i,"group-id:",this.tracks[i].groupId),this._setAudioTrack(i)):l.logger.warn('No fallback audio-track found for name/language: "'+t+'" / "'+r+'"')},r=t,(i=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}])&&Xe(r.prototype,i),n&&Xe(r,n),t}(he);function Je(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Qe(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}var Ze=window.performance,et=function(e){function t(t,r){var n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.AUDIO_TRACKS_UPDATED,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_LOADED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.BUFFER_RESET,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED,u.default.INIT_PTS_FOUND)||this;return n.fragmentTracker=r,n.config=t.config,n.audioCodecSwap=!1,n._state=fe,n.initPTS=[],n.waitingFragment=null,n.videoTrackCC=null,n.waitingVideoCC=null,n}r=e,(i=t).prototype=Object.create(r.prototype),(i.prototype.constructor=i).__proto__=r;var r,n,i=t.prototype;return i.onInitPtsFound=function(e){var t=e.id,r=e.frag.cc;e=e.initPTS,"main"===t&&(this.initPTS[r]=e,this.videoTrackCC=r,l.logger.log("InitPTS for cc: "+r+" found from main: "+e),this.state===Oe&&this.tick())},i.startLoad=function(e){var t;this.tracks?(t=this.lastCurrentTime,this.stopLoad(),this.setInterval(100),(this.fragLoadError=0)<t&&-1===e?(l.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=ge):(this.lastCurrentTime=this.startPosition||e,this.state=pe),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()):(this.startPosition=e,this.state=fe)},i.doTick=function(){var e,t,r,n=this.hls,i=n.config;switch(this.state){case ke:case me:case Se:break;case pe:this.state=_e,this.loadedmetadata=!1;break;case ge:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var o=this.mediaBuffer||this.media,s=this.videoBuffer||this.media,d=e<i.maxBufferHole?Math.max(2,i.maxBufferHole):i.maxBufferHole,h=H.bufferInfo(o,e,d),f=H.bufferInfo(s,e,d),p=h.len,g=h.end,m=this.fragPrevious,v=Math.min(i.maxBufferLength,i.maxMaxBufferLength),y=Math.max(v,f.len);if(s=this.audioSwitch,d=this.trackId,(p<y||s)&&d<a.length){if(void 0===(t=a[d].details)){this.state=_e;break}if(!s&&this._streamEnded(h,t))return this.hls.trigger(u.default.BUFFER_EOS,{type:"audio"}),void(this.state=Te);var b;if(f=(v=t.fragments).length,p=v[0].start,y=v[f-1].start+v[f-1].duration,s)if(t.live&&!t.PTSKnown)l.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),g=0;else if(g=e,t.PTSKnown&&e<p){if(!(h.end>p||h.nextStart))return;l.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=p+.05}if(t.initSegment&&!t.initSegment.data)b=t.initSegment;else if(g<=p){if(b=v[0],null!==this.videoTrackCC&&b.cc!==this.videoTrackCC&&(a=v,r=this.videoTrackCC,b=G.search(a,(function(e){return e.cc<r?1:e.cc>r?-1:0}))),t.live&&b.loadIdx&&b.loadIdx===this.fragLoadIdx){var _=h.nextStart||p;return l.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(_+.05)),void(this.media.currentTime=_+.05)}}else{var w=i.maxFragLookUpTolerance;_=m?v[m.sn-v[0].sn+1]:void 0,f=g<y?(y-w<g&&(w=0),_&&!le(g,w,_)?_:G.search(v,(function(e){return le(g,w,e)}))):v[f-1],f&&(p=(b=f).start,m&&b.level===m.level&&b.sn===m.sn&&(b.sn<t.endSN?(b=v[b.sn+1-t.startSN],this.fragmentTracker.getState(b)!==U&&l.logger.log("SN just loaded, load next one: "+b.sn)):b=null))}b&&(b.encrypted?(l.logger.log("Loading key for "+b.sn+" of ["+t.startSN+" ,"+t.endSN+"],track "+d),this.state=ve,n.trigger(u.default.KEY_LOADING,{frag:b})):(this.fragCurrent=b,!s&&this.fragmentTracker.getState(b)!==M||(l.logger.log("Loading "+b.sn+", cc: "+b.cc+" of ["+t.startSN+" ,"+t.endSN+"],track "+d+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+g.toFixed(3)),"initSegment"!==b.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(b.sn)&&(this.nextLoadPosition=b.start+b.duration),n.trigger(u.default.FRAG_LOADING,{frag:b}),this.state=ye)))}break;case _e:(b=this.tracks[this.trackId])&&b.details&&(this.state=ge);break;case be:var E=Ze.now(),S=this.retryDate,T=(o=this.media)&&o.seeking;(!S||S<=E||T)&&(l.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ge);break;case Oe:(S=this.waitingFragment)?(E=S.frag.cc,void 0!==this.initPTS[E]?(this.waitingFragment=null,this.state=ye,this.onFragLoaded(S)):this.videoTrackCC!==this.waitingVideoCC?(l.logger.log("Waiting fragment cc ("+E+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment()):le((T=H.bufferInfo(this.mediaBuffer,this.media.currentTime,i.maxBufferHole)).end,i.maxFragLookUpTolerance,S.frag)<0&&(l.logger.log("Waiting fragment cc ("+E+") @ "+S.frag.start+" cancelled because another fragment at "+T.end+" is needed"),this.clearWaitingFragment())):this.state=ge}},i.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=ge)},i.onMediaAttached=function(e){e=this.media=this.mediaBuffer=e.media,this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended),e=this.config,this.tracks&&e.autoStartLoad&&this.startLoad(e.startPosition)},i.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onAudioTracksUpdated=function(e){l.logger.log("audio tracks updated"),this.tracks=e.audioTracks},i.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=me,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=ge),this.tick()},i.onAudioTrackLoaded=function(e){var t=e.details,r=e.id,n=this.tracks[r],i=n.details,a=t.totalduration;e=0,l.logger.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live||i&&i.live?i&&0<t.fragments.length?(te(i,t),e=t.fragments[0].start,t.PTSKnown?l.logger.log("live audio playlist sliding:"+e.toFixed(3)):l.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,l.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,n.details=t,this.startFragRequested||(-1===this.startPosition&&(n=t.startTimeOffset,Object(c.isFiniteNumber)(n)?(l.logger.log("start time offset found in playlist, adjust startPosition to "+n),this.startPosition=n):t.live?(this.startPosition=this.computeLivePosition(e,t),l.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0),this.nextLoadPosition=this.startPosition),this.state===_e&&(this.state=ge),this.tick()},i.onKeyLoaded=function(){this.state===ve&&(this.state=ge,this.tick())},i.onFragLoaded=function(e){var t,r,n,i,a,o,s,c=this.fragCurrent,d=e.frag;this.state===ye&&c&&"audio"===d.type&&d.level===c.level&&d.sn===c.sn&&(r=(t=(s=this.tracks[this.trackId]).details).totalduration,n=c.level,i=c.sn,a=c.cc,o=this.config.defaultAudioCodec||s.audioCodec||"mp4a.40.2",d=this.stats=e.stats,"initSegment"===i?(this.state=ge,d.tparsed=d.tbuffered=Ze.now(),t.initSegment.data=e.payload,this.hls.trigger(u.default.FRAG_BUFFERED,{stats:d,frag:c,id:"audio"}),this.tick()):(this.state=we,this.appended=!1,this.demuxer||(this.demuxer=new J(this.hls,"audio")),s=this.initPTS[a],d=t.initSegment?t.initSegment.data:[],void 0!==s?(this.pendingBuffering=!0,l.logger.log("Demuxing "+i+" of ["+t.startSN+" ,"+t.endSN+"],track "+n),this.demuxer.push(e.payload,d,o,null,c,r,!1,s)):(l.logger.log("Unknown video PTS for cc "+a+", waiting for video PTS before demuxing audio frag "+i+" of ["+t.startSN+" ,"+t.endSN+"],track "+n),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=Oe))),this.fragLoadError=0},i.onFragParsingInitSegment=function(e){var t=this.fragCurrent,r=e.frag;t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===we&&((r=e.tracks).video&&delete r.video,(t=r.audio)&&(t.levelCodec=t.codec,t.id=e.id,this.hls.trigger(u.default.BUFFER_CODECS,r),l.logger.log("audio track:audio,container:"+t.container+",codecs[level/parsed]=["+t.levelCodec+"/"+t.codec+"]"),(t=t.initSegment)&&(t={type:"audio",data:t,parent:"audio",content:"initSegment"},this.audioSwitch?this.pendingData=[t]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,t))),this.tick()))},i.onFragParsingData=function(e){var t=this,r=this.fragCurrent,n=e.frag;if(r&&"audio"===e.id&&"audio"===e.type&&n.sn===r.sn&&n.level===r.level&&this.state===we){var i=this.trackId,a=this.tracks[i];n=this.hls,Object(c.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),r.addElementaryStream(g.AUDIO),l.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),ee(a.details,r,e.startPTS,e.endPTS),a=this.media,r=!1,this.audioSwitch&&(a&&a.readyState?(a=a.currentTime,l.logger.log("switching audio track : currentTime:"+a),a>=e.startPTS&&(l.logger.log("switching audio track : flushing all audio"),this.state=Se,n.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),this.audioSwitch=!(r=!0),n.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i}))):(this.audioSwitch=!1,n.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i})));var o=this.pendingData;if(!o)return l.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void n.trigger(u.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach((function(t){t&&t.length&&o.push({type:e.type,data:t,parent:"audio",content:"data"})})),!r&&o.length&&(o.forEach((function(e){t.state===we&&(t.pendingBuffering=!0,t.hls.trigger(u.default.BUFFER_APPENDING,e))})),this.pendingData=[],this.appended=!0)),this.tick()}},i.onFragParsed=function(e){var t=this.fragCurrent,r=e.frag;t&&"audio"===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===we&&(this.stats.tparsed=Ze.now(),this.state=Ee,this._checkAppendedParsed())},i.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},i.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},i.onBufferAppended=function(e){var t;"audio"===e.parent&&((t=this.state)!==we&&t!==Ee||(this.pendingBuffering=0<e.pending,this._checkAppendedParsed()))},i._checkAppendedParsed=function(){var e,t,r;this.state!==Ee||this.appended&&this.pendingBuffering||(r=this.fragCurrent,e=this.stats,t=this.hls,r&&(this.fragPrevious=r,e.tbuffered=Ze.now(),t.trigger(u.default.FRAG_BUFFERED,{stats:e,frag:r,id:"audio"}),(r=this.mediaBuffer||this.media)&&l.logger.log("audio buffered : "+ie.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,t.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ge),this.tick())},i.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:var r,n,i=e.frag;if(i&&"audio"!==i.type)break;e.fatal||((i=this.fragLoadError)?i++:i=1,i<=(r=this.config).fragLoadingMaxRetry?(this.fragLoadError=i,n=Math.min(Math.pow(2,i-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout),l.logger.warn("AudioStreamController: frag loading failed, retry in "+n+" ms"),this.retryDate=Ze.now()+n,this.state=be):(l.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=ke));break;case s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==ke&&(this.state=e.fatal?ke:ge,l.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case s.ErrorDetails.BUFFER_FULL_ERROR:"audio"!==e.parent||this.state!==we&&this.state!==Ee||(r=this.mediaBuffer,n=this.media.currentTime,r&&H.isBuffered(r,n)&&H.isBuffered(r,n+.5)?((n=this.config).maxMaxBufferLength>=n.maxBufferLength&&(n.maxMaxBufferLength/=2,l.logger.warn("AudioStreamController: reduce max buffer length to "+n.maxMaxBufferLength+"s")),this.state=ge):(l.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Se,this.hls.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})))}},i.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(l.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach((function(t){e.hls.trigger(u.default.BUFFER_APPENDING,t)})),this.appended=!0,this.pendingData=[],this.state=Ee):(this.state=ge,this.fragPrevious=null,this.tick())},r=t,(i=[{key:"state",set:function(e){var t;this.state!==e&&(t=this.state,this._state=e,l.logger.log("audio stream:"+t+"->"+e))},get:function(){return this._state}}])&&Je(r.prototype,i),n&&Je(r,n),t}(xe),tt=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}function n(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)e[r]=n[r]}return e}function i(t,i,a){var o=this,s={enumerable:!0};o.hasBeenReset=!1;var c="",u=!1,l=t,d=i,h=a,f=null,p="",g=!0,m="auto",v="start",y=50,b="middle",_=50,w="middle";Object.defineProperty(o,"id",n({},s,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",n({},s,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",n({},s,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},s,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},s,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},s,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},s,{get:function(){return p},set:function(t){if(!1===(t="string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()))throw new SyntaxError("An invalid or illegal string was specified.");p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},s,{get:function(){return g},set:function(e){g=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},s,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},s,{get:function(){return v},set:function(e){if(!(e=r(e)))throw new SyntaxError("An invalid or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},s,{get:function(){return y},set:function(e){if(e<0||100<e)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},s,{get:function(){return b},set:function(e){if(!(e=r(e)))throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},s,{get:function(){return _},set:function(e){if(e<0||100<e)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},s,{get:function(){return w},set:function(e){if(!(e=r(e)))throw new SyntaxError("An invalid or illegal string was specified.");w=e,this.hasBeenReset=!0}})),o.displayState=void 0}return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}();function rt(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Qe,this.regionList=[]}function nt(){this.values=Object.create(null)}function it(e,t,r,n){var i,a,o=n?e.split(n):[e];for(i in o)"string"==typeof o[i]&&2===(a=o[i].split(r)).length&&t(a[0],a[1])}nt.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(t=parseFloat(t))&&t<=100)&&(this.set(e,t),!0)}};var at=new tt(0,0,0),ot="middle"===at.align?"middle":"center";function st(e,t,r){var n,i,a,o=e;function s(){var t;function r(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+(0|n)/1e3}if(null===(t=(t=(t=e).match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/))?t[3]?r(t[1],t[2],t[3].replace(":",""),t[4]):59<t[1]?r(t[1],t[2],0,t[4]):r(0,t[1],t[2],t[4]):null))throw new Error("Malformed timestamp: "+o);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function c(){e=e.replace(/^\s+/,"")}if(c(),t.startTime=s(),c(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+o);e=e.substr(3),c(),t.endTime=s(),c(),n=e,i=t,a=new nt,it(n,(function(e,t){switch(e){case"region":for(var n=r.length-1;0<=n;n--)if(r[n].id===t){a.set(e,r[n].region);break}break;case"vertical":a.alt(e,t,["rl","lr"]);break;case"line":var i=t.split(","),o=i[0];a.integer(e,o),a.percent(e,o)&&a.set("snapToLines",!1),a.alt(e,o,["auto"]),2===i.length&&a.alt("lineAlign",i[1],["start",ot,"end"]);break;case"position":i=t.split(","),a.percent(e,i[0]),2===i.length&&a.alt("positionAlign",i[1],["start",ot,"end","line-left","line-right","auto"]);break;case"size":a.percent(e,t);break;case"align":a.alt(e,t,["start",ot,"end","left","right"])}}),/:/,/\s/),i.region=a.get("region",null),i.vertical=a.get("vertical",""),"auto"===(n=a.get("line","auto"))&&-1===at.line&&(n=-1),i.line=n,i.lineAlign=a.get("lineAlign","start"),i.snapToLines=a.get("snapToLines",!0),i.size=a.get("size",100),i.align=a.get("align",ot),"auto"===(n=a.get("position","auto"))&&50===at.position&&(n="start"===i.align||"left"===i.align?0:"end"===i.align||"right"===i.align?100:50),i.position=n}function ct(e){return e.replace(/<br(?: \/)?>/gi,"\n")}rt.prototype={parse:function(e){var t=this;function r(){for(var e=0,r=ct(r=t.buffer);e<r.length&&"\r"!==r[e]&&"\n"!==r[e];)++e;var n=r.substr(0,e);return"\r"===r[e]&&++e,"\n"===r[e]&&++e,t.buffer=r.substr(e),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var n,i=(n=r()).match(/^()?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=r(),t.state){case"HEADER":/:/.test(n)?it(n,(function(e,t){}),/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new tt(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":try{st(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var o=-1!==n.indexOf("--\x3e");if(!n||o&&(a=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){try{if(this.buffer+=this.decoder.decode(),!this.cue&&"HEADER"!==this.state||(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return this.onflush&&this.onflush(),this}};var ut=rt;function lt(e,t,r,n){for(var i,a,o,s,c,u=[],l=window.VTTCue||TextTrackCue,d=0;d<n.rows.length;d++)if(o=!0,s=0,c="",!(i=n.rows[d]).isEmpty()){for(var h=0;h<i.chars.length;h++)i.chars[h].uchar.match(/\s/)&&o?s++:(c+=i.chars[h].uchar,o=!1);(i.cueStartTime=t)===r&&(r+=1e-4),a=new l(t,r,ct(c.trim())),16<=s?s--:s++,navigator.userAgent.match(/Firefox\//)?a.line=d+1:a.line=7<d?d-2:d+1,a.align="left",a.position=Math.max(0,Math.min(100,s/32*100)),u.push(a),e&&e.addCue(a)}return u}function dt(e){var t=e;return ft.hasOwnProperty(e)&&(t=ft[e]),String.fromCharCode(t)}var ht,ft={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},pt=100,gt={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},mt={17:2,18:4,21:6,22:8,23:10,19:13,20:15},vt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},yt={25:2,26:4,29:6,30:8,31:10,27:13,28:15},bt=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];function _t(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t}(z=ht=ht||{})[z.ERROR=0]="ERROR",z[z.TEXT=1]="TEXT",z[z.WARNING=2]="WARNING",z[z.INFO=2]="INFO",z[z.DEBUG=3]="DEBUG",z[z.DATA=3]="DATA";var wt=function(){function e(){this.time=null,this.verboseLevel=ht.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&l.logger.log(this.time+" ["+e+"] "+t)},e}(),Et=function(){function e(e,t,r,n,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),St=function(){function e(e,t,r,n,i,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Et(t,r,n,i,a)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),Tt=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<pt;t++)this.chars.push(new St);this.logger=e,this.pos=0,this.currPenState=new Et}var t=e.prototype;return t.equals=function(e){for(var t=!0,r=0;r<pt;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<pt;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<pt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(ht.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>pt&&(this.logger.log(ht.DEBUG,"Too large cursor position "+this.pos),this.pos=pt)},t.moveCursor=function(e){var t=this.pos+e;if(1<e)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){144<=e&&this.backSpace();var t=dt(e);this.pos>=pt?this.logger.log(ht.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){for(var t=e;t<pt;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,r=0;r<pt;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),kt=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<15;t++)this.rows.push(new Tt(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<15;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,r=0;r<15;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<15;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<15;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(ht.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(ht.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<15;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var a=i.rows[n].cueStartTime,o=this.logger.time;if(a&&null!==o&&a<o)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(i.rows[n+s])}}this.currRow=t,a=this.rows[this.currRow],null!==e.indent&&(o=e.indent,o=Math.max(o-1,0),a.setCursor(e.indent),e.color=a.chars[o].penState.foreground),e={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1},this.setPen(e)},t.setBkgData=function(e){this.logger.log(ht.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e;null!==this.nrRollUpRows?(this.logger.log(ht.TEXT,this.getDisplayText()),e=this.currRow+1-this.nrRollUpRows,(e=this.rows.splice(e,1)[0]).clear(),this.rows.splice(this.currRow,0,e),this.logger.log(ht.INFO,"Rolling up")):this.logger.log(ht.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],r="",n=0;n<15;n++){var i=this.rows[n].getTextString();i&&(e?t.push("Row "+(n+1)+": '"+i+"'"):t.push(i.trim()))}return 0<t.length?e?"["+t.join(" | ")+"]":t.join("\n"):r},t.getTextAndFormat=function(){return this.rows},e}(),Ot=function(){function e(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new kt(r),this.nonDisplayedMemory=new kt(r),this.lastOutputScreen=new kt(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(ht.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(ht.INFO,r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(ht.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(ht.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(ht.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(ht.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(ht.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(ht.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(ht.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(ht.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(ht.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(ht.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(ht.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(ht.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e;this.logger.log(ht.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode&&(e=this.displayedMemory,this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(ht.TEXT,"DISP: "+this.displayedMemory.getDisplayText())),this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(ht.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};t.underline=e%2==1,t.italics=46<=e,t.italics?t.foreground="white":(e=Math.floor(e/2)-16,t.foreground=["white","green","blue","cyan","red","yellow","magenta"][e]),this.logger.log(ht.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}();function At(e,t,r){r.a=e,r.b=t}function xt(e,t,r){return r.a===e&&r.b===t}function Rt(){return{a:null,b:null}}function Ct(e,t,r){return e.substr(r||0,t.length)===t}function Lt(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}var It=function(){function e(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new wt;this.channels=[null,new Ot(e,t,n),new Ot(e+1,r,n)],this.cmdHistory=Rt(),this.logger=n}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var r,n=!1;this.logger.time=e;for(var i=0;i<t.length;i+=2){var a,o=127&t[i],s=127&t[i+1];0==o&&0==s||(this.logger.log(ht.DATA,"["+_t([t[i],t[i+1]])+"] -> ("+_t([o,s])+")"),(r=(r=(r=(r=this.parseCmd(o,s))||this.parseMidrow(o,s))||this.parsePAC(o,s))||this.parseBackgroundAttributes(o,s))||(n=this.parseChars(o,s))&&((a=this.currentChannel)&&0<a?this.channels[a].insertChars(n):this.logger.log(ht.WARNING,"No channel found yet. TEXT-MODE?")),r||n||this.logger.log(ht.WARNING,"Couldn't parse cleaned data "+_t([o,s])+" orig: "+_t([t[i],t[i+1]])))}},t.parseCmd=function(e,t){var r=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;if(xt(e,t,r))return At(null,null,r),this.logger.log(ht.DEBUG,"Repeated command ("+_t([e,t])+") is dropped"),!0;var n=20===e||21===e||23===e?1:2,i=this.channels[n];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),At(e,t,r),this.currentChannel=n,!0},t.parseMidrow=function(e,t){var r=0;return(17===e||25===e)&&32<=t&&t<=47&&((r=17===e?1:2)!==this.currentChannel?(this.logger.log(ht.ERROR,"Mismatch channel in midrow parsing"),!1):!!(r=this.channels[r])&&(r.ccMIDROW(t),this.logger.log(ht.DEBUG,"MIDROW ("+_t([e,t])+")"),!0))},t.parsePAC=function(e,t){var r=this.cmdHistory;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;if(xt(e,t,r))return At(null,null,r),!0;var n=e<=23?1:2,i=this.channels[n];return!!i&&(i.setPAC(this.interpretPAC((64<=t&&t<=95?1==n?gt:vt:1==n?mt:yt)[e],t)),At(e,t,r),this.currentChannel=n,!0)},t.interpretPAC=function(e,t){var r=t;return(e={color:null,italics:!1,indent:null,underline:!1,row:e}).underline=1==(1&(r=95<t?t-96:t-64)),r<=13?e.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(e.italics=!0,e.color="white"):e.indent=4*Math.floor((r-16)/2),e},t.parseChars=function(e,t){var r,n,i=null,a=null;return 17<=(a=25<=e?(r=2,e-8):(r=1,e))&&a<=19?(n=t,this.logger.log(ht.INFO,"Special char '"+dt(n=17===a?t+80:18===a?t+112:t+144)+"' in channel "+r),i=[n]):32<=e&&e<=127&&(i=0===t?[e]:[e,t]),i&&(n=_t(i),this.logger.log(ht.DEBUG,"Char codes =  "+n.join(",")),At(e,t,this.cmdHistory)),i},t.parseBackgroundAttributes=function(e,t){var r;if(!((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47))return!1;var n={};return 16===e||24===e?(r=Math.floor((t-32)/2),n.background=bt[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),this.channels[e<=23?1:2].setBkgData(n),At(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory=Rt()},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},e}(),Pt=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[]},e}(),Dt={parse:function(e,t,r,n,i,a){e=Object(De.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");var o,s="00:00.000",u=0,l=0,d=0,h=[],f=!0,p=!1,g=new ut;g.oncue=function(e){var t=r[n],i=r.ccOffset;t&&t.new&&(void 0!==l?i=r.ccOffset=t.start:function(e,t,r){var n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,n.new=!1;for(;i&&i.new;)e.ccOffset+=n.start-i.start,n.new=!1,i=e[(n=i).prevCC];e.presentationOffset=r}(r,n,d)),d&&(i=d-r.presentationOffset),p&&(e.startTime+=i-l,e.endTime+=i-l),e.id=Lt(e.startTime.toString())+Lt(e.endTime.toString())+Lt(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),0<e.endTime&&h.push(e)},g.onparsingerror=function(e){o=e},g.onflush=function(){o&&a?a(o):i(h)},e.forEach((function(e){if(f){if(Ct(e,"X-TIMESTAMP-MAP=")){p=!(f=!1),e.substr(16).split(",").forEach((function(e){Ct(e,"LOCAL:")?s=e.substr(6):Ct(e,"MPEGTS:")&&(u=parseInt(e.substr(7)))}));try{t+(9e4*r[n].start||0)<0&&(t+=8589934592),u-=t,l=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),n=parseInt(e.substr(-9,2)),i=9<e.length?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(c.isFiniteNumber)(t)&&Object(c.isFiniteNumber)(r)&&Object(c.isFiniteNumber)(n)&&Object(c.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*r,(t+=6e4*n)+36e5*i}(s)/1e3,d=u/9e4}catch(e){p=!1,o=e}return}""===e&&(f=!1)}g.parse(e+"\n")})),g.flush()}};function jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mt(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}function Nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ft(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];"subtitles"===n.kind&&n.label&&t.push(e[r])}return t}W=function(e){var t;function r(t){var r,n,i,a=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.FRAG_DECRYPTED,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.FRAG_LOADED,u.default.INIT_PTS_FOUND)||this;return a.media=null,a.config=void 0,a.enabled=!0,a.Cues=void 0,a.textTracks=[],a.tracks=[],a.initPTS=[],a.unparsedVttFrags=[],a.captionsTracks={},a.nonNativeCaptionsTracks={},a.captionsProperties=void 0,a.cea608Parser1=void 0,a.cea608Parser2=void 0,a.lastSn=-1,a.prevCC=-1,a.vttCCs=Mt(),a.hls=t,a.config=t.config,a.Cues=t.config.cueHandler,a.captionsProperties={textTrack1:{label:a.config.captionsTextTrack1Label,languageCode:a.config.captionsTextTrack1LanguageCode},textTrack2:{label:a.config.captionsTextTrack2Label,languageCode:a.config.captionsTextTrack2LanguageCode},textTrack3:{label:a.config.captionsTextTrack3Label,languageCode:a.config.captionsTextTrack3LanguageCode},textTrack4:{label:a.config.captionsTextTrack4Label,languageCode:a.config.captionsTextTrack4LanguageCode}},a.config.enableCEA708Captions&&(r=new Pt(jt(a),"textTrack1"),n=new Pt(jt(a),"textTrack2"),i=new Pt(jt(a),"textTrack3"),t=new Pt(jt(a),"textTrack4"),a.cea608Parser1=new It(1,r,n),a.cea608Parser2=new It(3,i,t)),a}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.addCues=function(e,t,r,n,i){for(var a,o,s,c=!1,l=i.length;l--;){var d=i[l],h=(a=d[0],o=d[1],h=t,s=r,Math.min(o,s)-Math.max(a,h));if(0<=h&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],r),c=!0,.5<h/(r-t)))return}c||i.push([t,r]),this.config.renderTextTracksNatively?this.Cues.newCue(this.captionsTracks[e],t,r,n):(n=this.Cues.newCue(null,t,r,n),this.hls.trigger(u.default.CUES_PARSED,{type:"captions",cues:n,track:e}))},n.onInitPtsFound=function(e){var t=this,r=e.frag,n=e.id,i=e.initPTS;e=this.unparsedVttFrags,"main"===n&&(this.initPTS[r.cc]=i),e.length&&(this.unparsedVttFrags=[],e.forEach((function(e){t.onFragLoaded(e)})))},n.getExistingTrack=function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var n=t.textTracks[r];if(n[e])return n}return null},n.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},n.createNativeTrack=function(e){var t,r,n,i,a;this.captionsTracks[e]||(a=this.captionsProperties,t=this.captionsTracks,r=this.media,n=(i=a[e]).label,a=i.languageCode,(i=this.getExistingTrack(e))?(t[e]=i,Me(t[e]),je(t[e],r)):(a=this.createTextTrack("captions",n,a))&&(a[e]=!0,t[e]=a))},n.createNonNativeTrack=function(e){var t;this.nonNativeCaptionsTracks[e]||(t=this.captionsProperties[e])&&(t={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media},this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]}))},n.createTextTrack=function(e,t,r){var n=this.media;if(n)return n.addTextTrack(e,t,r)},n.destroy=function(){e.prototype.destroy.call(this)},n.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},n.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Me(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},n.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=Mt(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},n._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Me(t[r])}},n.onManifestLoaded=function(e){var t,r,n=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT&&(r=e.subtitles||[],r=this.tracks&&r&&this.tracks.length===r.length,this.tracks=e.subtitles||[],this.config.renderTextTracksNatively?(t=this.media?this.media.textTracks:[],this.tracks.forEach((function(e,r){var i,a,o;if(r<t.length){for(var s=null,c=0;c<t.length;c++)if(o=e,(a=t[c])&&a.label===o.name&&!a.textTrack1&&!a.textTrack2){s=t[c];break}s&&(i=s)}i=i||n.createTextTrack("subtitles",e.name,e.lang),e.default?i.mode=n.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",n.textTracks.push(i)}))):!r&&this.tracks&&this.tracks.length&&(r=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}})),this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:r}))),this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(e){var t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);t&&(t="textTrack"+t[1],(t=n.captionsProperties[t])&&(t.label=e.name,e.lang&&(t.languageCode=e.lang),t.media=e))}))},n.onFragLoaded=function(e){var t=e.frag,r=e.payload,n=this.cea608Parser1,i=this.cea608Parser2,a=this.initPTS,o=this.lastSn,s=this.unparsedVttFrags;if("main"===t.type){var l=t.sn;t.sn!==o+1&&n&&i&&(n.reset(),i.reset()),this.lastSn=l}else if("subtitle"===t.type)if(r.byteLength){if(!Object(c.isFiniteNumber)(a[t.cc]))return s.push(e),void(a.length&&this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));null!=(a=t.decryptdata)&&null!=a.key&&"AES-128"===a.method||this._parseVTTs(t,r)}else this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},n._parseVTTs=function(e,t){var r=this,n=this.hls,i=this.prevCC,a=this.textTracks,o=this.vttCCs;o[e.cc]||(o[e.cc]={start:e.start,prevCC:i,new:!0},this.prevCC=e.cc),Dt.parse(t,this.initPTS[e.cc],o,e.cc,(function(t){if(r.config.renderTextTracksNatively){var i=a[e.level];if("disabled"===i.mode)return void n.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach((function(e){if(!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(r){l.logger.debug("Failed occurred on adding cues: "+r);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}))}else{var o=r.tracks[e.level].default?"default":"subtitles"+e.level;n.trigger(u.default.CUES_PARSED,{type:"subtitles",cues:t,track:o})}n.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){l.logger.log("Failed to parse VTT cue: "+t),n.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}))},n.onFragDecrypted=function(e){var t=e.frag,r=e.payload;"subtitle"===t.type&&(Object(c.isFiniteNumber)(this.initPTS[t.cc])?this._parseVTTs(t,r):this.unparsedVttFrags.push(e))},n.onFragParsingUserdata=function(e){var t=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&t&&r)for(var n=0;n<e.samples.length;n++){var i=e.samples[n].bytes;i&&(i=this.extractCea608Data(i),t.addData(e.samples[n].pts,i[0]),r.addData(e.samples[n].pts,i[1]))}},n.extractCea608Data=function(e){for(var t=31&e[0],r=2,n=[[],[]],i=0;i<t;i++){var a=e[r++],o=127&e[r++],s=127&e[r++],c=3&a;0==o&&0==s||0!=(4&a)&&(0!=c&&1!=c||(n[c].push(o),n[c].push(s)))}return n},r}(h),he=function(e){function t(t){return(t=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADED,u.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],t.trackId=-1,t.media=null,t.stopped=!0,t.subtitleDisplay=!0,t.queuedDefaultTrack=null,t}r=e,(i=t).prototype=Object.create(r.prototype),(i.prototype.constructor=i).__proto__=r;var r,n,i=t.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(c.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){t.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},i.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(c.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Ft(this.media.textTracks).forEach((function(e){Me(e)})),this.subtitleTrack=-1,this.media=null)},i.onManifestLoaded=function(e){var t=this;e=e.subtitles||[],this.tracks=e,this.hls.trigger(u.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:e}),e.forEach((function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)}))},i.onSubtitleTrackLoaded=function(e){var t=this,r=e.id,n=e.details,i=this.trackId,a=this.tracks,o=a[i];r>=a.length||r!==i||!o||this.stopped?this._clearReloadTimer():(l.logger.log("subtitle track "+r+" loaded"),n.live?(e=ne(o.details,n,e.stats.trequest),l.logger.log("Reloading live subtitle playlist in "+e+"ms"),this.timer=setTimeout((function(){t._loadCurrentTrack()}),e)):this._clearReloadTimer())},i.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},i.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},i._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},i._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,r=this.hls;t=t[e],e<0||!t||t.details&&!t.details.live||(l.logger.log("Loading subtitle track "+e),r.trigger(u.default.SUBTITLE_TRACK_LOADING,{url:t.url,id:e}))},i._toggleTrackModes=function(e){var t=this.media,r=this.subtitleDisplay,n=this.trackId;t&&(t=Ft(t.textTracks),-1===e?[].slice.call(t).forEach((function(e){e.mode="disabled"})):(n=t[n])&&(n.mode="disabled"),(e=t[e])&&(e.mode=r?"showing":"hidden"))},i._setSubtitleTrackInternal=function(e){var t=this.hls,r=this.tracks;!Object(c.isFiniteNumber)(e)||e<-1||e>=r.length||(this.trackId=e,l.logger.log("Switching to subtitle track "+e),t.trigger(u.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},i._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=Ft(this.media.textTracks),r=0;r<t.length;r++)if("hidden"===t[r].mode)e=r;else if("showing"===t[r].mode){e=r;break}this.subtitleTrack=e}},r=t,(i=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}])&&Nt(r.prototype,i),n&&Nt(r,n),t}(h);var Ut,Bt=r("./src/crypt/decrypter.js"),Gt=window.performance;function Ht(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function zt(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)),n}function Kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zt(Object(r),!0).forEach((function(t){var n,i;n=e,t=r[i=t],i in n?Object.defineProperty(n,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[i]=t})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}z=function(e){var t;function r(t,r){var n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.ERROR,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED,u.default.LEVEL_UPDATED)||this;return n.fragmentTracker=r,n.config=t.config,n.state=fe,n.tracks=[],n.tracksBuffered=[],n.currentTrackId=-1,n.decrypter=new Bt.default(t,t.config),n.lastAVStart=0,n._onMediaSeeking=n.onMediaSeeking.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n;var n=r.prototype;return n.startLoad=function(){this.stopLoad(),this.state=ge;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(500),this.tick())},n.onSubtitleFragProcessed=function(e){var t=e.frag;if(e=e.success,this.fragPrevious=t,this.state=ge,e){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var n,i=t.start,a=0;a<r.length;a++)if(i>=r[a].start&&i<=r[a].end){n=r[a];break}t=t.start+t.duration,n?n.end=t:r.push(n={start:i,end:t})}}},n.onMediaAttached=function(e){e=e.media,(this.media=e).addEventListener("seeking",this._onMediaSeeking),this.state=ge},n.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]})),this.media=null,this.state=fe)},n.onError=function(e){(e=e.frag)&&"subtitle"===e.type&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=ge)},n.onSubtitleTracksUpdated=function(e){var t=this;l.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]}))},n.onSubtitleTrackSwitch=function(e){this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId?(e=this.tracks[this.currentTrackId])&&e.details&&this.setInterval(500):this.clearInterval()},n.onSubtitleTrackLoaded=function(e){var t=e.id,r=e.details,n=this.currentTrackId,i=this.tracks;e=i[n],t>=i.length||t!==n||!e||(r.live&&function(e,t,r){void 0===r&&(r=0);var n=-1;re(e,t,(function(e,t,r){t.start=e.start,n=r}));var i=t.fragments;if(n<0)i.forEach((function(e){e.start+=r}));else for(var a=n+1;a<i.length;a++)i[a].start=i[a-1].start+i[a-1].duration}(e.details,r,this.lastAVStart),e.details=r,this.setInterval(500))},n.onKeyLoaded=function(){this.state===ve&&(this.state=ge)},n.onFragLoaded=function(e){var t,r=this.fragCurrent,n=e.frag.decryptdata,i=e.frag,a=this.hls;this.state===ye&&r&&"subtitle"===e.frag.type&&r.sn===e.frag.sn&&0<e.payload.byteLength&&n&&n.key&&"AES-128"===n.method&&(t=Gt.now(),this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,(function(e){var r=Gt.now();a.trigger(u.default.FRAG_DECRYPTED,{frag:i,payload:e,stats:{tstart:t,tdecrypt:r}})})))},n.onLevelUpdated=function(e){e=e.details.fragments,this.lastAVStart=e.length?e[0].start:0},n.doTick=function(){if(this.media)switch(this.state){case ge:var e=this.config,t=this.currentTrackId,r=this.fragmentTracker,n=this.media;if(!(a=this.tracks)||!a[t]||!a[t].details)break;var i,a,o,s=e.maxBufferHole,c=e.maxFragLookUpTolerance,d=Math.min(e.maxBufferLength,e.maxMaxBufferLength);if(e=(i=H.bufferedInfo(this._getBuffered(),n.currentTime,s)).end,n=i.len,t=(i=(s=a[t].details).fragments)[(a=i.length)-1].start+i[a-1].duration,d<n)return;n=this.fragPrevious,(o=e<t?(o=n&&s.hasProgramDateTime?ce(i,n.endProgramDateTime,c):o)||ue(n,i,e,c):i[a-1])&&o.encrypted?(l.logger.log("Loading key for "+o.sn),this.state=ve,this.hls.trigger(u.default.KEY_LOADING,{frag:o})):o&&r.getState(o)===M&&(this.fragCurrent=o,this.state=ye,this.hls.trigger(u.default.FRAG_LOADING,{frag:o}))}else this.state=ge},n.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,e.prototype.stopLoad.call(this)},n._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},n.onMediaSeeking=function(){var e,t,r;this.fragCurrent&&(e=this.media?this.media.currentTime:0,r=this.config.maxFragLookUpTolerance,t=this.fragCurrent.start-r,r=this.fragCurrent.start+this.fragCurrent.duration+r,(e<t||r<e)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=ge,this.tick()))},r}(xe),(r=Ut=Ut||{}).WIDEVINE="com.widevine.alpha",r.PLAYREADY="com.microsoft.playready",xe="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null,r=function(e){function t(t){var r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHED,u.default.MANIFEST_PARSED)||this;return r._widevineLicenseUrl=void 0,r._licenseXhrSetup=void 0,r._emeEnabled=void 0,r._requestMediaKeySystemAccess=void 0,r._drmSystemOptions=void 0,r._config=void 0,r._mediaKeysList=[],r._media=null,r._hasSetMediaKeys=!1,r._requestLicenseFailureCount=0,r.mediaKeysPromise=null,r._onMediaEncrypted=function(e){if(l.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!r.mediaKeysPromise)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void r.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});function t(t){r._media&&(r._attemptSetMediaKeys(t),r._generateRequestWithPreferredKeySession(e.initDataType,e.initData))}r.mediaKeysPromise.then(t).catch(t)},r._config=t.config,r._widevineLicenseUrl=r._config.widevineLicenseUrl,r._licenseXhrSetup=r._config.licenseXhrSetup,r._emeEnabled=r._config.emeEnabled,r._requestMediaKeySystemAccess=r._config.requestMediaKeySystemAccessFunc,r._drmSystemOptions=t.config.drmSystemOptions,r}r=e,(i=t).prototype=Object.create(r.prototype),(i.prototype.constructor=i).__proto__=r;var r,n,i=t.prototype;return i.getLicenseServerUrl=function(e){switch(e){case Ut.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},i._attemptKeySystemAccess=function(e,t,r){var n=this;r=function(e,t,r,n){if(e!==Ut.WIDEVINE)throw new Error("Unknown key-system: "+e);return i=n,a={audioCapabilities:[],videoCapabilities:[]},t.forEach((function(e){a.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:i.audioRobustness||""})})),r.forEach((function(e){a.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:i.videoRobustness||""})})),[a];var i,a}(e,t,r,this._drmSystemOptions),l.logger.log("Requesting encrypted media key-system access"),r=this.requestMediaKeySystemAccess(e,r),this.mediaKeysPromise=r.then((function(t){return n._onMediaKeySystemAccessObtained(e,t)})),r.catch((function(t){l.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},i._onMediaKeySystemAccessObtained=function(e,t){var r=this;l.logger.log('Access for key-system "'+e+'" obtained');var n={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(n);var i=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(t){return n.mediaKeys=t,l.logger.log('Media-keys created for key-system "'+e+'"'),r._onMediaKeysCreated(),t}));return i.catch((function(e){l.logger.error("Failed to create media-keys:",e)})),i},i._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},i._onNewMediaKeySession=function(e){var t=this;l.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(r){t._onKeySessionMessage(e,r.message)}),!1)},i._onKeySessionMessage=function(e,t){l.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){l.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),e.update(t)}))},i._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(e,t){var r=this,n=this._mediaKeysList[0];if(!n)return l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(!n.mediaKeysSessionInitialized){var i=n.mediaKeysSession;return i?t?(l.logger.log('Generating key-session request for "'+e+'" init data type'),n.mediaKeysSessionInitialized=!0,void i.generateRequest(e,t).then((function(){l.logger.debug("Key-session generation succeeded")})).catch((function(e){l.logger.error("Error generating key-session request:",e),r.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))):(l.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0})):(l.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}))}l.logger.warn("Key-Session already initialized but requested again")},i._createLicenseXhr=function(e,t,r){var n=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(n,e)}catch(t){n.open("POST",e,!0),i(n,e)}n.readyState||n.open("POST",e,!0)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,e,t,r),n},i._onLicenseRequestReadyStageChange=function(e,t,r,n){if(4===e.readyState)if(200===e.status)this._requestLicenseFailureCount=0,l.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&l.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),n(e.response);else{if(l.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,3<this._requestLicenseFailureCount)return void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});e=3-this._requestLicenseFailureCount+1,l.logger.warn("Retrying license request, "+e+" attempts left"),this._requestLicense(r,n)}},i._generateLicenseRequestChallenge=function(e,t){if(e.mediaKeySystemDomain===Ut.WIDEVINE)return t;throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},i._requestLicense=function(e,t){l.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var n=this.getLicenseServerUrl(r.mediaKeySystemDomain),i=this._createLicenseXhr(n,e,t);l.logger.log("Sending license request to URL: "+n);var a=this._generateLicenseRequestChallenge(r,e);i.send(a)}catch(e){l.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(u.default.ERROR,{type:s.ErrorTypes.KEY_SYSTEM_ERROR,details:s.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},i.onMediaAttached=function(e){this._emeEnabled&&(e=e.media,(this._media=e).addEventListener("encrypted",this._onMediaEncrypted))},i.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch((function(){}))}))).then((function(){return e.setMediaKeys(null)})).catch((function(){})))},i.onManifestParsed=function(e){var t;this._emeEnabled&&(t=e.levels.map((function(e){return e.audioCodec})),e=e.levels.map((function(e){return e.videoCodec})),this._attemptKeySystemAccess(Ut.WIDEVINE,t,e))},r=t,(i=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&Ht(r.prototype,i),n&&Ht(r,n),t}(h);var qt=Kt(Kt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ye,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:He,bufferController:Ke,capLevelController:Ve,fpsController:t,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:xe,testBandwidth:!0},{cueHandler:n,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:z,subtitleTrackController:he,timelineController:W,audioStreamController:et,audioTrackController:$e,emeController:r});function Vt(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)),n}function Wt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(r),!0).forEach((function(t){var n,i;n=e,t=r[i=t],i in n?Object.defineProperty(n,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[i]=t})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $t(e,t,r){return t&&Xt(e.prototype,t),r&&Xt(e,r),e}var Jt=function(e){var t;function r(t){var n;void 0===t&&(t={}),(n=e.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var i=r.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=Wt(Wt({},i),t);var a=Yt(n).config;if(void 0!==a.liveMaxLatencyDurationCount&&a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==a.liveMaxLatencyDuration&&(void 0===a.liveSyncDuration||a.liveMaxLatencyDuration<=a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(l.enableLogs)(a.debug),n._autoLevelCapping=-1;var o,s=n.abrController=new a.abrController(Yt(n)),c=new a.bufferController(Yt(n)),u=n.capLevelController=new a.capLevelController(Yt(n)),d=new a.fpsController(Yt(n)),h=new P(Yt(n)),f=new D(Yt(n)),p=new j(Yt(n)),g=new Ne(Yt(n)),m=n.levelController=new Pe(Yt(n));return i=new B(Yt(n)),t=[m,n.streamController=new Le(Yt(n),i)],(m=a.audioStreamController)&&t.push(new m(Yt(n),i)),n.networkControllers=t,d=[h,f,p,s,c,u,d,g,i],(m=a.audioTrackController)&&(g=new m(Yt(n)),n.audioTrackController=g,d.push(g)),(m=a.subtitleTrackController)&&(o=new m(Yt(n)),n.subtitleTrackController=o,t.push(o)),(m=a.emeController)&&(o=new m(Yt(n)),n.emeController=o,d.push(o)),(m=a.subtitleStreamController)&&t.push(new m(Yt(n),i)),(m=a.timelineController)&&d.push(new m(Yt(n))),n.coreComponents=d,n}n=e,(t=r).prototype=Object.create(n.prototype),(t.prototype.constructor=t).__proto__=n,r.isSupported=function(){if(!(t=V()))return!1;var e=self.SourceBuffer||self.WebKitSourceBuffer,t=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');return e=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove,!!t&&!!e},$t(r,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return u.default}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig||qt},set:function(e){r.defaultConfig=e}}]);var n=r.prototype;return n.destroy=function(){l.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(e){e.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},n.attachMedia=function(e){l.logger.log("attachMedia"),this.media=e,this.trigger(u.default.MEDIA_ATTACHING,{media:e})},n.detachMedia=function(){l.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null},n.loadSource=function(e){e=o.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),l.logger.log("loadSource:"+e),this.url=e,this.trigger(u.default.MANIFEST_LOADING,{url:e})},n.startLoad=function(e){l.logger.log("startLoad("+(e=void 0===e?-1:e)+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},n.stopLoad=function(){l.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},n.swapAudioCodec=function(){l.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},n.recoverMediaError=function(){l.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},n.removeLevel=function(e,t){this.levelController.removeLevel(e,t=void 0===t?0:t)},$t(r,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){l.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){l.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){l.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){l.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){l.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){(e=!!e)!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){l.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,r=e?e.length:0,n=0;n<r;n++)if(t<(e[n].realBitrate?Math.max(e[n].realBitrate,e[n].bitrate):e[n].bitrate))return n;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels;return e=-1===(e=this.autoLevelCapping)&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),r}(Y);Jt.defaultConfig=void 0},"./src/polyfills/number.js":function(e,t,r){"use strict";r.r(t),r.d(t,"isFiniteNumber",(function(){return n})),r.d(t,"MAX_SAFE_INTEGER",(function(){return i}));var n=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(e,t,r){"use strict";function n(){return"undefined"==typeof window?self:window}r.r(t),r.d(t,"getSelfScope",(function(){return n}))},"./src/utils/logger.js":function(e,t,r){"use strict";function n(){}r.r(t),r.d(t,"enableLogs",(function(){return c})),r.d(t,"logger",(function(){return u})),r=r("./src/utils/get-self-scope.js");var i={trace:n,debug:n,log:n,warn:n,info:n,error:n},a=i,o=Object(r.getSelfScope)();function s(e){var t=o.console[e];return t?function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];n[0]&&(n[0]="["+e+"] > "+n[0]),t.apply(o.console,n)}:n}var c=function(e){if(o.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];r.forEach((function(t){a[t]=e[t]?e[t].bind(e):s(t)}))}(e,"debug","log","info","warn","error");try{a.log()}catch(e){a=i}}else a=i},u=a}},e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var i in t)e.d(n,i,function(e){return t[e]}.bind(null,i));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="/dist/",e(e.s="./src/hls.ts").default;function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t,r},e.exports=n())},function(e,t,r){var n=r(3);e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(0<e?n:r)(e)}},function(e,t,r){var n=r(31);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n=r(10),i=r(65);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(r){}return function(r,a){return n(r),i(a),t?e.call(r,a):r.__proto__=a,r}}():void 0)},function(e,t,r){var n=r(2),i=r(51),a=r(15),o=r(16),s=r(18),c=r(1),u=r(32),l=Object.getOwnPropertyDescriptor;t.f=n?l:function(e,t){if(e=o(e),t=s(t,!0),u)try{return l(e,t)}catch(e){}if(c(e,t))return a(!i.f.call(e,t),e[t])}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(30),i=r(31);e.exports=function(e){return n(i(e))}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(3);e.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,r){var n=r(0),i=r(7),a=r(1),o=r(20),s=r(34),c=(r=r(21)).get,u=r.enforce,l=String(String).split("String");(e.exports=function(e,t,r,s){var c=!!s&&!!s.unsafe,d=!!s&&!!s.enumerable;s=!!s&&!!s.noTargetGet,"function"==typeof r&&("string"!=typeof t||a(r,"name")||i(r,"name",t),u(r).source=l.join("string"==typeof t?t:"")),e!==n?(c?!s&&e[t]&&(d=!0):delete e[t],d?e[t]=r:i(e,t,r)):d?e[t]=r:o(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&c(this).source||s(this)}))},function(e,t,r){var n=r(0),i=r(7);e.exports=function(e,t){try{i(n,e,t)}catch(r){n[e]=t}return t}},function(e,t,r){var n,i,a,o,s,c,u,l,d=r(52),h=r(0),f=r(3),p=r(7),g=r(1),m=r(22);r=r(24),h=h.WeakMap,u=d?(n=new h,i=n.get,a=n.has,o=n.set,s=function(e,t){return o.call(n,e,t),t},c=function(e){return i.call(n,e)||{}},function(e){return a.call(n,e)}):(r[l=m("state")]=!0,s=function(e,t){return p(e,l,t),t},c=function(e){return g(e,l)?e[l]:{}},function(e){return g(e,l)}),e.exports={set:s,get:c,has:u,enforce:function(e){return u(e)?c(e):s(e,{})},getterFor:function(e){return function(t){var r;if(!f(t)||(r=c(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){var n=r(36),i=r(23),a=n("keys");e.exports=function(e){return a[e]||(a[e]=i(e))}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++r+n).toString(36)}},function(e,t){e.exports={}},function(e,t,r){function n(e){return"function"==typeof e?e:void 0}var i=r(56),a=r(0);e.exports=function(e,t){return arguments.length<2?n(i[e])||n(a[e]):i[e]&&i[e][t]||a[e]&&a[e][t]}},function(e,t,r){var n=r(37),i=r(27).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){"use strict";function n(e){return u(e)&&l(O,d(e))}var i,a,o=r(40),s=r(2),c=r(0),u=r(3),l=r(1),d=r(29),h=r(7),f=r(19),p=r(6).f,g=r(41),m=r(13),v=r(4),y=r(23),b=c.Int8Array,_=b&&b.prototype,w=(r=(a=c.Uint8ClampedArray)&&a.prototype,b&&g(b)),E=_&&g(_),S=(a=Object.prototype).isPrototypeOf,T=(v=v("toStringTag"),y("TYPED_ARRAY_TAG")),k=o&&!!m&&"Opera"!==d(c.opera),O=(o=!1,{Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8});for(i in O)c[i]||(k=!1);if((!k||"function"!=typeof w||w===Function.prototype)&&(w=function(){throw TypeError("Incorrect invocation")},k))for(i in O)c[i]&&m(c[i],w);if((!k||!E||E===a)&&(E=w.prototype,k))for(i in O)c[i]&&m(c[i].prototype,E);if(k&&g(r)!==E&&m(r,E),s&&!l(E,v))for(i in o=!0,p(E,v,{get:function(){return u(this)?this[T]:void 0}}),O)c[i]&&h(c[i],T,i);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:k,TYPED_ARRAY_TAG:o&&T,aTypedArray:function(e){if(n(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(m){if(S.call(w,e))return e}else for(var t in O)if(l(O,i)&&(t=c[t])&&(e===t||S.call(t,e)))return e;throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(s){if(r)for(var n in O)(n=c[n])&&l(n.prototype,e)&&delete n.prototype[e];E[e]&&!r||f(E,e,!r&&k&&_[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(s){if(m){if(r)for(n in O)(i=c[n])&&l(i,e)&&delete i[e];if(w[e]&&!r)return;try{return f(w,e,!r&&k&&b[e]||t)}catch(e){}}for(n in O)!(i=c[n])||i[e]&&!r||f(i,e,t)}},isView:function(e){return"DataView"===(e=d(e))||l(O,e)},isTypedArray:n,TypedArray:w,TypedArrayPrototype:E}},function(e,t,r){var n=r(63),i=r(17),a=r(4)("toStringTag"),o="Arguments"==i(function(){return arguments}());e.exports=n?i:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),a))?e:o?i(t):"Object"==(e=i(t))&&"function"==typeof t.callee?"Arguments":e}},function(e,t,r){var n=r(5),i=r(17),a="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?a.call(e,""):Object(e)}:Object},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},function(e,t,r){var n=r(2),i=r(5),a=r(33);e.exports=!n&&!i((function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){var n=r(0),i=(r=r(3),n.document),a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,r){r=r(35);var n=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(e){return n.call(e)}),e.exports=r.inspectSource},function(e,t,r){var n=r(0),i=r(20);r=n[r="__core-js_shared__"]||i(r,{}),e.exports=r},function(e,t,r){var n=r(53),i=r(35);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:n?"pure":"global",copyright:" 2020 Denis Pushkarev (zloirock.ru)"})},function(e,t,r){var n=r(1),i=r(16),a=r(57).indexOf,o=r(24);e.exports=function(e,t){var r,s=i(e),c=0,u=[];for(r in s)!n(o,r)&&n(s,r)&&u.push(r);for(;t.length>c;)n(s,r=t[c++])&&(~a(u,r)||u.push(r));return u}},function(e,t,r){var n=r(11),i=Math.max,a=Math.min;e.exports=function(e,t){return(e=n(e))<0?i(e+t,0):a(e,t)}},function(e,t,r){r=r(5),e.exports=!!Object.getOwnPropertySymbols&&!r((function(){return!String(Symbol())}))},function(e,t){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},function(e,t,r){var n=r(1),i=r(12),a=r(22),o=(r=r(64),a("IE_PROTO")),s=Object.prototype;e.exports=r?Object.getPrototypeOf:function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t){e.exports=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e}},function(e,t,r){var n=r(11),i=r(8);e.exports=function(e){if(void 0===e)return 0;var t=n(e);if(t!==(e=i(t)))throw RangeError("Wrong length or index");return e}},function(e,t){e.exports={}},function(e,t,r){var n=r(80);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){e.exports=r(87)},function(e,t,r){r(48)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},function(e,t,r){"use strict";function n(e,t){for(var r=0,n=t.length,i=new(K(e))(n);r<n;)i[r]=t[r++];return i}function i(e){var t;return e instanceof F||"ArrayBuffer"==(t=_(e))||"SharedArrayBuffer"==t}function a(e,t){return q(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)}var o=r(49),s=r(0),c=r(2),u=r(60),l=r(28),d=r(66),h=r(42),f=r(15),p=r(7),g=r(8),m=r(43),v=r(71),y=r(18),b=r(1),_=r(29),w=r(3),E=r(73),S=r(13),T=r(26).f,k=r(77),O=r(81).forEach,A=r(84),x=r(6),R=r(14),C=r(21),L=r(85),I=C.get,P=C.set,D=x.f,j=R.f,M=Math.round,N=s.RangeError,F=d.ArrayBuffer,U=d.DataView,B=l.NATIVE_ARRAY_BUFFER_VIEWS,G=l.TYPED_ARRAY_TAG,H=l.TypedArray,z=l.TypedArrayPrototype,K=l.aTypedArrayConstructor,q=l.isTypedArray,V="BYTES_PER_ELEMENT",W="Wrong length";C=function(e,t){D(e,t,{get:function(){return I(this)[t]}})},d=function(e,t){return a(e,t=y(t,!0))?f(2,e[t]):j(e,t)},l=function(e,t,r){return!(a(e,t=y(t,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?D(e,t,r):(e[t]=r.value,e)},c?(B||(R.f=d,x.f=l,C(z,"buffer"),C(z,"byteOffset"),C(z,"byteLength"),C(z,"length")),o({target:"Object",stat:!0,forced:!B},{getOwnPropertyDescriptor:d,defineProperty:l}),e.exports=function(e,t,r){function a(e,t){D(e,t,{get:function(){return function(e,t){return(e=I(e)).view[d](t*c+e.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){e=I(e),r&&(n=(n=M(n))<0?0:255<n?255:255&n),e.view[f](t*c+e.byteOffset,n,!0)}(this,t,e)},enumerable:!0})}var c=e.match(/\d+$/)[0]/8,l=e+(r?"Clamped":"")+"Array",d="get"+e,f="set"+e,y=s[l],b=y,_=b&&b.prototype;e={},B?u&&(b=t((function(e,t,r,a){return h(e,b,l),L(w(t)?i(t)?void 0!==a?new y(t,v(r,c),a):void 0!==r?new y(t,v(r,c)):new y(t):q(t)?n(b,t):k.call(b,t):new y(m(t)),e,b)})),S&&S(b,H),O(T(y),(function(e){e in b||p(b,e,y[e])})),b.prototype=_):(b=t((function(e,t,r,o){h(e,b,l);var s,u,d=0,f=0;if(w(t)){if(!i(t))return q(t)?n(b,t):k.call(b,t);var p=t;if(f=v(r,c),r=t.byteLength,void 0===o){if(r%c)throw N(W);if((s=r-f)<0)throw N(W)}else if(r<(s=g(o)*c)+f)throw N(W);u=s/c}else u=m(t),p=new F(s=u*c);for(P(e,{buffer:p,byteOffset:f,byteLength:s,length:u,view:new U(p)});d<u;)a(e,d++)})),S&&S(b,H),_=b.prototype=E(z)),_.constructor!==b&&p(_,"constructor",b),G&&p(_,G,l),e[l]=b,o({global:!0,forced:b!=y,sham:!B},e),V in b||p(b,V,c),V in _||p(_,V,c),A(l)}):e.exports=function(){}},function(e,t,r){var n=r(0),i=r(14).f,a=r(7),o=r(19),s=r(20),c=r(54),u=r(59);e.exports=function(e,t){var r,l,d,h=e.target,f=e.global,p=e.stat,g=f?n:p?n[h]||s(h,{}):(n[h]||{}).prototype;if(g)for(r in t){if(l=t[r],d=e.noTargetGet?(d=i(g,r))&&d.value:g[r],!u(f?r:h+(p?".":"#")+r,e.forced)&&void 0!==d){if(typeof l==typeof d)continue;c(l,d)}(e.sham||d&&d.sham)&&a(l,"sham",!0),o(g,r,l,e)}}},function(e,t){var r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,a=i&&!n.call({1:2},1);t.f=a?function(e){return!!(e=i(this,e))&&e.enumerable}:n},function(e,t,r){var n=r(0);r=r(34),n=n.WeakMap,e.exports="function"==typeof n&&/native code/.test(r(n))},function(e,t){e.exports=!1},function(e,t,r){var n=r(1),i=r(55),a=r(14),o=r(6);e.exports=function(e,t){for(var r=i(t),s=o.f,c=a.f,u=0;u<r.length;u++){var l=r[u];n(e,l)||s(e,l,c(t,l))}}},function(e,t,r){var n=r(25),i=r(26),a=r(58),o=r(10);e.exports=n("Reflect","ownKeys")||function(e){var t=i.f(o(e)),r=a.f;return r?t.concat(r(e)):t}},function(e,t,r){r=r(0),e.exports=r},function(e,t,r){var n=r(16),i=r(8),a=r(38);r=function(e){return function(t,r,o){var s,c=n(t),u=i(c.length),l=a(o,u);if(e&&r!=r){for(;l<u;)if((s=c[l++])!=s)return!0}else for(;l<u;l++)if((e||l in c)&&c[l]===r)return e||l||0;return!e&&-1}},e.exports={includes:r(!0),indexOf:r(!1)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,r){var n=r(5),i=/#|\.prototype\./,a=(r=function(e,t){return(e=o[a(e)])==c||e!=s&&("function"==typeof t?n(t):!!t)},r.normalize=function(e){return String(e).replace(i,".").toLowerCase()}),o=r.data={},s=r.NATIVE="N",c=r.POLYFILL="P";e.exports=r},function(e,t,r){var n=r(0),i=r(5),a=r(61),o=(r=r(28).NATIVE_ARRAY_BUFFER_VIEWS,n.ArrayBuffer),s=n.Int8Array;e.exports=!r||!i((function(){s(1)}))||!i((function(){new s(-1)}))||!a((function(e){new s,new s(null),new s(1.5),new s(e)}),!0)||i((function(){return 1!==new s(new o(2),1,void 0).length}))},function(e,t,r){var n=r(4)("iterator"),i=!1;try{var a=0,o={next:function(){return{done:!!a++}},return:function(){i=!0}};o[n]=function(){return this},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var a={};a[n]=function(){return{next:function(){return{done:r=!0}}}},e(a)}catch(e){}return r}},function(e,t,r){r=r(39),e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){var n={};n[r(4)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){r=r(5),e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){var n=r(3);e.exports=function(e){if(!n(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},function(e,t,r){"use strict";function n(e){return[255&e]}function i(e){return[255&e,e>>8&255]}function a(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function o(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function s(e){return U(e,23,4)}function c(e){return U(e,52,8)}function u(e,t,r,n){var i=_(r);if(i+t>(r=x(e)).byteLength)throw F(P);return e=x(r.buffer).bytes,r=i+r.byteOffset,t=e.slice(r,r+t),n?t:t.reverse()}function l(e,t,r,n,i,a){if((r=_(r))+t>(e=x(e)).byteLength)throw F(P);for(var o=x(e.buffer).bytes,s=r+e.byteOffset,c=n(+i),u=0;u<t;u++)o[s+u]=c[a?u:t-u-1]}var d=r(0),h=r(2),f=r(40),p=r(7),g=r(67),m=r(5),v=r(42),y=r(11),b=r(8),_=r(43),w=r(68),E=r(41),S=r(13),T=r(26).f,k=r(6).f,O=r(69),A=r(70),x=(N=r(21)).get,R=N.set,C="ArrayBuffer",L="DataView",I="prototype",P="Wrong index",D=d[C],j=D,M=d[L],N=(r=M&&M[I],Object.prototype),F=d.RangeError,U=w.pack,B=w.unpack;if(w=function(e,t){k(e[I],t,{get:function(){return x(this)[t]}})},f){if(!m((function(){D(1)}))||!m((function(){new D(-1)}))||m((function(){return new D,new D(1.5),new D(NaN),D.name!=C}))){m=(j=function(e){return v(this,j),new D(_(e))})[I]=D[I];for(var G,H=T(D),z=0;H.length>z;)(G=H[z++])in j||p(j,G,D[G]);m.constructor=j}S&&E(r)!==N&&S(r,N),N=new M(new j(2));var K=r.setInt8;N.setInt8(0,2147483648),N.setInt8(1,2147483649),!N.getInt8(0)&&N.getInt8(1)||g(r,{setInt8:function(e,t){K.call(this,e,t<<24>>24)},setUint8:function(e,t){K.call(this,e,t<<24>>24)}},{unsafe:!0})}else j=function(e){v(this,j,C),e=_(e),R(this,{bytes:O.call(new Array(e),0),byteLength:e}),h||(this.byteLength=e)},M=function(e,t,r){v(this,M,L),v(e,j,L);var n=x(e).byteLength;if((t=y(t))<0||n<t)throw F("Wrong offset");if(n<t+(r=void 0===r?n-t:b(r)))throw F("Wrong length");R(this,{buffer:e,byteLength:r,byteOffset:t}),h||(this.buffer=e,this.byteLength=r,this.byteOffset=t)},h&&(w(j,"byteLength"),w(M,"buffer"),w(M,"byteLength"),w(M,"byteOffset")),g(M[I],{getInt8:function(e){return u(this,1,e)[0]<<24>>24},getUint8:function(e){return u(this,1,e)[0]},getInt16:function(e){return((e=u(this,2,e,1<arguments.length?arguments[1]:void 0))[1]<<8|e[0])<<16>>16},getUint16:function(e){return(e=u(this,2,e,1<arguments.length?arguments[1]:void 0))[1]<<8|e[0]},getInt32:function(e){return o(u(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return o(u(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return B(u(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return B(u(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){l(this,1,e,n,t)},setUint8:function(e,t){l(this,1,e,n,t)},setInt16:function(e,t){l(this,2,e,i,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){l(this,2,e,i,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){l(this,4,e,a,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){l(this,4,e,a,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){l(this,4,e,s,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){l(this,8,e,c,t,2<arguments.length?arguments[2]:void 0)}});A(j,C),A(M,L),e.exports={ArrayBuffer:j,DataView:M}},function(e,t,r){var n=r(19);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},function(e,t){var r=Math.abs,n=Math.pow,i=Math.floor,a=Math.log,o=Math.LN2;e.exports={pack:function(e,t,s){var c,u,l=new Array(s),d=8*s-t-1,h=(1<<d)-1,f=h>>1,p=23===t?n(2,-24)-n(2,-77):0,g=e<0||0===e&&1/e<0?1:0,m=0;for((e=r(e))!=e||e===1/0?(u=e!=e?1:0,c=h):(c=i(a(e)/o),e*(s=n(2,-c))<1&&(c--,s*=2),2<=(e+=1<=c+f?p/s:p*n(2,1-f))*s&&(c++,s/=2),h<=c+f?(u=0,c=h):1<=c+f?(u=(e*s-1)*n(2,t),c+=f):(u=e*n(2,f-1)*n(2,t),c=0));8<=t;l[m++]=255&u,u/=256,t-=8);for(c=c<<t|u,d+=t;0<d;l[m++]=255&c,c/=256,d-=8);return l[--m]|=128*g,l},unpack:function(e,t){var r,i,a=8*(i=e.length)-t-1,o=(1<<a)-1,s=o>>1,c=a-7,u=i-1,l=127&(i=e[u--]);for(i>>=7;0<c;l=256*l+e[u],u--,c-=8);for(r=l&(1<<-c)-1,l>>=-c,c+=t;0<c;r=256*r+e[u],u--,c-=8);if(0===l)l=1-s;else{if(l===o)return r?NaN:i?-1/0:1/0;r+=n(2,t),l-=s}return(i?-1:1)*r*n(2,l-t)}}},function(e,t,r){"use strict";var n=r(12),i=r(38),a=r(8);e.exports=function(e){for(var t,r=n(this),o=a(r.length),s=i(1<(t=arguments.length)?arguments[1]:void 0,o),c=void 0===(t=2<t?arguments[2]:void 0)?o:i(t,o);s<c;)r[s++]=e;return r}},function(e,t,r){var n=r(6).f,i=r(1),a=r(4)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,a)&&n(e,a,{configurable:!0,value:t})}},function(e,t,r){var n=r(72);e.exports=function(e,t){if((e=n(e))%t)throw RangeError("Wrong offset");return e}},function(e,t,r){var n=r(11);e.exports=function(e){if((e=n(e))<0)throw RangeError("The argument can't be less than 0");return e}},function(e,t,r){function n(){}function i(e){return"<script>"+e+"</"+f+">"}var a,o=r(10),s=r(74),c=r(27),u=r(24),l=r(76),d=r(33),h=(r=r(22),"prototype"),f="script",p=r("IE_PROTO"),g=function(){try{a=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e;g=a?function(e){e.write(i("")),e.close();var t=e.parentWindow.Object;return e=null,t}(a):((e=d("iframe")).style.display="none",l.appendChild(e),e.src=String("javascript:"),(e=e.contentWindow.document).open(),e.write(i("document.F=Object")),e.close(),e.F);for(var t=c.length;t--;)delete g[h][c[t]];return g()};u[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(n[h]=o(e),r=new n,n[h]=null,r[p]=e):r=g(),void 0===t?r:s(r,t)}},function(e,t,r){var n=r(2),i=r(6),a=r(10),o=r(75);e.exports=n?Object.defineProperties:function(e,t){a(e);for(var r,n=o(t),s=n.length,c=0;c<s;)i.f(e,r=n[c++],t[r]);return e}},function(e,t,r){var n=r(37),i=r(27);e.exports=Object.keys||function(e){return n(e,i)}},function(e,t,r){r=r(25),e.exports=r("document","documentElement")},function(e,t,r){var n=r(12),i=r(8),a=r(78),o=r(79),s=r(45),c=r(28).aTypedArrayConstructor;e.exports=function(e){var t,r,u,l,d,h,f=n(e),p=arguments.length,g=1<p?arguments[1]:void 0,m=void 0!==g,v=a(f);if(null!=v&&!o(v))for(h=(d=v.call(f)).next,f=[];!(l=h.call(d)).done;)f.push(l.value);for(m&&2<p&&(g=s(g,arguments[2],2)),r=i(f.length),u=new(c(this))(r),t=0;t<r;t++)u[t]=m?g(f[t],t):f[t];return u}},function(e,t,r){var n=r(29),i=r(44),a=r(4)("iterator");e.exports=function(e){if(null!=e)return e[a]||e["@@iterator"]||i[n(e)]}},function(e,t,r){var n=r(4),i=r(44),a=n("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[a]===e)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},function(e,t,r){var n=r(45),i=r(30),a=r(12),o=r(8),s=r(82),c=[].push;r=function(e){var t=1==e,r=2==e,u=3==e,l=4==e,d=6==e,h=5==e||d;return function(f,p,g,m){for(var v,y,b=a(f),_=i(b),w=n(p,g,3),E=o(_.length),S=0,T=(m=m||s,t?m(f,E):r?m(f,0):void 0);S<E;S++)if((h||S in _)&&(y=w(v=_[S],S,b),e))if(t)T[S]=y;else if(y)switch(e){case 3:return!0;case 5:return v;case 6:return S;case 2:c.call(T,v)}else if(l)return!1;return d?-1:u||l?l:T}},e.exports={forEach:r(0),map:r(1),filter:r(2),some:r(3),every:r(4),find:r(5),findIndex:r(6)}},function(e,t,r){var n=r(3),i=r(83),a=r(4)("species");e.exports=function(e,t){var r;return new(void 0===(r=i(e)&&("function"==typeof(r=e.constructor)&&(r===Array||i(r.prototype))||n(r)&&null===(r=r[a]))?void 0:r)?Array:r)(0===t?0:t)}},function(e,t,r){var n=r(17);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){"use strict";var n=r(25),i=r(6),a=r(4),o=r(2),s=a("species");e.exports=function(e){var t=n(e);e=i.f,o&&t&&!t[s]&&e(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,r){var n=r(3),i=r(13);e.exports=function(e,t,r){var a,o;return i&&"function"==typeof(a=t.constructor)&&a!==r&&n(o=a.prototype)&&o!==r.prototype&&i(e,o),e}},function(e,t,r){},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return ke})),r(47);var n=r(9);function i(e){return null!=e&&"object"==typeof e&&!0===e["@@functional/placeholder"]}function a(e){return function t(r){return 0===arguments.length||i(r)?t:e.apply(this,arguments)}}function o(e){return function t(r,n){switch(arguments.length){case 0:return t;case 1:return i(r)?t:a((function(t){return e(r,t)}));default:return i(r)&&i(n)?t:i(r)?a((function(t){return e(t,n)})):i(n)?a((function(t){return e(r,t)})):e(r,n)}}}function s(e){return function t(r,n,s){switch(arguments.length){case 0:return t;case 1:return i(r)?t:o((function(t,n){return e(r,t,n)}));case 2:return i(r)&&i(n)?t:i(r)?o((function(t,r){return e(t,n,r)})):i(n)?o((function(t,n){return e(r,t,n)})):a((function(t){return e(r,n,t)}));default:return i(r)&&i(n)&&i(s)?t:i(r)&&i(n)?o((function(t,r){return e(t,r,s)})):i(r)&&i(s)?o((function(t,r){return e(t,n,r)})):i(n)&&i(s)?o((function(t,n){return e(r,t,n)})):i(r)?a((function(t){return e(t,n,s)})):i(n)?a((function(t){return e(r,t,s)})):i(s)?a((function(t){return e(r,n,t)})):e(r,n,s)}}}var c=s((function(e,t,r){if(t<e)throw new Error("min must not be greater than max in clamp(min, max, value)");return r<e?e:t<r?t:r})),u=o((function(e,t){return null==t||t!=t?e:t}));function l(e){return 1===(e=e.toString(16)).length?"0"+e:e}function d(e){return"#"+e.map(l).join("")}function h(e,t,r){for(let n=0;n<r.length;n++)if(function(e,t,r){switch(r.length){case 3:if(function(e,t,r){return 255!==e[t+3]||e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]}(e,t,r))return!0;break;case 4:if(function(e,t,r){return e[t+3]&&r[3]?e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]&&e[t+3]===r[3]:e[t+3]===r[3]}(e,t,r))return!0;break;case 5:if(function(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],c=e[t+3];return r=f(c,o,s),o?!(c||!r)||!!(f(e[t],n,s)&&f(e[t+1],i,s)&&f(e[t+2],a,s)&&r):r}(e,t,r))return!0;break;default:return!1}}(e,t,r[n]))return 1}function f(e,t,r){return t-r<=e&&e<=t+r}function p(e,t,r){const n={};var i=r.ignoredColor,a=r.step;for(let r=0;r<t;r+=a){var o,s=e[r],c=e[r+1],u=e[r+2],l=e[r+3];i&&h(e,r,i)||(o=Math.round(s/24)+","+Math.round(c/24)+","+Math.round(u/24),n[o]?n[o]=[n[o][0]+s*l,n[o][1]+c*l,n[o][2]+u*l,n[o][3]+l,n[o][4]+1]:n[o]=[s*l,c*l,u*l,l,1])}var d=Object.keys(n).map((e=>n[e])).sort(((e,t)=>(e=e[4],(t=t[4])<e?-1:e===t?0:1)))[0],f=d[0],p=d[1],g=d[2],m=d[3];return d=d[4],m?[Math.round(f/m),Math.round(p/m),Math.round(g/m),Math.round(m/d)]:r.defaultColor}function g(e,t,r){let n=0,i=0,a=0,o=0,s=0;var c=r.ignoredColor,u=r.step;for(let r=0;r<t;r+=u){var l=e[r+3],d=e[r]*l,f=e[r+1]*l,p=e[r+2]*l;c&&h(e,r,c)||(n+=d,i+=f,a+=p,o+=l,s++)}return o?[Math.round(n/o),Math.round(i/o),Math.round(a/o),Math.round(o/s)]:r.defaultColor}function m(e,t,r){let n=0,i=0,a=0,o=0,s=0;var c=r.ignoredColor,u=r.step;for(let r=0;r<t;r+=u){var l=e[r],d=e[r+1],f=e[r+2],p=e[r+3];c&&h(e,r,c)||(n+=l*l*p,i+=d*d*p,a+=f*f*p,o+=p,s++)}return o?[Math.round(Math.sqrt(n/o)),Math.round(Math.sqrt(i/o)),Math.round(Math.sqrt(a/o)),Math.round(o/s)]:r.defaultColor}function v(e){return y(e,"defaultColor",[0,0,0,0])}function y(e,t,r){return void 0===e[t]?r:e[t]}const b="FastAverageColor: ";function _(e,t,r){e.silent||(console.error(b+t),r&&console.error(r))}function w(e){return Error(b+e)}var E=class{getColorAsync(e,t){if(!e)return Promise.reject(w("call .getColorAsync() without resource."));if("string"==typeof e){const r=new Image;return r.crossOrigin="",r.src=e,this._bindImageEvents(r,t)}return e instanceof Image&&!e.complete?this._bindImageEvents(e,t):(t=this.getColor(e,t)).error?Promise.reject(t.error):Promise.resolve(t)}getColor(e,t){var r=v(t=t||{});if(!e)return _(t,"call .getColor(null) without resource."),this.prepareResult(r);var n=function(e,t){var r=y(t,"left",0),n=y(t,"top",0),i=y(t,"width",e.width);let a,o=i,s=e=y(t,"height",e.height);return"precision"===t.mode||(e<i?(a=i/e,o=100,s=Math.round(o/a)):(a=e/i,s=100,o=Math.round(s/a)),(o>i||s>e||o<10||s<10)&&(o=i,s=e)),{srcLeft:r,srcTop:n,srcWidth:i,srcHeight:e,destWidth:o,destHeight:s}}(function(e){if(e instanceof HTMLImageElement){let t=e.naturalWidth,r=e.naturalHeight;return e.naturalWidth||-1===e.src.search(/\.svg(\?|$)/i)||(t=r=100),{width:t,height:r}}return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:{width:e.width,height:e.height}}(e),t);if(!(n.srcWidth&&n.srcHeight&&n.destWidth&&n.destHeight))return _(t,`incorrect sizes for resource "${e.src}".`),this.prepareResult(r);if(!this._ctx&&(this._canvas="undefined"==typeof window?new OffscreenCanvas(1,1):document.createElement("canvas"),this._ctx=this._canvas.getContext&&this._canvas.getContext("2d"),!this._ctx))return _(t,"Canvas Context 2D is not supported in this browser."),this.prepareResult(r);this._canvas.width=n.destWidth,this._canvas.height=n.destHeight;let i=r;try{this._ctx.clearRect(0,0,n.destWidth,n.destHeight),this._ctx.drawImage(e,n.srcLeft,n.srcTop,n.srcWidth,n.srcHeight,0,0,n.destWidth,n.destHeight);var a=this._ctx.getImageData(0,0,n.destWidth,n.destHeight).data;i=this.getColorFromArray4(a,t)}catch(r){_(t,`security error (CORS) for resource ${e.src}.\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`,r)}return this.prepareResult(i)}getColorFromArray4(e,t){var r=e.length,n=v(t=t||{});if(r<4)return n;var i=r-r%4;let a;switch(r=4*(t.step||1),t.algorithm||"sqrt"){case"simple":a=g;break;case"sqrt":a=m;break;case"dominant":a=p;break;default:throw w(`${t.algorithm} is unknown algorithm.`)}return a(e,i,{defaultColor:n,ignoredColor:(n=t.ignoredColor)&&(Array.isArray(n)?"number"==typeof n[0]?[n.slice()]:n:[n]),step:r})}prepareResult(e){const t=e.slice(0,3),r=[].concat(t,e[3]/255);var n=(299*(n=e)[0]+587*n[1]+114*n[2])/1e3<128;return{value:e,rgb:"rgb("+t.join(",")+")",rgba:"rgba("+r.join(",")+")",hex:d(t),hexa:d(e),isDark:n,isLight:!n}}destroy(){delete this._canvas,delete this._ctx}_bindImageEvents(e,t){return new Promise(((r,n)=>{const i=()=>{s();var i=this.getColor(e,t);i.error?n(i.error):r(i)},a=()=>{s(),n(w(`Error loading image "${e.src}".`))},o=()=>{s(),n(w(`Image "${e.src}" loading aborted.`))},s=()=>{e.removeEventListener("load",i),e.removeEventListener("error",a),e.removeEventListener("abort",o)};e.addEventListener("load",i),e.addEventListener("error",a),e.addEventListener("abort",o)}))}},S=a((function(e){return null==e})),T=o((function(e,t){return null!=t&&t.constructor===e||t instanceof e}));function k(e,t){return Object.prototype.hasOwnProperty.call(t,e)}var O=Object.prototype.toString,A=function(){return"[object Arguments]"===O.call(arguments)?function(e){return"[object Arguments]"===O.call(e)}:function(e){return k("callee",e)}}(),x=Array.isArray||function(e){return null!=e&&0<=e.length&&"[object Array]"===Object.prototype.toString.call(e)};function R(e){return"[object String]"===Object.prototype.toString.call(e)}var C=a((function(e){return null!=e&&"function"==typeof e["fantasy-land/empty"]?e["fantasy-land/empty"]():null!=e&&null!=e.constructor&&"function"==typeof e.constructor["fantasy-land/empty"]?e.constructor["fantasy-land/empty"]():null!=e&&"function"==typeof e.empty?e.empty():null!=e&&null!=e.constructor&&"function"==typeof e.constructor.empty?e.constructor.empty():x(e)?[]:R(e)?"":(t=e,"[object Object]"===Object.prototype.toString.call(t)?{}:A(e)?function(){return arguments}():void 0);var t}));function L(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}function I(e,t,r){for(var n=0,i=r.length;n<i;){if(e(t,r[n]))return 1;n+=1}}var P="function"==typeof Object.is?Object.is:function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},D=!{toString:null}.propertyIsEnumerable("toString"),j=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],M=function(){return arguments.propertyIsEnumerable("length")}(),N="function"!=typeof Object.keys||M?a((function(e){if(Object(e)!==e)return[];var t,r,n=[],i=M&&A(e);for(t in e)!k(t,e)||i&&"length"===t||(n[n.length]=t);if(D)for(r=j.length-1;0<=r;)k(t=j[r],e)&&!function(e,t){for(var r=0;r<e.length;){if(e[r]===t)return!0;r+=1}return!1}(n,t)&&(n[n.length]=t),--r;return n})):a((function(e){return Object(e)!==e?[]:Object.keys(e)})),F=a((function(e){return null===e?"Null":void 0===e?"Undefined":Object.prototype.toString.call(e).slice(8,-1)}));function U(e,t,r,n){function i(e,t){return B(e,t,r.slice(),n.slice())}return e=L(e),!I((function(e,t){return!I(i,t,e)}),L(t),e)}function B(e,t,r,n){if(P(e,t))return!0;var i,a=F(e);if(a!==F(t))return!1;if(null==e||null==t)return!1;if("function"==typeof e["fantasy-land/equals"]||"function"==typeof t["fantasy-land/equals"])return"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t)&&"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e);if("function"==typeof e.equals||"function"==typeof t.equals)return"function"==typeof e.equals&&e.equals(t)&&"function"==typeof t.equals&&t.equals(e);switch(a){case"Arguments":case"Array":case"Object":if("function"==typeof e.constructor&&"Promise"===(i=e.constructor,null==(i=String(i).match(/^function (\w*)/))?"":i[1]))return e===t;break;case"Boolean":case"Number":case"String":if(typeof e!=typeof t||!P(e.valueOf(),t.valueOf()))return!1;break;case"Date":if(!P(e.valueOf(),t.valueOf()))return!1;break;case"Error":return e.name===t.name&&e.message===t.message;case"RegExp":if(e.source!==t.source||e.global!==t.global||e.ignoreCase!==t.ignoreCase||e.multiline!==t.multiline||e.sticky!==t.sticky||e.unicode!==t.unicode)return!1}for(var o=r.length-1;0<=o;){if(r[o]===e)return n[o]===t;--o}switch(a){case"Map":return e.size===t.size&&U(e.entries(),t.entries(),r.concat([e]),n.concat([t]));case"Set":return e.size===t.size&&U(e.values(),t.values(),r.concat([e]),n.concat([t]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var s=N(e);if(s.length!==N(t).length)return!1;var c=r.concat([e]),u=n.concat([t]);for(o=s.length-1;0<=o;){var l=s[o];if(!k(l,t)||!B(t[l],e[l],c,u))return!1;--o}return!0}var G,H,z,K,q,V=o((function(e,t){return B(e,t,[],[])})),W=a((function(e){return null!=e&&V(e,C(e))})),Y="function"==typeof Object.assign?Object.assign:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1,n=arguments.length;r<n;){var i=arguments[r];if(null!=i)for(var a in i)k(a,i)&&(t[a]=i[a]);r+=1}return t},X=o((function(e,t){return Y({},e,t)})),$=o((function(e,t){var r,n=Number(t),i=0;if(n<0||isNaN(n))throw new RangeError("n must be a non-negative number");for(r=new Array(n);i<n;)r[i]=e(i),i+=1;return r}));r(86),(r=G=G||{}).HLS="hls",r.WEBRTC="webrtc",(r=H=H||{}).PLAYER="player",r.LIST="list",r.SETTINGS="settings",(r={}).CLOSED="closed",r.FAILED="failed",r.LISTENING="listening",r.OPEN="open",r.PAUSED="paused",r.RESPONDING="responding",r.PROCESSING="processing",r.SLEEPING="sleeping",(r=z=z||{}).LANDSCAPE="landscape",r.PORTRAIT="portrait",(r=K=K||{}).CHAT="chat",r.KIOSK="kiosk",(r=q=q||{}).BOT="bot",r.USER="user";var J=a((function(e){return function(){return e}}));function Q(e,t){switch(e){case 0:return function(){return t.apply(this,arguments)};case 1:return function(e){return t.apply(this,arguments)};case 2:return function(e,r){return t.apply(this,arguments)};case 3:return function(e,r,n){return t.apply(this,arguments)};case 4:return function(e,r,n,i){return t.apply(this,arguments)};case 5:return function(e,r,n,i,a){return t.apply(this,arguments)};case 6:return function(e,r,n,i,a,o){return t.apply(this,arguments)};case 7:return function(e,r,n,i,a,o,s){return t.apply(this,arguments)};case 8:return function(e,r,n,i,a,o,s,c){return t.apply(this,arguments)};case 9:return function(e,r,n,i,a,o,s,c,u){return t.apply(this,arguments)};case 10:return function(e,r,n,i,a,o,s,c,u,l){return t.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function Z(e,t,r){return function(){if(0===arguments.length)return r();var n,i=Array.prototype.slice.call(arguments,0),a=i.pop();if(!x(a)){for(var o=0;o<e.length;){if("function"==typeof a[e[o]])return a[e[o]].apply(a,i);o+=1}if(null!=(n=a)&&"function"==typeof n["@@transducer/step"])return t.apply(null,i)(a)}return r.apply(this,arguments)}}var ee=a((function(e){return!!x(e)||!!e&&"object"==typeof e&&!R(e)&&(1===e.nodeType?!!e.length:0===e.length||0<e.length&&e.hasOwnProperty(0)&&e.hasOwnProperty(e.length-1))})),te=function(){function e(e){this.f=e}return e.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},e.prototype["@@transducer/result"]=function(e){return e},e.prototype["@@transducer/step"]=function(e,t){return this.f(e,t)},e}(),re=o((function(e,t){return Q(e.length,(function(){return e.apply(t,arguments)}))}));function ne(e,t,r){for(var n=r.next();!n.done;){if((t=e["@@transducer/step"](t,n.value))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n=r.next()}return e["@@transducer/result"](t)}function ie(e,t,r,n){return e["@@transducer/result"](r[n](re(e["@@transducer/step"],e),t))}var ae="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function oe(e,t,r){if("function"==typeof e&&(e=new te(e)),ee(r))return function(e,t,r){for(var n=0,i=r.length;n<i;){if((t=e["@@transducer/step"](t,r[n]))&&t["@@transducer/reduced"]){t=t["@@transducer/value"];break}n+=1}return e["@@transducer/result"](t)}(e,t,r);if("function"==typeof r["fantasy-land/reduce"])return ie(e,t,r,"fantasy-land/reduce");if(null!=r[ae])return ne(e,t,r[ae]());if("function"==typeof r.next)return ne(e,t,r);if("function"==typeof r.reduce)return ie(e,t,r,"reduce");throw new TypeError("reduce: list must be array or iterable")}var se=function(){return this.xf["@@transducer/init"]()},ce=function(e){return this.xf["@@transducer/result"](e)},ue=function(){function e(e,t){this.xf=t,this.f=e}return e.prototype["@@transducer/init"]=se,e.prototype["@@transducer/result"]=ce,e.prototype["@@transducer/step"]=function(e,t){return this.xf["@@transducer/step"](e,this.f(t))},e}(),le=o((function(e,t){return 1===e?a(t):Q(e,function e(t,r,n){return function(){for(var a,o=[],s=0,c=t,u=0;u<r.length||s<arguments.length;)u<r.length&&(!i(r[u])||arguments.length<=s)?a=r[u]:(a=arguments[s],s+=1),i(o[u]=a)||--c,u+=1;return c<=0?n.apply(this,o):Q(c,e(t,o,n))}}(e,[],t))})),de=o(Z(["fantasy-land/map","map"],o((function(e,t){return new ue(e,t)})),(function(e,t){switch(Object.prototype.toString.call(t)){case"[object Function]":return le(t.length,(function(){return e.call(this,t.apply(this,arguments))}));case"[object Object]":return oe((function(r,n){return r[n]=e(t[n]),r}),{},N(t));default:return function(e,t){for(var r=0,n=t.length,i=Array(n);r<n;)i[r]=e(t[r]),r+=1;return i}(e,t)}}))),he=o((function(e,t){return e<t?t:e})),fe=s(oe),pe=a((function(e){return Q(fe(he,0,de((function(e){return e[0].length}),e)),(function(){for(var t=0;t<e.length;){if(e[t][0].apply(this,arguments))return e[t][1].apply(this,arguments);t+=1}}))}));function ge(e,t){return 0<=function(e,t,r){var n,i;if("function"==typeof e.indexOf)switch(typeof t){case"number":if(0===t){for(n=1/t;r<e.length;){if(0===(i=e[r])&&1/i==n)return r;r+=1}return-1}if(t==t)return e.indexOf(t,r);for(;r<e.length;){if("number"==typeof(i=e[r])&&i!=i)return r;r+=1}return-1;case"string":case"boolean":case"function":case"undefined":return e.indexOf(t,r);case"object":if(null===t)return e.indexOf(t,r)}for(;r<e.length;){if(V(e[r],t))return r;r+=1}return-1}(t,e,0)}function me(){return!0}var ve=o(ge);const ye=(e,t,r)=>{let n=e.scrollTop,i=t-n,a=0;const o=()=>{var t,s,c;a+=20,e.scrollTop=(t=a,s=n,c=i,(t/=r/2)<1?c/2*t*t+s:-c/2*(--t*(t-2)-1)+s),a<r&&setTimeout(o,20)};o()};var be=function(e,t,r,n){return new(r=r||Promise)((function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))},_e=function(e,t,r,n){return new(r=r||Promise)((function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))};const we={animationSpeed:500,backgroundAdvancedAnimationParticlesCount:20,backgroundColor:"#927263",backgroundImage:null,backgroundImageBlur:0,backgroundSimpleAnimation:!0,detectOrientation:!0,fullScreen:!0,customIcons:!1,arrowIcon:"icon--content--arrow-up",micIcon:"icon--content--mic",pauseIcon:"icon--content--pause",playIcon:"icon--content--play",keyboardIcon:"icon--content--keyboard",muteIcon:"icon--content--volume-mute",volumeIcon:"icon--content--volume",upSop:"icon--content--upSop",downSop:"icon--content--downSop",guiMode:K.KIOSK,imageAverageColorOpacity:.5,widgetSize:{height:"500px",width:"800px"},userMessageBackgroundColor:"rgba(255, 255, 255, .3)",userMessageTextColor:"#ffffff",userMessageTextOutlineColor:"rgba(0, 0, 0, .5)",botMessageBackgroundColor:"rgba(0, 0, 0, .4)",botMessageTextColor:"#ffffff",mode:"voice",inputAudio:!0,outputAudio:!0,botMessageTextOutlineColor:"rgba(0, 0, 0, .5)",reverseAvatarOrder:!1,collapsable:!1,collapsed:!1,sectionActive:0,sections:["LOGIN","INPUTSELECT","SOP","QUESTION"]},Ee={[K.CHAT]:2/3,[K.KIOSK]:1},Se=["mic","blocked","volume","speaking-head","arrow-up","play","pause","stop","keyboard","volume-mute","menu","mic2","back","downSop","upSop"],Te="icon--mic--active";class ke{constructor(e,t=we){var r,i;this.setControls=e=>{e?ke.chatTextInputElement.removeAttribute("no-controls"):ke.chatTextInputElement.setAttribute("no-controls","")},this.expand=()=>{ke.settings.collapsable&&ke.settings.collapsed&&this.changeCollapsedMode()},this.changeCollapsedMode=()=>{ke.settings.collapsed=!ke.settings.collapsed,ke.setCollapsableUIHeight(),this.collapsableTriggerCallback(ke.settings.collapsed);var e=(e=ke.element.getBoundingClientRect()).width>e.height?z.LANDSCAPE:z.PORTRAIT;this.setOrientation(e)},this.setupDataChannel=e=>{try{const t=ke.avatarConnection.createDataChannel(e,{ordered:!0});t.binaryType="arraybuffer";const r=this.dataChannelMessageCallback;return console.log("Created data channel (".concat(e,")")),t.onopen=function(t){console.log("data channel (".concat(e,") connect")),ke.avatarDataChannel.send(new Uint8Array([7]).buffer),ke.avatarDataChannel.send(new Uint8Array([1]).buffer)},t.onclose=function(t){console.log("data channel (".concat(e,") closed"))},t.onmessage=function(t){if(console.log("Got message (".concat(e,")"),t.data),void 0!==t.data.size){const e=new FileReader;e.addEventListener("loadend",(()=>{r(new Uint8Array(e.result))})),e.readAsArrayBuffer(t.data)}else r(new Uint8Array(t.data))},t}catch(e){return console.warn("No data channel",e),null}},this.setPlayIcon=e=>{},this.setScreen=(e=H.PLAYER)=>{},this.setOrientation=(e=ke.orientation)=>{ke.element.setAttribute("data-orientation",e);var{width:t,height:e}=ke.element.getBoundingClientRect(),t="100%"===ke.element.style.width?"".concat(t,"px"):ke.element.style.width;e="100%"===ke.element.style.height?"".concat(e,"px"):ke.element.style.height,ke.element.style.setProperty("--bot-ui-window-width",t),ke.element.style.setProperty("--bot-ui-window-height",e)},this.setState=e=>{},this.setBackgroundColor=e=>ke.setBackground({color:e}),this.setBackgroundImage=(e,t=ke.settings.backgroundImageBlur)=>ke.setBackground({url:{path:e,blur:t}}),this.setUserText=(e=null)=>{ke.settings.guiMode===K.KIOSK&&(ke.userTextKioskElement.setAttribute("data-empty",""),window.setTimeout((()=>{S(e)||W(e)?ke.userTextKioskElement.setAttribute("data-empty",""):(ke.userTextKioskElement.innerText=e,ke.userTextKioskElement.removeAttribute("data-empty"))}),ke.settings.animationSpeed)),ke.settings.guiMode!==K.CHAT||S(e)||W(e)||ke.setChatMessage(e,null,null,q.USER,!0)},this.setBotText=(e=null)=>{ke.settings.guiMode===K.KIOSK&&(ke.botTextKioskElement.setAttribute("data-empty",""),window.setTimeout((()=>{S(e)||W(e)?ke.botTextKioskElement.setAttribute("data-empty",""):(ke.botTextKioskElement.innerText=e,ke.botTextKioskElement.removeAttribute("data-empty"))}),ke.settings.animationSpeed)),ke.settings.guiMode!==K.CHAT||S(e)||W(e)||ke.setChatMessage(e,null,null,q.BOT)},this.setVideo=(e=null,t)=>{if(ke.videoCallback=t,ke.settings.guiMode===K.CHAT&&ke.setChatMessage(null,null,e,q.BOT),ke.settings.guiMode===K.KIOSK){const t=(e=!0)=>{ke.imageKioskElement.innerHTML="",e&&(ke.imageKioskElement.classList.add("bu-d-none"),ke.element.removeAttribute("data-width-image"))};if(e)if(e.includes("youtube.com/embed")){const r=document.createElement("iframe");r.setAttribute("src",e),t(!1),ke.imageKioskElement.classList.remove("bu-d-none"),ke.element.setAttribute("data-width-image",""),ke.imageKioskElement.appendChild(r),ke.videoCallback()}else{const r=document.createElement("video");r.autoplay=!0,r.onloadeddata=e=>{t(!1),ke.imageKioskElement.classList.remove("bu-d-none"),ke.element.setAttribute("data-width-image",""),ke.imageKioskElement.appendChild(r)},r.onended=e=>{ke.videoCallback()},r.src=e}else t()}},this.setButton=(e=null,t=null,r="general",n=!0,i="")=>{const a=ke.messagesElement,o=document.createElement("button");if(e){const t=new Image;o.append(t),t.src=e,o.style.background="transparent"}i&&(o.textContent=i),o.classList.add("inputButton","chat-message","chat-message-bot"),o.setAttribute("data-message-type","bot"),o.setAttribute("data-button-group",r),o.onclick=()=>{t(),n&&document.querySelectorAll("[data-button-group=".concat(r,"]")).forEach((e=>{e.setAttribute("disabled","")}))},a.appendChild(o),a.scrollTop=a.scrollHeight,ke.scrollToLastMessage(a)},this.setImage=(e=null)=>{if(ke.settings.guiMode===K.KIOSK){const t=(e=!0)=>{ke.imageKioskElement.innerHTML="",e&&(ke.imageKioskElement.classList.add("bu-d-none"),ke.element.removeAttribute("data-width-image"))};if(e){const r=new Image,n=new E;r.crossOrigin="anonymous",r.onload=e=>{t(!1),ke.imageKioskElement.classList.remove("bu-d-none"),ke.element.setAttribute("data-width-image",""),ke.imageKioskElement.appendChild(r),n.getColorAsync(ke.imageKioskElement.querySelector("img")).then((function(e){ke.element.style.setProperty("--bot-ui-image-background-color","rgba(".concat(e.value[0],", ").concat(e.value[1],", ").concat(e.value[2],", ").concat(ke.settings.imageAverageColorOpacity,")"))})).catch((function(e){console.log(e)}))},r.onerror=e=>{t()},r.src="https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?container=focus&refresh=2592000&url="+e}else t()}ke.settings.guiMode!==K.CHAT||S(e)||W(e)||ke.setChatMessage(null,e,null,q.BOT)},this.setInputAudio=(e=null)=>{ke.botPcmElement.classList.add("bu-invisible"),ke.botPcmElement.classList.remove("bu-visible"),S(e)||W(e)?(ke.userPcmElement.classList.add("bu-invisible"),ke.userPcmElement.classList.remove("bu-visible")):"voice"===ke.settings.mode&&(ke.userPcmElement.classList.add("bu-visible"),ke.userPcmElement.classList.remove("bu-invisible"))},this.setOutputAudio=(e=null,t,r=!1,n,i)=>{ke.userPcmElement.classList.add("bu-invisible"),ke.userPcmElement.classList.remove("bu-visible"),S(e)||W(e)?(ke.botPcmElement.classList.add("bu-invisible"),ke.botPcmElement.classList.remove("bu-visible")):"voice"!==t||r||(ke.botPcmElement.classList.add("bu-visible"),ke.botPcmElement.classList.remove("bu-invisible"))},this.chatInputCallback=()=>{},this.chatArrowCallback=()=>{},this.chatMicrophoneCallback=()=>{},this.chatMuteCallback=()=>{},this.chatBargeCallback=()=>{},this.chatPlayCallback=()=>{},this.chatStopCallback=()=>{},this.chatMicCallback=()=>{},this.chatBackCallback=()=>{},this.chatKeyboardCallback=()=>{this.setInputMode(ke.settings.mode),ke.settings.mode="voice"===ke.settings.mode?"text":"voice",console.log(ke.settings)},this.chatSopNextCallback=()=>{},this.chatSopPreviousCallback=()=>{},this.chatSopQuestionCallback=()=>{this.setSection("QUESTION")},this.chatTextInputElementCallback=()=>{},this.dataChannelMessageCallback=()=>{},this.collapsableTriggerCallback=e=>{},this.setMicrophone=(e=!1)=>{ke.isMicrophoneEnabled=e,ke._setMicrophone(),ke.getChatMicrophone(ke.isMicrophoneEnabled,this.chatMicrophoneCallback)},this.setUserMessageBackgroundColor=e=>{e=S(e)||!T(String,e)?ke.settings.userMessageBackgroundColor:e,ke.element.style.setProperty("--bot-ui-message-background-user",e)},this.setBotMessageBackgroundColor=e=>{e=S(e)||!T(String,e)?ke.settings.botMessageBackgroundColor:e,ke.element.style.setProperty("--bot-ui-message-background-bot",e)},this.setUserMessageTextColor=e=>{e=S(e)||!T(String,e)?ke.settings.userMessageTextColor:e,ke.element.style.setProperty("--bot-ui-message-color-user",e)},this.setBotMessageTextColor=e=>{e=S(e)||!T(String,e)?ke.settings.botMessageTextColor:e,ke.element.style.setProperty("--bot-ui-message-color-bot",e)},this.setUserMessageTextOutlineColor=e=>{e=S(e)||!T(String,e)?ke.settings.userMessageTextOutlineColor:e,ke.element.style.setProperty("--bot-ui-message-color-outline-user",e)},this.setBotMessageTextOutlineColor=e=>{e=S(e)||!T(String,e)?ke.settings.botMessageTextOutlineColor:e,ke.element.style.setProperty("--bot-ui-message-color-outline-bot",e)},this.setTextInputEnabled=(e=!1)=>{let t="0px";(ke.settings.textInputEnabled=e)?(ke.element.setAttribute("data-with-chat-input",""),t="80px"):ke.element.removeAttribute("data-with-chat-input"),ke.element.style.setProperty("--bot-ui-chat-input-height",t),ke.handleBotUiHeights()},this.setHlsAvatar=(e=null)=>{this.setAvatar({type:G.HLS,streamUrl:e})},this.setWebRtcAvatar=(e=null)=>{this.setAvatar({type:G.WEBRTC,streamUrl:e})},this.setAvatar=({type:e,streamUrl:t}={type:G.HLS,streamUrl:null})=>_e(this,void 0,void 0,(function*(){const r=document.createElement("video"),i=(e=!1)=>{ke.avatarElement.innerHTML="",ke.showAvatar(!1),e&&ke.avatarWs&&ke.avatarWs.close()};var a,o;if(i(),(e=>(e=e&&e.split(":/")||"",-1!==["http","https","ws","wss"].indexOf(e[0])))(t))if(e===G.HLS){if(ke.avatarElement.appendChild(r),n.isSupported()){const e=new n;e.detachMedia(),e.loadSource(t),e.attachMedia(r),e.on(n.Events.MANIFEST_PARSED,(()=>{r.play(),ke.showAvatar(!0)})),e.on(n.Events.ERROR,((t,r)=>{r&&r.response&&404===r.response.code&&(e.detachMedia(),i()),console.log(t,r.response,r)})),e.on(n.Events.LEVEL_SWITCHED,((t,r)=>{var{width:n,height:r}=e.levels[r.level];n&&r&&console.log("qualityChange ".concat(n,"x").concat(r))})),e.on(n.Events.BUFFER_EOS,(e=>{this.setHlsAvatar(null)}))}}else{let e=[];ke.avatarWs=new WebSocket(t),a=ke.avatarWs,o=1e4,(yield be(void 0,void 0,void 0,(function*(){var e=()=>a.readyState===WebSocket.OPEN;if(a.readyState!==WebSocket.CONNECTING)return e();{var t=o/100;let r=0;for(;a.readyState===WebSocket.CONNECTING&&r<t;)yield new Promise((e=>setTimeout(e,100))),r++;return e()}})))&&(ke.avatarWs.onmessage=t=>{var r=JSON.parse(t.data);switch(r.type){case"answer":ke.avatarConnection.setRemoteDescription({type:"answer",sdp:r.sdp}).then((()=>{e.forEach((e=>{ke.avatarConnection.addIceCandidate(e)})),e=[]})).catch((e=>{console.error("Failed to set remote description",e)}));break;case"error":console.error("Error message from server ".concat(r.message));break;case"iceCandidate":var n=new RTCIceCandidate(r.candidate);ke.avatarConnection&&ke.avatarConnection.remoteDescription?ke.avatarConnection.addIceCandidate(n).catch((e=>{console.error("Failed to add ICE candidate",e)})):(console.log("Connection not ready, queuing candidate",n),e.push(n));break;default:console.error("Unknown message from server ".concat(r.message))}},_e(this,void 0,void 0,(function*(){ke.avatarConnection=new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"],username:"",credential:""}]}),ke.avatarDataChannel=this.setupDataChannel("cirrus"),ke.avatarConnection.addEventListener("icecandidate",(e=>{(e=e.candidate)&&(console.log("Local ICE candidate"+JSON.stringify(e)),""!==e.candidate&&this.avatarSendMessage({type:"iceCandidate",candidate:e}))})),ke.avatarConnection.addEventListener("track",(e=>{console.log("Video track ready"),i(!1),ke.avatarElement.appendChild(r),r.playsInline=!0,r.srcObject?r.srcObject.addTrack(e.track):r.srcObject=e.streams[0],ke.showAvatar(!0)}));var e=yield ke.avatarConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});yield ke.avatarConnection.setLocalDescription(e),console.info("Sending SDP offer"),this.avatarSendMessage({type:"offer",sdp:e.sdp})})).catch((e=>{console.error("Failed to create WebRTC connection",e),i()})))}})),this.setReverseAvatarOrder=(e=!1)=>{ke.settings.guiMode===K.CHAT&&(e=!!e,ke.reverseAvatarOrderAction(e))},this.avatarSendMessage=e=>{e=JSON.stringify(e),console.log("Sending message: "+e),ke.avatarWs.send(e)},this.sendRTCData=e=>{if(ke.avatarDataChannel&&"open"==ke.avatarDataChannel.readyState){console.log("Sending",e);const t=JSON.stringify(e),r=new DataView(new ArrayBuffer(3+2*t.length));let n=0;r.setUint8(n,50),n++,r.setUint16(n,t.length,!0),n+=2;for(let e=0;e<t.length;e++)r.setUint16(n,t.charCodeAt(e),!0),n+=2;ke.avatarDataChannel.send(r.buffer)}},this.disableStop=e=>{ke.chatInputStopElement.classList.remove("icon--light"),e&&ke.chatInputStopElement.classList.add("icon--light")},ke.element=document.getElementById(e),we.textInputEnabled=t.guiMode===K.CHAT,t.guiMode=(r=t.guiMode,i=Object.values(K),e=K.KIOSK,pe([[ve(r),J(r)],[me,J(e)]])(i)),ke.settings=X(we,t),ke.settings.fullScreen=!ke.settings.collapsable&&ke.settings.fullScreen,ke.rootElement=document.documentElement,ke.element&&(ke.element.style.setProperty("--bot-ui-animation-speed","".concat(ke.settings.animationSpeed,"ms")),ke.element.style.setProperty("--bot-ui-background-url-blur","".concat(ke.settings.backgroundImageBlur,"px")),ke.element.style.setProperty("--bot-ui-background-url",'url("'.concat(ke.settings.backgroundImage,'")')),ke.element.style.setProperty("--bot-ui-background-color","".concat(ke.settings.backgroundColor)),ke.element.style.setProperty("--bot-ui-message-color-bot","".concat(ke.settings.botMessageTextColor)),ke.element.style.setProperty("--bot-ui-message-color-user","".concat(ke.settings.userMessageTextColor)),ke.element.style.setProperty("--bot-ui-message-background-bot","".concat(ke.settings.botMessageBackgroundColor)),ke.element.style.setProperty("--bot-ui-message-background-user","".concat(ke.settings.userMessageBackgroundColor)),ke.element.style.setProperty("--bot-ui-chat-pcm-height","80px"),ke.orientation=z.LANDSCAPE,ke.element.innerHTML='\n    <div data-wrapper class="bot bot-wrapper">\n        <div class="column column-image">\n            <div data-image class="image"></div>\n        </div>\n            <div data-avatar class="column column-avatar">\n        </div>\n            <div data-messages class="column column-messages">\n        </div>\n        <div data-chat-input class="chat-input">\n            <div class="chat-input-wrapper">\n                <div data-chat-sop class="sop-section">\n                    <button data-sop-back disabled>\n                        <span data-chat-input-arrow-up class="icon icon--upSop"></span>\n                    </button>\n                    <button data-sop-question>Question</button>\n                    <button data-sop-next class="next-button">\n                        <div data-chat-input-arrow-down class="icon icon--downSop"></div>\n                    </button>\n                </div>\n                <div data-chat-ask class="ask-section">\n                    <span data-chat-input-settings class="settings settings--hidden">\n                        <span data-chat-input-keyboard class="icon icon--keyboard"></span>\n                        <span data-chat-input-mute class="icon icon--volume-mute"></span>\n                    </span>\n\n                    <div data-sound-input-wrap>\n                        <span data-chat-input-mic class="icon icon--largest icon--mic"></span>\n                    </div>\n                    <div data-text-input-wrap>\n\n                        <input type="text" id="chatWindowTextInput" placeholder="Type text..." autocomplete="off"/>\n                        <span data-chat-input-controls class="controls--visible">\n                            <span data-chat-input-stop class="icon icon--stop icon--hidden"></span>\n                        </span>\n                        <span data-chat-input-arrow class="icon icon--arrow-up icon--arrow-up--hidden"></span>\n                    \n                    </div>\n                    <div data-chat-input-controllers class="data-chat-input-controllers">\n                        <span data-chat-input-menu class="icon icon--menu"></span>\n                    </div>    \n\n                    <span data-chat-input-back class="icon icon--back"></span>\n\n                </div>\n            </div>\n        </div>\n        <div data-user-pcm class="pcm pcm-user bu-invisible"></div>\n        <div data-bot-pcm class="pcm pcm-bot bu-invisible"></div>\n        <div data-background class="background"></div>\n    </div>\n    <div data-trigger></div>\n',ke.element.setAttribute("data-gui-mode",ke.settings.guiMode),ke.settings.fullScreen&&ke.element.setAttribute("data-fullscreen",""),ke.reverseAvatarOrderAction(),ke.imageKioskElement=ke.element.querySelector("[data-image]"),ke.userPcmElement=ke.element.querySelector("[data-user-pcm]"),ke.botPcmElement=ke.element.querySelector("[data-bot-pcm]"),ke.messagesElement=ke.element.querySelector("[data-messages]"),ke.chatElement=ke.element.querySelector("[data-chat-input]"),ke.chatInputElement=ke.chatElement.querySelector("input"),ke.chatTextInputElement=ke.element.querySelector("[data-chat-input]"),ke.chatInputMuteElement=ke.element.querySelector("[data-chat-input-mute]"),ke.chatInputMicrophoneElement=ke.element.querySelector("[data-chat-input-microphone]"),ke.chatInputMicElement=ke.element.querySelector("[data-chat-input-mic]"),ke.chatInputArrowElement=ke.element.querySelector("[data-chat-input-arrow]"),ke.avatarElement=ke.element.querySelector("[data-avatar]"),ke.chatInputMenuElement=ke.element.querySelector("[data-chat-input-menu]"),ke.chatInputSettingsElement=ke.element.querySelector("[data-chat-input-settings]"),ke.chatInputControlsElement=ke.element.querySelector("[data-chat-input-controls]"),ke.chatInputPlayElement=ke.element.querySelector("[data-chat-input-play]"),ke.chatInputStopElement=ke.element.querySelector("[data-chat-input-stop]"),ke.collapsableTriggerElement=ke.element.querySelector("[data-trigger]"),ke.botWrapperElement=ke.element.querySelector("[data-wrapper]"),ke.chatInputKeyboardElement=ke.element.querySelector("[data-chat-input-keyboard]"),ke.soundInput=ke.element.querySelector("[data-sound-input-wrap]"),ke.textInput=ke.element.querySelector("[data-text-input-wrap"),ke.controllerWrapper=ke.element.querySelector("[data-chat-input-controllers]"),ke.chatInputBackElement=ke.element.querySelector("[data-chat-input-back]"),ke.sopSection=ke.element.querySelector("[data-chat-sop]"),ke.questionSection=ke.element.querySelector("[data-chat-ask]"),ke.questionSOPButton=ke.element.querySelector("[data-sop-question]"),ke.upSOPButton=ke.element.querySelector("[data-sop-back]"),ke.downSOPButton=ke.element.querySelector("[data-sop-next]"),ke.settings.collapsable?(ke.setCollapsableUIHeight(),ke.collapsableTriggerElement.addEventListener("click",(e=>{this.changeCollapsedMode()}))):ke.collapsableTriggerElement.parentNode.removeChild(ke.collapsableTriggerElement),ke.settings.customIcons||Se.forEach((e=>{const t=document.querySelector(".icon--"+e);null!==t&&t.classList.add("icon--content--"+e)})),this.setSection(ke.settings.sections[0]),ke.settings.guiMode===K.KIOSK&&(ke.messagesElement.innerHTML='\n    <div data-user-message class="message message-user"><span></span></div>\n    <div data-bot-message class="message message-bot"><span></span></div>\n',ke.userTextKioskElement=ke.element.querySelector("[data-user-message] span"),ke.botTextKioskElement=ke.element.querySelector("[data-bot-message] span")),ke.isChatEnabled=ke.settings.outputAudio,ke.isMicrophoneEnabled=ke.settings.inputAudio,ke.backgroundElement=ke.element.querySelector("[data-background]"),ke.settings.collapsable||(({width:e,height:i}=ke.settings.widgetSize),ke.element.style.width=u("100vw",!ke.settings.fullScreen&&e?e:null),ke.element.style.height=u("100vh",!ke.settings.fullScreen&&i?i:null)),ke.settings.backgroundAdvancedAnimationParticlesCount=c(0,20,ke.settings.backgroundAdvancedAnimationParticlesCount),ke.backgroundElement.innerHTML="",ke.settings.backgroundSimpleAnimation,$((()=>{ke.backgroundElement.appendChild(document.createElement("span"))}),ke.settings.backgroundAdvancedAnimationParticlesCount),window.addEventListener("resize",((e,t=100)=>{let r;return function(n){r&&clearTimeout(r),r=setTimeout(e,t,n)}})((e=>{var t=(t=ke.element.getBoundingClientRect()).width>t.height?z.LANDSCAPE:z.PORTRAIT;this.setOrientation(t),ke.element.setAttribute("data-orientation",t),ke.handleBotUiHeights()}))),window.addEventListener("load",(e=>{var t=(t=ke.element.getBoundingClientRect()).width>t.height?z.LANDSCAPE:z.PORTRAIT;this.setOrientation(t)})),ke.chatInputElement.onkeyup=e=>{13===e.keyCode&&"text"===t.mode?(ke.getInputValue(ke.chatInputElement.value,this.chatInputCallback),ke.chatInputElement.value="",ke.changeClasses("icon--arrow-up--visible","icon--arrow-up--hidden",ke.chatInputArrowElement)):0<ke.chatInputElement.value.length?ke.chatInputArrowElement.classList.contains("icon--arrow-up--hidden")&&ke.changeClasses("icon--arrow-up--hidden","icon--arrow-up--visible",ke.chatInputArrowElement):ke.changeClasses("icon--arrow-up--visible","icon--arrow-up--hidden",ke.chatInputArrowElement)},ke.chatInputMuteElement.onclick=e=>{ke.isChatEnabled=!ke.isChatEnabled,ke.isChatEnabled?(ke.chatInputMuteElement.classList.remove("icon--light"),ke.changeClasses(ke.settings.muteIcon,ke.settings.volumeIcon,ke.chatInputMuteElement)):(ke.chatInputMuteElement.classList.add("icon--light"),ke.changeClasses(ke.settings.volumeIcon,ke.settings.muteIcon,ke.chatInputMuteElement)),ke.getChatMute(ke.isChatEnabled,this.chatMuteCallback)},ke.chatInputMenuElement.onclick=e=>{ke.changeClasses("settings--visible","settings--hidden",ke.chatInputSettingsElement)},ke.chatInputArrowElement.onclick=e=>{var t=ke.chatInputElement.value;""!==t?(ke.changeClasses("icon--arrow-up--visible","icon--arrow-up--hidden",ke.chatInputArrowElement),ke.getInputValue(t,this.chatInputCallback),ke.chatInputElement.value=""):this.chatArrowCallback()},this.setTextInputEnabled(ke.settings.textInputEnabled),(()=>{var e=document.querySelector("script[data-bot-ui-resource]");if(e){const t=e.src;e=t.substring(0,t.lastIndexOf("/")+1);const r="".concat(e,"app.css"),n=document.querySelectorAll('link[rel="stylesheet"]');let i=!1;if(n.forEach((e=>{0===e.href.indexOf(r)&&(i=!0)})),!i){const e=document.head,t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=r,e.appendChild(t)}}})(),ke.chatInputKeyboardElement.onclick=e=>{this.chatKeyboardCallback()},ke.questionSOPButton.onclick=e=>{this.chatSopQuestionCallback()},ke.upSOPButton.onclick=e=>{this.chatSopPreviousCallback()},ke.downSOPButton.onclick=e=>{this.chatSopNextCallback()},ke.chatInputMicElement.onclick=e=>{this.chatMicCallback()},ke.chatInputStopElement.onclick=e=>{this.chatStopCallback()},ke.chatInputBackElement.onclick=e=>{this.chatBackCallback(e)},ke.chatTextInputElement.oninput=e=>{this.chatTextInputElementCallback(e)},ke.setBackground({}))}setMicIcon(e){e?(ke.chatInputMicElement.classList.add(Te,"icon--large"),ke.chatInputMicElement.classList.remove("icon--largest")):(ke.chatInputMicElement.classList.remove(Te,"icon--large"),ke.chatInputMicElement.classList.add("icon--largest"))}setSection(e="SOP"){var t=ke.settings.sections.indexOf(e);ke.settings.sectionActive=t,this.setSectionUI(e)}nextSection(){var e;ke.settings.sectionActive<ke.settings.sections.length-1&&(ke.settings.sectionActive+=1,e=ke.settings.sections[ke.settings.sectionActive],this.setSection(e))}previousSection(){var e;0<=ke.settings.sectionActive&&(--ke.settings.sectionActive,e=ke.settings.sections[ke.settings.sectionActive],this.setSection(e))}setInputMode(e){ke.chatInputSettingsElement.classList.add("settings--hidden"),ke.chatInputSettingsElement.classList.remove("settings--visible"),"voice"===e?(ke.chatInputKeyboardElement.classList.add(ke.settings.micIcon+"2"),ke.chatInputKeyboardElement.classList.remove(ke.settings.keyboardIcon),ke.soundInput.setAttribute("style","display:none;"),ke.textInput.setAttribute("style","display:block;"),ke.controllerWrapper.classList.add("text-mode")):"text"===e&&(ke.chatInputKeyboardElement.classList.remove(ke.settings.micIcon+"2"),ke.chatInputKeyboardElement.classList.add(ke.settings.keyboardIcon),ke.soundInput.setAttribute("style","display:block;"),ke.textInput.setAttribute("style","display:none;"),ke.controllerWrapper.classList.remove("text-mode"),ke.chatInputSettingsElement.classList.add("text-mode"))}setSectionUI(e){switch(e){case"LOGIN":default:this.nextSection();break;case"INPUTSELECT":const e=e=>{this.setInputMode(e),sessionStorage.setItem("INPUTSELECT",e),ke.settings.mode="voice"===e?"text":"voice",ke.messagesElement.textContent="",this.nextSection()};var t=sessionStorage.getItem("INPUTSELECT");null===t?(ke.questionSection.classList.add("ask-section--hidden"),ke.sopSection.classList.add("sop-section--hidden"),this.setBotText("Please choose an input type."),this.setButton("",(()=>{e("text")}),"modeSelect",!0,"Voice Input"),this.setButton("",(()=>{e("voice")}),"modeSelect",!0,"Text Input")):e(t);break;case"SOP":ke.questionSection.classList.add("ask-section--hidden"),ke.sopSection.classList.remove("sop-section--hidden");break;case"QUESTION":ke.questionSection.classList.remove("ask-section--hidden"),ke.sopSection.classList.add("sop-section--hidden")}}removeOverlay(){ke.botPcmElement.classList.add("bu-invisible"),ke.botPcmElement.classList.remove("bu-visible")}resume(e,t){t||"voice"!==e||(ke.botPcmElement.classList.remove("bu-invisible"),ke.botPcmElement.classList.add("bu-visible"))}}ke.isChatEnabled=!0,ke.isMicrophoneEnabled=!0,ke.changeClasses=(e,t,r)=>{r.classList.contains(e)?(r.classList.remove(e),r.classList.add(t)):(r.classList.remove(t),r.classList.add(e))},ke.videoCallback=()=>{},ke.reverseAvatarOrderAction=(e=ke.settings.reverseAvatarOrder)=>{ke.settings.reverseAvatarOrder=e,!0===ke.settings.reverseAvatarOrder?ke.element.setAttribute("data-avatar-reverse-order",""):ke.element.removeAttribute("data-avatar-reverse-order")},ke.showAvatar=(e=!0)=>{ke.element.hasAttribute("data-with-avatar")||ke.settings.guiMode!==K.CHAT||ke.scrollToLastMessage(ke.messagesElement),e?ke.element.setAttribute("data-with-avatar",""):ke.element.removeAttribute("data-with-avatar"),ke.handleBotUiHeights()},ke.handleBotUiHeights=()=>{var e=ke.element.hasAttribute("data-with-avatar"),{height:t}=ke.element.getBoundingClientRect(),r=t*Ee[ke.settings.guiMode],t=.25*t*-1;r=e?"".concat(r,"px"):"0px",ke.element.style.setProperty("--bot-ui-avatar-height",r),ke.element.style.setProperty("--bot-ui-avatar-text-overlap","".concat(t,"px"))},ke.getInputValue=(e,t)=>t(e),ke.getChatMicrophone=(e,t)=>{ke.isMicrophoneEnabled?ke.chatInputBargeElement.classList.add(ke.settings.micIcon):ke.chatInputBargeElement.classList.remove(ke.settings.micIcon),t(e)},ke._setMicrophone=()=>{ke.isMicrophoneEnabled?ke.chatInputMicElement.classList.add("icon--light"):ke.chatInputMicElement.classList.remove("icon--light")},ke.getChatMute=(e,t)=>t(e),ke.setBackground=e=>{var{color:t=ke.settings.backgroundColor,url:{path:r=ke.settings.backgroundImage,blur:e=ke.settings.backgroundImageBlur}={}}=e;ke.settings.backgroundColor=t,ke.settings.backgroundImageBlur=e,ke.settings.backgroundImage=r,t&&(ke.element.style.setProperty("--bot-ui-background-color",t),ke.backgroundElement.classList.remove("background--image")),r&&(ke.backgroundElement.classList.add("background--image"),ke.element.style.setProperty("--bot-ui-background-url",'url("'.concat(r,'")')),ke.element.style.setProperty("--bot-ui-background-url-blur","".concat(e,"px")))},ke.setChatMessage=(e,t,r,n,i=!1)=>{const a=ke.messagesElement,o=(e=>{const t=document.createElement("DIV");return t.innerHTML=e,t})('\n    <div class="chat-message">\n        <span></span>\n    </div>\n'),s=o.querySelector("div.chat-message"),c=s.querySelector(":scope span");var{dataset:{messageType:u}={}}=a&&a.lastChild&&a.lastChild;if(i&&null!==a.lastChild&&u!==q.BOT?a.removeChild(a.lastChild):u&&u===n&&a.lastChild.classList.remove("chat-message-last"),c.innerHTML=e,s.setAttribute("data-message-type",n),s.classList.add("chat-message-"+n),s.classList.add("chat-message-last"),t){const e=new Image;e.onload=t=>{s.appendChild(e),a.scrollTop=a.scrollHeight},e.onerror=e=>{},e.src=t}if(r)if(r.includes("youtube.com/embed")){const e=document.createElement("iframe");e.setAttribute("src",r),s.appendChild(e),a.scrollTop=a.scrollHeight,ke.videoCallback()}else{const e=document.createElement("video");e.src=r,e.autoplay=!0,e.onloadeddata=e=>{a.scrollTop=a.scrollHeight},e.onended=e=>{ke.videoCallback()},s.appendChild(e)}a.appendChild(o.children[0]),a.scrollTop=a.scrollHeight,ke.scrollToLastMessage(a)},ke.scrollToLastMessage=e=>{window.setTimeout((()=>{ye(e,e.scrollHeight,ke.settings.animationSpeed)}))},ke.setCollapsableUIHeight=()=>{var e=ke.settings.collapsed?"collapsed":"expanded";ke.element.setAttribute("data-collapsable",e);var{width:t,height:e}=ke.settings.widgetSize;ke.element.style.width=ke.settings.collapsed?null:t,ke.element.style.height=ke.settings.collapsed?null:e}}],e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var i in t)e.d(n,i,function(e){return t[e]}.bind(null,i));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=46);function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var t,r}()},function(e,t,r){"use strict";(function(e){r.d(t,"c",(function(){return u})),r.d(t,"f",(function(){return l})),r.d(t,"e",(function(){return f})),r.d(t,"d",(function(){return m})),r.d(t,"b",(function(){return v})),r.d(t,"a",(function(){return y}));var n=r(0),i=r(24),a=r(4),o=r(32),s=r(21),c=r(14);function u(e,t,r){if(t in e){var n=e[t],i=r(n);if("function"==typeof i)try{i.prototype=i.prototype||{},Object.defineProperties(i,{__sentry_original__:{enumerable:!1,value:n}})}catch(e){}e[t]=i}}function l(e){return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}function d(e){if(Object(a.d)(e)){var t=e,r={message:t.message,name:t.name,stack:t.stack};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return r}if(Object(a.f)(e)){var o=e,s={};s.type=o.type;try{s.target=Object(a.c)(o.target)?Object(i.a)(o.target):Object.prototype.toString.call(o.target)}catch(e){s.target="<unknown>"}try{s.currentTarget=Object(a.c)(o.currentTarget)?Object(i.a)(o.currentTarget):Object.prototype.toString.call(o.currentTarget)}catch(e){s.currentTarget="<unknown>"}for(var n in"undefined"!=typeof CustomEvent&&Object(a.g)(e,CustomEvent)&&(s.detail=o.detail),o)Object.prototype.hasOwnProperty.call(o,n)&&(s[n]=o);return s}return e}function h(e){return function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(e))}function f(e,t,r){void 0===t&&(t=3),void 0===r&&(r=102400);var n=m(e,t);return h(n)>r?f(e,t-1,r):n}function p(t,r){return"domain"===r&&t&&"object"==typeof t&&t._events?"[Domain]":"domainEmitter"===r?"[DomainEmitter]":void 0!==e&&t===e?"[Global]":"undefined"!=typeof window&&t===window?"[Window]":"undefined"!=typeof document&&t===document?"[Document]":Object(a.l)(t)?"[SyntheticEvent]":"number"==typeof t&&t!=t?"[NaN]":void 0===t?"[undefined]":"function"==typeof t?"[Function: "+Object(s.a)(t)+"]":"symbol"==typeof t?"["+String(t)+"]":"bigint"==typeof t?"[BigInt: "+String(t)+"]":t}function g(e,t,r,n){if(void 0===r&&(r=1/0),void 0===n&&(n=new o.a),0===r)return function(e){var t=Object.prototype.toString.call(e);if("string"==typeof e)return e;if("[object Object]"===t)return"[Object]";if("[object Array]"===t)return"[Array]";var r=p(e);return Object(a.i)(r)?r:t}(t);if(null!=t&&"function"==typeof t.toJSON)return t.toJSON();var i=p(t,e);if(Object(a.i)(i))return i;var s=d(t),c=Array.isArray(t)?[]:{};if(n.memoize(t))return"[Circular ~]";for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(c[u]=g(u,s[u],r-1,n));return n.unmemoize(t),c}function m(e,t){try{return JSON.parse(JSON.stringify(e,(function(e,r){return g(e,r,t)})))}catch(e){return"**non-serializable**"}}function v(e,t){void 0===t&&(t=40);var r=Object.keys(d(e));if(r.sort(),!r.length)return"[object has no keys]";if(r[0].length>=t)return Object(c.d)(r[0],t);for(var n=r.length;n>0;n--){var i=r.slice(0,n).join(", ");if(!(i.length>t))return n===r.length?i:Object(c.d)(i,t)}return""}function y(e){var t,r;if(Object(a.h)(e)){var i=e,o={};try{for(var s=Object(n.f)(Object.keys(i)),c=s.next();!c.done;c=s.next()){var u=c.value;void 0!==i[u]&&(o[u]=y(i[u]))}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return o}return Array.isArray(e)?e.map(y):e}}).call(this,r(26))},function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"}(n||(n={})),function(e){e.fromHttpCode=function(t){if(t<400)return e.Ok;if(t>=400&&t<500)switch(t){case 401:return e.Unauthenticated;case 403:return e.PermissionDenied;case 404:return e.NotFound;case 409:return e.AlreadyExists;case 413:return e.FailedPrecondition;case 429:return e.ResourceExhausted;default:return e.InvalidArgument}if(t>=500&&t<600)switch(t){case 501:return e.Unimplemented;case 503:return e.Unavailable;case 504:return e.DeadlineExceeded;default:return e.InternalError}return e.UnknownError}}(n||(n={}))},function(e,t,r){"use strict";(function(e,n){r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return u}));var i=r(4),a=r(7);function o(){return"[object process]"===Object.prototype.toString.call(void 0!==e?e:0)}function s(e,t){return e.require(t)}var c=["cookies","data","headers","method","query_string","url"];function u(e,t){if(void 0===t&&(t=c),!o())throw new Error("Can't get node request data outside of a node environment");var r={},u=e.headers||e.header||{},l=e.method,d=e.hostname||e.host||u.host||"<no host>",h="https"===e.protocol||e.secure||(e.socket||{}).encrypted?"https":"http",f=e.originalUrl||e.url||"",p=h+"://"+d+f;return t.forEach((function(t){switch(t){case"headers":r.headers=u;break;case"method":r.method=l;break;case"url":r.url=p;break;case"cookies":r.cookies=e.cookies||s(n,"cookie").parse(u.cookie||"");break;case"query_string":r.query_string=s(n,"url").parse(f||"",!1).query;break;case"data":if("GET"===l||"HEAD"===l)break;void 0!==e.body&&(r.data=Object(i.k)(e.body)?e.body:JSON.stringify(Object(a.d)(e.body)));break;default:({}).hasOwnProperty.call(e,t)&&(r[t]=e[t])}})),r}}).call(this,r(37),r(15)(e))},,,function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return y})),r.d(t,"a",(function(){return b}));var n=r(0),i=r(20),a=r(23),o=r(3),s=r(9),c=r(4),u=r(5),l=r(33),d=r(16),h=r(17),f=r(2);function p(){var e=this.getScope();if(e){var t=e.getSpan();if(t)return{"sentry-trace":t.toTraceparent()}}return{}}function g(e,t,r){var i,s,c=e.getClient(),u=c&&c.getOptions()||{};return c&&Object(f.c)(u)?void 0!==t.sampled?(t.tags=Object(n.a)(Object(n.a)({},t.tags),{__sentry_samplingMethod:a.a.Explicit}),t):("function"==typeof u.tracesSampler?(s=u.tracesSampler(r),t.tags=Object(n.a)(Object(n.a)({},t.tags),{__sentry_samplingMethod:a.a.Sampler,__sentry_sampleRate:String(Number(s))})):void 0!==r.parentSampled?(s=r.parentSampled,t.tags=Object(n.a)(Object(n.a)({},t.tags),{__sentry_samplingMethod:a.a.Inheritance})):(s=u.tracesSampleRate,t.tags=Object(n.a)(Object(n.a)({},t.tags),{__sentry_samplingMethod:a.a.Rate,__sentry_sampleRate:String(Number(s))})),function(e){if(isNaN(e)||"number"!=typeof e&&"boolean"!=typeof e)return o.a.warn("[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got "+JSON.stringify(e)+" of type "+JSON.stringify(typeof e)+"."),!1;if(e<0||e>1)return o.a.warn("[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got "+e+"."),!1;return!0}(s)?s?(t.sampled=Math.random()<s,t.sampled?(t.initSpanRecorder(null===(i=u._experiments)||void 0===i?void 0:i.maxSpans),o.a.log("[Tracing] starting "+t.op+" transaction - "+t.name),t):(o.a.log("[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = "+Number(s)+")"),t)):(o.a.log("[Tracing] Discarding transaction because "+("function"==typeof u.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),t.sampled=!1,t):(o.a.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)):(t.sampled=!1,t)}function m(t){var r={transactionContext:t,parentSampled:t.parentSampled};if(Object(s.c)()){var a=Object(i.b)();if(a){var o=Object(s.a)(e,"http").IncomingMessage,l=a.members.find((function(e){return Object(c.g)(e,o)}));l&&(r.request=Object(s.b)(l))}}else{var d=Object(u.e)();"location"in d&&(r.location=Object(n.a)({},d.location))}return r}function v(e,t){return g(this,new h.a(e,this),Object(n.a)(Object(n.a)({},m(e)),t))}function y(e,t,r,n){return g(e,new d.b(t,e,r,n),m(t))}function b(){var e;(e=Object(i.d)()).__SENTRY__&&(e.__SENTRY__.extensions=e.__SENTRY__.extensions||{},e.__SENTRY__.extensions.startTransaction||(e.__SENTRY__.extensions.startTransaction=v),e.__SENTRY__.extensions.traceHeaders||(e.__SENTRY__.extensions.traceHeaders=p)),Object(l.a)()}}).call(this,r(15)(e))},function(e,t,r){"use strict";r.d(t,"b",(function(){return c})),r.d(t,"a",(function(){return u}));var n=r(0),i=r(5),a=r(18),o=r(7),s=r(8),c=function(){function e(e){void 0===e&&(e=1e3),this.spans=[],this._maxlen=e}return e.prototype.add=function(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)},e}(),u=function(){function e(e){if(this.traceId=Object(i.i)(),this.spanId=Object(i.i)().substring(16),this.startTimestamp=Object(a.c)(),this.tags={},this.data={},!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp)}return e.prototype.child=function(e){return this.startChild(e)},e.prototype.startChild=function(t){var r=new e(Object(n.a)(Object(n.a)({},t),{parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId}));return r.spanRecorder=this.spanRecorder,r.spanRecorder&&r.spanRecorder.add(r),r.transaction=this.transaction,r},e.prototype.setTag=function(e,t){var r;return this.tags=Object(n.a)(Object(n.a)({},this.tags),((r={})[e]=t,r)),this},e.prototype.setData=function(e,t){var r;return this.data=Object(n.a)(Object(n.a)({},this.data),((r={})[e]=t,r)),this},e.prototype.setStatus=function(e){return this.status=e,this},e.prototype.setHttpStatus=function(e){this.setTag("http.status_code",String(e));var t=s.a.fromHttpCode(e);return t!==s.a.UnknownError&&this.setStatus(t),this},e.prototype.isSuccess=function(){return this.status===s.a.Ok},e.prototype.finish=function(e){this.endTimestamp="number"==typeof e?e:Object(a.c)()},e.prototype.toTraceparent=function(){var e="";return void 0!==this.sampled&&(e=this.sampled?"-1":"-0"),this.traceId+"-"+this.spanId+e},e.prototype.getTraceContext=function(){return Object(o.a)({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})},e.prototype.toJSON=function(){return Object(o.a)({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})},e}()},function(e,t,r){"use strict";r.d(t,"d",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return s}));var n=r(4);function i(e,t){return void 0===t&&(t=0),"string"!=typeof e||0===t||e.length<=t?e:e.substr(0,t)+"..."}function a(e,t){var r=e,n=r.length;if(n<=150)return r;t>n&&(t=n);var i=Math.max(t-60,0);i<5&&(i=0);var a=Math.min(i+140,n);return a>n-5&&(a=n),a===n&&(i=Math.max(a-140,0)),r=r.slice(i,a),i>0&&(r="'{snip} "+r),a<n&&(r+=" {snip}"),r}function o(e,t){if(!Array.isArray(e))return"";for(var r=[],n=0;n<e.length;n++){var i=e[n];try{r.push(String(i))}catch(e){r.push("[value cannot be serialized]")}}return r.join(t)}function s(e,t){return!!Object(n.k)(e)&&(Object(n.j)(t)?t.test(e):"string"==typeof t&&-1!==e.indexOf(t))}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return d}));var n=r(0),i=r(18),a=r(3),o=r(13),s=r(8),c=r(17),u=1e3,l=function(e){function t(t,r,n,i){void 0===n&&(n="");var a=e.call(this,i)||this;return a._pushActivity=t,a._popActivity=r,a.transactionSpanId=n,a}return Object(n.b)(t,e),t.prototype.add=function(t){var r=this;t.spanId!==this.transactionSpanId&&(t.finish=function(e){t.endTimestamp="number"==typeof e?e:Object(i.c)(),r._popActivity(t.spanId)},void 0===t.endTimestamp&&this._pushActivity(t.spanId)),e.prototype.add.call(this,t)},t}(o.b),d=function(e){function t(t,r,n,i){void 0===n&&(n=u),void 0===i&&(i=!1);var o=e.call(this,t,r)||this;return o._idleHub=r,o._idleTimeout=n,o._onScope=i,o.activities={},o._heartbeatTimer=0,o._heartbeatCounter=0,o._finished=!1,o._beforeFinishCallbacks=[],r&&i&&(h(r),a.a.log("Setting idle transaction on scope. Span ID: "+o.spanId),r.configureScope((function(e){return e.setSpan(o)}))),o}return Object(n.b)(t,e),t.prototype.finish=function(t){var r,o,c=this;if(void 0===t&&(t=Object(i.c)()),this._finished=!0,this.activities={},this.spanRecorder){a.a.log("[Tracing] finishing IdleTransaction",new Date(1e3*t).toISOString(),this.op);try{for(var u=Object(n.f)(this._beforeFinishCallbacks),l=u.next();!l.done;l=u.next()){(0,l.value)(this,t)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}this.spanRecorder.spans=this.spanRecorder.spans.filter((function(e){if(e.spanId===c.spanId)return!0;e.endTimestamp||(e.endTimestamp=t,e.setStatus(s.a.Cancelled),a.a.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(e,void 0,2)));var r=e.startTimestamp<t;return r||a.a.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(e,void 0,2)),r})),this._onScope&&h(this._idleHub),a.a.log("[Tracing] flushing IdleTransaction")}else a.a.log("[Tracing] No active IdleTransaction");return e.prototype.finish.call(this,t)},t.prototype.registerBeforeFinishCallback=function(e){this._beforeFinishCallbacks.push(e)},t.prototype.initSpanRecorder=function(e){var t=this;if(!this.spanRecorder){this._initTimeout=setTimeout((function(){t._finished||t.finish()}),this._idleTimeout);this.spanRecorder=new l((function(e){t._finished||t._pushActivity(e)}),(function(e){t._finished||t._popActivity(e)}),this.spanId,e),a.a.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)},t.prototype._pushActivity=function(e){this._initTimeout&&(clearTimeout(this._initTimeout),this._initTimeout=void 0),a.a.log("[Tracing] pushActivity: "+e),this.activities[e]=!0,a.a.log("[Tracing] new activities count",Object.keys(this.activities).length)},t.prototype._popActivity=function(e){var t=this;if(this.activities[e]&&(a.a.log("[Tracing] popActivity "+e),delete this.activities[e],a.a.log("[Tracing] new activities count",Object.keys(this.activities).length)),0===Object.keys(this.activities).length){var r=this._idleTimeout,n=Object(i.c)()+r/1e3;setTimeout((function(){t._finished||t.finish(n)}),r)}},t.prototype._beat=function(){if(clearTimeout(this._heartbeatTimer),!this._finished){var e=Object.keys(this.activities),t=e.length?e.reduce((function(e,t){return e+t})):"";t===this._prevHeartbeatString?this._heartbeatCounter+=1:this._heartbeatCounter=1,this._prevHeartbeatString=t,this._heartbeatCounter>=3?(a.a.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus(s.a.DeadlineExceeded),this.setTag("heartbeat","failed"),this.finish()):this._pingHeartbeat()}},t.prototype._pingHeartbeat=function(){var e=this;a.a.log("pinging Heartbeat -> current counter: "+this._heartbeatCounter),this._heartbeatTimer=setTimeout((function(){e._beat()}),5e3)},t}(c.a);function h(e){if(e){var t=e.getScope();if(t)t.getTransaction()&&t.setSpan(void 0)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(0),i=r(20),a=r(4),o=r(3),s=r(13),c=function(e){function t(t,r){var n=e.call(this,t)||this;return n._measurements={},n._hub=Object(i.c)(),Object(a.g)(r,i.a)&&(n._hub=r),n.name=t.name?t.name:"",n._trimEnd=t.trimEnd,n.transaction=n,n}return Object(n.b)(t,e),t.prototype.setName=function(e){this.name=e},t.prototype.initSpanRecorder=function(e){void 0===e&&(e=1e3),this.spanRecorder||(this.spanRecorder=new s.b(e)),this.spanRecorder.add(this)},t.prototype.setMeasurements=function(e){this._measurements=Object(n.a)({},e)},t.prototype.finish=function(t){var r=this;if(void 0===this.endTimestamp){if(this.name||(o.a.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),e.prototype.finish.call(this,t),!0===this.sampled){var n=this.spanRecorder?this.spanRecorder.spans.filter((function(e){return e!==r&&e.endTimestamp})):[];this._trimEnd&&n.length>0&&(this.endTimestamp=n.reduce((function(e,t){return e.endTimestamp&&t.endTimestamp?e.endTimestamp>t.endTimestamp?e:t:e})).endTimestamp);var i={contexts:{trace:this.getTraceContext()},spans:n,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction"};return Object.keys(this._measurements).length>0&&(o.a.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),i.measurements=this._measurements),this._hub.captureEvent(i)}o.a.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.")}},t}(s.a)},function(e,t,r){"use strict";(function(e){r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return l}));var n=r(5),i=r(9),a={nowSeconds:function(){return Date.now()/1e3}};var o=Object(i.c)()?function(){try{return Object(i.a)(e,"perf_hooks").performance}catch(e){return}}():function(){var e=Object(n.e)().performance;if(e&&e.now)return{now:function(){return e.now()},timeOrigin:Date.now()-e.now()}}(),s=void 0===o?a:{nowSeconds:function(){return(o.timeOrigin+o.now())/1e3}},c=a.nowSeconds.bind(a),u=s.nowSeconds.bind(s),l=function(){var e=Object(n.e)().performance;if(e)return e.timeOrigin?e.timeOrigin:e.timing&&e.timing.navigationStart||Date.now()}()}).call(this,r(15)(e))},function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n,i=r(4);!function(e){e.PENDING="PENDING",e.RESOLVED="RESOLVED",e.REJECTED="REJECTED"}(n||(n={}));var a=function(){function e(e){var t=this;this._state=n.PENDING,this._handlers=[],this._resolve=function(e){t._setResult(n.RESOLVED,e)},this._reject=function(e){t._setResult(n.REJECTED,e)},this._setResult=function(e,r){t._state===n.PENDING&&(Object(i.m)(r)?r.then(t._resolve,t._reject):(t._state=e,t._value=r,t._executeHandlers()))},this._attachHandler=function(e){t._handlers=t._handlers.concat(e),t._executeHandlers()},this._executeHandlers=function(){if(t._state!==n.PENDING){var e=t._handlers.slice();t._handlers=[],e.forEach((function(e){e.done||(t._state===n.RESOLVED&&e.onfulfilled&&e.onfulfilled(t._value),t._state===n.REJECTED&&e.onrejected&&e.onrejected(t._value),e.done=!0)}))}};try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}return e.resolve=function(t){return new e((function(e){e(t)}))},e.reject=function(t){return new e((function(e,r){r(t)}))},e.all=function(t){return new e((function(r,n){if(Array.isArray(t))if(0!==t.length){var i=t.length,a=[];t.forEach((function(t,o){e.resolve(t).then((function(e){a[o]=e,0===(i-=1)&&r(a)})).then(null,n)}))}else r([]);else n(new TypeError("Promise.all requires an array as input."))}))},e.prototype.then=function(t,r){var n=this;return new e((function(e,i){n._attachHandler({done:!1,onfulfilled:function(r){if(t)try{return void e(t(r))}catch(e){return void i(e)}else e(r)},onrejected:function(t){if(r)try{return void e(r(t))}catch(e){return void i(e)}else i(t)}})}))},e.prototype.catch=function(e){return this.then((function(e){return e}),e)},e.prototype.finally=function(t){var r=this;return new e((function(e,n){var i,a;return r.then((function(e){a=!1,i=e,t&&t()}),(function(e){a=!0,i=e,t&&t()})).then((function(){a?n(i):e(i)}))}))},e.prototype.toString=function(){return"[object SyncPromise]"},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"d",(function(){return f})),r.d(t,"c",(function(){return g})),r.d(t,"b",(function(){return m}));var n=r(0),i=r(5),a=r(18),o=r(3),s=r(9),c=r(22),u=r(42),l=r(7),d=function(){function e(e){this.errors=0,this.sid=Object(i.i)(),this.timestamp=Date.now(),this.started=Date.now(),this.duration=0,this.status=u.a.Ok,e&&this.update(e)}return e.prototype.update=function(e){void 0===e&&(e={}),e.user&&(e.user.ip_address&&(this.ipAddress=e.user.ip_address),e.did||(this.did=e.user.id||e.user.email||e.user.username)),this.timestamp=e.timestamp||Date.now(),e.sid&&(this.sid=32===e.sid.length?e.sid:Object(i.i)()),e.did&&(this.did=""+e.did),"number"==typeof e.started&&(this.started=e.started),"number"==typeof e.duration?this.duration=e.duration:this.duration=this.timestamp-this.started,e.release&&(this.release=e.release),e.environment&&(this.environment=e.environment),e.ipAddress&&(this.ipAddress=e.ipAddress),e.userAgent&&(this.userAgent=e.userAgent),"number"==typeof e.errors&&(this.errors=e.errors),e.status&&(this.status=e.status)},e.prototype.close=function(e){e?this.update({status:e}):this.status===u.a.Ok?this.update({status:u.a.Exited}):this.update()},e.prototype.toJSON=function(){return Object(l.a)({sid:""+this.sid,init:!0,started:new Date(this.started).toISOString(),timestamp:new Date(this.timestamp).toISOString(),status:this.status,errors:this.errors,did:"number"==typeof this.did||"string"==typeof this.did?""+this.did:void 0,duration:this.duration,attrs:Object(l.a)({release:this.release,environment:this.environment,ip_address:this.ipAddress,user_agent:this.userAgent})})},e}(),h=function(){function e(e,t,r){void 0===t&&(t=new c.a),void 0===r&&(r=3),this._version=r,this._stack=[{}],this.getStackTop().scope=t,this.bindClient(e)}return e.prototype.isOlderThan=function(e){return this._version<e},e.prototype.bindClient=function(e){this.getStackTop().client=e,e&&e.setupIntegrations&&e.setupIntegrations()},e.prototype.pushScope=function(){var e=c.a.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:e}),e},e.prototype.popScope=function(){return!(this.getStack().length<=1)&&!!this.getStack().pop()},e.prototype.withScope=function(e){var t=this.pushScope();try{e(t)}finally{this.popScope()}},e.prototype.getClient=function(){return this.getStackTop().client},e.prototype.getScope=function(){return this.getStackTop().scope},e.prototype.getStack=function(){return this._stack},e.prototype.getStackTop=function(){return this._stack[this._stack.length-1]},e.prototype.captureException=function(e,t){var r=this._lastEventId=Object(i.i)(),a=t;if(!t){var o=void 0;try{throw new Error("Sentry syntheticException")}catch(e){o=e}a={originalException:e,syntheticException:o}}return this._invokeClient("captureException",e,Object(n.a)(Object(n.a)({},a),{event_id:r})),r},e.prototype.captureMessage=function(e,t,r){var a=this._lastEventId=Object(i.i)(),o=r;if(!r){var s=void 0;try{throw new Error(e)}catch(e){s=e}o={originalException:e,syntheticException:s}}return this._invokeClient("captureMessage",e,t,Object(n.a)(Object(n.a)({},o),{event_id:a})),a},e.prototype.captureEvent=function(e,t){var r=this._lastEventId=Object(i.i)();return this._invokeClient("captureEvent",e,Object(n.a)(Object(n.a)({},t),{event_id:r})),r},e.prototype.lastEventId=function(){return this._lastEventId},e.prototype.addBreadcrumb=function(e,t){var r=this.getStackTop(),o=r.scope,s=r.client;if(o&&s){var c=s.getOptions&&s.getOptions()||{},u=c.beforeBreadcrumb,l=void 0===u?null:u,d=c.maxBreadcrumbs,h=void 0===d?100:d;if(!(h<=0)){var f=Object(a.b)(),p=Object(n.a)({timestamp:f},e),g=l?Object(i.c)((function(){return l(p,t)})):p;null!==g&&o.addBreadcrumb(g,Math.min(h,100))}}},e.prototype.setUser=function(e){var t=this.getScope();t&&t.setUser(e)},e.prototype.setTags=function(e){var t=this.getScope();t&&t.setTags(e)},e.prototype.setExtras=function(e){var t=this.getScope();t&&t.setExtras(e)},e.prototype.setTag=function(e,t){var r=this.getScope();r&&r.setTag(e,t)},e.prototype.setExtra=function(e,t){var r=this.getScope();r&&r.setExtra(e,t)},e.prototype.setContext=function(e,t){var r=this.getScope();r&&r.setContext(e,t)},e.prototype.configureScope=function(e){var t=this.getStackTop(),r=t.scope,n=t.client;r&&n&&e(r)},e.prototype.run=function(e){var t=p(this);try{e(this)}finally{p(t)}},e.prototype.getIntegration=function(e){var t=this.getClient();if(!t)return null;try{return t.getIntegration(e)}catch(t){return o.a.warn("Cannot retrieve integration "+e.id+" from the current Hub"),null}},e.prototype.startSpan=function(e){return this._callExtensionMethod("startSpan",e)},e.prototype.startTransaction=function(e,t){return this._callExtensionMethod("startTransaction",e,t)},e.prototype.traceHeaders=function(){return this._callExtensionMethod("traceHeaders")},e.prototype.startSession=function(e){this.endSession();var t=this.getStackTop(),r=t.scope,i=t.client,a=i&&i.getOptions()||{},o=a.release,s=a.environment,c=new d(Object(n.a)(Object(n.a)({release:o,environment:s},r&&{user:r.getUser()}),e));return r&&r.setSession(c),c},e.prototype.endSession=function(){var e=this.getStackTop(),t=e.scope,r=e.client;if(t){var n=t.getSession&&t.getSession();n&&(n.close(),r&&r.captureSession&&r.captureSession(n),t.setSession())}},e.prototype._invokeClient=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a=this.getStackTop(),o=a.scope,s=a.client;s&&s[e]&&(t=s)[e].apply(t,Object(n.e)(r,[o]))},e.prototype._callExtensionMethod=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=f(),i=n.__SENTRY__;if(i&&i.extensions&&"function"==typeof i.extensions[e])return i.extensions[e].apply(this,t);o.a.warn("Extension method "+e+" couldn't be found, doing nothing.")},e}();function f(){var e=Object(i.e)();return e.__SENTRY__=e.__SENTRY__||{extensions:{},hub:void 0},e}function p(e){var t=f(),r=y(t);return b(t,e),r}function g(){var e=f();return v(e)&&!y(e).isOlderThan(3)||b(e,new h),Object(s.c)()?function(e){try{var t=m();if(!t)return y(e);if(!v(t)||y(t).isOlderThan(3)){var r=y(e).getStackTop();b(t,new h(r.client,c.a.clone(r.scope)))}return y(t)}catch(t){return y(e)}}(e):y(e)}function m(){var e=f().__SENTRY__;return e&&e.extensions&&e.extensions.domain&&e.extensions.domain.active}function v(e){return!!(e&&e.__SENTRY__&&e.__SENTRY__.hub)}function y(e){return e&&e.__SENTRY__&&e.__SENTRY__.hub||(e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.hub=new h),e.__SENTRY__.hub}function b(e,t){return!!e&&(e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.hub=t,!0)}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n="<anonymous>";function i(e){try{return e&&"function"==typeof e&&e.name||n}catch(e){return n}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));var n=r(0),i=r(4),a=r(18),o=r(19),s=r(5),c=function(){function e(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._user={},this._tags={},this._extra={},this._contexts={}}return e.clone=function(t){var r=new e;return t&&(r._breadcrumbs=Object(n.e)(t._breadcrumbs),r._tags=Object(n.a)({},t._tags),r._extra=Object(n.a)({},t._extra),r._contexts=Object(n.a)({},t._contexts),r._user=t._user,r._level=t._level,r._span=t._span,r._session=t._session,r._transactionName=t._transactionName,r._fingerprint=t._fingerprint,r._eventProcessors=Object(n.e)(t._eventProcessors)),r},e.prototype.addScopeListener=function(e){this._scopeListeners.push(e)},e.prototype.addEventProcessor=function(e){return this._eventProcessors.push(e),this},e.prototype.setUser=function(e){return this._user=e||{},this._session&&this._session.update({user:e}),this._notifyScopeListeners(),this},e.prototype.getUser=function(){return this._user},e.prototype.setTags=function(e){return this._tags=Object(n.a)(Object(n.a)({},this._tags),e),this._notifyScopeListeners(),this},e.prototype.setTag=function(e,t){var r;return this._tags=Object(n.a)(Object(n.a)({},this._tags),((r={})[e]=t,r)),this._notifyScopeListeners(),this},e.prototype.setExtras=function(e){return this._extra=Object(n.a)(Object(n.a)({},this._extra),e),this._notifyScopeListeners(),this},e.prototype.setExtra=function(e,t){var r;return this._extra=Object(n.a)(Object(n.a)({},this._extra),((r={})[e]=t,r)),this._notifyScopeListeners(),this},e.prototype.setFingerprint=function(e){return this._fingerprint=e,this._notifyScopeListeners(),this},e.prototype.setLevel=function(e){return this._level=e,this._notifyScopeListeners(),this},e.prototype.setTransactionName=function(e){return this._transactionName=e,this._notifyScopeListeners(),this},e.prototype.setTransaction=function(e){return this.setTransactionName(e)},e.prototype.setContext=function(e,t){var r;return null===t?delete this._contexts[e]:this._contexts=Object(n.a)(Object(n.a)({},this._contexts),((r={})[e]=t,r)),this._notifyScopeListeners(),this},e.prototype.setSpan=function(e){return this._span=e,this._notifyScopeListeners(),this},e.prototype.getSpan=function(){return this._span},e.prototype.getTransaction=function(){var e,t,r,n,i=this.getSpan();return(null===(e=i)||void 0===e?void 0:e.transaction)?null===(t=i)||void 0===t?void 0:t.transaction:(null===(n=null===(r=i)||void 0===r?void 0:r.spanRecorder)||void 0===n?void 0:n.spans[0])?i.spanRecorder.spans[0]:void 0},e.prototype.setSession=function(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this},e.prototype.getSession=function(){return this._session},e.prototype.update=function(t){if(!t)return this;if("function"==typeof t){var r=t(this);return r instanceof e?r:this}return t instanceof e?(this._tags=Object(n.a)(Object(n.a)({},this._tags),t._tags),this._extra=Object(n.a)(Object(n.a)({},this._extra),t._extra),this._contexts=Object(n.a)(Object(n.a)({},this._contexts),t._contexts),t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint)):Object(i.h)(t)&&(this._tags=Object(n.a)(Object(n.a)({},this._tags),t.tags),this._extra=Object(n.a)(Object(n.a)({},this._extra),t.extra),this._contexts=Object(n.a)(Object(n.a)({},this._contexts),t.contexts),t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint)),this},e.prototype.clear=function(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this},e.prototype.addBreadcrumb=function(e,t){var r=Object(n.a)({timestamp:Object(a.b)()},e);return this._breadcrumbs=void 0!==t&&t>=0?Object(n.e)(this._breadcrumbs,[r]).slice(-t):Object(n.e)(this._breadcrumbs,[r]),this._notifyScopeListeners(),this},e.prototype.clearBreadcrumbs=function(){return this._breadcrumbs=[],this._notifyScopeListeners(),this},e.prototype.applyToEvent=function(e,t){var r;if(this._extra&&Object.keys(this._extra).length&&(e.extra=Object(n.a)(Object(n.a)({},this._extra),e.extra)),this._tags&&Object.keys(this._tags).length&&(e.tags=Object(n.a)(Object(n.a)({},this._tags),e.tags)),this._user&&Object.keys(this._user).length&&(e.user=Object(n.a)(Object(n.a)({},this._user),e.user)),this._contexts&&Object.keys(this._contexts).length&&(e.contexts=Object(n.a)(Object(n.a)({},this._contexts),e.contexts)),this._level&&(e.level=this._level),this._transactionName&&(e.transaction=this._transactionName),this._span){e.contexts=Object(n.a)({trace:this._span.getTraceContext()},e.contexts);var i=null===(r=this._span.transaction)||void 0===r?void 0:r.name;i&&(e.tags=Object(n.a)({transaction:i},e.tags))}return this._applyFingerprint(e),e.breadcrumbs=Object(n.e)(e.breadcrumbs||[],this._breadcrumbs),e.breadcrumbs=e.breadcrumbs.length>0?e.breadcrumbs:void 0,this._notifyEventProcessors(Object(n.e)(u(),this._eventProcessors),e,t)},e.prototype._notifyEventProcessors=function(e,t,r,a){var s=this;return void 0===a&&(a=0),new o.a((function(o,c){var u=e[a];if(null===t||"function"!=typeof u)o(t);else{var l=u(Object(n.a)({},t),r);Object(i.m)(l)?l.then((function(t){return s._notifyEventProcessors(e,t,r,a+1).then(o)})).then(null,c):s._notifyEventProcessors(e,l,r,a+1).then(o).then(null,c)}}))},e.prototype._notifyScopeListeners=function(){var e=this;this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((function(t){t(e)})),this._notifyingListeners=!1)},e.prototype._applyFingerprint=function(e){e.fingerprint=e.fingerprint?Array.isArray(e.fingerprint)?e.fingerprint:[e.fingerprint]:[],this._fingerprint&&(e.fingerprint=e.fingerprint.concat(this._fingerprint)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint},e}();function u(){var e=Object(s.e)();return e.__SENTRY__=e.__SENTRY__||{},e.__SENTRY__.globalEventProcessors=e.__SENTRY__.globalEventProcessors||[],e.__SENTRY__.globalEventProcessors}function l(e){u().push(e)}},function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.Explicit="explicitly_set",e.Sampler="client_sampler",e.Rate="client_rate",e.Inheritance="inheritance"}(n||(n={}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(4);function i(e){try{for(var t=e,r=[],n=0,i=0,o=" > ".length,s=void 0;t&&n++<5&&!("html"===(s=a(t))||n>1&&i+r.length*o+s.length>=80);)r.push(s),i+=s.length,t=t.parentNode;return r.reverse().join(" > ")}catch(e){return"<unknown>"}}function a(e){var t,r,i,a,o,s=e,c=[];if(!s||!s.tagName)return"";if(c.push(s.tagName.toLowerCase()),s.id&&c.push("#"+s.id),(t=s.className)&&Object(n.k)(t))for(r=t.split(/\s+/),o=0;o<r.length;o++)c.push("."+r[o]);var u=["type","name","title","alt"];for(o=0;o<u.length;o++)i=u[o],(a=s.getAttribute(i))&&c.push("["+i+'="'+a+'"]');return c.join("")}},function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return c})),r.d(t,"b",(function(){return u}));var n=r(3),i=r(5);function a(){if(!("fetch"in Object(i.e)()))return!1;try{return new Headers,new Request(""),new Response,!0}catch(e){return!1}}function o(e){return e&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function s(){if(!a())return!1;var e=Object(i.e)();if(o(e.fetch))return!0;var t=!1,r=e.document;if(r&&"function"==typeof r.createElement)try{var s=r.createElement("iframe");s.hidden=!0,r.head.appendChild(s),s.contentWindow&&s.contentWindow.fetch&&(t=o(s.contentWindow.fetch)),r.head.removeChild(s)}catch(e){n.a.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return t}function c(){if(!a())return!1;try{return new Request("_",{referrerPolicy:"origin"}),!0}catch(e){return!1}}function u(){var e=Object(i.e)(),t=e.chrome,r=t&&t.app&&t.app.runtime,n="history"in e&&!!e.history.pushState&&!!e.history.replaceState;return!r&&n}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return o}));var n=r(9),i=r(3),a=r(7),o=function(){function t(){this.name=t.id}return t.prototype.setupOnce=function(t,r){var o;try{o=Object(n.a)(e,"pg").Client}catch(e){return void i.a.error("Postgres Integration was unable to require `pg` package.")}Object(a.c)(o.prototype,"query",(function(e){return function(t,n,i){var a,o,s=null===(o=null===(a=r().getScope())||void 0===a?void 0:a.getSpan())||void 0===o?void 0:o.startChild({description:"string"==typeof t?t:t.text,op:"db"});return"function"==typeof i?e.call(this,t,n,(function(e,t){var r;null===(r=s)||void 0===r||r.finish(),i(e,t)})):"function"==typeof n?e.call(this,t,(function(e,t){var r;null===(r=s)||void 0===r||r.finish(),n(e,t)})):e.call(this,t,n).then((function(e){var t;return null===(t=s)||void 0===t||t.finish(),e}))}}))},t.id="Postgres",t}()}).call(this,r(15)(e))},function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return o}));var n=r(9),i=r(3),a=r(7),o=function(){function t(){this.name=t.id}return t.prototype.setupOnce=function(t,r){var o;try{o=Object(n.a)(e,"mysql/lib/Connection.js")}catch(e){return void i.a.error("Mysql Integration was unable to require `mysql` package.")}Object(a.c)(o.prototype,"query",(function(e){return function(t,n,i){var a,o,s=null===(o=null===(a=r().getScope())||void 0===a?void 0:a.getSpan())||void 0===o?void 0:o.startChild({description:"string"==typeof t?t:t.sql,op:"db"});return"function"==typeof i?e.call(this,t,n,(function(e,t,r){var n;null===(n=s)||void 0===n||n.finish(),i(e,t,r)})):"function"==typeof n?e.call(this,t,(function(e,t,r){var i;null===(i=s)||void 0===i||i.finish(),n(e,t,r)})):e.call(this,t,n,i)}}))},t.id="Mysql",t}()}).call(this,r(15)(e))},function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u}));var n=r(0),i=r(9),a=r(3),o=r(7),s=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],c={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]},u=function(){function t(e){void 0===e&&(e={}),this.name=t.id,this._operations=Array.isArray(e.operations)?e.operations:s,this._describeOperations=!("describeOperations"in e)||e.describeOperations}return t.prototype.setupOnce=function(t,r){var n;try{n=Object(i.a)(e,"mongodb").Collection}catch(e){return void a.a.error("Mongo Integration was unable to require `mongodb` package.")}this._instrumentOperations(n,this._operations,r)},t.prototype._instrumentOperations=function(e,t,r){var n=this;t.forEach((function(t){return n._patchOperation(e,t,r)}))},t.prototype._patchOperation=function(e,t,r){if(t in e.prototype){var i=this._getSpanContextFromOperationArguments.bind(this);Object(o.c)(e.prototype,t,(function(e){return function(){for(var a,o,s,c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];var l=c[c.length-1],d=r().getScope(),h=null===(a=d)||void 0===a?void 0:a.getSpan();if("function"!=typeof l||"mapReduce"===t&&2===c.length){var f=null===(o=h)||void 0===o?void 0:o.startChild(i(this,t,c));return e.call.apply(e,Object(n.e)([this],c)).then((function(e){var t;return null===(t=f)||void 0===t||t.finish(),e}))}var p=null===(s=h)||void 0===s?void 0:s.startChild(i(this,t,c.slice(0,-1)));return e.call.apply(e,Object(n.e)([this],c.slice(0,-1),[function(e,t){var r;null===(r=p)||void 0===r||r.finish(),l(e,t)}]))}}))}},t.prototype._getSpanContextFromOperationArguments=function(e,t,r){var i={collectionName:e.collectionName,dbName:e.dbName,namespace:e.namespace},a={op:"db",description:t,data:i},o=c[t],s=Array.isArray(this._describeOperations)?this._describeOperations.includes(t):this._describeOperations;if(!o||!s)return a;try{if("mapReduce"===t){var u=Object(n.c)(r,2),l=u[0],d=u[1];i[o[0]]="string"==typeof l?l:l.name||"<anonymous>",i[o[1]]="string"==typeof d?d:d.name||"<anonymous>"}else for(var h=0;h<o.length;h++)i[o[h]]=JSON.stringify(r[h])}catch(e){}return a},t.id="Mongo",t}()}).call(this,r(15)(e))},function(e,t,r){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t,r){e.exports=r(14)},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function r(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,c,"next",e)}function c(e){r(o,i,a,s,c,"throw",e)}s(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(6);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(10),i=r(4),a=r(5),o=r(11);e.exports=function(e){return n(e)||i(e)||a(e)||o()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(12),i=r(4),a=r(5),o=r(13);e.exports=function(e){return n(e)||i(e)||a(e)||o()},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){e.exports=r(15)},function(e,t){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=r(6);e.exports=function(e){if(Array.isArray(e))return n(e)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,r){var n=function(e){"use strict";var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof d?t:d,a=Object.create(i.prototype),o=new S(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return k()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=_(o,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,o),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function d(){}function h(){}function f(){}var p={};p[i]=function(){return this};var g=Object.getPrototypeOf,m=g&&g(g(T([])));m&&m!==t&&r.call(m,i)&&(p=m);var v=f.prototype=d.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(i,a){function o(){return new t((function(n,o){!function n(i,a,o,s){var c=u(e[i],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}(i,a,n,o)}))}return n=n?n.then(o,o):o()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,l;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:k}}function k(){return{value:void 0,done:!0}}return h.prototype=v.constructor=f,f.constructor=h,h.displayName=s(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(b.prototype),b.prototype[a]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var o=new b(c(t,r,n,i),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(v),s(v,o,"Generator"),v[i]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=T,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),E(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;E(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:T(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}},function(e,t,r){"use strict";r.r(t);var n=r(7),i=r.n(n),a=r(8),o=r.n(a),s=r(3),c=r.n(s),u=r(2),l=r.n(u),d=r(1),h=r.n(d),f=r(0),p=r.n(f),g=function e(t,r){var n=this;c()(this,e),h()(this,"open",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.features.getSpeechRecognition().then((function(e){var t=new e;return t.lang=n.language,t.interimResults=!1,t.maxAlternatives=1,t.onresult=function(e){for(var t=0;t<e.results.length;t++)for(var r=e.results[t],i=r.isFinal,a=0;a<r.length&&a<1;a++){var o=r[a];n.cbx({type:"Transcript",transcript:o.transcript,confidence:o.confidence,isFinal:i})}},t.onerror=function(e){console.log("WebSpeech error: ".concat(e.error))},t.onnomatch=function(e){console.log("No match received")},n.recognition=t,Promise.resolve()})));case 1:case"end":return e.stop()}}),e)})))),h()(this,"start",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.recognition.start(),n.cbx({type:"Event",eventType:"InputAudioStreamOpen"}),e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),h()(this,"stop",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.recognition.stop(),e.abrupt("return",Promise.resolve());case 2:case"end":return e.stop()}}),e)})))),h()(this,"close",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.recognition=null,e.abrupt("return",Promise.resolve());case 2:case"end":return e.stop()}}),e)})))),this.features=t,this.cbx=r,console.log("Google STT is being used")},m=function e(t,r,n,i){var a=this;c()(this,e),h()(this,"close",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.audioContext){e.next=4;break}return e.next=3,a.audioContext.close();case 3:a.audioContext=null;case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})))),h()(this,"streamAudioData",(function(e){var t=e.inputBuffer.getChannelData(0),r=Int16Array.from(t.map((function(e){var t=e<0?32768*e:32767*e;return Math.max(-32768,Math.min(32768,t))})));a.webSocket.send(r)})),h()(this,"event",(function(e){if("InputAudioStreamOpen"===e.type){var t=a.audioContext,r=a.stream;a.scriptProcessor=null;var n=t.createGain();if(null===r)return;var i=t.createMediaStreamSource(r),o=t.createAnalyser();a.scriptProcessor=n.context.createScriptProcessor(2048,2,2),i.connect(n),n.connect(o),n.connect(a.scriptProcessor),a.scriptProcessor.connect(n.context.destination),a.scriptProcessor.addEventListener("audioprocess",a.streamAudioData)}})),h()(this,"start",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.audioContext){e.next=8;break}if("suspended"!==a.audioContext.state){e.next=5;break}return e.abrupt("return",a.audioContext.resume().then((function(){return a.init()})));case 5:if("running"!==a.audioContext.state){e.next=7;break}return e.abrupt("return",a.init());case 7:return e.abrupt("return",Promise.reject("Unhandled AudioContext state [".concat(a.audioContext.state,"]")));case 8:return e.abrupt("return",a.features.getAudioContext().then((function(e){return a.audioContext=new e,a.sampleRate=a.audioContext.sampleRate,a.init()})));case 9:case"end":return e.stop()}}),e)})))),h()(this,"init",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.features.getUserMedia().then((function(){return navigator.mediaDevices.getUserMedia({audio:!0})})).then((function(e){return a.stream=e,a.sendAudioOpen(),Promise.resolve()})));case 1:case"end":return e.stop()}}),e)})))),h()(this,"stop",function(){var e=l()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&a.sendAudioClose(),a.scriptProcessor&&(a.scriptProcessor.removeEventListener("audioprocess",a.streamAudioData),a.scriptProcessor=null),a.stream&&(a.stream.getTracks().forEach((function(e){e.stop()})),a.stream=null),e.abrupt("return",a.audioContext.suspend());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.webSocket=r,this.features=t,this.sendAudioOpen=n,this.sendAudioClose=i},v=function e(t,r,n,i,a){var o=this;c()(this,e),h()(this,"detectEngine",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.features.detect("SpeechRecognition").then((function(e){return console.log(e),e?(console.log("chrome"),Promise.resolve("web-speech-api")):Promise.resolve("audio-stream-api")})).catch((function(){return Promise.resolve("audio-stream-api")})));case 1:case"end":return e.stop()}}),e)})))),h()(this,"getEngine",(function(){return o.api})),h()(this,"selectEngine",(function(e){o.api!==e&&("audio-stream-api"===e?o.stt=new m(o.features,o.webSocket,o.sendAudioOpen,o.sendAudioClose):"web-speech-api"===e&&(o.stt=new g(o.features,o.callback)))})),h()(this,"selectLanguage",(function(e){o.stt.language=e})),h()(this,"open",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.stt.open){e.next=2;break}return e.abrupt("return",o.stt.open());case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),h()(this,"start",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.stt.start){e.next=2;break}return e.abrupt("return",o.stt.start());case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),h()(this,"stop",function(){var e=l()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.stt.stop){e.next=2;break}return e.abrupt("return",o.stt.stop(t));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),h()(this,"close",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.stt.close){e.next=2;break}return e.abrupt("return",o.stt.close());case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})))),h()(this,"event",function(){var e=l()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o.stt.event){e.next=2;break}return e.abrupt("return",o.stt.event(t));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.features=t,this.webSocket=r,this.callback=n,this.sendAudioOpen=i,this.sendAudioClose=a},y=Intl.DateTimeFormat,b=function e(t,r,n,i,a){var o=this,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"cs-CZ",u=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,f=arguments.length>8?arguments[8]:void 0,g=arguments.length>9?arguments[9]:void 0;c()(this,e),h()(this,"onSttCallback",(function(e){var t=e.type,r=e.transcript,n=e.isFinal,i=e.eventType;"Transcript"===t?n&&(o.sendText(r),o.callback({type:"Recognized",message:{items:[{text:r}]}})):"Event"===t&&o.callback({type:i})})),h()(this,"open",l()(p.a.mark((function e(){var t,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.webSocket=new WebSocket(o.wsUrl),o.stt=new v(o.features,o.webSocket,o.onSttCallback,o.sendAudioOpen,o.sendAudioClose),t=o.bot.botCallback.getVoice(),r=void 0===t?o.language:o.voices[t],o.stt.detectEngine().then((function(e){return console.log("detected engine",e),o.stt.selectEngine(e)})).then((function(){o.stt.selectLanguage(r),o.stt.open()})),o.webSocket.onmessage=function(e){if(e.data instanceof ArrayBuffer)o.replay(e.data);else if(e.data instanceof Blob)new Response(e.data).arrayBuffer().then(o.replay);else if("string"==typeof e.data){var t=JSON.parse(e.data);o.stt.event(t),o.callback(t)}},o.webSocket.onerror=function(e){o.errorCallback({type:"Client",message:"Socket error:  ".concat(e)})},o.webSocket.onclose=function(e){console.log("Reason for websocket closing: ",e.reason)},e.abrupt("return",new Promise((function(e){o.webSocket.onopen=function(){o.sendPing(o),o.webSocket.send(JSON.stringify({type:"Init",key:o.key,appKey:o.key,deviceId:o.deviceId,sender:o.deviceId,token:o.token,config:{tts:"RequiredLinks",sttSampleRate:44100,ttsFileType:o.ttsFileType,locale:r,zoneId:y().resolvedOptions().timeZone,voice:t,sendResponseItems:!0,sttInterimResults:!0}})),e()}})));case 9:case"end":return e.stop()}}),e)})))),h()(this,"sendPing",(function(e){window.setTimeout((function(){e.webSocket&&null!==e.sessionId&&(e.webSocket.send(new Int16Array),e.sendPing(e))}),1e4)})),h()(this,"getStt",(function(){return o.stt})),h()(this,"close",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.stt.close();case 2:return o.webSocket&&(o.webSocket.close(),o.webSocket=null),e.abrupt("return",Promise.resolve());case 4:case"end":return e.stop()}}),e)})))),h()(this,"sendText",function(){var e=l()(p.a.mark((function e(t){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={zoneId:y().resolvedOptions().timeZone,locale:o.language,attributes:o.bot.botCallback.getAttributes(),transcript:{text:t}},!o.webSocket){e.next=8;break}if(1!==o.webSocket.readyState){e.next=7;break}return o.webSocket.send(JSON.stringify({type:"Input",input:r})),e.abrupt("return",Promise.resolve());case 7:return e.abrupt("return",Promise.reject("Incorrect websocket state"));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),h()(this,"sendLogs",(function(e){o.webSocket&&o.webSocket.send(JSON.stringify({type:"Log",entries:e}))})),h()(this,"sendAudioOpen",(function(){o.webSocket&&o.sessionId&&o.webSocket.send(JSON.stringify({type:"InputAudioStreamOpen",message:{appKey:o.key,deviceId:o.deviceId,sender:o.deviceId,token:o.token,sessionId:o.sessionId},appKey:o.key}))})),h()(this,"sendAudioClose",(function(){o.webSocket&&o.webSocket.send(JSON.stringify({type:"InputAudioStreamClose",appKey:o.key}))})),h()(this,"replay",function(){var e=l()(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.features.getAudioContext().then((function(e){var r=new e;return r.decodeAudioData(t).then((function(e){var t=r.createBufferSource();t.buffer=e,t.connect(r.destination),t.onended=function(){r.close()},t.start(0)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),h()(this,"setSessionId",(function(e){o.sessionId=e})),this.features=t,this.wsUrl=r,this.key=a,this.callback=n,this.errorCallback=i,this.language=s,this.muted=!1,this.deviceId=u,this.bot=d,this.token=f,this.ttsFileType=g,this.voices={George:"en",Grace:"en",Gordon:"en",Gwyneth:"en",Gabriela:"cs",Anthony:"en",Audrey:"en",Arthur:"en",Amy:"en",Michael:"en",Mary:"en",Milan:"cs",Victor:"en",Victoria:"en"}},_=function e(){var t=this;c()(this,e),h()(this,"getUserMedia",l()(p.a.mark((function e(){var r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.getUserMedia){e.next=2;break}return e.abrupt("return",Promise.resolve(t.state.getUserMedia));case 2:if(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0!==navigator.mediaDevices.getUserMedia){e.next=8;break}if(r=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||!1){e.next=7;break}return e.abrupt("return",Promise.reject(new Error("getUserMedia is not implemented in this browser")));case 7:navigator.mediaDevices.getUserMedia=function(e){return new Promise((function(t,n){r.call(navigator,e,t,n)}))};case 8:return t.state.getUserMedia=navigator.mediaDevices.getUserMedia,e.abrupt("return",Promise.resolve(t.state.getUserMedia));case 10:case"end":return e.stop()}}),e)})))),h()(this,"getAudioContext",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.AudioContext){e.next=2;break}return e.abrupt("return",Promise.resolve(t.state.AudioContext));case 2:if(t.state.AudioContext=window.AudioContext||window.webkitAudioContext||!1,!t.state.AudioContext){e.next=5;break}return e.abrupt("return",Promise.resolve(t.state.AudioContext));case 5:return e.abrupt("return",Promise.reject("AudioContext is not implemented in this browser"));case 6:case"end":return e.stop()}}),e)})))),h()(this,"getSpeechRecognitionOld",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Promise.resolve(!1);case 1:case"end":return e.stop()}}),e)})))),h()(this,"getSpeechRecognition",l()(p.a.mark((function e(){var r,n,i,a,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!!document.documentMode,n=!r&&!!window.StyleMedia,!(window.chrome&&(window.chrome.webstore||window.chrome.runtime)&&-1!==navigator.userAgent.indexOf("Edg")||n)){e.next=6;break}return e.abrupt("return",Promise.reject("Web Speech API.SpeechRecognition does not work in Edge"));case 6:if(i=navigator.userAgent,a=/IEMobile|Windows Phone|Lumia/i.test(i)?"w":/iPhone|iP[oa]d/.test(i)?"i":/Android/.test(i)?"a":/BlackBerry|PlayBook|BB10/.test(i)?"b":/Mobile Safari/.test(i)?"s":/webOS|Mobile|Tablet|Opera Mini|\bCrMo\/|Opera Mobi/i.test(i)?1:0,o=/Android/.test(i)?1:0,t.state.isAndroid=o,t.state.SpeechRecognition=window.SpeechRecognition||window.speechRecognition||window.webkitSpeechRecognition||!1,!t.state.SpeechRecognition){e.next=13;break}return e.abrupt("return",a?Promise.resolve(!1):Promise.resolve(t.state.SpeechRecognition));case 13:return e.abrupt("return",Promise.reject("Web Speech API.SpeechRecognition is not implemented in this browser"));case 14:case"end":return e.stop()}}),e)})))),h()(this,"getSpeechSynthesis",l()(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.state.SpeechSynthesis){e.next=2;break}return e.abrupt("return",Promise.resolve(t.state.SpeechSynthesis));case 2:if(t.state.SpeechSynthesis=window.speechSynthesis||window.webkitSpeechSynthesis||!1,!t.state.SpeechSynthesis){e.next=5;break}return e.abrupt("return",Promise.resolve(t.state.SpeechSynthesis));case 5:return e.abrupt("return",Promise.reject("Web Speech API.SpeechSynthesis is not implemented in this browser"));case 6:case"end":return e.stop()}}),e)})))),h()(this,"detect",function(){var e=l()(p.a.mark((function e(r){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r,e.next="getUserMedia"===e.t0?3:"AudioContext"===e.t0?4:"SpeechRecognition"===e.t0?5:"SpeechSynthesis"===e.t0?6:7;break;case 3:return e.abrupt("return",Promise.resolve(t.getUserMedia()));case 4:return e.abrupt("return",Promise.resolve(t.getAudioContext()));case 5:return e.abrupt("return",Promise.resolve(t.getSpeechRecognition()));case 6:return e.abrupt("return",Promise.resolve(t.getSpeechSynthesis()));case 7:return e.abrupt("return",Promise.resolve(!1));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.state={getUserMedia:void 0,AudioContext:void 0,SpeechRecognition:void 0,SpeechSynthesis:void 0}};t.default=function(e,t,r,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mp3",s=function e(){c()(this,e)},u=null,l=[],d=void 0,h=!0,f=!0,p=!0,g=!1,m="#intro",v=void 0,y="en",w=["error"],E=void 0,S=arguments.length>4&&void 0!==arguments[4]&&!arguments[4]?new s:this;S.botCallback=n,S.sessionEnded=!1;var T=!1,k=0,O=!1,A=!1,x=!1,R=0,C=[],L="",I={listening:new Audio("https://repository.flowstorm.ai/audio/client/listening.mp3"),recognized:new Audio("https://repository.flowstorm.ai/audio/client/recognized.mp3"),waiting:new Audio("https://repository.flowstorm.ai/audio/client/waiting.mp3"),error:new Audio("https://repository.flowstorm.ai/audio/client/error.mp3"),sleep:new Audio("https://repository.flowstorm.ai/audio/client/sleep.mp3")},P=t;function D(){k=0;var t=(d=new Audio("https://repository.flowstorm.ai/audio/client/intro.mp3")).play();void 0!==t&&t.then((function(e){w.includes("intro")||(d.pause(),d.currentTime=0),console.log("Audio OK")})).catch((function(e){console.error(e)}));var r=function(e){I[e].volume=0,I[e].play().then((function(t){I[e].pause(),I[e].currentTime=0}))};for(var n in I)r(n);return R=W(),console.log("Bot init"),j("INFO","Bot init"),(u=new b(new _,e.replace("http","ws")+"/socket/",G,N,v,y,P,S,E,a)).open().then((function(){})).catch((function(e){N({type:"Client",message:"Error opening socket:  ".concat(e)})})),this}function j(e,t){var r=new Date,n=(W()-R)/1e3;C.push({time:r,relativeTime:n,level:e,text:t})}function M(e){j("INFO","Client status changed to "+e),n.setStatus({status:e})}function N(e){V("error"),j("ERROR",e.message),u.sendLogs(C),C=[],n.onError(e),S.onStopClick(),n.onEnd()}function F(e){return null!==e&&e}function U(){d.removeEventListener("ended",U),S.addRecord()}void 0===t&&void 0!==window.localStorage&&(null===localStorage.getItem("sender")?(P=o()(Array(16)).map((function(){return Math.floor(16*Math.random()).toString(16)})).join(""),localStorage.setItem("sender",P)):P=localStorage.getItem("sender")),S.pause=function(){M("PAUSED"),""!==d.src&&h&&d.pause()},S.resume=function(){M("RESPONDING"),""!==d.src&&h?d.play():h||(z(),M("LISTENING"))},S.inAudio=function(e){j("INFO","Input audio "+(f?"on":"off")),"LISTENING"===e&&(f?H(x):S.closeAudioStream("InputAudioEvent",!0))},S.setInAudio=function(e){f=e},S.getInAudio=function(){return f},S.outAudio=function(e){h?("RESPONDING"===e&&Y(),h=!1):h=!0,j("INFO","Output audio "+(h?"on":"off"))},S.getOutAudio=function(){return h},S.click=function(e){"RESPONDING"===(j("INFO","Click on state "+e),e)&&Y()},S.playAudio=function(e){j("INFO","Playing audio file "+e),e&&h&&(d.src=e,d.addEventListener("ended",U),d.play().catch((function(e){N({type:"Client",message:"Audio error in ".concat(d.src,":  ").concat(e)})}))),""!==d.src&&h&&e||S.addRecord()},S.startTyping=function(){x=!0},window.addEventListener("message",(function(e){"BotStopEvent"===e.data&&S.onStopClick()})),S.init=function(e,t,r,n){var i=this;if(h=n,f=r,v=e,y=t,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#intro",p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["error"],g=arguments.length>7&&void 0!==arguments[7]&&arguments[7],E=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0,k<W()||0===k)return D();k=0,u.sendText(m).then((function(e){return R=W(),X(m),i})).catch((function(e){D()}))},S.addRecord=function(){if(F(l)&&l.length>0){var e=l,t=i()(e),r=t[0],a=t.slice(1),o=r.audio,s=r.image,c=r.text,f=r.background,p=r.video,g=r.code,m=r.nodeId;n.focusOnNode&&0!==m&&n.focusOnNode(m),p?n.addVideo(p,(function(){l=a,""!==d.src&&h&&o||S.addRecord()})):(l=a,c.startsWith("#")?(n.handleCommand(c,g),"#walk"!==c&&S.addRecord()):(n.addMessage("received",c,s,f),S.playAudio(o)))}else O?A=!0:(u.sessionId&&0===k?setTimeout((function(){H(!x)}),T?200:0):((S.sessionEnded||0!==k)&&(V("sleep"),n.onEnd()),n.setStatus({isActive:!0,status:"SLEEPING"})),l=void 0)};var B=function(t){var r=t.audio,n=t.image,i=t.text,a=t.ssml,o=t.background,s=t.video,c=t.code,u=t.nodeId;return{audio:F(r)?r.startsWith("/")?"".concat(e).concat(r):r:F(a)&&a.includes("<audio")?a.split('"')[1]:null,image:F(n)?n.startsWith("/")?"".concat(e).concat(n):n:null,video:F(s)?s:null,text:F(i)?i:"",background:F(o)?0===o.length?null:o:null,code:F(c)?0===c.length?"{}":c:"{}",nodeId:F(u)?u:0}};function G(e){var t=e.response,i=void 0===t?[]:t.items;switch(j("INFO","Received event "+e.type),e.type){case"ResponseItem":M("RESPONDING"),K();var a=B(e.responseItem);void 0===l&&(l=[]),l.push(a),O&&!A||(A=!1,O=!0,S.addRecord());break;case"Response":M("RESPONDING"),K(),u.language=t.locale,i.length,t.sleepTimeout>0&&(k=W()+1e3*t.sleepTimeout);var o=i.map(B);l=void 0!==l?l.concat(o):o,n.addLogs(t.logs),t.sessionEnded&&(S.sessionEnded=!0,u.setSessionId(null)),!O||A?(O=!1,A=!1,S.addRecord()):O=!1;break;case"Recognized":var s=(void 0===e.message?[e]:e.message.items)[0];(s.text.length>L.length||s.isFinal)&&(L=s.text,X(s.text)),R=W(),s.isFinal&&(L="",M("PROCESSING"),S.closeAudioStream("recognized",!1));break;case"Ready":u.setSessionId(n.getUUID()),S.sessionEnded=!1,T=!1,r?(X(m),u.sendText(m),R=W()):n.play("bot_ready");break;case"InputAudioStreamOpen":M("LISTENING");break;case"SessionStarted":var c=e.sessionId;L="",u.setSessionId(c),M("RESPONDING");break;case"Error":if(n.onError({type:"Server:",message:e.text}),V("error"),null===c)break;case"SessionEnded":u.sendLogs(C),C=[],R=0,S.sessionEnded=!0,S.closeAudioStream("sessionEnd",!1),u.setSessionId(null),h||(n.onEnd(),K(),V("sleep"),M("SLEEPING"))}}function H(e){u.sendLogs(C),C=[],f&&e&&!T&&k<W()?(V("listening"),u.getStt().start().then((function(){T=!0,S.setInputAudio(!0)})).catch((function(e){g?M("LISTENING"):N({type:"Client",message:"Speech to text start error: ".concat(e)})}))):M("LISTENING")}function z(){""!==d.src&&(d.pause(),d.src="",F(l)&&l.length>0&&(l.forEach((function(e){console.log(e),"#"!==e.text.charAt(0)&&n.addMessage("received",e.text,e.image,e.background)})),l=void 0))}function K(){I.waiting.removeEventListener("ended",q),I.waiting.pause(),I.waiting.currentTime=0}function q(){V("waiting")}function V(e){w.includes(e)&&(I[e].volume=1,I[e].currentTime=0,I[e].play())}function W(){return(new Date).getTime()}function Y(){z(),k>0?(n.onEnd(),M("SLEEPING")):S.sessionEnded?(S.onStopClick(),n.onEnd()):(H(!0),M("LISTENING"))}function X(e){var t="#"===e.charAt(0)&&p?null:e,r=e;n.addMessage("sent",t,null,null,r)}return S.closeAudioStream=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];"sessionEnd"!==e&&V("recognized"),T&&u.getStt().stop(t).then((function(){T=!1})).catch((function(){N({type:"Client",message:"Speech to text stop error in ".concat(e)})}))},S.handleOnTextInput=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};z(),x=!1,k=0,r.sopInput||r.buttonInput||X(e),M("PROCESSING"),u.sendText(e),R=W(),t&&f&&S.closeAudioStream("handleTextInput",!1)},S.onStopClick=function(){S.sessionEnded=!0,K(),d&&z(),u&&(u.setSessionId(null),u.close()),k=0,M("SLEEPING")},S}}])},function(e,t,r){var n;(function(){function i(e){"use strict";var t={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:"Remove only spaces, ' and \" from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids",type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,description:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,description:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,description:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,description:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,description:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",description:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,description:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,description:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,description:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,description:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,description:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},completeHTMLDocument:{defaultValue:!1,description:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,description:"Enable support for document metadata (defined at the top of the document between `` and `` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,description:"Split adjacent blockquote blocks",type:"boolean"}};if(!1===e)return JSON.parse(JSON.stringify(t));var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n].defaultValue);return r}var a={},o={},s={},c=i(!0),u="vanilla",l={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:i(!0),allOn:function(){"use strict";var e=i(!0),t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=!0);return t}()};function d(e,t){"use strict";var r=t?"Error in "+t+" extension->":"Error in unnamed extension",n={valid:!0,error:""};a.helper.isArray(e)||(e=[e]);for(var i=0;i<e.length;++i){var o=r+" sub-extension "+i+": ",s=e[i];if("object"!=typeof s)return n.valid=!1,n.error=o+"must be an object, but "+typeof s+" given",n;if(!a.helper.isString(s.type))return n.valid=!1,n.error=o+'property "type" must be a string, but '+typeof s.type+" given",n;var c=s.type=s.type.toLowerCase();if("language"===c&&(c=s.type="lang"),"html"===c&&(c=s.type="output"),"lang"!==c&&"output"!==c&&"listener"!==c)return n.valid=!1,n.error=o+"type "+c+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',n;if("listener"===c){if(a.helper.isUndefined(s.listeners))return n.valid=!1,n.error=o+'. Extensions of type "listener" must have a property called "listeners"',n}else if(a.helper.isUndefined(s.filter)&&a.helper.isUndefined(s.regex))return n.valid=!1,n.error=o+c+' extensions must define either a "regex" property or a "filter" method',n;if(s.listeners){if("object"!=typeof s.listeners)return n.valid=!1,n.error=o+'"listeners" property must be an object but '+typeof s.listeners+" given",n;for(var u in s.listeners)if(s.listeners.hasOwnProperty(u)&&"function"!=typeof s.listeners[u])return n.valid=!1,n.error=o+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+u+" must be a function but "+typeof s.listeners[u]+" given",n}if(s.filter){if("function"!=typeof s.filter)return n.valid=!1,n.error=o+'"filter" must be a function, but '+typeof s.filter+" given",n}else if(s.regex){if(a.helper.isString(s.regex)&&(s.regex=new RegExp(s.regex,"g")),!(s.regex instanceof RegExp))return n.valid=!1,n.error=o+'"regex" property must either be a string or a RegExp object, but '+typeof s.regex+" given",n;if(a.helper.isUndefined(s.replace))return n.valid=!1,n.error=o+'"regex" extensions must implement a replace string or function',n}}return n}function h(e,t){"use strict";return"E"+t.charCodeAt(0)+"E"}a.helper={},a.extensions={},a.setOption=function(e,t){"use strict";return c[e]=t,this},a.getOption=function(e){"use strict";return c[e]},a.getOptions=function(){"use strict";return c},a.resetOptions=function(){"use strict";c=i(!0)},a.setFlavor=function(e){"use strict";if(!l.hasOwnProperty(e))throw Error(e+" flavor was not found");a.resetOptions();var t=l[e];for(var r in u=e,t)t.hasOwnProperty(r)&&(c[r]=t[r])},a.getFlavor=function(){"use strict";return u},a.getFlavorOptions=function(e){"use strict";if(l.hasOwnProperty(e))return l[e]},a.getDefaultOptions=function(e){"use strict";return i(e)},a.subParser=function(e,t){"use strict";if(a.helper.isString(e)){if(void 0===t){if(o.hasOwnProperty(e))return o[e];throw Error("SubParser named "+e+" not registered!")}o[e]=t}},a.extension=function(e,t){"use strict";if(!a.helper.isString(e))throw Error("Extension 'name' must be a string");if(e=a.helper.stdExtName(e),a.helper.isUndefined(t)){if(!s.hasOwnProperty(e))throw Error("Extension named "+e+" is not registered!");return s[e]}"function"==typeof t&&(t=t()),a.helper.isArray(t)||(t=[t]);var r=d(t,e);if(!r.valid)throw Error(r.error);s[e]=t},a.getAllExtensions=function(){"use strict";return s},a.removeExtension=function(e){"use strict";delete s[e]},a.resetExtensions=function(){"use strict";s={}},a.validateExtension=function(e){"use strict";var t=d(e,null);return!!t.valid||(console.warn(t.error),!1)},a.hasOwnProperty("helper")||(a.helper={}),a.helper.isString=function(e){"use strict";return"string"==typeof e||e instanceof String},a.helper.isFunction=function(e){"use strict";return e&&"[object Function]"==={}.toString.call(e)},a.helper.isArray=function(e){"use strict";return Array.isArray(e)},a.helper.isUndefined=function(e){"use strict";return void 0===e},a.helper.forEach=function(e,t){"use strict";if(a.helper.isUndefined(e))throw new Error("obj param is required");if(a.helper.isUndefined(t))throw new Error("callback param is required");if(!a.helper.isFunction(t))throw new Error("callback param must be a function/closure");if("function"==typeof e.forEach)e.forEach(t);else if(a.helper.isArray(e))for(var r=0;r<e.length;r++)t(e[r],r,e);else{if("object"!=typeof e)throw new Error("obj does not seem to be an array or an iterable object");for(var n in e)e.hasOwnProperty(n)&&t(e[n],n,e)}},a.helper.stdExtName=function(e){"use strict";return e.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()},a.helper.escapeCharactersCallback=h,a.helper.escapeCharacters=function(e,t,r){"use strict";var n="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";r&&(n="\\\\"+n);var i=new RegExp(n,"g");return e=e.replace(i,h)},a.helper.unescapeHTMLEntities=function(e){"use strict";return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var f=function(e,t,r,n){"use strict";var i,a,o,s,c,u=n||"",l=u.indexOf("g")>-1,d=new RegExp(t+"|"+r,"g"+u.replace(/g/g,"")),h=new RegExp(t,u.replace(/g/g,"")),f=[];do{for(i=0;o=d.exec(e);)if(h.test(o[0]))i++||(s=(a=d.lastIndex)-o[0].length);else if(i&&!--i){c=o.index+o[0].length;var p={left:{start:s,end:a},match:{start:a,end:o.index},right:{start:o.index,end:c},wholeMatch:{start:s,end:c}};if(f.push(p),!l)return f}}while(i&&(d.lastIndex=a));return f};a.helper.matchRecursiveRegExp=function(e,t,r,n){"use strict";for(var i=f(e,t,r,n),a=[],o=0;o<i.length;++o)a.push([e.slice(i[o].wholeMatch.start,i[o].wholeMatch.end),e.slice(i[o].match.start,i[o].match.end),e.slice(i[o].left.start,i[o].left.end),e.slice(i[o].right.start,i[o].right.end)]);return a},a.helper.replaceRecursiveRegExp=function(e,t,r,n,i){"use strict";if(!a.helper.isFunction(t)){var o=t;t=function(){return o}}var s=f(e,r,n,i),c=e,u=s.length;if(u>0){var l=[];0!==s[0].wholeMatch.start&&l.push(e.slice(0,s[0].wholeMatch.start));for(var d=0;d<u;++d)l.push(t(e.slice(s[d].wholeMatch.start,s[d].wholeMatch.end),e.slice(s[d].match.start,s[d].match.end),e.slice(s[d].left.start,s[d].left.end),e.slice(s[d].right.start,s[d].right.end))),d<u-1&&l.push(e.slice(s[d].wholeMatch.end,s[d+1].wholeMatch.start));s[u-1].wholeMatch.end<e.length&&l.push(e.slice(s[u-1].wholeMatch.end)),c=l.join("")}return c},a.helper.regexIndexOf=function(e,t,r){"use strict";if(!a.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(t instanceof RegExp==!1)throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var n=e.substring(r||0).search(t);return n>=0?n+(r||0):n},a.helper.splitAtIndex=function(e,t){"use strict";if(!a.helper.isString(e))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[e.substring(0,t),e.substring(t)]},a.helper.encodeEmailAddress=function(e){"use strict";var t=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+e.charCodeAt(0).toString(16)+";"},function(e){return e}];return e=e.replace(/./g,(function(e){if("@"===e)e=t[Math.floor(2*Math.random())](e);else{var r=Math.random();e=r>.9?t[2](e):r>.45?t[1](e):t[0](e)}return e}))},a.helper.padEnd=function(e,t,r){"use strict";return t>>=0,r=String(r||" "),e.length>t?String(e):((t-=e.length)>r.length&&(r+=r.repeat(t/r.length)),String(e)+r.slice(0,t))},"undefined"==typeof console&&(console={warn:function(e){"use strict";alert(e)},log:function(e){"use strict";alert(e)},error:function(e){"use strict";throw e}}),a.helper.regexes={asteriskDashAndColon:/([*_:~])/g},a.helper.emojis={"+1":"","-1":"",100:"",1234:"","1st_place_medal":"","2nd_place_medal":"","3rd_place_medal":"","8ball":"",a:"",ab:"",abc:"",abcd:"",accept:"",aerial_tramway:"",airplane:"",alarm_clock:"",alembic:"",alien:"",ambulance:"",amphora:"",anchor:"",angel:"",anger:"",angry:"",anguished:"",ant:"",apple:"",aquarius:"",aries:"",arrow_backward:"",arrow_double_down:"",arrow_double_up:"",arrow_down:"",arrow_down_small:"",arrow_forward:"",arrow_heading_down:"",arrow_heading_up:"",arrow_left:"",arrow_lower_left:"",arrow_lower_right:"",arrow_right:"",arrow_right_hook:"",arrow_up:"",arrow_up_down:"",arrow_up_small:"",arrow_upper_left:"",arrow_upper_right:"",arrows_clockwise:"",arrows_counterclockwise:"",art:"",articulated_lorry:"",artificial_satellite:"",astonished:"",athletic_shoe:"",atm:"",atom_symbol:"",avocado:"",b:"",baby:"",baby_bottle:"",baby_chick:"",baby_symbol:"",back:"",bacon:"",badminton:"",baggage_claim:"",baguette_bread:"",balance_scale:"",balloon:"",ballot_box:"",ballot_box_with_check:"",bamboo:"",banana:"",bangbang:"",bank:"",bar_chart:"",barber:"",baseball:"",basketball:"",basketball_man:"",basketball_woman:"&zwj;",bat:"",bath:"",bathtub:"",battery:"",beach_umbrella:"",bear:"",bed:"",bee:"",beer:"",beers:"",beetle:"",beginner:"",bell:"",bellhop_bell:"",bento:"",biking_man:"",bike:"",biking_woman:"&zwj;",bikini:"",biohazard:"",bird:"",birthday:"",black_circle:"",black_flag:"",black_heart:"",black_joker:"",black_large_square:"",black_medium_small_square:"",black_medium_square:"",black_nib:"",black_small_square:"",black_square_button:"",blonde_man:"",blonde_woman:"&zwj;",blossom:"",blowfish:"",blue_book:"",blue_car:"",blue_heart:"",blush:"",boar:"",boat:"",bomb:"",book:"",bookmark:"",bookmark_tabs:"",books:"",boom:"",boot:"",bouquet:"",bowing_man:"",bow_and_arrow:"",bowing_woman:"&zwj;",bowling:"",boxing_glove:"",boy:"",bread:"",bride_with_veil:"",bridge_at_night:"",briefcase:"",broken_heart:"",bug:"",building_construction:"",bulb:"",bullettrain_front:"",bullettrain_side:"",burrito:"",bus:"",business_suit_levitating:"",busstop:"",bust_in_silhouette:"",busts_in_silhouette:"",butterfly:"",cactus:"",cake:"",calendar:"",call_me_hand:"",calling:"",camel:"",camera:"",camera_flash:"",camping:"",cancer:"",candle:"",candy:"",canoe:"",capital_abcd:"",capricorn:"",car:"",card_file_box:"",card_index:"",card_index_dividers:"",carousel_horse:"",carrot:"",cat:"",cat2:"",cd:"",chains:"",champagne:"",chart:"",chart_with_downwards_trend:"",chart_with_upwards_trend:"",checkered_flag:"",cheese:"",cherries:"",cherry_blossom:"",chestnut:"",chicken:"",children_crossing:"",chipmunk:"",chocolate_bar:"",christmas_tree:"",church:"",cinema:"",circus_tent:"",city_sunrise:"",city_sunset:"",cityscape:"",cl:"",clamp:"",clap:"",clapper:"",classical_building:"",clinking_glasses:"",clipboard:"",clock1:"",clock10:"",clock1030:"",clock11:"",clock1130:"",clock12:"",clock1230:"",clock130:"",clock2:"",clock230:"",clock3:"",clock330:"",clock4:"",clock430:"",clock5:"",clock530:"",clock6:"",clock630:"",clock7:"",clock730:"",clock8:"",clock830:"",clock9:"",clock930:"",closed_book:"",closed_lock_with_key:"",closed_umbrella:"",cloud:"",cloud_with_lightning:"",cloud_with_lightning_and_rain:"",cloud_with_rain:"",cloud_with_snow:"",clown_face:"",clubs:"",cocktail:"",coffee:"",coffin:"",cold_sweat:"",comet:"",computer:"",computer_mouse:"",confetti_ball:"",confounded:"",confused:"",congratulations:"",construction:"",construction_worker_man:"",construction_worker_woman:"&zwj;",control_knobs:"",convenience_store:"",cookie:"",cool:"",policeman:"",copyright:"",corn:"",couch_and_lamp:"",couple:"",couple_with_heart_woman_man:"",couple_with_heart_man_man:"&zwj;&zwj;",couple_with_heart_woman_woman:"&zwj;&zwj;",couplekiss_man_man:"&zwj;&zwj;&zwj;",couplekiss_man_woman:"",couplekiss_woman_woman:"&zwj;&zwj;&zwj;",cow:"",cow2:"",cowboy_hat_face:"",crab:"",crayon:"",credit_card:"",crescent_moon:"",cricket:"",crocodile:"",croissant:"",crossed_fingers:"",crossed_flags:"",crossed_swords:"",crown:"",cry:"",crying_cat_face:"",crystal_ball:"",cucumber:"",cupid:"",curly_loop:"",currency_exchange:"",curry:"",custard:"",customs:"",cyclone:"",dagger:"",dancer:"",dancing_women:"",dancing_men:"&zwj;",dango:"",dark_sunglasses:"",dart:"",dash:"",date:"",deciduous_tree:"",deer:"",department_store:"",derelict_house:"",desert:"",desert_island:"",desktop_computer:"",male_detective:"",diamond_shape_with_a_dot_inside:"",diamonds:"",disappointed:"",disappointed_relieved:"",dizzy:"",dizzy_face:"",do_not_litter:"",dog:"",dog2:"",dollar:"",dolls:"",dolphin:"",door:"",doughnut:"",dove:"",dragon:"",dragon_face:"",dress:"",dromedary_camel:"",drooling_face:"",droplet:"",drum:"",duck:"",dvd:"","e-mail":"",eagle:"",ear:"",ear_of_rice:"",earth_africa:"",earth_americas:"",earth_asia:"",egg:"",eggplant:"",eight_pointed_black_star:"",eight_spoked_asterisk:"",electric_plug:"",elephant:"",email:"",end:"",envelope_with_arrow:"",euro:"",european_castle:"",european_post_office:"",evergreen_tree:"",exclamation:"",expressionless:"",eye:"",eye_speech_bubble:"&zwj;",eyeglasses:"",eyes:"",face_with_head_bandage:"",face_with_thermometer:"",fist_oncoming:"",factory:"",fallen_leaf:"",family_man_woman_boy:"",family_man_boy:"&zwj;",family_man_boy_boy:"&zwj;&zwj;",family_man_girl:"&zwj;",family_man_girl_boy:"&zwj;&zwj;",family_man_girl_girl:"&zwj;&zwj;",family_man_man_boy:"&zwj;&zwj;",family_man_man_boy_boy:"&zwj;&zwj;&zwj;",family_man_man_girl:"&zwj;&zwj;",family_man_man_girl_boy:"&zwj;&zwj;&zwj;",family_man_man_girl_girl:"&zwj;&zwj;&zwj;",family_man_woman_boy_boy:"&zwj;&zwj;&zwj;",family_man_woman_girl:"&zwj;&zwj;",family_man_woman_girl_boy:"&zwj;&zwj;&zwj;",family_man_woman_girl_girl:"&zwj;&zwj;&zwj;",family_woman_boy:"&zwj;",family_woman_boy_boy:"&zwj;&zwj;",family_woman_girl:"&zwj;",family_woman_girl_boy:"&zwj;&zwj;",family_woman_girl_girl:"&zwj;&zwj;",family_woman_woman_boy:"&zwj;&zwj;",family_woman_woman_boy_boy:"&zwj;&zwj;&zwj;",family_woman_woman_girl:"&zwj;&zwj;",family_woman_woman_girl_boy:"&zwj;&zwj;&zwj;",family_woman_woman_girl_girl:"&zwj;&zwj;&zwj;",fast_forward:"",fax:"",fearful:"",feet:"",female_detective:"&zwj;",ferris_wheel:"",ferry:"",field_hockey:"",file_cabinet:"",file_folder:"",film_projector:"",film_strip:"",fire:"",fire_engine:"",fireworks:"",first_quarter_moon:"",first_quarter_moon_with_face:"",fish:"",fish_cake:"",fishing_pole_and_fish:"",fist_raised:"",fist_left:"",fist_right:"",flags:"",flashlight:"",fleur_de_lis:"",flight_arrival:"",flight_departure:"",floppy_disk:"",flower_playing_cards:"",flushed:"",fog:"",foggy:"",football:"",footprints:"",fork_and_knife:"",fountain:"",fountain_pen:"",four_leaf_clover:"",fox_face:"",framed_picture:"",free:"",fried_egg:"",fried_shrimp:"",fries:"",frog:"",frowning:"",frowning_face:"",frowning_man:"&zwj;",frowning_woman:"",middle_finger:"",fuelpump:"",full_moon:"",full_moon_with_face:"",funeral_urn:"",game_die:"",gear:"",gem:"",gemini:"",ghost:"",gift:"",gift_heart:"",girl:"",globe_with_meridians:"",goal_net:"",goat:"",golf:"",golfing_man:"",golfing_woman:"&zwj;",gorilla:"",grapes:"",green_apple:"",green_book:"",green_heart:"",green_salad:"",grey_exclamation:"",grey_question:"",grimacing:"",grin:"",grinning:"",guardsman:"",guardswoman:"&zwj;",guitar:"",gun:"",haircut_woman:"",haircut_man:"&zwj;",hamburger:"",hammer:"",hammer_and_pick:"",hammer_and_wrench:"",hamster:"",hand:"",handbag:"",handshake:"",hankey:"",hatched_chick:"",hatching_chick:"",headphones:"",hear_no_evil:"",heart:"",heart_decoration:"",heart_eyes:"",heart_eyes_cat:"",heartbeat:"",heartpulse:"",hearts:"",heavy_check_mark:"",heavy_division_sign:"",heavy_dollar_sign:"",heavy_heart_exclamation:"",heavy_minus_sign:"",heavy_multiplication_x:"",heavy_plus_sign:"",helicopter:"",herb:"",hibiscus:"",high_brightness:"",high_heel:"",hocho:"",hole:"",honey_pot:"",horse:"",horse_racing:"",hospital:"",hot_pepper:"",hotdog:"",hotel:"",hotsprings:"",hourglass:"",hourglass_flowing_sand:"",house:"",house_with_garden:"",houses:"",hugs:"",hushed:"",ice_cream:"",ice_hockey:"",ice_skate:"",icecream:"",id:"",ideograph_advantage:"",imp:"",inbox_tray:"",incoming_envelope:"",tipping_hand_woman:"",information_source:"",innocent:"",interrobang:"",iphone:"",izakaya_lantern:"",jack_o_lantern:"",japan:"",japanese_castle:"",japanese_goblin:"",japanese_ogre:"",jeans:"",joy:"",joy_cat:"",joystick:"",kaaba:"",key:"",keyboard:"",keycap_ten:"",kick_scooter:"",kimono:"",kiss:"",kissing:"",kissing_cat:"",kissing_closed_eyes:"",kissing_heart:"",kissing_smiling_eyes:"",kiwi_fruit:"",koala:"",koko:"",label:"",large_blue_circle:"",large_blue_diamond:"",large_orange_diamond:"",last_quarter_moon:"",last_quarter_moon_with_face:"",latin_cross:"",laughing:"",leaves:"",ledger:"",left_luggage:"",left_right_arrow:"",leftwards_arrow_with_hook:"",lemon:"",leo:"",leopard:"",level_slider:"",libra:"",light_rail:"",link:"",lion:"",lips:"",lipstick:"",lizard:"",lock:"",lock_with_ink_pen:"",lollipop:"",loop:"",loud_sound:"",loudspeaker:"",love_hotel:"",love_letter:"",low_brightness:"",lying_face:"",m:"",mag:"",mag_right:"",mahjong:"",mailbox:"",mailbox_closed:"",mailbox_with_mail:"",mailbox_with_no_mail:"",man:"",man_artist:"&zwj;",man_astronaut:"&zwj;",man_cartwheeling:"&zwj;",man_cook:"&zwj;",man_dancing:"",man_facepalming:"&zwj;",man_factory_worker:"&zwj;",man_farmer:"&zwj;",man_firefighter:"&zwj;",man_health_worker:"&zwj;",man_in_tuxedo:"",man_judge:"&zwj;",man_juggling:"&zwj;",man_mechanic:"&zwj;",man_office_worker:"&zwj;",man_pilot:"&zwj;",man_playing_handball:"&zwj;",man_playing_water_polo:"&zwj;",man_scientist:"&zwj;",man_shrugging:"&zwj;",man_singer:"&zwj;",man_student:"&zwj;",man_teacher:"&zwj;",man_technologist:"&zwj;",man_with_gua_pi_mao:"",man_with_turban:"",tangerine:"",mans_shoe:"",mantelpiece_clock:"",maple_leaf:"",martial_arts_uniform:"",mask:"",massage_woman:"",massage_man:"&zwj;",meat_on_bone:"",medal_military:"",medal_sports:"",mega:"",melon:"",memo:"",men_wrestling:"&zwj;",menorah:"",mens:"",metal:"",metro:"",microphone:"",microscope:"",milk_glass:"",milky_way:"",minibus:"",minidisc:"",mobile_phone_off:"",money_mouth_face:"",money_with_wings:"",moneybag:"",monkey:"",monkey_face:"",monorail:"",moon:"",mortar_board:"",mosque:"",motor_boat:"",motor_scooter:"",motorcycle:"",motorway:"",mount_fuji:"",mountain:"",mountain_biking_man:"",mountain_biking_woman:"&zwj;",mountain_cableway:"",mountain_railway:"",mountain_snow:"",mouse:"",mouse2:"",movie_camera:"",moyai:"",mrs_claus:"",muscle:"",mushroom:"",musical_keyboard:"",musical_note:"",musical_score:"",mute:"",nail_care:"",name_badge:"",national_park:"",nauseated_face:"",necktie:"",negative_squared_cross_mark:"",nerd_face:"",neutral_face:"",new:"",new_moon:"",new_moon_with_face:"",newspaper:"",newspaper_roll:"",next_track_button:"",ng:"",no_good_man:"&zwj;",no_good_woman:"",night_with_stars:"",no_bell:"",no_bicycles:"",no_entry:"",no_entry_sign:"",no_mobile_phones:"",no_mouth:"",no_pedestrians:"",no_smoking:"","non-potable_water":"",nose:"",notebook:"",notebook_with_decorative_cover:"",notes:"",nut_and_bolt:"",o:"",o2:"",ocean:"",octopus:"",oden:"",office:"",oil_drum:"",ok:"",ok_hand:"",ok_man:"&zwj;",ok_woman:"",old_key:"",older_man:"",older_woman:"",om:"",on:"",oncoming_automobile:"",oncoming_bus:"",oncoming_police_car:"",oncoming_taxi:"",open_file_folder:"",open_hands:"",open_mouth:"",open_umbrella:"",ophiuchus:"",orange_book:"",orthodox_cross:"",outbox_tray:"",owl:"",ox:"",package:"",page_facing_up:"",page_with_curl:"",pager:"",paintbrush:"",palm_tree:"",pancakes:"",panda_face:"",paperclip:"",paperclips:"",parasol_on_ground:"",parking:"",part_alternation_mark:"",partly_sunny:"",passenger_ship:"",passport_control:"",pause_button:"",peace_symbol:"",peach:"",peanuts:"",pear:"",pen:"",pencil2:"",penguin:"",pensive:"",performing_arts:"",persevere:"",person_fencing:"",pouting_woman:"",phone:"",pick:"",pig:"",pig2:"",pig_nose:"",pill:"",pineapple:"",ping_pong:"",pisces:"",pizza:"",place_of_worship:"",plate_with_cutlery:"",play_or_pause_button:"",point_down:"",point_left:"",point_right:"",point_up:"",point_up_2:"",police_car:"",policewoman:"&zwj;",poodle:"",popcorn:"",post_office:"",postal_horn:"",postbox:"",potable_water:"",potato:"",pouch:"",poultry_leg:"",pound:"",rage:"",pouting_cat:"",pouting_man:"&zwj;",pray:"",prayer_beads:"",pregnant_woman:"",previous_track_button:"",prince:"",princess:"",printer:"",purple_heart:"",purse:"",pushpin:"",put_litter_in_its_place:"",question:"",rabbit:"",rabbit2:"",racehorse:"",racing_car:"",radio:"",radio_button:"",radioactive:"",railway_car:"",railway_track:"",rainbow:"",rainbow_flag:"&zwj;",raised_back_of_hand:"",raised_hand_with_fingers_splayed:"",raised_hands:"",raising_hand_woman:"",raising_hand_man:"&zwj;",ram:"",ramen:"",rat:"",record_button:"",recycle:"",red_circle:"",registered:"",relaxed:"",relieved:"",reminder_ribbon:"",repeat:"",repeat_one:"",rescue_worker_helmet:"",restroom:"",revolving_hearts:"",rewind:"",rhinoceros:"",ribbon:"",rice:"",rice_ball:"",rice_cracker:"",rice_scene:"",right_anger_bubble:"",ring:"",robot:"",rocket:"",rofl:"",roll_eyes:"",roller_coaster:"",rooster:"",rose:"",rosette:"",rotating_light:"",round_pushpin:"",rowing_man:"",rowing_woman:"&zwj;",rugby_football:"",running_man:"",running_shirt_with_sash:"",running_woman:"&zwj;",sa:"",sagittarius:"",sake:"",sandal:"",santa:"",satellite:"",saxophone:"",school:"",school_satchel:"",scissors:"",scorpion:"",scorpius:"",scream:"",scream_cat:"",scroll:"",seat:"",secret:"",see_no_evil:"",seedling:"",selfie:"",shallow_pan_of_food:"",shamrock:"",shark:"",shaved_ice:"",sheep:"",shell:"",shield:"",shinto_shrine:"",ship:"",shirt:"",shopping:"",shopping_cart:"",shower:"",shrimp:"",signal_strength:"",six_pointed_star:"",ski:"",skier:"",skull:"",skull_and_crossbones:"",sleeping:"",sleeping_bed:"",sleepy:"",slightly_frowning_face:"",slightly_smiling_face:"",slot_machine:"",small_airplane:"",small_blue_diamond:"",small_orange_diamond:"",small_red_triangle:"",small_red_triangle_down:"",smile:"",smile_cat:"",smiley:"",smiley_cat:"",smiling_imp:"",smirk:"",smirk_cat:"",smoking:"",snail:"",snake:"",sneezing_face:"",snowboarder:"",snowflake:"",snowman:"",snowman_with_snow:"",sob:"",soccer:"",soon:"",sos:"",sound:"",space_invader:"",spades:"",spaghetti:"",sparkle:"",sparkler:"",sparkles:"",sparkling_heart:"",speak_no_evil:"",speaker:"",speaking_head:"",speech_balloon:"",speedboat:"",spider:"",spider_web:"",spiral_calendar:"",spiral_notepad:"",spoon:"",squid:"",stadium:"",star:"",star2:"",star_and_crescent:"",star_of_david:"",stars:"",station:"",statue_of_liberty:"",steam_locomotive:"",stew:"",stop_button:"",stop_sign:"",stopwatch:"",straight_ruler:"",strawberry:"",stuck_out_tongue:"",stuck_out_tongue_closed_eyes:"",stuck_out_tongue_winking_eye:"",studio_microphone:"",stuffed_flatbread:"",sun_behind_large_cloud:"",sun_behind_rain_cloud:"",sun_behind_small_cloud:"",sun_with_face:"",sunflower:"",sunglasses:"",sunny:"",sunrise:"",sunrise_over_mountains:"",surfing_man:"",surfing_woman:"&zwj;",sushi:"",suspension_railway:"",sweat:"",sweat_drops:"",sweat_smile:"",sweet_potato:"",swimming_man:"",swimming_woman:"&zwj;",symbols:"",synagogue:"",syringe:"",taco:"",tada:"",tanabata_tree:"",taurus:"",taxi:"",tea:"",telephone_receiver:"",telescope:"",tennis:"",tent:"",thermometer:"",thinking:"",thought_balloon:"",ticket:"",tickets:"",tiger:"",tiger2:"",timer_clock:"",tipping_hand_man:"&zwj;",tired_face:"",tm:"",toilet:"",tokyo_tower:"",tomato:"",tongue:"",top:"",tophat:"",tornado:"",trackball:"",tractor:"",traffic_light:"",train:"",train2:"",tram:"",triangular_flag_on_post:"",triangular_ruler:"",trident:"",triumph:"",trolleybus:"",trophy:"",tropical_drink:"",tropical_fish:"",truck:"",trumpet:"",tulip:"",tumbler_glass:"",turkey:"",turtle:"",tv:"",twisted_rightwards_arrows:"",two_hearts:"",two_men_holding_hands:"",two_women_holding_hands:"",u5272:"",u5408:"",u55b6:"",u6307:"",u6708:"",u6709:"",u6e80:"",u7121:"",u7533:"",u7981:"",u7a7a:"",umbrella:"",unamused:"",underage:"",unicorn:"",unlock:"",up:"",upside_down_face:"",v:"",vertical_traffic_light:"",vhs:"",vibration_mode:"",video_camera:"",video_game:"",violin:"",virgo:"",volcano:"",volleyball:"",vs:"",vulcan_salute:"",walking_man:"",walking_woman:"&zwj;",waning_crescent_moon:"",waning_gibbous_moon:"",warning:"",wastebasket:"",watch:"",water_buffalo:"",watermelon:"",wave:"",wavy_dash:"",waxing_crescent_moon:"",wc:"",weary:"",wedding:"",weight_lifting_man:"",weight_lifting_woman:"&zwj;",whale:"",whale2:"",wheel_of_dharma:"",wheelchair:"",white_check_mark:"",white_circle:"",white_flag:"",white_flower:"",white_large_square:"",white_medium_small_square:"",white_medium_square:"",white_small_square:"",white_square_button:"",wilted_flower:"",wind_chime:"",wind_face:"",wine_glass:"",wink:"",wolf:"",woman:"",woman_artist:"&zwj;",woman_astronaut:"&zwj;",woman_cartwheeling:"&zwj;",woman_cook:"&zwj;",woman_facepalming:"&zwj;",woman_factory_worker:"&zwj;",woman_farmer:"&zwj;",woman_firefighter:"&zwj;",woman_health_worker:"&zwj;",woman_judge:"&zwj;",woman_juggling:"&zwj;",woman_mechanic:"&zwj;",woman_office_worker:"&zwj;",woman_pilot:"&zwj;",woman_playing_handball:"&zwj;",woman_playing_water_polo:"&zwj;",woman_scientist:"&zwj;",woman_shrugging:"&zwj;",woman_singer:"&zwj;",woman_student:"&zwj;",woman_teacher:"&zwj;",woman_technologist:"&zwj;",woman_with_turban:"&zwj;",womans_clothes:"",womans_hat:"",women_wrestling:"&zwj;",womens:"",world_map:"",worried:"",wrench:"",writing_hand:"",x:"",yellow_heart:"",yen:"",yin_yang:"",yum:"",zap:"",zipper_mouth_face:"",zzz:"",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:"<span style=\"font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;\">S</span>"},a.Converter=function(e){"use strict";var t={},r=[],n=[],i={},o=u,h={parsed:{},raw:"",format:""};function f(e,t){if(t=t||null,a.helper.isString(e)){if(t=e=a.helper.stdExtName(e),a.extensions[e])return console.warn("DEPRECATION WARNING: "+e+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),void function(e,t){"function"==typeof e&&(e=e(new a.Converter));a.helper.isArray(e)||(e=[e]);var i=d(e,t);if(!i.valid)throw Error(i.error);for(var o=0;o<e.length;++o)switch(e[o].type){case"lang":r.push(e[o]);break;case"output":n.push(e[o]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}(a.extensions[e],e);if(a.helper.isUndefined(s[e]))throw Error('Extension "'+e+'" could not be loaded. It was either not found or is not a valid extension.');e=s[e]}"function"==typeof e&&(e=e()),a.helper.isArray(e)||(e=[e]);var i=d(e,t);if(!i.valid)throw Error(i.error);for(var o=0;o<e.length;++o){switch(e[o].type){case"lang":r.push(e[o]);break;case"output":n.push(e[o])}if(e[o].hasOwnProperty("listeners"))for(var c in e[o].listeners)e[o].listeners.hasOwnProperty(c)&&p(c,e[o].listeners[c])}}function p(e,t){if(!a.helper.isString(e))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof e+" given");if("function"!=typeof t)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof t+" given");i.hasOwnProperty(e)||(i[e]=[]),i[e].push(t)}!function(){for(var r in e=e||{},c)c.hasOwnProperty(r)&&(t[r]=c[r]);if("object"!=typeof e)throw Error("Converter expects the passed parameter to be an object, but "+typeof e+" was passed instead.");for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.extensions&&a.helper.forEach(t.extensions,f)}(),this._dispatch=function(e,t,r,n){if(i.hasOwnProperty(e))for(var a=0;a<i[e].length;++a){var o=i[e][a](e,t,this,r,n);o&&void 0!==o&&(t=o)}return t},this.listen=function(e,t){return p(e,t),this},this.makeHtml=function(e){if(!e)return e;var i={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:r,outputModifiers:n,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return e=(e=(e=(e=(e=e.replace(//g,"T")).replace(/\$/g,"D")).replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/\u00A0/g,"&nbsp;"),t.smartIndentationFix&&(e=function(e){var t=e.match(/^\s*/)[0].length,r=new RegExp("^\\s{0,"+t+"}","gm");return e.replace(r,"")}(e)),e="\n\n"+e+"\n\n",e=(e=a.subParser("detab")(e,t,i)).replace(/^[ \t]+$/gm,""),a.helper.forEach(r,(function(r){e=a.subParser("runExtension")(r,e,t,i)})),e=a.subParser("metadata")(e,t,i),e=a.subParser("hashPreCodeTags")(e,t,i),e=a.subParser("githubCodeBlocks")(e,t,i),e=a.subParser("hashHTMLBlocks")(e,t,i),e=a.subParser("hashCodeTags")(e,t,i),e=a.subParser("stripLinkDefinitions")(e,t,i),e=a.subParser("blockGamut")(e,t,i),e=a.subParser("unhashHTMLSpans")(e,t,i),e=(e=(e=a.subParser("unescapeSpecialChars")(e,t,i)).replace(/D/g,"$$")).replace(/T/g,""),e=a.subParser("completeHTMLDocument")(e,t,i),a.helper.forEach(n,(function(r){e=a.subParser("runExtension")(r,e,t,i)})),h=i.metadata,e},this.makeMarkdown=this.makeMd=function(e,t){if(e=(e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")).replace(/>[ \t]+</,">NBSP;<"),!t){if(!window||!window.document)throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");t=window.document}var r=t.createElement("div");r.innerHTML=e;var n={preList:function(e){for(var t=e.querySelectorAll("pre"),r=[],n=0;n<t.length;++n)if(1===t[n].childElementCount&&"code"===t[n].firstChild.tagName.toLowerCase()){var i=t[n].firstChild.innerHTML.trim(),o=t[n].firstChild.getAttribute("data-language")||"";if(""===o)for(var s=t[n].firstChild.className.split(" "),c=0;c<s.length;++c){var u=s[c].match(/^language-(.+)$/);if(null!==u){o=u[1];break}}i=a.helper.unescapeHTMLEntities(i),r.push(i),t[n].outerHTML='<precode language="'+o+'" precodenum="'+n.toString()+'"></precode>'}else r.push(t[n].innerHTML),t[n].innerHTML="",t[n].setAttribute("prenum",n.toString());return r}(r)};!function e(t){for(var r=0;r<t.childNodes.length;++r){var n=t.childNodes[r];3===n.nodeType?/\S/.test(n.nodeValue)?(n.nodeValue=n.nodeValue.split("\n").join(" "),n.nodeValue=n.nodeValue.replace(/(\s)+/g,"$1")):(t.removeChild(n),--r):1===n.nodeType&&e(n)}}(r);for(var i=r.childNodes,o="",s=0;s<i.length;s++)o+=a.subParser("makeMarkdown.node")(i[s],n);return o},this.setOption=function(e,r){t[e]=r},this.getOption=function(e){return t[e]},this.getOptions=function(){return t},this.addExtension=function(e,t){f(e,t=t||null)},this.useExtension=function(e){f(e)},this.setFlavor=function(e){if(!l.hasOwnProperty(e))throw Error(e+" flavor was not found");var r=l[e];for(var n in o=e,r)r.hasOwnProperty(n)&&(t[n]=r[n])},this.getFlavor=function(){return o},this.removeExtension=function(e){a.helper.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t){for(var i=e[t],o=0;o<r.length;++o)r[o]===i&&r[o].splice(o,1);for(;0<n.length;++o)n[0]===i&&n[0].splice(o,1)}},this.getAllExtensions=function(){return{language:r,output:n}},this.getMetadata=function(e){return e?h.raw:h.parsed},this.getMetadataFormat=function(){return h.format},this._setMetadataPair=function(e,t){h.parsed[e]=t},this._setMetadataFormat=function(e){h.format=e},this._setMetadataRaw=function(e){h.raw=e}},a.subParser("anchors",(function(e,t,r){"use strict";var n=function(e,n,i,o,s,c,u){if(a.helper.isUndefined(u)&&(u=""),i=i.toLowerCase(),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)o="";else if(!o){if(i||(i=n.toLowerCase().replace(/ ?\n/g," ")),o="#"+i,a.helper.isUndefined(r.gUrls[i]))return e;o=r.gUrls[i],a.helper.isUndefined(r.gTitles[i])||(u=r.gTitles[i])}var l='<a href="'+(o=o.replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback))+'"';return""!==u&&null!==u&&(l+=' title="'+(u=(u=u.replace(/"/g,"&quot;")).replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback))+'"'),t.openLinksInNewWindow&&!/^#/.test(o)&&(l+=' rel="noopener noreferrer" target="E95Eblank"'),l+=">"+n+"</a>"};return e=(e=(e=(e=(e=r.converter._dispatch("anchors.before",e,t,r)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,n)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,n)).replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,n)).replace(/\[([^\[\]]+)]()()()()()/g,n),t.ghMentions&&(e=e.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gim,(function(e,r,n,i,o){if("\\"===n)return r+i;if(!a.helper.isString(t.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var s=t.ghMentionsLink.replace(/\{u}/g,o),c="";return t.openLinksInNewWindow&&(c=' rel="noopener noreferrer" target="E95Eblank"'),r+'<a href="'+s+'"'+c+">"+i+"</a>"}))),e=r.converter._dispatch("anchors.after",e,t,r)}));var p=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,g=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,m=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,v=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gim,y=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,b=function(e){"use strict";return function(t,r,n,i,o,s,c){var u=n=n.replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback),l="",d="",h=r||"",f=c||"";return/^www\./i.test(n)&&(n=n.replace(/^www\./i,"http://www.")),e.excludeTrailingPunctuationFromURLs&&s&&(l=s),e.openLinksInNewWindow&&(d=' rel="noopener noreferrer" target="E95Eblank"'),h+'<a href="'+n+'"'+d+">"+u+"</a>"+l+f}},_=function(e,t){"use strict";return function(r,n,i){var o="mailto:";return n=n||"",i=a.subParser("unescapeSpecialChars")(i,e,t),e.encodeEmails?(o=a.helper.encodeEmailAddress(o+i),i=a.helper.encodeEmailAddress(i)):o+=i,n+'<a href="'+o+'">'+i+"</a>"}};a.subParser("autoLinks",(function(e,t,r){"use strict";return e=(e=(e=r.converter._dispatch("autoLinks.before",e,t,r)).replace(m,b(t))).replace(y,_(t,r)),e=r.converter._dispatch("autoLinks.after",e,t,r)})),a.subParser("simplifiedAutoLinks",(function(e,t,r){"use strict";return t.simplifiedAutoLink?(e=r.converter._dispatch("simplifiedAutoLinks.before",e,t,r),e=(e=t.excludeTrailingPunctuationFromURLs?e.replace(g,b(t)):e.replace(p,b(t))).replace(v,_(t,r)),e=r.converter._dispatch("simplifiedAutoLinks.after",e,t,r)):e})),a.subParser("blockGamut",(function(e,t,r){"use strict";return e=r.converter._dispatch("blockGamut.before",e,t,r),e=a.subParser("blockQuotes")(e,t,r),e=a.subParser("headers")(e,t,r),e=a.subParser("horizontalRule")(e,t,r),e=a.subParser("lists")(e,t,r),e=a.subParser("codeBlocks")(e,t,r),e=a.subParser("tables")(e,t,r),e=a.subParser("hashHTMLBlocks")(e,t,r),e=a.subParser("paragraphs")(e,t,r),e=r.converter._dispatch("blockGamut.after",e,t,r)})),a.subParser("blockQuotes",(function(e,t,r){"use strict";e=r.converter._dispatch("blockQuotes.before",e,t,r),e+="\n\n";var n=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return t.splitAdjacentBlockquotes&&(n=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),e=e.replace(n,(function(e){return e=(e=(e=e.replace(/^[ \t]*>[ \t]?/gm,"")).replace(/0/g,"")).replace(/^[ \t]+$/gm,""),e=a.subParser("githubCodeBlocks")(e,t,r),e=(e=(e=a.subParser("blockGamut")(e,t,r)).replace(/(^|\n)/g,"$1  ")).replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,(function(e,t){var r=t;return r=(r=r.replace(/^  /gm,"0")).replace(/0/g,"")})),a.subParser("hashBlock")("<blockquote>\n"+e+"\n</blockquote>",t,r)})),e=r.converter._dispatch("blockQuotes.after",e,t,r)})),a.subParser("codeBlocks",(function(e,t,r){"use strict";e=r.converter._dispatch("codeBlocks.before",e,t,r);return e=(e=(e+="0").replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=0))/g,(function(e,n,i){var o=n,s=i,c="\n";return o=a.subParser("outdent")(o,t,r),o=a.subParser("encodeCode")(o,t,r),o=(o=(o=a.subParser("detab")(o,t,r)).replace(/^\n+/g,"")).replace(/\n+$/g,""),t.omitExtraWLInCodeBlocks&&(c=""),o="<pre><code>"+o+c+"</code></pre>",a.subParser("hashBlock")(o,t,r)+s}))).replace(/0/,""),e=r.converter._dispatch("codeBlocks.after",e,t,r)})),a.subParser("codeSpans",(function(e,t,r){"use strict";return void 0===(e=r.converter._dispatch("codeSpans.before",e,t,r))&&(e=""),e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,(function(e,n,i,o){var s=o;return s=(s=s.replace(/^([ \t]*)/g,"")).replace(/[ \t]*$/g,""),s=n+"<code>"+(s=a.subParser("encodeCode")(s,t,r))+"</code>",s=a.subParser("hashHTMLSpans")(s,t,r)})),e=r.converter._dispatch("codeSpans.after",e,t,r)})),a.subParser("completeHTMLDocument",(function(e,t,r){"use strict";if(!t.completeHTMLDocument)return e;e=r.converter._dispatch("completeHTMLDocument.before",e,t,r);var n="html",i="<!DOCTYPE HTML>\n",a="",o='<meta charset="utf-8">\n',s="",c="";for(var u in void 0!==r.metadata.parsed.doctype&&(i="<!DOCTYPE "+r.metadata.parsed.doctype+">\n","html"!==(n=r.metadata.parsed.doctype.toString().toLowerCase())&&"html5"!==n||(o='<meta charset="utf-8">')),r.metadata.parsed)if(r.metadata.parsed.hasOwnProperty(u))switch(u.toLowerCase()){case"doctype":break;case"title":a="<title>"+r.metadata.parsed.title+"</title>\n";break;case"charset":o="html"===n||"html5"===n?'<meta charset="'+r.metadata.parsed.charset+'">\n':'<meta name="charset" content="'+r.metadata.parsed.charset+'">\n';break;case"language":case"lang":s=' lang="'+r.metadata.parsed[u]+'"',c+='<meta name="'+u+'" content="'+r.metadata.parsed[u]+'">\n';break;default:c+='<meta name="'+u+'" content="'+r.metadata.parsed[u]+'">\n'}return e=i+"<html"+s+">\n<head>\n"+a+o+c+"</head>\n<body>\n"+e.trim()+"\n</body>\n</html>",e=r.converter._dispatch("completeHTMLDocument.after",e,t,r)})),a.subParser("detab",(function(e,t,r){"use strict";return e=(e=(e=(e=(e=(e=r.converter._dispatch("detab.before",e,t,r)).replace(/\t(?=\t)/g,"    ")).replace(/\t/g,"AB")).replace(/B(.+?)A/g,(function(e,t){for(var r=t,n=4-r.length%4,i=0;i<n;i++)r+=" ";return r}))).replace(/A/g,"    ")).replace(/B/g,""),e=r.converter._dispatch("detab.after",e,t,r)})),a.subParser("ellipsis",(function(e,t,r){"use strict";return e=(e=r.converter._dispatch("ellipsis.before",e,t,r)).replace(/\.\.\./g,""),e=r.converter._dispatch("ellipsis.after",e,t,r)})),a.subParser("emoji",(function(e,t,r){"use strict";if(!t.emoji)return e;return e=(e=r.converter._dispatch("emoji.before",e,t,r)).replace(/:([\S]+?):/g,(function(e,t){return a.helper.emojis.hasOwnProperty(t)?a.helper.emojis[t]:e})),e=r.converter._dispatch("emoji.after",e,t,r)})),a.subParser("encodeAmpsAndAngles",(function(e,t,r){"use strict";return e=(e=(e=(e=(e=r.converter._dispatch("encodeAmpsAndAngles.before",e,t,r)).replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;")).replace(/<(?![a-z\/?$!])/gi,"&lt;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e=r.converter._dispatch("encodeAmpsAndAngles.after",e,t,r)})),a.subParser("encodeBackslashEscapes",(function(e,t,r){"use strict";return e=(e=(e=r.converter._dispatch("encodeBackslashEscapes.before",e,t,r)).replace(/\\(\\)/g,a.helper.escapeCharactersCallback)).replace(/\\([`*_{}\[\]()>#+.!~=|-])/g,a.helper.escapeCharactersCallback),e=r.converter._dispatch("encodeBackslashEscapes.after",e,t,r)})),a.subParser("encodeCode",(function(e,t,r){"use strict";return e=(e=r.converter._dispatch("encodeCode.before",e,t,r)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,a.helper.escapeCharactersCallback),e=r.converter._dispatch("encodeCode.after",e,t,r)})),a.subParser("escapeSpecialCharsWithinTagAttributes",(function(e,t,r){"use strict";return e=(e=(e=r.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",e,t,r)).replace(/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,(function(e){return e.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,a.helper.escapeCharactersCallback)}))).replace(/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi,(function(e){return e.replace(/([\\`*_~=|])/g,a.helper.escapeCharactersCallback)})),e=r.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",e,t,r)})),a.subParser("githubCodeBlocks",(function(e,t,r){"use strict";return t.ghCodeBlocks?(e=r.converter._dispatch("githubCodeBlocks.before",e,t,r),e=(e=(e+="0").replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,(function(e,n,i,o){var s=t.omitExtraWLInCodeBlocks?"":"\n";return o=a.subParser("encodeCode")(o,t,r),o="<pre><code"+(i?' class="'+i+" language-"+i+'"':"")+">"+(o=(o=(o=a.subParser("detab")(o,t,r)).replace(/^\n+/g,"")).replace(/\n+$/g,""))+s+"</code></pre>",o=a.subParser("hashBlock")(o,t,r),"\n\nG"+(r.ghCodeBlocks.push({text:e,codeblock:o})-1)+"G\n\n"}))).replace(/0/,""),r.converter._dispatch("githubCodeBlocks.after",e,t,r)):e})),a.subParser("hashBlock",(function(e,t,r){"use strict";return e=(e=r.converter._dispatch("hashBlock.before",e,t,r)).replace(/(^\n+|\n+$)/g,""),e="\n\nK"+(r.gHtmlBlocks.push(e)-1)+"K\n\n",e=r.converter._dispatch("hashBlock.after",e,t,r)})),a.subParser("hashCodeTags",(function(e,t,r){"use strict";e=r.converter._dispatch("hashCodeTags.before",e,t,r);return e=a.helper.replaceRecursiveRegExp(e,(function(e,n,i,o){var s=i+a.subParser("encodeCode")(n,t,r)+o;return"C"+(r.gHtmlSpans.push(s)-1)+"C"}),"<code\\b[^>]*>","</code>","gim"),e=r.converter._dispatch("hashCodeTags.after",e,t,r)})),a.subParser("hashElement",(function(e,t,r){"use strict";return function(e,t){var n=t;return n=(n=(n=n.replace(/\n\n/g,"\n")).replace(/^\n/,"")).replace(/\n+$/g,""),n="\n\nK"+(r.gHtmlBlocks.push(n)-1)+"K\n\n"}})),a.subParser("hashHTMLBlocks",(function(e,t,r){"use strict";e=r.converter._dispatch("hashHTMLBlocks.before",e,t,r);var n=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],i=function(e,t,n,i){var a=e;return-1!==n.search(/\bmarkdown\b/)&&(a=n+r.converter.makeHtml(t)+i),"\n\nK"+(r.gHtmlBlocks.push(a)-1)+"K\n\n"};t.backslashEscapesHTMLTags&&(e=e.replace(/\\<(\/?[^>]+?)>/g,(function(e,t){return"&lt;"+t+"&gt;"})));for(var o=0;o<n.length;++o)for(var s,c=new RegExp("^ {0,3}(<"+n[o]+"\\b[^>]*>)","im"),u="<"+n[o]+"\\b[^>]*>",l="</"+n[o]+">";-1!==(s=a.helper.regexIndexOf(e,c));){var d=a.helper.splitAtIndex(e,s),h=a.helper.replaceRecursiveRegExp(d[1],i,u,l,"im");if(h===d[1])break;e=d[0].concat(h)}return e=e.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,a.subParser("hashElement")(e,t,r)),e=(e=a.helper.replaceRecursiveRegExp(e,(function(e){return"\n\nK"+(r.gHtmlBlocks.push(e)-1)+"K\n\n"}),"^ {0,3}\x3c!--","--\x3e","gm")).replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,a.subParser("hashElement")(e,t,r)),e=r.converter._dispatch("hashHTMLBlocks.after",e,t,r)})),a.subParser("hashHTMLSpans",(function(e,t,r){"use strict";function n(e){return"C"+(r.gHtmlSpans.push(e)-1)+"C"}return e=(e=(e=(e=(e=r.converter._dispatch("hashHTMLSpans.before",e,t,r)).replace(/<[^>]+?\/>/gi,(function(e){return n(e)}))).replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,(function(e){return n(e)}))).replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,(function(e){return n(e)}))).replace(/<[^>]+?>/gi,(function(e){return n(e)})),e=r.converter._dispatch("hashHTMLSpans.after",e,t,r)})),a.subParser("unhashHTMLSpans",(function(e,t,r){"use strict";e=r.converter._dispatch("unhashHTMLSpans.before",e,t,r);for(var n=0;n<r.gHtmlSpans.length;++n){for(var i=r.gHtmlSpans[n],a=0;/C(\d+)C/.test(i);){var o=RegExp.$1;if(i=i.replace("C"+o+"C",r.gHtmlSpans[o]),10===a){console.error("maximum nesting of 10 spans reached!!!");break}++a}e=e.replace("C"+n+"C",i)}return e=r.converter._dispatch("unhashHTMLSpans.after",e,t,r)})),a.subParser("hashPreCodeTags",(function(e,t,r){"use strict";e=r.converter._dispatch("hashPreCodeTags.before",e,t,r);return e=a.helper.replaceRecursiveRegExp(e,(function(e,n,i,o){var s=i+a.subParser("encodeCode")(n,t,r)+o;return"\n\nG"+(r.ghCodeBlocks.push({text:e,codeblock:s})-1)+"G\n\n"}),"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),e=r.converter._dispatch("hashPreCodeTags.after",e,t,r)})),a.subParser("headers",(function(e,t,r){"use strict";e=r.converter._dispatch("headers.before",e,t,r);var n=isNaN(parseInt(t.headerLevelStart))?1:parseInt(t.headerLevelStart),i=t.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,o=t.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;e=(e=e.replace(i,(function(e,i){var o=a.subParser("spanGamut")(i,t,r),s=t.noHeaderId?"":' id="'+c(i)+'"',u="<h"+n+s+">"+o+"</h"+n+">";return a.subParser("hashBlock")(u,t,r)}))).replace(o,(function(e,i){var o=a.subParser("spanGamut")(i,t,r),s=t.noHeaderId?"":' id="'+c(i)+'"',u=n+1,l="<h"+u+s+">"+o+"</h"+u+">";return a.subParser("hashBlock")(l,t,r)}));var s=t.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;function c(e){var n,i;if(t.customizedHeaderId){var o=e.match(/\{([^{]+?)}\s*$/);o&&o[1]&&(e=o[1])}return n=e,i=a.helper.isString(t.prefixHeaderId)?t.prefixHeaderId:!0===t.prefixHeaderId?"section-":"",t.rawPrefixHeaderId||(n=i+n),n=t.ghCompatibleHeaderId?n.replace(/ /g,"-").replace(/&amp;/g,"").replace(/T/g,"").replace(/D/g,"").replace(/[&+$,\/:;=?@"#{}|^~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():t.rawHeaderId?n.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/T/g,"").replace(/D/g,"$").replace(/["']/g,"-").toLowerCase():n.replace(/[^\w]/g,"").toLowerCase(),t.rawPrefixHeaderId&&(n=i+n),r.hashLinkCounts[n]?n=n+"-"+r.hashLinkCounts[n]++:r.hashLinkCounts[n]=1,n}return e=e.replace(s,(function(e,i,o){var s=o;t.customizedHeaderId&&(s=o.replace(/\s?\{([^{]+?)}\s*$/,""));var u=a.subParser("spanGamut")(s,t,r),l=t.noHeaderId?"":' id="'+c(o)+'"',d=n-1+i.length,h="<h"+d+l+">"+u+"</h"+d+">";return a.subParser("hashBlock")(h,t,r)})),e=r.converter._dispatch("headers.after",e,t,r)})),a.subParser("horizontalRule",(function(e,t,r){"use strict";e=r.converter._dispatch("horizontalRule.before",e,t,r);var n=a.subParser("hashBlock")("<hr />",t,r);return e=(e=(e=e.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,n)).replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,n)).replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,n),e=r.converter._dispatch("horizontalRule.after",e,t,r)})),a.subParser("images",(function(e,t,r){"use strict";function n(e,t,n,i,o,s,c,u){var l=r.gUrls,d=r.gTitles,h=r.gDimensions;if(n=n.toLowerCase(),u||(u=""),e.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)i="";else if(""===i||null===i){if(""!==n&&null!==n||(n=t.toLowerCase().replace(/ ?\n/g," ")),i="#"+n,a.helper.isUndefined(l[n]))return e;i=l[n],a.helper.isUndefined(d[n])||(u=d[n]),a.helper.isUndefined(h[n])||(o=h[n].width,s=h[n].height)}t=t.replace(/"/g,"&quot;").replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback);var f='<img src="'+(i=i.replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback))+'" alt="'+t+'"';return u&&a.helper.isString(u)&&(f+=' title="'+(u=u.replace(/"/g,"&quot;").replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback))+'"'),o&&s&&(f+=' width="'+(o="*"===o?"auto":o)+'"',f+=' height="'+(s="*"===s?"auto":s)+'"'),f+=" />"}return e=(e=(e=(e=(e=(e=r.converter._dispatch("images.before",e,t,r)).replace(/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,n)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,(function(e,t,r,i,a,o,s,c){return n(e,t,r,i=i.replace(/\s/g,""),a,o,s,c)}))).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,n)).replace(/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,n)).replace(/!\[([^\[\]]+)]()()()()()/g,n),e=r.converter._dispatch("images.after",e,t,r)})),a.subParser("italicsAndBold",(function(e,t,r){"use strict";function n(e,t,r){return t+e+r}return e=r.converter._dispatch("italicsAndBold.before",e,t,r),e=t.literalMidWordUnderscores?(e=(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return n(t,"<strong><em>","</em></strong>")}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return n(t,"<strong>","</strong>")}))).replace(/\b_(\S[\s\S]*?)_\b/g,(function(e,t){return n(t,"<em>","</em>")})):(e=(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong><em>","</em></strong>"):e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong>","</strong>"):e}))).replace(/_([^\s_][\s\S]*?)_/g,(function(e,t){return/\S$/.test(t)?n(t,"<em>","</em>"):e})),e=t.literalMidWordAsterisks?(e=(e=e.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,(function(e,t,r){return n(r,t+"<strong><em>","</em></strong>")}))).replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,(function(e,t,r){return n(r,t+"<strong>","</strong>")}))).replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,(function(e,t,r){return n(r,t+"<em>","</em>")})):(e=(e=e.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong><em>","</em></strong>"):e}))).replace(/\*\*(\S[\s\S]*?)\*\*/g,(function(e,t){return/\S$/.test(t)?n(t,"<strong>","</strong>"):e}))).replace(/\*([^\s*][\s\S]*?)\*/g,(function(e,t){return/\S$/.test(t)?n(t,"<em>","</em>"):e})),e=r.converter._dispatch("italicsAndBold.after",e,t,r)})),a.subParser("lists",(function(e,t,r){"use strict";function n(e,n){r.gListLevel++,e=e.replace(/\n{2,}$/,"\n");var i=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,o=/\n[ \t]*\n(?!0)/.test(e+="0");return t.disableForced4SpacesIndentedSublists&&(i=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(0|\2([*+-]|\d+[.])[ \t]+))/gm),e=(e=e.replace(i,(function(e,n,i,s,c,u,l){l=l&&""!==l.trim();var d=a.subParser("outdent")(c,t,r),h="";return u&&t.tasklists&&(h=' class="task-list-item" style="list-style-type: none;"',d=d.replace(/^[ \t]*\[(x|X| )?]/m,(function(){var e='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return l&&(e+=" checked"),e+=">"}))),d=d.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,(function(e){return"A"+e})),n||d.search(/\n{2,}/)>-1?(d=a.subParser("githubCodeBlocks")(d,t,r),d=a.subParser("blockGamut")(d,t,r)):(d=(d=a.subParser("lists")(d,t,r)).replace(/\n$/,""),d=(d=a.subParser("hashHTMLBlocks")(d,t,r)).replace(/\n\n+/g,"\n\n"),d=o?a.subParser("paragraphs")(d,t,r):a.subParser("spanGamut")(d,t,r)),d="<li"+h+">"+(d=d.replace("A",""))+"</li>\n"}))).replace(/0/g,""),r.gListLevel--,n&&(e=e.replace(/\s+$/,"")),e}function i(e,t){if("ol"===t){var r=e.match(/^ *(\d+)\./);if(r&&"1"!==r[1])return' start="'+r[1]+'"'}return""}function o(e,r,a){var o=t.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,s=t.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,c="ul"===r?o:s,u="";if(-1!==e.search(c))!function t(l){var d=l.search(c),h=i(e,r);-1!==d?(u+="\n\n<"+r+h+">\n"+n(l.slice(0,d),!!a)+"</"+r+">\n",c="ul"===(r="ul"===r?"ol":"ul")?o:s,t(l.slice(d))):u+="\n\n<"+r+h+">\n"+n(l,!!a)+"</"+r+">\n"}(e);else{var l=i(e,r);u="\n\n<"+r+l+">\n"+n(e,!!a)+"</"+r+">\n"}return u}return e=r.converter._dispatch("lists.before",e,t,r),e+="0",e=(e=r.gListLevel?e.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,r){return o(t,r.search(/[*+-]/g)>-1?"ul":"ol",!0)})):e.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,(function(e,t,r,n){return o(r,n.search(/[*+-]/g)>-1?"ul":"ol",!1)}))).replace(/0/,""),e=r.converter._dispatch("lists.after",e,t,r)})),a.subParser("metadata",(function(e,t,r){"use strict";if(!t.metadata)return e;function n(e){r.metadata.raw=e,(e=(e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;")).replace(/\n {4}/g," ")).replace(/^([\S ]+): +([\s\S]+?)$/gm,(function(e,t,n){return r.metadata.parsed[t]=n,""}))}return e=(e=(e=(e=r.converter._dispatch("metadata.before",e,t,r)).replace(/^\s*+(\S*?)\n([\s\S]+?)\n+\n/,(function(e,t,r){return n(r),"M"}))).replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,(function(e,t,i){return t&&(r.metadata.format=t),n(i),"M"}))).replace(/M/g,""),e=r.converter._dispatch("metadata.after",e,t,r)})),a.subParser("outdent",(function(e,t,r){"use strict";return e=(e=(e=r.converter._dispatch("outdent.before",e,t,r)).replace(/^(\t|[ ]{1,4})/gm,"0")).replace(/0/g,""),e=r.converter._dispatch("outdent.after",e,t,r)})),a.subParser("paragraphs",(function(e,t,r){"use strict";for(var n=(e=(e=(e=r.converter._dispatch("paragraphs.before",e,t,r)).replace(/^\n+/g,"")).replace(/\n+$/g,"")).split(/\n{2,}/g),i=[],o=n.length,s=0;s<o;s++){var c=n[s];c.search(/(K|G)(\d+)\1/g)>=0?i.push(c):c.search(/\S/)>=0&&(c=(c=a.subParser("spanGamut")(c,t,r)).replace(/^([ \t]*)/g,"<p>"),c+="</p>",i.push(c))}for(o=i.length,s=0;s<o;s++){for(var u="",l=i[s],d=!1;/(K|G)(\d+)\1/.test(l);){var h=RegExp.$1,f=RegExp.$2;u=(u="K"===h?r.gHtmlBlocks[f]:d?a.subParser("encodeCode")(r.ghCodeBlocks[f].text,t,r):r.ghCodeBlocks[f].codeblock).replace(/\$/g,"$$$$"),l=l.replace(/(\n\n)?(K|G)\d+\2(\n\n)?/,u),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(l)&&(d=!0)}i[s]=l}return e=(e=(e=i.join("\n")).replace(/^\n+/g,"")).replace(/\n+$/g,""),r.converter._dispatch("paragraphs.after",e,t,r)})),a.subParser("runExtension",(function(e,t,r,n){"use strict";if(e.filter)t=e.filter(t,n.converter,r);else if(e.regex){var i=e.regex;i instanceof RegExp||(i=new RegExp(i,"g")),t=t.replace(i,e.replace)}return t})),a.subParser("spanGamut",(function(e,t,r){"use strict";return e=r.converter._dispatch("spanGamut.before",e,t,r),e=a.subParser("codeSpans")(e,t,r),e=a.subParser("escapeSpecialCharsWithinTagAttributes")(e,t,r),e=a.subParser("encodeBackslashEscapes")(e,t,r),e=a.subParser("images")(e,t,r),e=a.subParser("anchors")(e,t,r),e=a.subParser("autoLinks")(e,t,r),e=a.subParser("simplifiedAutoLinks")(e,t,r),e=a.subParser("emoji")(e,t,r),e=a.subParser("underline")(e,t,r),e=a.subParser("italicsAndBold")(e,t,r),e=a.subParser("strikethrough")(e,t,r),e=a.subParser("ellipsis")(e,t,r),e=a.subParser("hashHTMLSpans")(e,t,r),e=a.subParser("encodeAmpsAndAngles")(e,t,r),t.simpleLineBreaks?/\n\nK/.test(e)||(e=e.replace(/\n+/g,"<br />\n")):e=e.replace(/  +\n/g,"<br />\n"),e=r.converter._dispatch("spanGamut.after",e,t,r)})),a.subParser("strikethrough",(function(e,t,r){"use strict";return t.strikethrough&&(e=(e=r.converter._dispatch("strikethrough.before",e,t,r)).replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,(function(e,n){return function(e){return t.simplifiedAutoLink&&(e=a.subParser("simplifiedAutoLinks")(e,t,r)),"<del>"+e+"</del>"}(n)})),e=r.converter._dispatch("strikethrough.after",e,t,r)),e})),a.subParser("stripLinkDefinitions",(function(e,t,r){"use strict";var n=function(e,n,i,o,s,c,u){return n=n.toLowerCase(),i.match(/^data:.+?\/.+?;base64,/)?r.gUrls[n]=i.replace(/\s/g,""):r.gUrls[n]=a.subParser("encodeAmpsAndAngles")(i,t,r),c?c+u:(u&&(r.gTitles[n]=u.replace(/"|'/g,"&quot;")),t.parseImgDimensions&&o&&s&&(r.gDimensions[n]={width:o,height:s}),"")};return e=(e=(e=(e+="0").replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=0)|(?=\n\[))/gm,n)).replace(/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=0))/gm,n)).replace(/0/,"")})),a.subParser("tables",(function(e,t,r){"use strict";if(!t.tables)return e;function n(e,n){return"<td"+n+">"+a.subParser("spanGamut")(e,t,r)+"</td>\n"}function i(e){var i,o=e.split("\n");for(i=0;i<o.length;++i)/^ {0,3}\|/.test(o[i])&&(o[i]=o[i].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(o[i])&&(o[i]=o[i].replace(/\|[ \t]*$/,"")),o[i]=a.subParser("codeSpans")(o[i],t,r);var s,c,u,l,d=o[0].split("|").map((function(e){return e.trim()})),h=o[1].split("|").map((function(e){return e.trim()})),f=[],p=[],g=[],m=[];for(o.shift(),o.shift(),i=0;i<o.length;++i)""!==o[i].trim()&&f.push(o[i].split("|").map((function(e){return e.trim()})));if(d.length<h.length)return e;for(i=0;i<h.length;++i)g.push((s=h[i],/^:[ \t]*--*$/.test(s)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(s)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(s)?' style="text-align:center;"':""));for(i=0;i<d.length;++i)a.helper.isUndefined(g[i])&&(g[i]=""),p.push((c=d[i],u=g[i],l=void 0,l="",c=c.trim(),(t.tablesHeaderId||t.tableHeaderId)&&(l=' id="'+c.replace(/ /g,"_").toLowerCase()+'"'),"<th"+l+u+">"+(c=a.subParser("spanGamut")(c,t,r))+"</th>\n"));for(i=0;i<f.length;++i){for(var v=[],y=0;y<p.length;++y)a.helper.isUndefined(f[i][y]),v.push(n(f[i][y],g[y]));m.push(v)}return function(e,t){for(var r="<table>\n<thead>\n<tr>\n",n=e.length,i=0;i<n;++i)r+=e[i];for(r+="</tr>\n</thead>\n<tbody>\n",i=0;i<t.length;++i){r+="<tr>\n";for(var a=0;a<n;++a)r+=t[i][a];r+="</tr>\n"}return r+"</tbody>\n</table>\n"}(p,m)}return e=(e=(e=(e=r.converter._dispatch("tables.before",e,t,r)).replace(/\\(\|)/g,a.helper.escapeCharactersCallback)).replace(/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|0)/gm,i)).replace(/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|0)/gm,i),e=r.converter._dispatch("tables.after",e,t,r)})),a.subParser("underline",(function(e,t,r){"use strict";return t.underline?(e=r.converter._dispatch("underline.before",e,t,r),e=(e=t.literalMidWordUnderscores?(e=e.replace(/\b___(\S[\s\S]*?)___\b/g,(function(e,t){return"<u>"+t+"</u>"}))).replace(/\b__(\S[\s\S]*?)__\b/g,(function(e,t){return"<u>"+t+"</u>"})):(e=e.replace(/___(\S[\s\S]*?)___/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/__(\S[\s\S]*?)__/g,(function(e,t){return/\S$/.test(t)?"<u>"+t+"</u>":e}))).replace(/(_)/g,a.helper.escapeCharactersCallback),e=r.converter._dispatch("underline.after",e,t,r)):e})),a.subParser("unescapeSpecialChars",(function(e,t,r){"use strict";return e=(e=r.converter._dispatch("unescapeSpecialChars.before",e,t,r)).replace(/E(\d+)E/g,(function(e,t){var r=parseInt(t);return String.fromCharCode(r)})),e=r.converter._dispatch("unescapeSpecialChars.after",e,t,r)})),a.subParser("makeMarkdown.blockquote",(function(e,t){"use strict";var r="";if(e.hasChildNodes())for(var n=e.childNodes,i=n.length,o=0;o<i;++o){var s=a.subParser("makeMarkdown.node")(n[o],t);""!==s&&(r+=s)}return r="> "+(r=r.trim()).split("\n").join("\n> ")})),a.subParser("makeMarkdown.codeBlock",(function(e,t){"use strict";var r=e.getAttribute("language"),n=e.getAttribute("precodenum");return"```"+r+"\n"+t.preList[n]+"\n```"})),a.subParser("makeMarkdown.codeSpan",(function(e){"use strict";return"`"+e.innerHTML+"`"})),a.subParser("makeMarkdown.emphasis",(function(e,t){"use strict";var r="";if(e.hasChildNodes()){r+="*";for(var n=e.childNodes,i=n.length,o=0;o<i;++o)r+=a.subParser("makeMarkdown.node")(n[o],t);r+="*"}return r})),a.subParser("makeMarkdown.header",(function(e,t,r){"use strict";var n=new Array(r+1).join("#"),i="";if(e.hasChildNodes()){i=n+" ";for(var o=e.childNodes,s=o.length,c=0;c<s;++c)i+=a.subParser("makeMarkdown.node")(o[c],t)}return i})),a.subParser("makeMarkdown.hr",(function(){"use strict";return"---"})),a.subParser("makeMarkdown.image",(function(e){"use strict";var t="";return e.hasAttribute("src")&&(t+="!["+e.getAttribute("alt")+"](",t+="<"+e.getAttribute("src")+">",e.hasAttribute("width")&&e.hasAttribute("height")&&(t+=" ="+e.getAttribute("width")+"x"+e.getAttribute("height")),e.hasAttribute("title")&&(t+=' "'+e.getAttribute("title")+'"'),t+=")"),t})),a.subParser("makeMarkdown.links",(function(e,t){"use strict";var r="";if(e.hasChildNodes()&&e.hasAttribute("href")){var n=e.childNodes,i=n.length;r="[";for(var o=0;o<i;++o)r+=a.subParser("makeMarkdown.node")(n[o],t);r+="](",r+="<"+e.getAttribute("href")+">",e.hasAttribute("title")&&(r+=' "'+e.getAttribute("title")+'"'),r+=")"}return r})),a.subParser("makeMarkdown.list",(function(e,t,r){"use strict";var n="";if(!e.hasChildNodes())return"";for(var i=e.childNodes,o=i.length,s=e.getAttribute("start")||1,c=0;c<o;++c)if(void 0!==i[c].tagName&&"li"===i[c].tagName.toLowerCase()){n+=("ol"===r?s.toString()+". ":"- ")+a.subParser("makeMarkdown.listItem")(i[c],t),++s}return(n+="\n\x3c!-- --\x3e\n").trim()})),a.subParser("makeMarkdown.listItem",(function(e,t){"use strict";for(var r="",n=e.childNodes,i=n.length,o=0;o<i;++o)r+=a.subParser("makeMarkdown.node")(n[o],t);return/\n$/.test(r)?r=r.split("\n").join("\n    ").replace(/^ {4}$/gm,"").replace(/\n\n+/g,"\n\n"):r+="\n",r})),a.subParser("makeMarkdown.node",(function(e,t,r){"use strict";r=r||!1;var n="";if(3===e.nodeType)return a.subParser("makeMarkdown.txt")(e,t);if(8===e.nodeType)return"\x3c!--"+e.data+"--\x3e\n\n";if(1!==e.nodeType)return"";switch(e.tagName.toLowerCase()){case"h1":r||(n=a.subParser("makeMarkdown.header")(e,t,1)+"\n\n");break;case"h2":r||(n=a.subParser("makeMarkdown.header")(e,t,2)+"\n\n");break;case"h3":r||(n=a.subParser("makeMarkdown.header")(e,t,3)+"\n\n");break;case"h4":r||(n=a.subParser("makeMarkdown.header")(e,t,4)+"\n\n");break;case"h5":r||(n=a.subParser("makeMarkdown.header")(e,t,5)+"\n\n");break;case"h6":r||(n=a.subParser("makeMarkdown.header")(e,t,6)+"\n\n");break;case"p":r||(n=a.subParser("makeMarkdown.paragraph")(e,t)+"\n\n");break;case"blockquote":r||(n=a.subParser("makeMarkdown.blockquote")(e,t)+"\n\n");break;case"hr":r||(n=a.subParser("makeMarkdown.hr")(e,t)+"\n\n");break;case"ol":r||(n=a.subParser("makeMarkdown.list")(e,t,"ol")+"\n\n");break;case"ul":r||(n=a.subParser("makeMarkdown.list")(e,t,"ul")+"\n\n");break;case"precode":r||(n=a.subParser("makeMarkdown.codeBlock")(e,t)+"\n\n");break;case"pre":r||(n=a.subParser("makeMarkdown.pre")(e,t)+"\n\n");break;case"table":r||(n=a.subParser("makeMarkdown.table")(e,t)+"\n\n");break;case"code":n=a.subParser("makeMarkdown.codeSpan")(e,t);break;case"em":case"i":n=a.subParser("makeMarkdown.emphasis")(e,t);break;case"strong":case"b":n=a.subParser("makeMarkdown.strong")(e,t);break;case"del":n=a.subParser("makeMarkdown.strikethrough")(e,t);break;case"a":n=a.subParser("makeMarkdown.links")(e,t);break;case"img":n=a.subParser("makeMarkdown.image")(e,t);break;default:n=e.outerHTML+"\n\n"}return n})),a.subParser("makeMarkdown.paragraph",(function(e,t){"use strict";var r="";if(e.hasChildNodes())for(var n=e.childNodes,i=n.length,o=0;o<i;++o)r+=a.subParser("makeMarkdown.node")(n[o],t);return r=r.trim()})),a.subParser("makeMarkdown.pre",(function(e,t){"use strict";var r=e.getAttribute("prenum");return"<pre>"+t.preList[r]+"</pre>"})),a.subParser("makeMarkdown.strikethrough",(function(e,t){"use strict";var r="";if(e.hasChildNodes()){r+="~~";for(var n=e.childNodes,i=n.length,o=0;o<i;++o)r+=a.subParser("makeMarkdown.node")(n[o],t);r+="~~"}return r})),a.subParser("makeMarkdown.strong",(function(e,t){"use strict";var r="";if(e.hasChildNodes()){r+="**";for(var n=e.childNodes,i=n.length,o=0;o<i;++o)r+=a.subParser("makeMarkdown.node")(n[o],t);r+="**"}return r})),a.subParser("makeMarkdown.table",(function(e,t){"use strict";var r,n,i="",o=[[],[]],s=e.querySelectorAll("thead>tr>th"),c=e.querySelectorAll("tbody>tr");for(r=0;r<s.length;++r){var u=a.subParser("makeMarkdown.tableCell")(s[r],t),l="---";if(s[r].hasAttribute("style"))switch(s[r].getAttribute("style").toLowerCase().replace(/\s/g,"")){case"text-align:left;":l=":---";break;case"text-align:right;":l="---:";break;case"text-align:center;":l=":---:"}o[0][r]=u.trim(),o[1][r]=l}for(r=0;r<c.length;++r){var d=o.push([])-1,h=c[r].getElementsByTagName("td");for(n=0;n<s.length;++n){var f=" ";void 0!==h[n]&&(f=a.subParser("makeMarkdown.tableCell")(h[n],t)),o[d].push(f)}}var p=3;for(r=0;r<o.length;++r)for(n=0;n<o[r].length;++n){var g=o[r][n].length;g>p&&(p=g)}for(r=0;r<o.length;++r){for(n=0;n<o[r].length;++n)1===r?":"===o[r][n].slice(-1)?o[r][n]=a.helper.padEnd(o[r][n].slice(-1),p-1,"-")+":":o[r][n]=a.helper.padEnd(o[r][n],p,"-"):o[r][n]=a.helper.padEnd(o[r][n],p);i+="| "+o[r].join(" | ")+" |\n"}return i.trim()})),a.subParser("makeMarkdown.tableCell",(function(e,t){"use strict";var r="";if(!e.hasChildNodes())return"";for(var n=e.childNodes,i=n.length,o=0;o<i;++o)r+=a.subParser("makeMarkdown.node")(n[o],t,!0);return r.trim()})),a.subParser("makeMarkdown.txt",(function(e){"use strict";var t=e.nodeValue;return t=(t=t.replace(/ +/g," ")).replace(/NBSP;/g," "),t=(t=(t=(t=(t=(t=(t=(t=(t=a.helper.unescapeHTMLEntities(t)).replace(/([*_~|`])/g,"\\$1")).replace(/^(\s*)>/g,"\\$1>")).replace(/^#/gm,"\\#")).replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3")).replace(/^( {0,3}\d+)\./gm,"$1\\.")).replace(/^( {0,3})([+-])/gm,"$1\\$2")).replace(/]([\s]*)\(/g,"\\]$1\\(")).replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:")}));void 0===(n=function(){"use strict";return a}.call(t,r,t,e))||(e.exports=n)}).call(this)},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(){function e(){this._hasWeakSet="function"==typeof WeakSet,this._inner=this._hasWeakSet?new WeakSet:[]}return e.prototype.memoize=function(e){if(this._hasWeakSet)return!!this._inner.has(e)||(this._inner.add(e),!1);for(var t=0;t<this._inner.length;t++){if(this._inner[t]===e)return!0}return this._inner.push(e),!1},e.prototype.unmemoize=function(e){if(this._hasWeakSet)this._inner.delete(e);else for(var t=0;t<this._inner.length;t++)if(this._inner[t]===e){this._inner.splice(t,1);break}},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(34),i=r(3),a=r(8),o=r(2);function s(){Object(n.a)({callback:c,type:"error"}),Object(n.a)({callback:c,type:"unhandledrejection"})}function c(){var e=Object(o.b)();e&&(i.a.log("[Tracing] Transaction: "+a.a.InternalError+" -> Global error occured"),e.setStatus(a.a.InternalError))}},function(e,t,r){"use strict";r.d(t,"a",(function(){return g}));var n,i=r(0),a=r(4),o=r(3),s=r(5),c=r(7),u=r(21),l=r(25),d=Object(s.e)(),h={},f={};function p(e){if(!f[e])switch(f[e]=!0,e){case"console":!function(){if(!("console"in d))return;["debug","info","warn","error","log","assert"].forEach((function(e){e in d.console&&Object(c.c)(d.console,e,(function(t){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];m("console",{args:r,level:e}),t&&Function.prototype.apply.call(t,d.console,r)}}))}))}();break;case"dom":!function(){if(!("document"in d))return;d.document.addEventListener("click",E("click",m.bind(null,"dom")),!1),d.document.addEventListener("keypress",S(m.bind(null,"dom")),!1),["EventTarget","Node"].forEach((function(e){var t=d[e]&&d[e].prototype;t&&t.hasOwnProperty&&t.hasOwnProperty("addEventListener")&&(Object(c.c)(t,"addEventListener",(function(e){return function(t,r,n){return r&&r.handleEvent?("click"===t&&Object(c.c)(r,"handleEvent",(function(e){return function(t){return E("click",m.bind(null,"dom"))(t),e.call(this,t)}})),"keypress"===t&&Object(c.c)(r,"handleEvent",(function(e){return function(t){return S(m.bind(null,"dom"))(t),e.call(this,t)}}))):("click"===t&&E("click",m.bind(null,"dom"),!0)(this),"keypress"===t&&S(m.bind(null,"dom"))(this)),e.call(this,t,r,n)}})),Object(c.c)(t,"removeEventListener",(function(e){return function(t,r,n){try{e.call(this,t,r.__sentry_wrapped__,n)}catch(e){}return e.call(this,t,r,n)}})))}))}();break;case"xhr":!function(){if(!("XMLHttpRequest"in d))return;var e=[],t=[],r=XMLHttpRequest.prototype;Object(c.c)(r,"open",(function(r){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=this,s=n[1];o.__sentry_xhr__={method:Object(a.k)(n[0])?n[0].toUpperCase():n[0],url:n[1]},Object(a.k)(s)&&"POST"===o.__sentry_xhr__.method&&s.match(/sentry_key/)&&(o.__sentry_own_request__=!0);var u=function(){if(4===o.readyState){try{o.__sentry_xhr__&&(o.__sentry_xhr__.status_code=o.status)}catch(e){}try{var r=e.indexOf(o);if(-1!==r){e.splice(r);var i=t.splice(r)[0];o.__sentry_xhr__&&void 0!==i[0]&&(o.__sentry_xhr__.body=i[0])}}catch(e){}m("xhr",{args:n,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:o})}};return"onreadystatechange"in o&&"function"==typeof o.onreadystatechange?Object(c.c)(o,"onreadystatechange",(function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return u(),e.apply(o,t)}})):o.addEventListener("readystatechange",u),r.apply(o,n)}})),Object(c.c)(r,"send",(function(r){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return e.push(this),t.push(n),m("xhr",{args:n,startTimestamp:Date.now(),xhr:this}),r.apply(this,n)}}))}();break;case"fetch":!function(){if(!Object(l.c)())return;Object(c.c)(d,"fetch",(function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n={args:t,fetchData:{method:v(t),url:y(t)},startTimestamp:Date.now()};return m("fetch",Object(i.a)({},n)),e.apply(d,t).then((function(e){return m("fetch",Object(i.a)(Object(i.a)({},n),{endTimestamp:Date.now(),response:e})),e}),(function(e){throw m("fetch",Object(i.a)(Object(i.a)({},n),{endTimestamp:Date.now(),error:e})),e}))}}))}();break;case"history":!function(){if(!Object(l.b)())return;var e=d.onpopstate;function t(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=t.length>2?t[2]:void 0;if(i){var a=n,o=String(i);n=o,m("history",{from:a,to:o})}return e.apply(this,t)}}d.onpopstate=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=d.location.href,a=n;if(n=i,m("history",{from:a,to:i}),e)return e.apply(this,t)},Object(c.c)(d.history,"pushState",t),Object(c.c)(d.history,"replaceState",t)}();break;case"error":T=d.onerror,d.onerror=function(e,t,r,n,i){return m("error",{column:n,error:i,line:r,msg:e,url:t}),!!T&&T.apply(this,arguments)};break;case"unhandledrejection":k=d.onunhandledrejection,d.onunhandledrejection=function(e){return m("unhandledrejection",e),!k||k.apply(this,arguments)};break;default:o.a.warn("unknown instrumentation type:",e)}}function g(e){e&&"string"==typeof e.type&&"function"==typeof e.callback&&(h[e.type]=h[e.type]||[],h[e.type].push(e.callback),p(e.type))}function m(e,t){var r,n;if(e&&h[e])try{for(var a=Object(i.f)(h[e]||[]),s=a.next();!s.done;s=a.next()){var c=s.value;try{c(t)}catch(t){o.a.error("Error while triggering instrumentation handler.\nType: "+e+"\nName: "+Object(u.a)(c)+"\nError: "+t)}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}}function v(e){return void 0===e&&(e=[]),"Request"in d&&Object(a.g)(e[0],Request)&&e[0].method?String(e[0].method).toUpperCase():e[1]&&e[1].method?String(e[1].method).toUpperCase():"GET"}function y(e){return void 0===e&&(e=[]),"string"==typeof e[0]?e[0]:"Request"in d&&Object(a.g)(e[0],Request)?e[0].url:String(e[0])}var b,_,w=0;function E(e,t,r){return void 0===r&&(r=!1),function(n){b=void 0,n&&_!==n&&(_=n,w&&clearTimeout(w),r?w=setTimeout((function(){t({event:n,name:e})})):t({event:n,name:e}))}}function S(e){return function(t){var r;try{r=t.target}catch(e){return}var n=r&&r.tagName;n&&("INPUT"===n||"TEXTAREA"===n||r.isContentEditable)&&(b||E("input",e)(t),clearTimeout(b),b=setTimeout((function(){b=void 0}),1e3))}}var T=null;var k=null},,,function(e,t){var r,n,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c,u=[],l=!1,d=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):d=-1,u.length&&f())}function f(){if(!l){var e=s(h);l=!0;for(var t=u.length;t;){for(c=u,u=[];++d<t;)c&&c[d].run();d=-1,t=u.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new p(e,t)),1!==u.length||l||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,r){"use strict";r.r(t),r.d(t,"initFSClientBot",(function(){return Zt}));var n={};r.r(n),r.d(n,"FunctionToString",(function(){return o})),r.d(n,"InboundFilters",(function(){return p}));var i,a={};r.r(a),r.d(a,"Express",(function(){return it})),r.d(a,"Postgres",(function(){return ct.a})),r.d(a,"Mysql",(function(){return ut.a})),r.d(a,"Mongo",(function(){return lt.a}));var o=function(){function e(){this.name=e.id}return e.prototype.setupOnce=function(){i=Function.prototype.toString,Function.prototype.toString=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.__sentry_original__||this;return i.apply(r,e)}},e.id="FunctionToString",e}(),s=r(0),c=r(22),u=r(20),l=r(3),d=r(5),h=r(14),f=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/],p=function(){function e(t){void 0===t&&(t={}),this._options=t,this.name=e.id}return e.prototype.setupOnce=function(){Object(c.b)((function(t){var r=Object(u.c)();if(!r)return t;var n=r.getIntegration(e);if(n){var i=r.getClient(),a=i?i.getOptions():{},o=n._mergeOptions(a);if(n._shouldDropEvent(t,o))return null}return t}))},e.prototype._shouldDropEvent=function(e,t){return this._isSentryError(e,t)?(l.a.warn("Event dropped due to being internal Sentry Error.\nEvent: "+Object(d.d)(e)),!0):this._isIgnoredError(e,t)?(l.a.warn("Event dropped due to being matched by `ignoreErrors` option.\nEvent: "+Object(d.d)(e)),!0):this._isDeniedUrl(e,t)?(l.a.warn("Event dropped due to being matched by `denyUrls` option.\nEvent: "+Object(d.d)(e)+".\nUrl: "+this._getEventFilterUrl(e)),!0):!this._isAllowedUrl(e,t)&&(l.a.warn("Event dropped due to not being matched by `allowUrls` option.\nEvent: "+Object(d.d)(e)+".\nUrl: "+this._getEventFilterUrl(e)),!0)},e.prototype._isSentryError=function(e,t){if(!t.ignoreInternal)return!1;try{return e&&e.exception&&e.exception.values&&e.exception.values[0]&&"SentryError"===e.exception.values[0].type||!1}catch(e){return!1}},e.prototype._isIgnoredError=function(e,t){return!(!t.ignoreErrors||!t.ignoreErrors.length)&&this._getPossibleEventMessages(e).some((function(e){return t.ignoreErrors.some((function(t){return Object(h.a)(e,t)}))}))},e.prototype._isDeniedUrl=function(e,t){if(!t.denyUrls||!t.denyUrls.length)return!1;var r=this._getEventFilterUrl(e);return!!r&&t.denyUrls.some((function(e){return Object(h.a)(r,e)}))},e.prototype._isAllowedUrl=function(e,t){if(!t.allowUrls||!t.allowUrls.length)return!0;var r=this._getEventFilterUrl(e);return!r||t.allowUrls.some((function(e){return Object(h.a)(r,e)}))},e.prototype._mergeOptions=function(e){return void 0===e&&(e={}),{allowUrls:Object(s.e)(this._options.whitelistUrls||[],this._options.allowUrls||[],e.whitelistUrls||[],e.allowUrls||[]),denyUrls:Object(s.e)(this._options.blacklistUrls||[],this._options.denyUrls||[],e.blacklistUrls||[],e.denyUrls||[]),ignoreErrors:Object(s.e)(this._options.ignoreErrors||[],e.ignoreErrors||[],f),ignoreInternal:void 0===this._options.ignoreInternal||this._options.ignoreInternal}},e.prototype._getPossibleEventMessages=function(e){if(e.message)return[e.message];if(e.exception)try{var t=e.exception.values&&e.exception.values[0]||{},r=t.type,n=void 0===r?"":r,i=t.value,a=void 0===i?"":i;return[""+a,n+": "+a]}catch(t){return l.a.error("Cannot extract message for event "+Object(d.d)(e)),[]}return[]},e.prototype._getEventFilterUrl=function(e){try{if(e.stacktrace){var t=e.stacktrace.frames;return t&&t[t.length-1].filename||null}if(e.exception){var r=e.exception.values&&e.exception.values[0].stacktrace&&e.exception.values[0].stacktrace.frames;return r&&r[r.length-1].filename||null}return null}catch(t){return l.a.error("Cannot extract url for event "+Object(d.d)(e)),null}},e.id="InboundFilters",e}();var g=r(19),m=r(42),v=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){return e.__proto__=t,e}:function(e,t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r]);return e});var y=function(e){function t(t){var r=this.constructor,n=e.call(this,t)||this;return n.message=t,n.name=r.prototype.constructor.name,v(n,r.prototype),n}return Object(s.b)(t,e),t}(Error),b=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/,_="Invalid Dsn",w=function(){function e(e){"string"==typeof e?this._fromString(e):this._fromComponents(e),this._validate()}return e.prototype.toString=function(e){void 0===e&&(e=!1);var t=this,r=t.host,n=t.path,i=t.pass,a=t.port,o=t.projectId;return t.protocol+"://"+t.user+(e&&i?":"+i:"")+"@"+r+(a?":"+a:"")+"/"+(n?n+"/":n)+o},e.prototype._fromString=function(e){var t=b.exec(e);if(!t)throw new y(_);var r=Object(s.c)(t.slice(1),6),n=r[0],i=r[1],a=r[2],o=void 0===a?"":a,c=r[3],u=r[4],l=void 0===u?"":u,d="",h=r[5],f=h.split("/");if(f.length>1&&(d=f.slice(0,-1).join("/"),h=f.pop()),h){var p=h.match(/^\d+/);p&&(h=p[0])}this._fromComponents({host:c,pass:o,path:d,projectId:h,port:l,protocol:n,user:i})},e.prototype._fromComponents=function(e){this.protocol=e.protocol,this.user=e.user,this.pass=e.pass||"",this.host=e.host,this.port=e.port||"",this.path=e.path||"",this.projectId=e.projectId},e.prototype._validate=function(){var e=this;if(["protocol","user","host","projectId"].forEach((function(t){if(!e[t])throw new y("Invalid Dsn: "+t+" missing")})),!this.projectId.match(/^\d+$/))throw new y("Invalid Dsn: Invalid projectId "+this.projectId);if("http"!==this.protocol&&"https"!==this.protocol)throw new y("Invalid Dsn: Invalid protocol "+this.protocol);if(this.port&&isNaN(parseInt(this.port,10)))throw new y("Invalid Dsn: Invalid port "+this.port)},e}(),E=r(4),S=r(18),T=r(7),k=[];function O(e){var t={};return function(e){var t=e.defaultIntegrations&&Object(s.e)(e.defaultIntegrations)||[],r=e.integrations,n=[];if(Array.isArray(r)){var i=r.map((function(e){return e.name})),a=[];t.forEach((function(e){-1===i.indexOf(e.name)&&-1===a.indexOf(e.name)&&(n.push(e),a.push(e.name))})),r.forEach((function(e){-1===a.indexOf(e.name)&&(n.push(e),a.push(e.name))}))}else"function"==typeof r?(n=r(t),n=Array.isArray(n)?n:[n]):n=Object(s.e)(t);var o=n.map((function(e){return e.name})),c="Debug";return-1!==o.indexOf(c)&&n.push.apply(n,Object(s.e)(n.splice(o.indexOf(c),1))),n}(e).forEach((function(e){t[e.name]=e,function(e){-1===k.indexOf(e.name)&&(e.setupOnce(c.b,u.c),k.push(e.name),l.a.log("Integration installed: "+e.name))}(e)})),t}var A,x=function(){function e(e,t){this._integrations={},this._processing=0,this._backend=new e(t),this._options=t,t.dsn&&(this._dsn=new w(t.dsn))}return e.prototype.captureException=function(e,t,r){var n=this,i=t&&t.event_id;return this._process(this._getBackend().eventFromException(e,t).then((function(e){return n._captureEvent(e,t,r)})).then((function(e){i=e}))),i},e.prototype.captureMessage=function(e,t,r,n){var i=this,a=r&&r.event_id,o=Object(E.i)(e)?this._getBackend().eventFromMessage(String(e),t,r):this._getBackend().eventFromException(e,r);return this._process(o.then((function(e){return i._captureEvent(e,r,n)})).then((function(e){a=e}))),a},e.prototype.captureEvent=function(e,t,r){var n=t&&t.event_id;return this._process(this._captureEvent(e,t,r).then((function(e){n=e}))),n},e.prototype.captureSession=function(e){e.release?this._sendSession(e):l.a.warn("Discarded session because of missing release")},e.prototype.getDsn=function(){return this._dsn},e.prototype.getOptions=function(){return this._options},e.prototype.flush=function(e){var t=this;return this._isClientProcessing(e).then((function(r){return t._getBackend().getTransport().close(e).then((function(e){return r&&e}))}))},e.prototype.close=function(e){var t=this;return this.flush(e).then((function(e){return t.getOptions().enabled=!1,e}))},e.prototype.setupIntegrations=function(){this._isEnabled()&&(this._integrations=O(this._options))},e.prototype.getIntegration=function(e){try{return this._integrations[e.id]||null}catch(t){return l.a.warn("Cannot retrieve integration "+e.id+" from the current Client"),null}},e.prototype._updateSessionFromEvent=function(e,t){var r,n,i,a=!1,o=!1,c=t.exception&&t.exception.values;if(c){o=!0;try{for(var u=Object(s.f)(c),l=u.next();!l.done;l=u.next()){var d=l.value.mechanism;if(d&&!1===d.handled){a=!0;break}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}var h=t.user;if(!e.userAgent){var f=t.request?t.request.headers:{};for(var p in f)if("user-agent"===p.toLowerCase()){i=f[p];break}}e.update(Object(s.a)(Object(s.a)({},a&&{status:m.a.Crashed}),{user:h,userAgent:i,errors:e.errors+Number(o||a)}))},e.prototype._sendSession=function(e){this._getBackend().sendSession(e)},e.prototype._isClientProcessing=function(e){var t=this;return new g.a((function(r){var n=0,i=setInterval((function(){0==t._processing?(clearInterval(i),r(!0)):(n+=1,e&&n>=e&&(clearInterval(i),r(!1)))}),1)}))},e.prototype._getBackend=function(){return this._backend},e.prototype._isEnabled=function(){return!1!==this.getOptions().enabled&&void 0!==this._dsn},e.prototype._prepareEvent=function(e,t,r){var n=this,i=this.getOptions().normalizeDepth,a=void 0===i?3:i,o=Object(s.a)(Object(s.a)({},e),{event_id:e.event_id||(r&&r.event_id?r.event_id:Object(d.i)()),timestamp:e.timestamp||Object(S.b)()});this._applyClientOptions(o),this._applyIntegrationsMetadata(o);var u=t;r&&r.captureContext&&(u=c.a.clone(u).update(r.captureContext));var l=g.a.resolve(o);return u&&(l=u.applyToEvent(o,r)),l.then((function(e){return"number"==typeof a&&a>0?n._normalizeEvent(e,a):e}))},e.prototype._normalizeEvent=function(e,t){if(!e)return null;var r=Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)(Object(s.a)({},e),e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map((function(e){return Object(s.a)(Object(s.a)({},e),e.data&&{data:Object(T.d)(e.data,t)})}))}),e.user&&{user:Object(T.d)(e.user,t)}),e.contexts&&{contexts:Object(T.d)(e.contexts,t)}),e.extra&&{extra:Object(T.d)(e.extra,t)});return e.contexts&&e.contexts.trace&&(r.contexts.trace=e.contexts.trace),r},e.prototype._applyClientOptions=function(e){var t=this.getOptions(),r=t.environment,n=t.release,i=t.dist,a=t.maxValueLength,o=void 0===a?250:a;"environment"in e||(e.environment="environment"in t?r:"production"),void 0===e.release&&void 0!==n&&(e.release=n),void 0===e.dist&&void 0!==i&&(e.dist=i),e.message&&(e.message=Object(h.d)(e.message,o));var s=e.exception&&e.exception.values&&e.exception.values[0];s&&s.value&&(s.value=Object(h.d)(s.value,o));var c=e.request;c&&c.url&&(c.url=Object(h.d)(c.url,o))},e.prototype._applyIntegrationsMetadata=function(e){var t=e.sdk,r=Object.keys(this._integrations);t&&r.length>0&&(t.integrations=r)},e.prototype._sendEvent=function(e){this._getBackend().sendEvent(e)},e.prototype._captureEvent=function(e,t,r){return this._processEvent(e,t,r).then((function(e){return e.event_id}),(function(e){l.a.error(e)}))},e.prototype._processEvent=function(e,t,r){var n=this,i=this.getOptions(),a=i.beforeSend,o=i.sampleRate;if(!this._isEnabled())return g.a.reject(new y("SDK not enabled, will not send event."));var s="transaction"===e.type;return!s&&"number"==typeof o&&Math.random()>o?g.a.reject(new y("Discarding event because it's not included in the random sample (sampling rate = "+o+")")):this._prepareEvent(e,r,t).then((function(e){if(null===e)throw new y("An event processor returned null, will not send event.");if(t&&t.data&&!0===t.data.__sentry__||s||!a)return e;var r=a(e,t);if(void 0===r)throw new y("`beforeSend` method has to return `null` or a valid event.");return Object(E.m)(r)?r.then((function(e){return e}),(function(e){throw new y("beforeSend rejected with "+e)})):r})).then((function(e){if(null===e)throw new y("`beforeSend` returned `null`, will not send event.");var t=r&&r.getSession&&r.getSession();return!s&&t&&n._updateSessionFromEvent(t,e),n._sendEvent(e),e})).then(null,(function(e){if(e instanceof y)throw e;throw n.captureException(e,{data:{__sentry__:!0},originalException:e}),new y("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+e)}))},e.prototype._process=function(e){var t=this;this._processing+=1,e.then((function(e){return t._processing-=1,e}),(function(e){return t._processing-=1,e}))},e}();!function(e){e.Unknown="unknown",e.Skipped="skipped",e.Success="success",e.RateLimit="rate_limit",e.Invalid="invalid",e.Failed="failed"}(A||(A={})),function(e){e.fromHttpCode=function(t){return t>=200&&t<300?e.Success:429===t?e.RateLimit:t>=400&&t<500?e.Invalid:t>=500?e.Failed:e.Unknown}}(A||(A={}));var R,C=function(){function e(){}return e.prototype.sendEvent=function(e){return g.a.resolve({reason:"NoopTransport: Event has been skipped because no Dsn is configured.",status:A.Skipped})},e.prototype.close=function(e){return g.a.resolve(!0)},e}(),L=function(){function e(e){this._options=e,this._options.dsn||l.a.warn("No DSN provided, backend will not do anything."),this._transport=this._setupTransport()}return e.prototype.eventFromException=function(e,t){throw new y("Backend has to implement `eventFromException` method")},e.prototype.eventFromMessage=function(e,t,r){throw new y("Backend has to implement `eventFromMessage` method")},e.prototype.sendEvent=function(e){this._transport.sendEvent(e).then(null,(function(e){l.a.error("Error while sending event: "+e)}))},e.prototype.sendSession=function(e){this._transport.sendSession?this._transport.sendSession(e).then(null,(function(e){l.a.error("Error while sending session: "+e)})):l.a.warn("Dropping session because custom transport doesn't implement sendSession")},e.prototype.getTransport=function(){return this._transport},e.prototype._setupTransport=function(){return new C},e}();!function(e){e.Fatal="fatal",e.Error="error",e.Warning="warning",e.Log="log",e.Info="info",e.Debug="debug",e.Critical="critical"}(R||(R={})),function(e){e.fromString=function(t){switch(t){case"debug":return e.Debug;case"info":return e.Info;case"warn":case"warning":return e.Warning;case"error":return e.Error;case"fatal":return e.Fatal;case"critical":return e.Critical;default:return e.Log}}}(R||(R={}));var I=r(25),P="?",D=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,j=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|capacitor).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,M=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,N=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,F=/\((\S*)(?::(\d+))(?::(\d+))\)/,U=/Minified React error #\d+;/i;function B(e){var t=null,r=0;e&&("number"==typeof e.framesToPop?r=e.framesToPop:U.test(e.message)&&(r=1));try{if(t=function(e){if(!e||!e.stacktrace)return null;for(var t,r=e.stacktrace,n=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,i=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\((.*)\))? in (.*):\s*$/i,a=r.split("\n"),o=[],s=0;s<a.length;s+=2){var c=null;(t=n.exec(a[s]))?c={url:t[2],func:t[3],args:[],line:+t[1],column:null}:(t=i.exec(a[s]))&&(c={url:t[6],func:t[3]||t[4],args:t[5]?t[5].split(","):[],line:+t[1],column:+t[2]}),c&&(!c.func&&c.line&&(c.func=P),o.push(c))}if(!o.length)return null;return{message:H(e),name:e.name,stack:o}}(e),t)return G(t,r)}catch(e){}try{if(t=function(e){if(!e||!e.stack)return null;for(var t,r,n,i=[],a=e.stack.split("\n"),o=0;o<a.length;++o){if(r=D.exec(a[o])){var s=r[2]&&0===r[2].indexOf("native");r[2]&&0===r[2].indexOf("eval")&&(t=F.exec(r[2]))&&(r[2]=t[1],r[3]=t[2],r[4]=t[3]),n={url:r[2]&&0===r[2].indexOf("address at ")?r[2].substr("address at ".length):r[2],func:r[1]||P,args:s?[r[2]]:[],line:r[3]?+r[3]:null,column:r[4]?+r[4]:null}}else if(r=M.exec(a[o]))n={url:r[2],func:r[1]||P,args:[],line:+r[3],column:r[4]?+r[4]:null};else{if(!(r=j.exec(a[o])))continue;r[3]&&r[3].indexOf(" > eval")>-1&&(t=N.exec(r[3]))?(r[1]=r[1]||"eval",r[3]=t[1],r[4]=t[2],r[5]=""):0!==o||r[5]||void 0===e.columnNumber||(i[0].column=e.columnNumber+1),n={url:r[3],func:r[1]||P,args:r[2]?r[2].split(","):[],line:r[4]?+r[4]:null,column:r[5]?+r[5]:null}}!n.func&&n.line&&(n.func=P),i.push(n)}if(!i.length)return null;return{message:H(e),name:e.name,stack:i}}(e),t)return G(t,r)}catch(e){}return{message:H(e),name:e&&e.name,stack:[],failed:!0}}function G(e,t){try{return Object(s.a)(Object(s.a)({},e),{stack:e.stack.slice(t)})}catch(t){return e}}function H(e){var t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:t:"No error message"}function z(e){var t=q(e.stack),r={type:e.name,value:e.message};return t&&t.length&&(r.stacktrace={frames:t}),void 0===r.type&&""===r.value&&(r.value="Unrecoverable error caught"),r}function K(e){return{exception:{values:[z(e)]}}}function q(e){if(!e||!e.length)return[];var t=e,r=t[0].func||"",n=t[t.length-1].func||"";return-1===r.indexOf("captureMessage")&&-1===r.indexOf("captureException")||(t=t.slice(1)),-1!==n.indexOf("sentryWrapped")&&(t=t.slice(0,-1)),t.slice(0,50).map((function(e){return{colno:null===e.column?void 0:e.column,filename:e.url||t[0].url,function:e.func||"?",in_app:!0,lineno:null===e.line?void 0:e.line}})).reverse()}function V(e,t,r){var n;if(void 0===r&&(r={}),Object(E.e)(e)&&e.error)return n=K(B(e=e.error));if(Object(E.a)(e)||Object(E.b)(e)){var i=e,a=i.name||(Object(E.a)(i)?"DOMError":"DOMException"),o=i.message?a+": "+i.message:a;return n=W(o,t,r),Object(d.b)(n,o),"code"in i&&(n.tags=Object(s.a)(Object(s.a)({},n.tags),{"DOMException.code":""+i.code})),n}return Object(E.d)(e)?n=K(B(e)):Object(E.h)(e)||Object(E.f)(e)?(n=function(e,t,r){var n={exception:{values:[{type:Object(E.f)(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:"Non-Error "+(r?"promise rejection":"exception")+" captured with keys: "+Object(T.b)(e)}]},extra:{__serialized__:Object(T.e)(e)}};if(t){var i=q(B(t).stack);n.stacktrace={frames:i}}return n}(e,t,r.rejection),Object(d.a)(n,{synthetic:!0}),n):(n=W(e,t,r),Object(d.b)(n,""+e,void 0),Object(d.a)(n,{synthetic:!0}),n)}function W(e,t,r){void 0===r&&(r={});var n={message:e};if(r.attachStacktrace&&t){var i=q(B(t).stack);n.stacktrace={frames:i}}return n}function Y(e,t){return{body:JSON.stringify({sent_at:(new Date).toISOString()})+"\n"+JSON.stringify({type:"session"})+"\n"+JSON.stringify(e),type:"session",url:t.getEnvelopeEndpointWithUrlEncodedAuth()}}function X(e,t){var r=e.tags||{},n=r.__sentry_samplingMethod,i=r.__sentry_sampleRate,a=Object(s.d)(r,["__sentry_samplingMethod","__sentry_sampleRate"]);e.tags=a;var o="transaction"===e.type,c={body:JSON.stringify(e),type:e.type||"event",url:o?t.getEnvelopeEndpointWithUrlEncodedAuth():t.getStoreEndpointWithUrlEncodedAuth()};if(o){var u=JSON.stringify({event_id:e.event_id,sent_at:(new Date).toISOString()})+"\n"+JSON.stringify({type:e.type,sample_rates:[{id:n,rate:i}]})+"\n"+c.body;c.body=u}return c}var $=function(){function e(e){this.dsn=e,this._dsnObject=new w(e)}return e.prototype.getDsn=function(){return this._dsnObject},e.prototype.getBaseApiEndpoint=function(){var e=this._dsnObject,t=e.protocol?e.protocol+":":"",r=e.port?":"+e.port:"";return t+"//"+e.host+r+(e.path?"/"+e.path:"")+"/api/"},e.prototype.getStoreEndpoint=function(){return this._getIngestEndpoint("store")},e.prototype.getStoreEndpointWithUrlEncodedAuth=function(){return this.getStoreEndpoint()+"?"+this._encodedAuth()},e.prototype.getEnvelopeEndpointWithUrlEncodedAuth=function(){return this._getEnvelopeEndpoint()+"?"+this._encodedAuth()},e.prototype.getStoreEndpointPath=function(){var e=this._dsnObject;return(e.path?"/"+e.path:"")+"/api/"+e.projectId+"/store/"},e.prototype.getRequestHeaders=function(e,t){var r=this._dsnObject,n=["Sentry sentry_version=7"];return n.push("sentry_client="+e+"/"+t),n.push("sentry_key="+r.user),r.pass&&n.push("sentry_secret="+r.pass),{"Content-Type":"application/json","X-Sentry-Auth":n.join(", ")}},e.prototype.getReportDialogEndpoint=function(e){void 0===e&&(e={});var t=this._dsnObject,r=this.getBaseApiEndpoint()+"embed/error-page/",n=[];for(var i in n.push("dsn="+t.toString()),e)if("dsn"!==i)if("user"===i){if(!e.user)continue;e.user.name&&n.push("name="+encodeURIComponent(e.user.name)),e.user.email&&n.push("email="+encodeURIComponent(e.user.email))}else n.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return n.length?r+"?"+n.join("&"):r},e.prototype._getEnvelopeEndpoint=function(){return this._getIngestEndpoint("envelope")},e.prototype._getIngestEndpoint=function(e){return""+this.getBaseApiEndpoint()+this._dsnObject.projectId+"/"+e+"/"},e.prototype._encodedAuth=function(){var e={sentry_key:this._dsnObject.user,sentry_version:"7"};return Object(T.f)(e)},e}(),J=function(){function e(e){this._limit=e,this._buffer=[]}return e.prototype.isReady=function(){return void 0===this._limit||this.length()<this._limit},e.prototype.add=function(e){var t=this;return this.isReady()?(-1===this._buffer.indexOf(e)&&this._buffer.push(e),e.then((function(){return t.remove(e)})).then(null,(function(){return t.remove(e).then(null,(function(){}))})),e):g.a.reject(new y("Not adding Promise due to buffer limit reached."))},e.prototype.remove=function(e){return this._buffer.splice(this._buffer.indexOf(e),1)[0]},e.prototype.length=function(){return this._buffer.length},e.prototype.drain=function(e){var t=this;return new g.a((function(r){var n=setTimeout((function(){e&&e>0&&r(!1)}),e);g.a.all(t._buffer).then((function(){clearTimeout(n),r(!0)})).then(null,(function(){r(!0)}))}))},e}(),Q=function(){function e(e){this.options=e,this._buffer=new J(30),this._rateLimits={},this._api=new $(this.options.dsn),this.url=this._api.getStoreEndpointWithUrlEncodedAuth()}return e.prototype.sendEvent=function(e){throw new y("Transport Class has to implement `sendEvent` method")},e.prototype.close=function(e){return this._buffer.drain(e)},e.prototype._handleResponse=function(e){var t=e.requestType,r=e.response,n=e.headers,i=e.resolve,a=e.reject,o=A.fromHttpCode(r.status);this._handleRateLimit(n)&&l.a.warn("Too many requests, backing off until: "+this._disabledUntil(t)),o!==A.Success?a(r):i({status:o})},e.prototype._disabledUntil=function(e){return this._rateLimits[e]||this._rateLimits.all},e.prototype._isRateLimited=function(e){return this._disabledUntil(e)>new Date(Date.now())},e.prototype._handleRateLimit=function(e){var t,r,n,i,a=Date.now(),o=e["x-sentry-rate-limits"],c=e["retry-after"];if(o){try{for(var u=Object(s.f)(o.trim().split(",")),l=u.next();!l.done;l=u.next()){var h=l.value.split(":",2),f=parseInt(h[0],10),p=1e3*(isNaN(f)?60:f);try{for(var g=(n=void 0,Object(s.f)(h[1].split(";"))),m=g.next();!m.done;m=g.next()){var v=m.value;this._rateLimits[v||"all"]=new Date(a+p)}}catch(e){n={error:e}}finally{try{m&&!m.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return!0}return!!c&&(this._rateLimits.all=new Date(a+Object(d.g)(a,c)),!0)},e}(),Z=Object(d.e)(),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.b)(t,e),t.prototype.sendEvent=function(e){return this._sendRequest(X(e,this._api),e)},t.prototype.sendSession=function(e){return this._sendRequest(Y(e,this._api),e)},t.prototype._sendRequest=function(e,t){var r=this;if(this._isRateLimited(e.type))return Promise.reject({event:t,type:e.type,reason:"Transport locked till "+this._disabledUntil(e.type)+" due to too many requests.",status:429});var n={body:e.body,method:"POST",referrerPolicy:Object(I.d)()?"origin":""};return void 0!==this.options.fetchParameters&&Object.assign(n,this.options.fetchParameters),void 0!==this.options.headers&&(n.headers=this.options.headers),this._buffer.add(new g.a((function(t,i){Z.fetch(e.url,n).then((function(n){var a={"x-sentry-rate-limits":n.headers.get("X-Sentry-Rate-Limits"),"retry-after":n.headers.get("Retry-After")};r._handleResponse({requestType:e.type,response:n,headers:a,resolve:t,reject:i})})).catch(i)})))},t}(Q),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.b)(t,e),t.prototype.sendEvent=function(e){return this._sendRequest(X(e,this._api),e)},t.prototype.sendSession=function(e){return this._sendRequest(Y(e,this._api),e)},t.prototype._sendRequest=function(e,t){var r=this;return this._isRateLimited(e.type)?Promise.reject({event:t,type:e.type,reason:"Transport locked till "+this._disabledUntil(e.type)+" due to too many requests.",status:429}):this._buffer.add(new g.a((function(t,n){var i=new XMLHttpRequest;for(var a in i.onreadystatechange=function(){if(4===i.readyState){var a={"x-sentry-rate-limits":i.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":i.getResponseHeader("Retry-After")};r._handleResponse({requestType:e.type,response:i,headers:a,resolve:t,reject:n})}},i.open("POST",e.url),r.options.headers)r.options.headers.hasOwnProperty(a)&&i.setRequestHeader(a,r.options.headers[a]);i.send(e.body)})))},t}(Q),re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.b)(t,e),t.prototype.eventFromException=function(e,t){return function(e,t,r){var n=V(t,r&&r.syntheticException||void 0,{attachStacktrace:e.attachStacktrace});return Object(d.a)(n,{handled:!0,type:"generic"}),n.level=R.Error,r&&r.event_id&&(n.event_id=r.event_id),g.a.resolve(n)}(this._options,e,t)},t.prototype.eventFromMessage=function(e,t,r){return void 0===t&&(t=R.Info),function(e,t,r,n){void 0===r&&(r=R.Info);var i=W(t,n&&n.syntheticException||void 0,{attachStacktrace:e.attachStacktrace});return i.level=r,n&&n.event_id&&(i.event_id=n.event_id),g.a.resolve(i)}(this._options,e,t,r)},t.prototype._setupTransport=function(){if(!this._options.dsn)return e.prototype._setupTransport.call(this);var t=Object(s.a)(Object(s.a)({},this._options.transportOptions),{dsn:this._options.dsn});return this._options.transport?new this._options.transport(t):Object(I.a)()?new ee(t):new te(t)},t}(L);function ne(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=Object(u.c)();if(n&&n[e])return n[e].apply(n,Object(s.e)(t));throw new Error("No hub defined or "+e+" was not found on the hub, please open a bug report.")}function ie(e,t){var r;try{throw new Error("Sentry syntheticException")}catch(e){r=e}return ne("captureException",e,{captureContext:t,originalException:e,syntheticException:r})}function ae(e){ne("withScope",e)}var oe=0;function se(){return oe>0}function ce(){oe+=1,setTimeout((function(){oe-=1}))}function ue(e,t,r){if(void 0===t&&(t={}),"function"!=typeof e)return e;try{if(e.__sentry__)return e;if(e.__sentry_wrapped__)return e.__sentry_wrapped__}catch(t){return e}var n=function(){var n=Array.prototype.slice.call(arguments);try{r&&"function"==typeof r&&r.apply(this,arguments);var i=n.map((function(e){return ue(e,t)}));return e.handleEvent?e.handleEvent.apply(this,i):e.apply(this,i)}catch(e){throw ce(),ae((function(r){r.addEventProcessor((function(e){var r=Object(s.a)({},e);return t.mechanism&&(Object(d.b)(r,void 0,void 0),Object(d.a)(r,t.mechanism)),r.extra=Object(s.a)(Object(s.a)({},r.extra),{arguments:n}),r})),ie(e)})),e}};try{for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}catch(e){}e.prototype=e.prototype||{},n.prototype=e.prototype,Object.defineProperty(e,"__sentry_wrapped__",{enumerable:!1,value:n}),Object.defineProperties(n,{__sentry__:{enumerable:!1,value:!0},__sentry_original__:{enumerable:!1,value:e}});try{Object.getOwnPropertyDescriptor(n,"name").configurable&&Object.defineProperty(n,"name",{get:function(){return e.name}})}catch(e){}return n}function le(e){if(void 0===e&&(e={}),e.eventId)if(e.dsn){var t=document.createElement("script");t.async=!0,t.src=new $(e.dsn).getReportDialogEndpoint(e),e.onLoad&&(t.onload=e.onLoad),(document.head||document.body).appendChild(t)}else l.a.error("Missing dsn option in showReportDialog call");else l.a.error("Missing eventId option in showReportDialog call")}var de=r(34),he=r(24),fe=function(){function e(t){this.name=e.id,this._options=Object(s.a)({console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0},t)}return e.prototype.addSentryBreadcrumb=function(e){this._options.sentry&&Object(u.c)().addBreadcrumb({category:"sentry."+("transaction"===e.type?"transaction":"event"),event_id:e.event_id,level:e.level,message:Object(d.d)(e)},{event:e})},e.prototype.setupOnce=function(){var e=this;this._options.console&&Object(de.a)({callback:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e._consoleBreadcrumb.apply(e,Object(s.e)(t))},type:"console"}),this._options.dom&&Object(de.a)({callback:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e._domBreadcrumb.apply(e,Object(s.e)(t))},type:"dom"}),this._options.xhr&&Object(de.a)({callback:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e._xhrBreadcrumb.apply(e,Object(s.e)(t))},type:"xhr"}),this._options.fetch&&Object(de.a)({callback:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e._fetchBreadcrumb.apply(e,Object(s.e)(t))},type:"fetch"}),this._options.history&&Object(de.a)({callback:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e._historyBreadcrumb.apply(e,Object(s.e)(t))},type:"history"})},e.prototype._consoleBreadcrumb=function(e){var t={category:"console",data:{arguments:e.args,logger:"console"},level:R.fromString(e.level),message:Object(h.b)(e.args," ")};if("assert"===e.level){if(!1!==e.args[0])return;t.message="Assertion failed: "+(Object(h.b)(e.args.slice(1)," ")||"console.assert"),t.data.arguments=e.args.slice(1)}Object(u.c)().addBreadcrumb(t,{input:e.args,level:e.level})},e.prototype._domBreadcrumb=function(e){var t;try{t=e.event.target?Object(he.a)(e.event.target):Object(he.a)(e.event)}catch(e){t="<unknown>"}0!==t.length&&Object(u.c)().addBreadcrumb({category:"ui."+e.name,message:t},{event:e.event,name:e.name})},e.prototype._xhrBreadcrumb=function(e){if(e.endTimestamp){if(e.xhr.__sentry_own_request__)return;var t=e.xhr.__sentry_xhr__||{},r=t.method,n=t.url,i=t.status_code,a=t.body;Object(u.c)().addBreadcrumb({category:"xhr",data:{method:r,url:n,status_code:i},type:"http"},{xhr:e.xhr,input:a})}else;},e.prototype._fetchBreadcrumb=function(e){e.endTimestamp&&(e.fetchData.url.match(/sentry_key/)&&"POST"===e.fetchData.method||(e.error?Object(u.c)().addBreadcrumb({category:"fetch",data:e.fetchData,level:R.Error,type:"http"},{data:e.error,input:e.args}):Object(u.c)().addBreadcrumb({category:"fetch",data:Object(s.a)(Object(s.a)({},e.fetchData),{status_code:e.response.status}),type:"http"},{input:e.args,response:e.response})))},e.prototype._historyBreadcrumb=function(e){var t=Object(d.e)(),r=e.from,n=e.to,i=Object(d.h)(t.location.href),a=Object(d.h)(r),o=Object(d.h)(n);a.path||(a=i),i.protocol===o.protocol&&i.host===o.host&&(n=o.relative),i.protocol===a.protocol&&i.host===a.host&&(r=a.relative),Object(u.c)().addBreadcrumb({category:"navigation",data:{from:r,to:n}})},e.id="Breadcrumbs",e}(),pe="5.30.0",ge=function(e){function t(t){return void 0===t&&(t={}),e.call(this,re,t)||this}return Object(s.b)(t,e),t.prototype.showReportDialog=function(e){void 0===e&&(e={}),Object(d.e)().document&&(this._isEnabled()?le(Object(s.a)(Object(s.a)({},e),{dsn:e.dsn||this.getDsn()})):l.a.error("Trying to call showReportDialog with Sentry Client disabled"))},t.prototype._prepareEvent=function(t,r,n){return t.platform=t.platform||"javascript",t.sdk=Object(s.a)(Object(s.a)({},t.sdk),{name:"sentry.javascript.browser",packages:Object(s.e)(t.sdk&&t.sdk.packages||[],[{name:"npm:@sentry/browser",version:pe}]),version:pe}),e.prototype._prepareEvent.call(this,t,r,n)},t.prototype._sendEvent=function(t){var r=this.getIntegration(fe);r&&r.addSentryBreadcrumb(t),e.prototype._sendEvent.call(this,t)},t}(x),me=r(21),ve=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],ye=function(){function e(t){this.name=e.id,this._options=Object(s.a)({XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0},t)}return e.prototype.setupOnce=function(){var e=Object(d.e)();(this._options.setTimeout&&Object(T.c)(e,"setTimeout",this._wrapTimeFunction.bind(this)),this._options.setInterval&&Object(T.c)(e,"setInterval",this._wrapTimeFunction.bind(this)),this._options.requestAnimationFrame&&Object(T.c)(e,"requestAnimationFrame",this._wrapRAF.bind(this)),this._options.XMLHttpRequest&&"XMLHttpRequest"in e&&Object(T.c)(XMLHttpRequest.prototype,"send",this._wrapXHR.bind(this)),this._options.eventTarget)&&(Array.isArray(this._options.eventTarget)?this._options.eventTarget:ve).forEach(this._wrapEventTarget.bind(this))},e.prototype._wrapTimeFunction=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=t[0];return t[0]=ue(n,{mechanism:{data:{function:Object(me.a)(e)},handled:!0,type:"instrument"}}),e.apply(this,t)}},e.prototype._wrapRAF=function(e){return function(t){return e.call(this,ue(t,{mechanism:{data:{function:"requestAnimationFrame",handler:Object(me.a)(e)},handled:!0,type:"instrument"}}))}},e.prototype._wrapEventTarget=function(e){var t=Object(d.e)(),r=t[e]&&t[e].prototype;r&&r.hasOwnProperty&&r.hasOwnProperty("addEventListener")&&(Object(T.c)(r,"addEventListener",(function(t){return function(r,n,i){try{"function"==typeof n.handleEvent&&(n.handleEvent=ue(n.handleEvent.bind(n),{mechanism:{data:{function:"handleEvent",handler:Object(me.a)(n),target:e},handled:!0,type:"instrument"}}))}catch(e){}return t.call(this,r,ue(n,{mechanism:{data:{function:"addEventListener",handler:Object(me.a)(n),target:e},handled:!0,type:"instrument"}}),i)}})),Object(T.c)(r,"removeEventListener",(function(e){return function(t,r,n){var i,a=r;try{var o=null===(i=a)||void 0===i?void 0:i.__sentry_wrapped__;o&&e.call(this,t,o,n)}catch(e){}return e.call(this,t,a,n)}})))},e.prototype._wrapXHR=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this,i=["onload","onerror","onprogress","onreadystatechange"];return i.forEach((function(e){e in n&&"function"==typeof n[e]&&Object(T.c)(n,e,(function(t){var r={mechanism:{data:{function:e,handler:Object(me.a)(t)},handled:!0,type:"instrument"}};return t.__sentry_original__&&(r.mechanism.data.handler=Object(me.a)(t.__sentry_original__)),ue(t,r)}))})),e.apply(this,t)}},e.id="TryCatch",e}(),be=function(){function e(t){this.name=e.id,this._onErrorHandlerInstalled=!1,this._onUnhandledRejectionHandlerInstalled=!1,this._options=Object(s.a)({onerror:!0,onunhandledrejection:!0},t)}return e.prototype.setupOnce=function(){Error.stackTraceLimit=50,this._options.onerror&&(l.a.log("Global Handler attached: onerror"),this._installGlobalOnErrorHandler()),this._options.onunhandledrejection&&(l.a.log("Global Handler attached: onunhandledrejection"),this._installGlobalOnUnhandledRejectionHandler())},e.prototype._installGlobalOnErrorHandler=function(){var t=this;this._onErrorHandlerInstalled||(Object(de.a)({callback:function(r){var n=r.error,i=Object(u.c)(),a=i.getIntegration(e),o=n&&!0===n.__sentry_own_request__;if(a&&!se()&&!o){var s=i.getClient(),c=Object(E.i)(n)?t._eventFromIncompleteOnError(r.msg,r.url,r.line,r.column):t._enhanceEventWithInitialFrame(V(n,void 0,{attachStacktrace:s&&s.getOptions().attachStacktrace,rejection:!1}),r.url,r.line,r.column);Object(d.a)(c,{handled:!1,type:"onerror"}),i.captureEvent(c,{originalException:n})}},type:"error"}),this._onErrorHandlerInstalled=!0)},e.prototype._installGlobalOnUnhandledRejectionHandler=function(){var t=this;this._onUnhandledRejectionHandlerInstalled||(Object(de.a)({callback:function(r){var n=r;try{"reason"in r?n=r.reason:"detail"in r&&"reason"in r.detail&&(n=r.detail.reason)}catch(e){}var i=Object(u.c)(),a=i.getIntegration(e),o=n&&!0===n.__sentry_own_request__;if(!a||se()||o)return!0;var s=i.getClient(),c=Object(E.i)(n)?t._eventFromRejectionWithPrimitive(n):V(n,void 0,{attachStacktrace:s&&s.getOptions().attachStacktrace,rejection:!0});c.level=R.Error,Object(d.a)(c,{handled:!1,type:"onunhandledrejection"}),i.captureEvent(c,{originalException:n})},type:"unhandledrejection"}),this._onUnhandledRejectionHandlerInstalled=!0)},e.prototype._eventFromIncompleteOnError=function(e,t,r,n){var i,a=Object(E.e)(e)?e.message:e;if(Object(E.k)(a)){var o=a.match(/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i);o&&(i=o[1],a=o[2])}var s={exception:{values:[{type:i||"Error",value:a}]}};return this._enhanceEventWithInitialFrame(s,t,r,n)},e.prototype._eventFromRejectionWithPrimitive=function(e){return{exception:{values:[{type:"UnhandledRejection",value:"Non-Error promise rejection captured with value: "+String(e)}]}}},e.prototype._enhanceEventWithInitialFrame=function(e,t,r,n){e.exception=e.exception||{},e.exception.values=e.exception.values||[],e.exception.values[0]=e.exception.values[0]||{},e.exception.values[0].stacktrace=e.exception.values[0].stacktrace||{},e.exception.values[0].stacktrace.frames=e.exception.values[0].stacktrace.frames||[];var i=isNaN(parseInt(n,10))?void 0:n,a=isNaN(parseInt(r,10))?void 0:r,o=Object(E.k)(t)&&t.length>0?t:Object(d.f)();return 0===e.exception.values[0].stacktrace.frames.length&&e.exception.values[0].stacktrace.frames.push({colno:i,filename:o,function:"?",in_app:!0,lineno:a}),e},e.id="GlobalHandlers",e}(),_e=function(){function e(t){void 0===t&&(t={}),this.name=e.id,this._key=t.key||"cause",this._limit=t.limit||5}return e.prototype.setupOnce=function(){Object(c.b)((function(t,r){var n=Object(u.c)().getIntegration(e);return n?n._handler(t,r):t}))},e.prototype._handler=function(e,t){if(!(e.exception&&e.exception.values&&t&&Object(E.g)(t.originalException,Error)))return e;var r=this._walkErrorTree(t.originalException,this._key);return e.exception.values=Object(s.e)(r,e.exception.values),e},e.prototype._walkErrorTree=function(e,t,r){if(void 0===r&&(r=[]),!Object(E.g)(e[t],Error)||r.length+1>=this._limit)return r;var n=z(B(e[t]));return this._walkErrorTree(e[t],t,Object(s.e)([n],r))},e.id="LinkedErrors",e}(),we=Object(d.e)(),Ee=function(){function e(){this.name=e.id}return e.prototype.setupOnce=function(){Object(c.b)((function(t){var r,n,i;if(Object(u.c)().getIntegration(e)){if(!we.navigator&&!we.location&&!we.document)return t;var a=(null===(r=t.request)||void 0===r?void 0:r.url)||(null===(n=we.location)||void 0===n?void 0:n.href),o=(we.document||{}).referrer,c=(we.navigator||{}).userAgent,l=Object(s.a)(Object(s.a)(Object(s.a)({},null===(i=t.request)||void 0===i?void 0:i.headers),o&&{Referer:o}),c&&{"User-Agent":c}),d=Object(s.a)(Object(s.a)({},a&&{url:a}),{headers:l});return Object(s.a)(Object(s.a)({},t),{request:d})}return t}))},e.id="UserAgent",e}(),Se=[new n.InboundFilters,new n.FunctionToString,new ye,new fe,new be,new _e,new Ee];function Te(e){if(void 0===e&&(e={}),void 0===e.defaultIntegrations&&(e.defaultIntegrations=Se),void 0===e.release){var t=Object(d.e)();t.SENTRY_RELEASE&&t.SENTRY_RELEASE.id&&(e.release=t.SENTRY_RELEASE.id)}void 0===e.autoSessionTracking&&(e.autoSessionTracking=!1),function(e,t){!0===t.debug&&l.a.enable();var r=Object(u.c)(),n=new e(t);r.bindClient(n)}(ge,e),e.autoSessionTracking&&function(){var e=Object(d.e)(),t=Object(u.c)(),r="complete"===document.readyState,n=!1,i=function(){n&&r&&t.endSession()},a=function(){r=!0,i(),e.removeEventListener("load",a)};t.startSession(),r||e.addEventListener("load",a);try{var o=new PerformanceObserver((function(e,t){e.getEntries().forEach((function(e){"first-contentful-paint"===e.name&&e.startTime<s&&(t.disconnect(),n=!0,i())}))})),s="hidden"===document.visibilityState?0:1/0;document.addEventListener("visibilitychange",(function(e){s=Math.min(s,e.timeStamp)}),{once:!0}),o.observe({type:"paint",buffered:!0})}catch(e){n=!0,i()}}()}var ke=r(30),Oe=r.n(ke),Ae=r(6),xe=r.n(Ae),Re=r(31),Ce=r(12),Le=r(16),Ie=r(8),Pe=r(2),De=Object(d.e)();var je,Me,Ne=function(e,t,r,n){var i;return function(){r&&t.isFinal&&r.disconnect(),t.value>=0&&(n||t.isFinal||"hidden"===document.visibilityState)&&(t.delta=t.value-(i||0),(t.delta||t.isFinal||void 0===i)&&(e(t),i=t.value))}},Fe=function(e,t){return void 0===t&&(t=-1),{name:e,value:t,delta:0,entries:[],id:Date.now()+"-"+(Math.floor(8999999999999*Math.random())+1e12),isFinal:!1}},Ue=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return r.observe({type:e,buffered:!0}),r}}catch(e){}},Be=!1,Ge=!1,He=function(e){Be=!e.persisted},ze=function(e,t){void 0===t&&(t=!1),Ge||(addEventListener("pagehide",He),addEventListener("beforeunload",(function(){})),Ge=!0),addEventListener("visibilitychange",(function(t){var r=t.timeStamp;"hidden"===document.visibilityState&&e({timeStamp:r,isUnloading:Be})}),{capture:!0,once:t})},Ke=function(){return void 0===je&&(je="hidden"===document.visibilityState?0:1/0,ze((function(e){var t=e.timeStamp;return je=t}),!0)),{get timeStamp(){return je}}},qe=function(e,t){void 0===t&&(t=!1);var r,n=Fe("LCP"),i=Ke(),a=function(e){var t=e.startTime;t<i.timeStamp?(n.value=t,n.entries.push(e)):n.isFinal=!0,r()},o=Ue("largest-contentful-paint",a);if(o){r=Ne(e,n,o,t);var s=function(){n.isFinal||(o.takeRecords().map(a),n.isFinal=!0,r())};(Me||(Me=new Promise((function(e){return["scroll","keydown","pointerdown"].map((function(t){addEventListener(t,e,{once:!0,passive:!0,capture:!0})}))}))),Me).then(s),ze(s,!0)}},Ve=Object(d.e)(),We=function(e){var t,r=Fe("TTFB");t=function(){try{var t=Ve.performance.getEntriesByType("navigation")[0]||function(){var e=Ve.performance.timing,t={entryType:"navigation",startTime:0};for(var r in e)"navigationStart"!==r&&"toJSON"!==r&&(t[r]=Math.max(e[r]-e.navigationStart,0));return t}();r.value=r.delta=t.responseStart,r.entries=[t],e(r)}catch(e){}},"complete"===document.readyState?setTimeout(t,0):addEventListener("pageshow",t)},Ye=Object(d.e)(),Xe=function(){function e(){this._measurements={},this._performanceCursor=0,Ye&&Ye.performance&&(Ye.performance.mark&&Ye.performance.mark("sentry-tracing-init"),this._trackCLS(),this._trackLCP(),this._trackFID(),this._trackTTFB())}return e.prototype.addPerformanceEntries=function(e){var t=this;if(Ye&&Ye.performance&&Ye.performance.getEntries&&S.a){l.a.log("[Tracing] Adding & adjusting spans using Performance API");var r,n,i,a=Object(Pe.d)(S.a);if(Ye.document)for(var o=0;o<document.scripts.length;o++)if("true"===document.scripts[o].dataset.entry){r=document.scripts[o].src;break}if(Ye.performance.getEntries().slice(this._performanceCursor).forEach((function(o){var s=Object(Pe.d)(o.startTime),c=Object(Pe.d)(o.duration);if(!("navigation"===e.op&&a+s<e.startTimestamp))switch(o.entryType){case"navigation":!function(e,t,r){$e(e,t,"unloadEvent",r),$e(e,t,"redirect",r),$e(e,t,"domContentLoadedEvent",r),$e(e,t,"loadEvent",r),$e(e,t,"connect",r),$e(e,t,"secureConnection",r,"connectEnd"),$e(e,t,"fetch",r,"domainLookupStart"),$e(e,t,"domainLookup",r),function(e,t,r){Je(e,{op:"browser",description:"request",startTimestamp:r+Object(Pe.d)(t.requestStart),endTimestamp:r+Object(Pe.d)(t.responseEnd)}),Je(e,{op:"browser",description:"response",startTimestamp:r+Object(Pe.d)(t.responseStart),endTimestamp:r+Object(Pe.d)(t.responseEnd)})}(e,t,r)}(e,o,a);break;case"mark":case"paint":case"measure":var u=function(e,t,r,n,i){var a=i+r,o=a+n;return Je(e,{description:t.name,endTimestamp:o,op:t.entryType,startTimestamp:a}),a}(e,o,s,c,a);void 0===i&&"sentry-tracing-init"===o.name&&(i=u);var d=Ke(),h=o.startTime<d.timeStamp;"first-paint"===o.name&&h&&(l.a.log("[Measurements] Adding FP"),t._measurements.fp={value:o.startTime},t._measurements["mark.fp"]={value:u}),"first-contentful-paint"===o.name&&h&&(l.a.log("[Measurements] Adding FCP"),t._measurements.fcp={value:o.startTime},t._measurements["mark.fcp"]={value:u});break;case"resource":var f=o.name.replace(window.location.origin,""),p=function(e,t,r,n,i,a){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;var o={};"transferSize"in t&&(o["Transfer Size"]=t.transferSize);"encodedBodySize"in t&&(o["Encoded Body Size"]=t.encodedBodySize);"decodedBodySize"in t&&(o["Decoded Body Size"]=t.decodedBodySize);var s=a+n,c=s+i;return Je(e,{description:r,endTimestamp:c,op:t.initiatorType?"resource."+t.initiatorType:"resource",startTimestamp:s,data:o}),c}(e,o,f,s,c,a);void 0===n&&(r||"").indexOf(f)>-1&&(n=p)}})),void 0!==n&&void 0!==i&&Je(e,{description:"evaluation",endTimestamp:i,op:"script",startTimestamp:n}),this._performanceCursor=Math.max(performance.getEntries().length-1,0),this._trackNavigator(e),"pageload"===e.op){var s=Object(Pe.d)(S.a);["fcp","fp","lcp","ttfb"].forEach((function(r){if(t._measurements[r]&&!(s>=e.startTimestamp)){var n=t._measurements[r].value,i=s+Object(Pe.d)(n),a=Math.abs(1e3*(i-e.startTimestamp)),o=a-n;l.a.log("[Measurements] Normalized "+r+" from "+n+" to "+a+" ("+o+")"),t._measurements[r].value=a}})),this._measurements["mark.fid"]&&this._measurements.fid&&Je(e,{description:"first input delay",endTimestamp:this._measurements["mark.fid"].value+Object(Pe.d)(this._measurements.fid.value),op:"web.vitals",startTimestamp:this._measurements["mark.fid"].value}),e.setMeasurements(this._measurements)}}},e.prototype._trackCLS=function(){var e=this;!function(e,t){void 0===t&&(t=!1);var r,n=Fe("CLS",0),i=function(e){e.hadRecentInput||(n.value+=e.value,n.entries.push(e),r())},a=Ue("layout-shift",i);a&&(r=Ne(e,n,a,t),ze((function(e){var t=e.isUnloading;a.takeRecords().map(i),t&&(n.isFinal=!0),r()})))}((function(t){t.entries.pop()&&(l.a.log("[Measurements] Adding CLS"),e._measurements.cls={value:t.value})}))},e.prototype._trackNavigator=function(e){var t=Ye.navigator;if(t){var r=t.connection;r&&(r.effectiveType&&e.setTag("effectiveConnectionType",r.effectiveType),r.type&&e.setTag("connectionType",r.type),Qe(r.rtt)&&(this._measurements["connection.rtt"]={value:r.rtt}),Qe(r.downlink)&&(this._measurements["connection.downlink"]={value:r.downlink})),Qe(t.deviceMemory)&&e.setTag("deviceMemory",String(t.deviceMemory)),Qe(t.hardwareConcurrency)&&e.setTag("hardwareConcurrency",String(t.hardwareConcurrency))}},e.prototype._trackLCP=function(){var e=this;qe((function(t){var r=t.entries.pop();if(r){var n=Object(Pe.d)(performance.timeOrigin),i=Object(Pe.d)(r.startTime);l.a.log("[Measurements] Adding LCP"),e._measurements.lcp={value:t.value},e._measurements["mark.lcp"]={value:n+i}}}))},e.prototype._trackFID=function(){var e,t,r,n,i,a,o=this;e=function(e){var t=e.entries.pop();if(t){var r=Object(Pe.d)(performance.timeOrigin),n=Object(Pe.d)(t.startTime);l.a.log("[Measurements] Adding FID"),o._measurements.fid={value:e.value},o._measurements["mark.fid"]={value:r+n}}},t=Fe("FID"),r=Ke(),i=Ue("first-input",n=function(e){e.startTime<r.timeStamp&&(t.value=e.processingStart-e.startTime,t.entries.push(e),t.isFinal=!0,a())}),a=Ne(e,t,i),i?ze((function(){i.takeRecords().map(n),i.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(e,n){n.timeStamp<r.timeStamp&&(t.value=e,t.isFinal=!0,t.entries=[{entryType:"first-input",name:n.type,target:n.target,cancelable:n.cancelable,startTime:n.timeStamp,processingStart:n.timeStamp+e}],a())}))},e.prototype._trackTTFB=function(){var e=this;We((function(t){var r,n=t.entries.pop();if(n){l.a.log("[Measurements] Adding TTFB"),e._measurements.ttfb={value:t.value};var i=t.value-(r=t.entries[0],null!=r?r:n).requestStart;e._measurements["ttfb.requestTime"]={value:i}}}))},e}();function $e(e,t,r,n,i){var a=i?t[i]:t[r+"End"],o=t[r+"Start"];o&&a&&Je(e,{op:"browser",description:r,startTimestamp:n+Object(Pe.d)(o),endTimestamp:n+Object(Pe.d)(a)})}function Je(e,t){var r=t.startTimestamp,n=Object(s.d)(t,["startTimestamp"]);return r&&e.startTimestamp>r&&(e.startTimestamp=r),e.startChild(Object(s.a)({startTimestamp:r},n))}function Qe(e){return"number"==typeof e&&isFinite(e)}var Ze={traceFetch:!0,traceXHR:!0,tracingOrigins:["localhost",/^\//]};function et(e){var t=Object(s.a)(Object(s.a)({},Ze),e),r=t.traceFetch,n=t.traceXHR,i=t.tracingOrigins,a=t.shouldCreateSpanForRequest,o={},c=function(e){if(o[e])return o[e];var t=i;return o[e]=t.some((function(t){return Object(h.a)(e,t)}))&&!Object(h.a)(e,"sentry_key"),o[e]},l=c;"function"==typeof a&&(l=function(e){return c(e)&&a(e)});var d={};r&&Object(de.a)({callback:function(e){!function(e,t,r){var n,i=null===(n=Object(u.c)().getClient())||void 0===n?void 0:n.getOptions();if(!(i&&Object(Pe.c)(i)&&e.fetchData&&t(e.fetchData.url)))return;if(e.endTimestamp&&e.fetchData.__span){if(c=r[e.fetchData.__span]){var a=e.response;a&&c.setHttpStatus(a.status),c.finish(),delete r[e.fetchData.__span]}return}var o=Object(Pe.b)();if(o){var c=o.startChild({data:Object(s.a)(Object(s.a)({},e.fetchData),{type:"fetch"}),description:e.fetchData.method+" "+e.fetchData.url,op:"http"});e.fetchData.__span=c.spanId,r[c.spanId]=c;var l=e.args[0]=e.args[0],d=e.args[1]=e.args[1]||{},h=d.headers;Object(E.g)(l,Request)&&(h=l.headers),h?"function"==typeof h.append?h.append("sentry-trace",c.toTraceparent()):h=Array.isArray(h)?Object(s.e)(h,[["sentry-trace",c.toTraceparent()]]):Object(s.a)(Object(s.a)({},h),{"sentry-trace":c.toTraceparent()}):h={"sentry-trace":c.toTraceparent()},d.headers=h}}(e,l,d)},type:"fetch"}),n&&Object(de.a)({callback:function(e){!function(e,t,r){var n,i=null===(n=Object(u.c)().getClient())||void 0===n?void 0:n.getOptions();if(!i||!Object(Pe.c)(i)||!(e.xhr&&e.xhr.__sentry_xhr__&&t(e.xhr.__sentry_xhr__.url))||e.xhr.__sentry_own_request__)return;var a=e.xhr.__sentry_xhr__;if(e.endTimestamp&&e.xhr.__sentry_xhr_span_id__){return void((c=r[e.xhr.__sentry_xhr_span_id__])&&(c.setHttpStatus(a.status_code),c.finish(),delete r[e.xhr.__sentry_xhr_span_id__]))}var o=Object(Pe.b)();if(o){var c=o.startChild({data:Object(s.a)(Object(s.a)({},a.data),{type:"xhr",method:a.method,url:a.url}),description:a.method+" "+a.url,op:"http"});if(e.xhr.__sentry_xhr_span_id__=c.spanId,r[e.xhr.__sentry_xhr_span_id__]=c,e.xhr.setRequestHeader)try{e.xhr.setRequestHeader("sentry-trace",c.toTraceparent())}catch(e){}}}(e,l,d)},type:"xhr"})}var tt=Object(d.e)();var rt=Object(s.a)({idleTimeout:Le.a,markBackgroundTransactions:!0,maxTransactionDuration:600,routingInstrumentation:function(e,t,r){if(void 0===t&&(t=!0),void 0===r&&(r=!0),tt&&tt.location){var n,i=tt.location.href;t&&(n=e({name:tt.location.pathname,op:"pageload"})),r&&Object(de.a)({callback:function(t){var r=t.to,a=t.from;void 0===a&&i&&-1!==i.indexOf(r)?i=void 0:a!==r&&(i=void 0,n&&(l.a.log("[Tracing] Finishing current transaction with op: "+n.op),n.finish()),n=e({name:tt.location.pathname,op:"navigation"}))},type:"history"})}else l.a.warn("Could not initialize routing instrumentation due to invalid location")},startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0},Ze),nt=function(){function e(t){this.name=e.id,this._metrics=new Xe,this._emitOptionsWarning=!1;var r=Ze.tracingOrigins;t&&t.tracingOrigins&&Array.isArray(t.tracingOrigins)&&0!==t.tracingOrigins.length?r=t.tracingOrigins:this._emitOptionsWarning=!0,this.options=Object(s.a)(Object(s.a)(Object(s.a)({},rt),t),{tracingOrigins:r})}return e.prototype.setupOnce=function(e,t){var r=this;this._getCurrentHub=t,this._emitOptionsWarning&&(l.a.warn("[Tracing] You need to define `tracingOrigins` in the options. Set an array of urls or patterns to trace."),l.a.warn("[Tracing] We added a reasonable default for you: "+Ze.tracingOrigins));var n=this.options,i=n.routingInstrumentation,a=n.startTransactionOnLocationChange,o=n.startTransactionOnPageLoad,s=n.markBackgroundTransactions,c=n.traceFetch,u=n.traceXHR,d=n.tracingOrigins,h=n.shouldCreateSpanForRequest;i((function(e){return r._createRouteTransaction(e)}),o,a),s&&(De&&De.document?De.document.addEventListener("visibilitychange",(function(){var e=Object(Pe.b)();De.document.hidden&&e&&(l.a.log("[Tracing] Transaction: "+Ie.a.Cancelled+" -> since tab moved to the background, op: "+e.op),e.status||e.setStatus(Ie.a.Cancelled),e.setTag("visibilitychange","document.hidden"),e.finish())})):l.a.warn("[Tracing] Could not set up background tab detection due to lack of global document")),et({traceFetch:c,traceXHR:u,tracingOrigins:d,shouldCreateSpanForRequest:h})},e.prototype._createRouteTransaction=function(e){var t=this;if(this._getCurrentHub){var r=this.options,n=r.beforeNavigate,i=r.idleTimeout,a=r.maxTransactionDuration,o="pageload"===e.op?function(){var e=(t="sentry-trace",r=document.querySelector("meta[name="+t+"]"),r?r.getAttribute("content"):null);var t,r;if(e)return Object(Pe.a)(e);return}():void 0,c=Object(s.a)(Object(s.a)(Object(s.a)({},e),o),{trimEnd:!0}),u="function"==typeof n?n(c):c,d=void 0===u?Object(s.a)(Object(s.a)({},c),{sampled:!1}):u;!1===d.sampled&&l.a.log("[Tracing] Will not send "+d.op+" transaction because of beforeNavigate.");var h=this._getCurrentHub(),f=Object(Ce.b)(h,d,i,!0);return l.a.log("[Tracing] Starting "+d.op+" transaction on scope"),f.registerBeforeFinishCallback((function(e,r){t._metrics.addPerformanceEntries(e),function(e,t,r){var n=r-t.startTimestamp;r&&(n>e||n<0)&&(t.setStatus(Ie.a.DeadlineExceeded),t.setTag("maxTransactionDurationExceeded","true"))}(Object(Pe.e)(a),e,r)})),f}l.a.warn("[Tracing] Did not create "+e.op+" transaction because _getCurrentHub is invalid.")},e.id="BrowserTracing",e}();var it=function(){function e(t){void 0===t&&(t={}),this.name=e.id,this._router=t.router||t.app,this._methods=(Array.isArray(t.methods)?t.methods:[]).concat("use")}return e.prototype.setupOnce=function(){this._router?function(e,t){void 0===t&&(t=[]);t.forEach((function(t){return function(e,t){var r=e[t];return e[t]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return r.call.apply(r,Object(s.e)([this],ot(e,t)))},e}(e,t)}))}(this._router,this._methods):l.a.error("ExpressIntegration is missing an Express instance")},e.id="Express",e}();function at(e,t){var r=e.length;switch(r){case 2:return function(r,n){var i=n.__sentry_transaction;if(i){var a=i.startChild({description:e.name,op:"middleware."+t});n.once("finish",(function(){a.finish()}))}return e.call(this,r,n)};case 3:return function(r,n,i){var a,o=null===(a=n.__sentry_transaction)||void 0===a?void 0:a.startChild({description:e.name,op:"middleware."+t});e.call(this,r,n,(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];null===(e=o)||void 0===e||e.finish(),i.call.apply(i,Object(s.e)([this],t))}))};case 4:return function(r,n,i,a){var o,c=null===(o=i.__sentry_transaction)||void 0===o?void 0:o.startChild({description:e.name,op:"middleware."+t});e.call(this,r,n,i,(function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];null===(e=c)||void 0===e||e.finish(),a.call.apply(a,Object(s.e)([this],t))}))};default:throw new Error("Express middleware takes 2-4 arguments. Got: "+r)}}function ot(e,t){return e.map((function(e){return"function"==typeof e?at(e,t):Array.isArray(e)?e.map((function(e){return"function"==typeof e?at(e,t):e})):e}))}var st,ct=r(27),ut=r(28),lt=r(29),dt=Object(s.a)(Object(s.a)({},a),{BrowserTracing:nt});Object(Ce.a)();var ht=new Uint8Array(16);function ft(){if(!st&&!(st="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return st(ht)}var pt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var gt=function(e){return"string"==typeof e&&pt.test(e)},mt=[],vt=0;vt<256;++vt)mt.push((vt+256).toString(16).substr(1));var yt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(mt[e[t+0]]+mt[e[t+1]]+mt[e[t+2]]+mt[e[t+3]]+"-"+mt[e[t+4]]+mt[e[t+5]]+"-"+mt[e[t+6]]+mt[e[t+7]]+"-"+mt[e[t+8]]+mt[e[t+9]]+"-"+mt[e[t+10]]+mt[e[t+11]]+mt[e[t+12]]+mt[e[t+13]]+mt[e[t+14]]+mt[e[t+15]]).toLowerCase();if(!gt(r))throw TypeError("Stringified UUID is invalid");return r};var bt=function(e,t,r){var n=(e=e||{}).random||(e.rng||ft)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return yt(n)},_t=function(e){var t=document.createElement("DIV");return t.innerHTML=e,t},wt=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){console.log("Not found")},o=new XMLHttpRequest;o.responseType="json",o.onreadystatechange=function(){4!==o.readyState||200!==o.status&&204!==o.status?4===o.readyState&&a():r(o.response)},o.open(t,e,!0),null!==n&&o.setRequestHeader("Authorization","Bearer "+n),o.send(i)};function Et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return St(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return St(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function St(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e,t,r){return t&&Tt(e.prototype,t),r&&Tt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ot(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var At=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=kt((function e(){Ot(this,e)})),n=new r;return n.startMessage=e,n.defaultStartMessage=e,n.addAttribute=function(e,t){n.attributes[e]=t},n.addAttributes=function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var i=Et(r[t],2),a=i[0],o=i[1];n.attributes[a]=o}},n.resetAttributes=function(){n.attributes={clientType:"web",clientScreen:!0},n.addAttributes(t)},n.resetAttributes(),n.getAttribute=function(e){return n.attributes[e]},n.getAttributes=function(){return n.attributes},n.setMessage=function(e){n.startMessage=e},n.getMessage=function(){return n.startMessage},n};function xt(e){return function(e){if(Array.isArray(e))return Rt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Rt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Lt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(r),!0).forEach((function(t){It(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ct(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function It(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Pt,Dt,jt="",Mt="5f7db5f1e662e830b20dbe7c",Nt="https://studio".concat(jt,".flowstorm.ai"),Ft="https://core".concat(jt,".flowstorm.ai"),Ut=void 0,Bt=void 0,Gt=new Re.Converter,Ht=new At,zt=!1,Kt={},qt=/https:\/\/core(-([0-9]+|preview)){0,1}.flowstorm.ai\/file\/tts\/[0-9a-f]+\.wav/g,Vt={guiMode:"chat",fullScreen:!1,widgetSize:{width:"400px",height:"700px"},imageAverageColorOpacity:.5,backgroundImageBlur:0,textInputEnabled:!0,collapsable:!0,backgroundAdvancedAnimationParticlesCount:5,animationSpeed:500,backgroundSimpleAnimation:!0,collapsed:!0,mode:"voice",inputTypeSelect:!1,sections:["LOGIN","SOP","QUESTION"]},Wt={allowUrlParams:!1,botKey:Mt,customCssClass:null,domain:"",startMessage:void 0,jwtToken:null,attributes:{},callback:{},coreUrl:Ft,autoStart:!1,ttsFileType:"mp3"},Yt=void 0,Xt=void 0,$t={},Jt=!0,Qt=!1,Zt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Te({dsn:"https://da1caa885aee4032898d553d1129571b@o318069.ingest.sentry.io/5438705",integrations:[new dt.BrowserTracing],tracesSampleRate:1,environment:jt});var t=new URLSearchParams(window.location.search),r=Lt(Lt(Lt({},Wt),Vt),e),n=r,i=n.allowUrlParams,a=n.startMessage;if(Mt=r.botKey,Qt=r.textInputEnabled,r.textInputEnabled=!1,Ht=new At(a,r.attributes),i){var o={};xt(t.entries()).forEach((function(e){return o[e[0]]=e[1]}));var s=t.get("key");25===window.location.pathname.length?Mt=window.location.pathname.substring(1):null!==s&&24===s.length&&(Mt=s);var c=null===t.get("animObjects")?5:parseInt(t.get("animObjects")),u=null===t.get("animate")||"true"===t.get("animate"),l=t.get("avatarURL"),d=u?500:0;r=Lt(Lt({},r),{},{backgroundAdvancedAnimationParticlesCount:c,backgroundSimpleAnimation:u,animationSpeed:d,avatarURL:l},o)}var h=er(r);if(h)rr(h,r),sr(),Yt.getInAudio||h.setInputMode("text");else{var f=r,p=f.elementId,g=void 0===p?null:p;console.error('Element with ID "'.concat(g,'" was not found in DOM. Cannot initialize BOT UI. Use existing element with ID or remove elementId property from initialization.'))}return or},er=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.elementId,r=void 0===t?null:t,n=e.customCssClass,i=void 0===n?null:n;if(null===r){var a=document.createElement("div");r="fs-client-".concat(bt()),a.setAttribute("id",r),document.body.appendChild(a)}if(null!==i){i=i.toString().split(/[ ,;]+/);var o,s=document.getElementById(r);if(s)(o=s.classList).add.apply(o,xt(i))}var c=new xe.a(r,e);if(c.setUserText(),!(Pt=xe.a.element))return null;var u=new MutationObserver((function(e){e.forEach((function(e){"attributes"===e.type&&tr(e.target)}))}));return u.observe(Pt,{attributes:!0}),e.avatarURL&&(c.setWebRtcAvatar(e.avatarURL),e.ttsFileType="wav"),c},tr=function(e){var t=e.dataset.collapsable,r=Pt.querySelector("[data-play]");if("collapsed"===t)Dt&&(Dt.style.display="none"),r&&(r.style.display="none");else{if(Dt){var n=Dt.querySelector("[data-fs-bot-modal-consent]"),i=Pt.getBoundingClientRect().height,a=getComputedStyle(Pt).paddingBottom;n.style.height=3*(i-parseInt(a,10))/5+"px",Dt.style.display="block"}r&&(r.style.display="block")}},rr=function(e,t){var r=$t.status,n=void 0===r?void 0:r;window.addEventListener("message",(function(e){"BotStopEvent"===e.data&&h.onEnd()})),e.disableStop("SLEEPING"===n);var i,a,o={setStatus:function(r){$t=r,"LISTENING"===r.status?(console.log(t.mode),e.setOutputAudio(1,t.mode,zt)):e.setInputAudio(1),gr("SLEEPING"===r.status||"PAUSED"===r.status||!r.status,e),e.disableStop("SLEEPING"===r.status),"SLEEPING"===r.status&&e.setMicIcon(!1)},getStatusString:function(e){return e},addMessage:function(r,n,i,a,o){if("sent"===r)null!==n&&e.setUserText(n);else{Jt=!0,e.expand(),Jt=!1,xe.a.botTextKioskElement&&(xe.a.botTextKioskElement.style.transition="transform 0s linear 0s",xe.a.botTextKioskElement.style.transform="translateY(0px)");var s=Pt.querySelector("[data-play]");null!==s&&s.remove(),e.setBotText(n),window.setTimeout((function(){var e="portrait"===xe.a.orientation?window.innerHeight/2:window.innerHeight;if(xe.a.botTextKioskElement&&xe.a.botTextKioskElement.scrollHeight>e){var t=e-xe.a.botTextKioskElement.scrollHeight;xe.a.botTextKioskElement.style.transition="transform "+-t/120+"s linear 3s",xe.a.botTextKioskElement.style.transform="translateY("+t+"px)"}}),xe.a.settings.animationSpeed+5)}null!=i&&e.setImage(i),null!=a&&a!==Xt&&(Xt=a,t.avatarURL?e.sendRTCData({Background:a}):a.startsWith("#")?e.setBackgroundColor(a):e.setBackgroundImage(a))},addVideo:function(t,r){e.setVideo(t,r)},addLogs:function(e){e.forEach((function(e){console.log(e.text)}))},onError:function(e){console.log(e),ie(e.message)},onEnd:function(){e.setBotText(),e.setUserText(),e.setInputAudio(null),e.setImage(null),dr(e),e.sendRTCData({Expression:{Name:"neutral"}}),Yt.sessionEnded&&sr()},handleCommand:function(r,n){var i=JSON.parse(n);switch(r){case"#expression":e.sendRTCData({Expression:{Name:i.name}});break;case"#animation":case"#gesture":e.sendRTCData({Animation:i.name});break;case"#snow":e.sendRTCData({Snowing:i.snowing});break;case"#transition":e.sendRTCData({Transition:""});break;case"#shirt":e.sendRTCData({ChangeShirt:i.state});break;case"#level":e.sendRTCData({Level:i.name+"Level"});break;case"#avatar":e.sendRTCData({Character:i.name});break;case"#walk":e.sendRTCData({Walk:i.action});break;case"#actions":zt=!0,i.tiles.forEach((function(r){e.setButton(r.background,(function(){"LISTENING"!==ir()&&"RESPONDING"!==ir()||Yt.handleOnTextInput("#".concat(r.action),null,{buttonInput:!0}),Yt.setInAudio("text"!==t.mode),zt=!1}),i.title.replaceAll(" ","")),Yt.setInAudio(!1)}))}},getAttributes:function(){var e=Ht.getAttributes();return Ht.resetAttributes(),e},getUUID:function(){return bt()},getVoice:function(){},focusOnNode:function(){},play:function(e){"in"!==e&&"out"!==e||Kt[e].play()}},s=function(e){var t=ir();if(null!=Yt){if("Input"===e)return;Yt.outAudio(t)}},c=function(){Yt.onStopClick(),t.avatarURL&&e.sendRTCData({Stop:""}),h.onEnd()},u=function(){var r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=$t,i=n.status,a=void 0===i?void 0:i;console.log(a);var o=!1;switch(a){case"SLEEPING":r||ar();break;case"LISTENING":Yt.setInAudio(!1),Yt.inAudio(a),gr(o=!o,e);break;case"RESPONDING":Yt.pause(),t.avatarURL&&(e.sendRTCData({Pause:"true"}),e.removeOverlay());break;case"PAUSED":Yt.resume(),t.avatarURL&&(e.sendRTCData({Pause:"false"}),Yt.setInAudio("text"!==t.mode),e.resume(t.mode,zt));break;case void 0:xe.a.avatarElement.children[0]&&xe.a.avatarElement.children[0].play(),ar()}},l=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}("deviceId");if(null===l){var d=t.domain;(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"/",i=new Date(Date.now()+31556952e4).toUTCString();document.cookie="".concat(e,"=").concat(t,";expires=").concat(i,";domain=").concat(r,";path=").concat(n)})("deviceId",l=Math.abs((i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,Math.floor(Math.random()*(a-i))+i)).toString(36),d)}t.jwtToken?(Ut=t.jwtToken,ur(e)):cr(l,(function(t){t.id,Ut=t.access,ur(e)})),e.chatInputCallback=function(e){"SLEEPING"===ir()||function(e){e=e.trim();var t=ir();if(""!==e&&("LISTENING"===t||"RESPONDING"===t)){var r="LISTENING"===t;Yt.handleOnTextInput(e,r)}}(e)},e.chatMicrophoneCallback=function(e){return s("Input")},e.chatMuteCallback=function(e){return s("Output")},e.chatArrowCallback=function(r){return function(){var r=ir();t.avatarURL&&e.sendRTCData({Stop:""}),Yt.click(r)}()},e.chatPlayCallback=function(e){Jt=!Jt,u()},e.chatSopNextCallback=function(e){var t=ir();console.log(t),void 0!==t&&"SLEEPING"!==t&&Yt.handleOnTextInput("yes",null,{sopInput:!0})},e.chatBackCallback=function(t){e.previousSection()},e.chatMicCallback=function(t){var r=ir();"SLEEPING"===r||void 0===r?(u(),e.setMicIcon(!0)):c()},e.chatKeyboardCallback=function(r){var n=t.mode;t.mode="text"===n?"voice":"text",e.setInputMode(n),Yt.setInAudio("text"!==t.mode)},e.chatStopCallback=function(e){return c()},e.chatTextInputElementCallback=function(e){var t=ir();"LISTENING"===t?Yt.closeAudioStream("User started typing",!0):"RESPONDING"===t&&Yt.startTyping()},e.dataChannelMessageCallback=function(e){1===e[0]&&function(e){switch(e){case"AudioEnded":case"AnimEnded":Yt.addRecord();break;default:console.log("Received data channel response",e)}}(new TextDecoder("utf-16").decode(e.slice(1)))},e.collapsableTriggerCallback=function(e){var t=ir();!Jt&&t&&u(!0)};var h=Lt(Lt({},o),t.callback);return Yt=Oe()(t.coreUrl,l,t.autoStart,h,!1,t.ttsFileType),t.avatarURL&&(Yt.playAudio=function(t){if(null===t)Yt.addRecord();else if(t.match(qt))e.sendRTCData({PCM:t});else{var r=new Audio(t);r.onended=Yt.addRecord,r.play()}}),Yt},nr=function(){var e=Ht.getMessage(),t=new URLSearchParams(window.location.search);return e?(Ht.setMessage(Ht.defaultStartMessage),e):window.location.hash?window.location.hash:null!==t.get("text")?"#".concat(t.get("text")):"#intro"},ir=function(){var e=$t.status;return void 0===e?void 0:e},ar=function(){var e=ir();void 0!==e&&"SLEEPING"!==e||Yt.handleOnTextInput(nr(),!1)},or=function(e,t){Ht.addAttributes(t),Ht.setMessage(e),ar()},sr=function(){Yt?Yt.init(Mt,"en",!0,!0,nr(),void 0,void 0,void 0,Ut):(!function(e,t){var r;try{throw new Error(e)}catch(e){r=e}var n="string"!=typeof t?{captureContext:t}:void 0;ne("captureMessage",e,"string"==typeof t?t:void 0,Object(s.a)({originalException:e,syntheticException:r},n))}("Bot is undefined"),console.error("There was an unexpected error with the bot. Please try reloading the page."))},cr=function(e,t){wt(Nt+"/auth/"+e,"GET",t)},ur=function(e){wt(Nt+"/user/signupAnonymous","POST",(function(){lr(Mt,e)}),Ut,null,(function(){lr(Mt,e)}))},lr=function(e,t){wt(Nt+"/terms/application/"+e,"GET",(function(e){null===e?dr(t):(Bt=e._id,hr(t))}),Ut,null,(function(){dr(t)}))},dr=function(e){if(Qt)e.setTextInputEnabled(Qt),gr(!0,e);else{xe.a.element.style.setProperty("--bot-ui-chat-input-height",xe.a.element.style.getPropertyValue("--bot-ui-chat-pcm-height"));var t=_t('\n    <div class="fs-client-play" title="Start" data-play></div>\n');Pt.append(t),Pt.querySelector("[data-play]").onclick=function(e){pr()&&xe.a.settings.fullScreen&&(document.body.requestFullScreen?document.body.requestFullScreen():document.body.mozRequestFullScreen?document.body.mozRequestFullScreen():document.body.webkitRequestFullScreen&&document.body.webkitRequestFullScreen()),xe.a.avatarElement.children[0]&&xe.a.avatarElement.children[0].play(),ar(),e.target.remove()},Pt.querySelector("[data-play]").style.display="block",tr(Pt)}},hr=function(e){var t=_t('\n    <div class="fs-client-modal" data-fs-bot-modal>\n        <div class="fs-client-modal-content">\n            <div class="fs-client-modal-header"></div>\n            <div class="fs-client-consent" data-fs-bot-modal-consent></div>\n            <div class="fs-client-modal-body fs-client-consent-text">\n                <strong>Do you consent to these terms?</strong>\n            </div>\n            <div class="fs-client-modal-footer fs-client-consent-buttons">\n                <button class="fs-client-consent-button" data-fs-bot-consent-button>I consent</button>\n            </div>\n        </div>\n    </div>\n');Pt.append(t),Dt=t.querySelector("[data-fs-bot-modal]");var r=function(){Dt.remove(),Dt=null,dr(e)};t.querySelector("[data-fs-bot-consent-button]").onclick=function(){fr((function(){r()}))},wt(Nt+"/terms/"+Bt+"/consent","GET",(function(e){r()}),Ut,null,(function(){wt(Nt+"/terms/"+Bt,"GET",(function(e){var t=Dt.querySelector("[data-fs-bot-modal-consent]"),r=Gt.makeHtml(e.text);t.innerHTML=r,tr(Pt)}),Ut)}))},fr=function(e){wt(Nt+"/terms/"+Bt+"/consent","POST",e,Ut)},pr=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},gr=function(e,t){e?t.setPlayIcon("icon--content--play"):t.setPlayIcon("icon--content--pause")}},,,,function(e,t,r){"use strict";var n;r.d(t,"a",(function(){return n})),function(e){e.Ok="ok",e.Exited="exited",e.Crashed="crashed",e.Abnormal="abnormal"}(n||(n={}))}])}));